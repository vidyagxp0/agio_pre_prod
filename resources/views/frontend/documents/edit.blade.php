@extends('frontend.layout.main')
@section('container')
    <link href='https://cdn.jsdelivr.net/npm/froala-editor@latest/css/froala_editor.pkgd.min.css' rel='stylesheet'
        type='text/css' />
    <script type='text/javascript' src='https://cdn.jsdelivr.net/npm/froala-editor@latest/js/froala_editor.pkgd.min.js'>
    </script>
    <style>
        #fr-logo {
            display: none;
        }

        .fr-logo {
            display: none;
        }

        textarea.note-codable {
            display: none !important;
        }

        .sop-type-header {
            display: grid;
            grid-template-columns: 135px 1fr;
            border: 2px solid #000000;
            margin-bottom: 20px;
        }

        .main-head {
            display: grid;
            place-items: center;
            align-content: center;
            font-size: 1.2rem;
            font-weight: 700;
            border-left: 2px solid #000000;
        }

        .sub-head-2 {
            text-align: center;
            background: #4274da;
            margin-bottom: 20px;
            padding: 10px 20px;
            font-size: 1.5rem;
            color: #fff;
            border: 2px solid #000000;
            border-radius: 40px;
        }

        #displayField {
            border: 1px solid #f0f0f0;
            background: white;
            padding: 20px;
            position: relative;
            display: flex;
            align-items: center;
            list-style-type: none;
        }

        #displayField li {
            margin-left: 1rem;
            background-color: #f0f0f0;
            padding: 5px;
        }

        .close-icon {
            color: red;
            margin-left: auto;
            /* Pushes the icon to the right */
            cursor: pointer;
        }

        div.note-modal-footer>input {
            background: black;
        }
         .hidden-tabs{
            display:none;
         }
    </style>


    {{-- <script>
        document.addEventListener("DOMContentLoaded", function () {
            let docTypeSelect = document.getElementById("doc-type");

            function showMatchingTabs(docTypeId) {
                let allTabs = document.querySelectorAll(".hidden-tabs");

                allTabs.forEach(tab => {
                    if (tab.dataset.id === docTypeId) {
                        tab.style.display = "inline-block";
                    } else {
                        tab.style.display = "none";
                    }
                });
            }

            if (docTypeSelect.value) {
                showMatchingTabs(docTypeSelect.value);
            }

            docTypeSelect.addEventListener("change", function () {
                showMatchingTabs(this.value);
            });
        });

        function openData(evt, tabName) {
            var i, tabcontent, tablinks;

            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }

            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script> --}}

<script>
        document.addEventListener("DOMContentLoaded", function () {
            let docTypeSelect = document.getElementById("doc-type");
            let allTabs = document.querySelectorAll(".hidden-tabs");

            function showMatchingTabs(docTypeId) {
                allTabs.forEach(tab => {
                    tab.style.display = "none";
                    if (tab.dataset.id === docTypeId) {
                        tab.style.display = "inline-block";
                    }
                });
            }

            if (docTypeSelect.value) {
                showMatchingTabs(docTypeSelect.value);
            }

            docTypeSelect.addEventListener("change", function () {
                showMatchingTabs(this.value);
            });
        });
    </script>

  <style>

        /*Main Table Styling */
        #isPasted {
            width: 650px !important;
        border-collapse: collapse;
        table-layout: auto; /* Adjusts column width dynamically */
    }

    /* First column adjusts to its content */
    #isPasted td:first-child,
    #isPasted th:first-child {
        white-space: nowrap; /* Prevent wrapping */
        width: 1%; /* Shrink to fit content */
        vertical-align: top;
    }

    /* Second column takes remaining space */
    #isPasted td:last-child,
    #isPasted th:last-child {
        width: auto; /* Take remaining space */
        vertical-align: top;

    }

    /* Common Table Cell Styling */
    #isPasted th,
    #isPasted td {
        border: 1px solid #000 !important;
        padding: 8px;
        text-align: left;
        max-width: 500px;
    word-wrap: break-word;
    overflow-wrap: break-word;
    }

    /* Paragraph Styling Inside Table Cells */
    #isPasted td > p {
        text-align: justify;
        text-justify: inter-word;
        margin: 0;
        max-width: 500px;
    word-wrap: break-word;
    overflow-wrap: break-word;
    }

    #isPasted img {
        max-width: 500px !important; /* Ensure image doesn't overflow the cell */
        height: 100%; /* Maintain image aspect ratio */
        display: block; /* Remove extra space below the image */
        margin: 5px auto; /* Add spacing and center align */
    }

    /* If you want larger images */
    #isPasted td img {
        max-width: 400px !important; /* Adjust this to your preferred maximum width */
        height: 300px;
        margin: 5px auto;
    }
    </style>

    <div id="data-fields">
        <div class="container-fluid">
            <div class="tab">
                <button class="tablinks active" onclick="openData(event, 'doc-info')" id="defaultOpen">Document Information</button>
                <button class="tablinks" onclick="openData(event, 'add-doc')">Training Information</button>
                <button class="tablinks" onclick="openData(event, 'doc-content')">Document Content</button>

                <!-- Hidden Tabs (Only Show Based on document_type_id) -->
                <button class="tablinks hidden-tabs" data-id="FPS" onclick="openData(event, 'doc_FPS')">Finished Product Specification</button>
                <button class="tablinks hidden-tabs" data-id="INPS" onclick="openData(event, 'doc_INPS')">Inprocess Specification</button>
                <button class="tablinks hidden-tabs" data-id="CVS" onclick="openData(event, 'doc_CVS')">Cleaning Validation Specification</button>

                <button class="tablinks hidden-tabs" data-id="FPSTP" onclick="openData(event, 'doc-fpstp')">Finished Product Standard Testing Procedure</button>
                <button class="tablinks hidden-tabs" data-id="INPSTP" onclick="openData(event, 'doc-istp')">Inprocess Standard Testing Procedure</button>
                <button class="tablinks hidden-tabs" data-id="CVSTP" onclick="openData(event, 'doc-cvstp')">Cleaning Validation Standard Testing Procedure</button>

                <button class="tablinks hidden-tabs" data-id="TEMPMAPPING" onclick="openData(event, 'doc-tempmapping')">Temperature Mapping Report</button>
                <button class="tablinks hidden-tabs" data-id="HOLDTIMESTUDYREPORT" onclick="openData(event, 'doc-holdtimstduy')">Hold Time Study Report</button>

                <button class="tablinks hidden-tabs" data-id="HOLDTIMESTUDYPROTOCOL" onclick="openData(event, 'doc-htsp')">Hold Time Study Protocol</button>
                <button class="tablinks hidden-tabs" data-id="PACKVALIPROTOCOL" onclick="openData(event, 'doc-pvp')">Packing validation Protocol</button>
                <button class="tablinks hidden-tabs" data-id="PACKVALIREPORT" onclick="openData(event, 'doc-PacValRep')">Packing Validation Report</button>
                <button class="tablinks hidden-tabs" data-id="FOCONITOGENPROTOCOL" onclick="openData(event, 'doc-FoCoANGsP')">Format For Compressed Air And Nitrogen Gas System Protocol</button>

                <button class="tablinks hidden-tabs" data-id="PROVALIPROTOCOL" onclick="openData(event, 'doc_prvp')">Process Validation Protocol</button>

                <button class="tablinks hidden-tabs" data-id="RMSTP" onclick="openData(event, 'doc_rmstp')">Raw Material Standard Testing Procedure</button>
                <button class="tablinks hidden-tabs" data-id="RAWMS" onclick="openData(event, 'doc-rawms')">Raw Material Specification</button>
                <button class="tablinks hidden-tabs" data-id="PAMS" onclick="openData(event, 'doc_pams')">PACKING MATERIAL SPECIFICATION</button>
                <button class="tablinks hidden-tabs" data-id="PROCUMREPORT" onclick="openData(event, 'doc_PCR')">Protocol Cum Report</button>
                {{-- <button class="tablinks hidden-tabs" data-id="TEMPMAPPING" onclick="openData(event, 'doc-temper_maping')">Temperature Mapping Protocol Cum Report</button> --}}
                <button class="tablinks hidden-tabs" data-id="PIAS" onclick="openData(event, 'doc_pias')">Product / Item Information-Addendum Specification</button>
                <button class="tablinks hidden-tabs" data-id="TDS" onclick="openData(event, 'doc-tds')">Test Data Sheet</button>
                <button class="tablinks hidden-tabs" data-id="GTP" onclick="openData(event, 'doc-gtp')">General Testing Procedure</button>
                <button class="tablinks hidden-tabs" data-id="MFPS" onclick="openData(event, 'doc-mfps')">Master Finished Product Specification</button>
                <button class="tablinks hidden-tabs" data-id="MFPSTP" onclick="openData(event, 'doc-mfpstp')">Master Finished Product Standard Testing Procedure</button>
                <button class="tablinks hidden-tabs" data-id="STUDY" onclick="openData(event, 'doc-study')">Study Report</button>
                <button class="tablinks hidden-tabs" data-id="STUDYPROTOCOL" onclick="openData(event, 'doc-stprotocol')">Study Protocol</button>
                <button class="tablinks hidden-tabs" data-id="EQUIPMENTHOLDREPORT" onclick="openData(event, 'doc-eqpreport')">Equipment Hold Time Study Report</button>

                <button class="tablinks hidden-tabs" data-id="EQUIPMENTHOLDPROTOCOL" onclick="openData(event, 'doc-eqpprotocol')">Equipment Hold Time Study Protocol</button>
                <button class="tablinks hidden-tabs" data-id="FOCONITOGENREPORT" onclick="openData(event, 'doc-fcreport')">Format for compressed air and Nitrogen gas system Report</button>

                <button class="tablinks hidden-tabs" data-id="PROVALIDRE" onclick="openData(event, 'doc_pvr')">Process Validation Report</button>

                <button class="tablinks hidden-tabs" data-id="CLEAVALIPROTODOC" onclick="openData(event, 'doc_cvpd')">Cleaning Validation Protocol</button>
                <button class="tablinks hidden-tabs" data-id="CLEAVALIREPORTDOC" onclick="openData(event, 'doc_cvrd')">Cleaning Validation Report</button>
                <button class="tablinks hidden-tabs" data-id="STABILITYPROTOCOL" onclick="openData(event, 'doc_ssp')">STABILITY STUDY PROTOCOL</button>
                <button class="tablinks hidden-tabs" data-id="VMP" onclick="openData(event, 'doc_vmp')">Validation Master Plan</button>
                <button class="tablinks hidden-tabs" data-id="QM" onclick="openData(event, 'doc_qm')">Quality Manual </button>
                <button class="tablinks hidden-tabs" data-id="QUALIPROCUMREP" onclick="openData(event, 'doc_qpcr')">Qualification Protocol Cum Report</button>

                <button class="tablinks hidden-tabs" data-id="PROVALIINTERRE" onclick="openData(event, 'doc_proc_interim')">Process Validation Interim Report</button>

                <button class="tablinks hidden-tabs" data-id="ANNIGxPASSES" onclick="openData(event, 'doc_Annexure_I')">Annexure I-Gxp Assessment</button>
                <button class="tablinks hidden-tabs" data-id="ANNIIRiskASSES" onclick="openData(event, 'doc_Annexure_II')">Annexure II-Initial Risk Assessment</button>
                <button class="tablinks hidden-tabs" data-id="ANNIIIERESASSES" onclick="openData(event, 'doc_Annexure_III')">Annexure III-ERES Assessment</button>
                <button class="tablinks hidden-tabs" data-id="ANNIVPlanASSES" onclick="openData(event, 'doc_Annexure_IV')">Annexure IV-Validation Plan</button>
                <button class="tablinks hidden-tabs" data-id="ANNVUserReqSpe" onclick="openData(event, 'doc_Annexure_V')">Annexure V-User Requirements Specification</button>
                <button class="tablinks hidden-tabs" data-id="ANNVIFunReqSpe" onclick="openData(event, 'doc_Annexure_VI')">Annexure VI-Functional Requirement Specification</button>
                <button class="tablinks hidden-tabs" data-id="ANNVIIFunSpe" onclick="openData(event, 'doc_Annexure_VII')">Annexure VII-Functional Specification</button>
                <button class="tablinks hidden-tabs" data-id="ANNVIIITechSpe" onclick="openData(event, 'doc_Annexure_VIII')">Annexure VIII-Technical Specification</button>
                <button class="tablinks hidden-tabs" data-id="ANNIXFunRiskASSES" onclick="openData(event, 'doc_Annexure_IX')">Annexure IX Functional Risk Assssment</button>
                <button class="tablinks hidden-tabs" data-id="ANNXDesignSpe" onclick="openData(event, 'doc_Annexure_X')">Annexure X-Design Specification</button>


                <button class="tablinks hidden-tabs" data-id="ANNXIConfiSpe" onclick="openData(event, 'doc_Annexure_XI')">Annexure XI Configuration Specification</button>
                <button class="tablinks hidden-tabs" data-id="ANNXIIQualiProto" onclick="openData(event, 'doc_Annexure_XII')">Annexure XII Installation Infrastructure Operational Performance Qualification Protocol</button>
                <button class="tablinks hidden-tabs" data-id="ANNXIIIUnitInTest" onclick="openData(event, 'doc_Annexure_XIII')">Annexure XIII Unit Integration Test Script</button>
                <button class="tablinks hidden-tabs" data-id="ANNXIVDataMigPro" onclick="openData(event, 'doc_Annexure_XIV')">Annexure XIV Data Migration Protocol</button>
                <button class="tablinks hidden-tabs" data-id="ANNXVPerfQualif" onclick="openData(event, 'doc_Annexure_XV')">Annexure XV Data Qualification Protocol</button>

                <button class="tablinks hidden-tabs" data-id="ANNEQUALPROTO" onclick="openData(event, 'doc-afqp')">Annexure For Qualification Protocol</button>
                <button class="tablinks hidden-tabs" data-id="ANNEQUALREPORT" onclick="openData(event, 'doc-afqr')">Annexure For Qualification Report</button>
                <button class="tablinks hidden-tabs" data-id="AAEUSERREQUESPECI" onclick="openData(event, 'doc-afurs')">Annexure For User Requirement Specification</button>
                <button class="tablinks hidden-tabs" data-id="REQULIFICATIONPROTOCOL" onclick="openData(event, 'doc-aqp')">Area Qualification Protocol</button>
                <button class="tablinks hidden-tabs" data-id="AREAQUALIFICATIONREPORT" onclick="openData(event, 'doc-aqr')">Area Qualification Report</button>
                <button class="tablinks hidden-tabs" data-id="PROTOCOLFORMEDIAFILL" onclick="openData(event, 'doc-pfmf')">Protocol For Media Fill</button>
                <button class="tablinks hidden-tabs" data-id="REPORTFORMEDIAFILL" onclick="openData(event, 'doc-rfmf')">Report For Media Fill</button>

                <button class="tablinks hidden-tabs" data-id="BOM" onclick="openData(event, 'doc-billofmaterial')">Bill Of Matrial</button>
                <button class="tablinks hidden-tabs" data-id="BMR" onclick="openData(event, 'doc-manufacturingRecord')">Batch Manufacturing Record (BMR)</button>
                <button class="tablinks hidden-tabs" data-id="MAForRec" onclick="openData(event, 'doc-masterformulaRecord')">Master Formul Record  </button>
                <button class="tablinks hidden-tabs" data-id="MAPacRec" onclick="openData(event, 'doc-masterPackingRecord')">Master Packing Record</button>
                <button class="tablinks hidden-tabs" data-id="SMF" onclick="openData(event, 'doc-SiteMasterFile')">Site Master File (SMF)</button>

                <button class="tablinks hidden-tabs" data-id="ANNEXUREXIXSYSTEMRETIREMENT" onclick="openData(event, 'doc-asr')">annexure-XIX - System Retirement</button>
                <button class="tablinks hidden-tabs" data-id="ANNEXUREXVIIITRACEABILITYMATRIX" onclick="openData(event, 'doc-atm')">annexure-XVIII - Traceability Matrix</button>
                <button class="tablinks hidden-tabs" data-id="ANNEXUREXVIIVALIDATION" onclick="openData(event, 'doc-avsr')">annexure-XVII - Validation Summary Report </button>
                <button class="tablinks hidden-tabs" data-id="ANNEXUREXVIINSTALLATION" onclick="openData(event, 'doc-aiiopq')">annexure-XVI - Installation_Infrastructure_Operational_Performance Qualification</button>

                <button class="tablinks" onclick="openData(event, 'annexures')">Annexures</button>
                <button class="tablinks" onclick="openData(event, 'distribution-retrieval')">Distribution & Retrieval</button>
                <button class="tablinks" onclick="openData(event, 'sign')">Signature</button>
                <button class="tablinks printdoc" style="float: right;" onclick="window.print();return false;">Print</button>
            </div>
            <form method="POST" action="{{ route('documents.update', $document->id) }}" enctype="multipart/form-data">
                @csrf
                @method('PUT')

                {{-- <textarea id="editor"><h1>Test</h1></textarea>
                <script>
                    const editor = Jodit.make('#editor');
                </script> --}}

                <!-- Tab content -->
                {{-- @foreach ($history as $tempHistory) --}}
                <div id="doc-info" class="tabcontent">
                    <div class="input-fields">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="originator">Originator</label>
                                    <div class="default-name">{{ $document->originator_name }}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="open-date">Date Opened</label>
                                    <div class="default-name"> {{ $document->date }}</div>
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="group-input">
                                    <label for="Division Code"><b>Site/Location Code</b></label>
                                    <input disabled type="text" name="division_code"
                                        value="{{ Helpers::getDivisionName($document->division_id) }}">
                                    {{-- <div class="static">{{ Helpers::getDivisionName(session()->get('division')) }}
                            </div> --}}
                                </div>
                            </div>
                          @if($document->document_type_id == 'SOP')
                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="document_name-desc">Document Name<span
                                            class="text-danger">*</span></label><span id="rchars">255</span>
                                    characters remaining
                                    <input type="text" name="document_name" id="docname" maxlength="255"
                                        {{ Helpers::isRevised($document->stage) }} value="{{ $document->document_name }}"
                                        required>
                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Document Name' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                        color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                                <p id="docnameError" style="color:red">**Document Name is required</p>
                            </div>

                              @if (Auth::user()->role != 3 && $document->stage < 8)
                                <div class="comment">
                                    <div>
                                        <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                            {{ date('d-M-Y h:i:s') }}
                                        </p>
                                        <input class="input-field" type="text" name="document_name_comment">
                                    </div>
                                    <div class="button">Add Comment</div>
                                </div>
                            @endif
                            @else
                            <div class="col-md-12"  style="display: none;">>
                                <div class="group-input">
                                    <label for="document_name-desc">Document Name<span
                                            class="text-danger">*</span></label><span id="rchars">255</span>
                                    characters remaining
                                    <input type="text" name="document_name" id="docname">

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Document Name' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                        color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                                <p id="docnameError" style="color:red; display: none;">**Document Name is required</p>
                            </div>
                            @endif


                            @if($document->document_type_id == 'SOP')
                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="short-desc">Short Description* </label>
                                    <span id="editrchars">255</span>
                                    characters remaining
                                    <input type="text" name="short_desc" id="short_desc" maxlength="255"
                                        {{ Helpers::isRevised($document->stage) }}
                                        value="{{ $document->short_description }}">
                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Short Description' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                                <p id="short_descError" style="color:red">**Short description is required</p>
                            </div>

                            @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                    class="comment">
                                    <div>
                                        <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                            {{ date('d-M-Y h:i:s') }}
                                        </p>

                                        <input class="input-field" type="text" name="short_desc_comment">
                                    </div>
                                    <div class="button">Add Comment</div>
                                </div>
                            @endif
                            @else
                                <div class="col-md-12" id="short-desc-container" style="display: none;">
                                    <div class="group-input">
                                        <label for="short-desc">Short Description* </label>
                                        <span id="editrchars">255</span> characters remaining
                                        <input type="text" name="short_desc" id="short_desc"
                                            value="{{ $document->short_description }}">
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Short Description' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at {{ $tempHistory->created_at }}</p>
                                                <input class="input-field" style="background: #ffff0061; color: black;" type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                    <p id="short_descError" style="color:red; display: none;">**Short description is required</p>
                                </div>
                            @endif


                            @if($document->document_type_id == 'SOP')
                            <div class="col-12">
                                <div class="group-input">
                                    <label for="sop_type">SOP Type</label>
                                    <select name="sop_type" id="sop_type" required onchange="updateSopTypeShort()"
                                        @if ($document->stage == 11 || $document->status == 'Obsolete') disabled @endif>
                                        <option value="" disabled {{ $document->sop_type == '' ? 'selected' : '' }}>
                                            Enter your selection</option>
                                        <option value="SOP (Standard Operating procedure)"
                                            {{ $document->sop_type == 'SOP (Standard Operating procedure)' ? 'selected' : '' }}>
                                            SOP (Standard Operating procedure)</option>
                                        <option value="EOP (Equipment Operating procedure)"
                                            {{ $document->sop_type == 'EOP (Equipment Operating procedure)' ? 'selected' : '' }}>
                                            EOP (Equipment Operating procedure)</option>
                                        <option value="IOP (Instrument Operating Procedure)"
                                            {{ $document->sop_type == 'IOP (Instrument Operating Procedure)' ? 'selected' : '' }}>
                                            IOP (Instrument Operating Procedure)</option>
                                    </select>
                                </div>
                                @if (Auth::user()->role != 3 && $document->stage < 8) Add Comment <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text" name="sop_type_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                    <input type="hidden" name="sop_type_short" id="sop_type_short"
                                        value="{{ $document->sop_type_short }}">

                                @endif
                            </div>
                                @else
                                <div class="col-12" style="display: none;">
                                    <div class="group-input">
                                        <label for="sop_type">SOP Type</label>
                                        <select name="sop_type" id="sop_type" onchange="updateSopTypeShort()"
                                            @if ($document->stage == 11 || $document->status == 'Obsolete') disabled @endif>
                                            <option value="" disabled {{ $document->sop_type == '' ? 'selected' : '' }}>
                                                Enter your selection</option>
                                            <option value="SOP (Standard Operating procedure)"
                                                {{ $document->sop_type == 'SOP (Standard Operating procedure)' ? 'selected' : '' }}>
                                                SOP (Standard Operating procedure)</option>
                                            <option value="EOP (Equipment Operating procedure)"
                                                {{ $document->sop_type == 'EOP (Equipment Operating procedure)' ? 'selected' : '' }}>
                                                EOP (Equipment Operating procedure)</option>
                                            <option value="IOP (Instrument Operating Procedure)"
                                                {{ $document->sop_type == 'IOP (Instrument Operating Procedure)' ? 'selected' : '' }}>
                                                IOP (Instrument Operating Procedure)</option>
                                        </select>
                                    </div>
                                </div>
                                @endif

                                <script>
                                    function updateSopTypeShort() {
                                        const sopType = document.getElementById('sop_type').value;
                                        let shortName = '';
                                        if (sopType === 'SOP (Standard Operating procedure)') {
                                            shortName = 'SOP';
                                        } else if (sopType === 'EOP (Equipment Operating procedure)') {
                                            shortName = 'EOP';
                                        } else if (sopType === 'IOP (Instrument Operating Procedure)') {
                                            shortName = 'IOP';
                                        }
                                        document.getElementById('sop_type_short').value = shortName;
                                    }
                                    window.onload = function() {
                                        updateSopTypeShort();
                                    }
                                </script>

                        @if($document->document_type_id == 'SOP')   
                            <div class="col-md-4 new-date-data-field">
                                <div class="group-input input-date">
                                    <label for="due-date">Due Date</label>
                                    <div><small class="text-primary">Kindly Fill Target Date of Completion</small>
                                    </div>
                                    <div class="calenderauditee">
                                        <input type="text" id="due_dateDoc"
                                            value="{{ $document->due_dateDoc ? Carbon\Carbon::parse($document->due_dateDoc)->format('d-M-Y') : '' }}"
                                            placeholder="DD-MMM-YYYY" />
                                        <input type="date" name="due_dateDoc"
                                            value="{{ $document->due_dateDoc ? Carbon\Carbon::parse($document->due_dateDoc)->format('Y-m-d') : '' }}"
                                            readonly {{ Helpers::isRevised($document->stage) }} class="hide-input"
                                            style="position: absolute; top: 0; left: 0; opacity: 0;"
                                            min="{{ Carbon\Carbon::today()->format('Y-m-d') }}"
                                            oninput="handleDateInput(this, 'due_dateDoc')" />
                                    </div>
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Due Date' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                            color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                                <p id="due_dateDocError" style="color:red">**Due Date is required</p>

                                @if (Auth::user()->role != 3 && $document->stage < 8)
                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="due_date_comment">
                                        </div>

                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif
                            </div>
                            @else
                            <div class="col-md-4 new-date-data-field" style="display: none;">
                                <div class="group-input input-date">
                                    <label for="due-date">Due Date</label>
                                    <div><small class="text-primary">Kindly Fill Target Date of Completion</small>
                                    </div>
                                    <div class="calenderauditee">
                                        <input type="text" id="due_dateDoc"
                                            value="{{ $document->due_dateDoc ? Carbon\Carbon::parse($document->due_dateDoc)->format('d-M-Y') : '' }}"
                                            placeholder="DD-MMM-YYYY" />
                                        <input type="date" name="due_dateDoc"
                                            value="{{ $document->due_dateDoc ? Carbon\Carbon::parse($document->due_dateDoc)->format('Y-m-d') : '' }}"/>
                                    </div>
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Due Date' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                            color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                                <p id="due_dateDocError" style="color:red; display: none;">**Due Date is required</p>
                                </div>
                            @endif 

                            @if($document->document_type_id == 'SOP') 
                            <div class="col-md-8">
                                <div class="group-input">
                                    <label for="notify_to">Notify To</label>
                                    <select multiple name="notify_to[]" placeholder="Select Persons" data-search="false"
                                        data-silent-initial-value-set="true" id="notify_to"
                                        {{ Helpers::isRevised($document->stage) }}>
                                        @php
                                            $notify_user_id = explode(',', $document->notify_to);
                                        @endphp
                                        @foreach ($users as $data)
                                            <option value="{{ $data->id }}"
                                                {{ in_array($data->id, $notify_user_id) ? 'selected' : '' }}>
                                                {{ $data->name }}
                                            </option>
                                        @endforeach
                                    </select>
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Notify To' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)
                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text" name="notify_to_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif
                            </div>
                            @else
                            <div class="col-md-8" style="display: none;">
                                <div class="group-input">
                                    <label for="notify_to">Notify To</label>
                                    <select multiple name="notify_to[]" placeholder="Select Persons" data-search="false"
                                        data-silent-initial-value-set="true" id="notify_to"
                                        {{ Helpers::isRevised($document->stage) }}>
                                        @php
                                            $notify_user_id = explode(',', $document->notify_to);
                                        @endphp
                                        @foreach ($users as $data)
                                            <option value="{{ $data->id }}"
                                                {{ in_array($data->id, $notify_user_id) ? 'selected' : '' }}>
                                                {{ $data->name }}
                                                {{-- ({{ $data->role }}) --}}
                                            </option>
                                        @endforeach
                                    </select>
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Notify To' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                              </div>
                            @endif    


                            @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                    class="comment">
                                    <div>
                                        <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                            {{ date('d-M-Y h:i:s') }}
                                        </p>

                                        <input class="input-field" type="text" name="description_comment">
                                    </div>
                                </div>
                            @endif

                        </div>
                    </div>
                    <div class="orig-head">
                        Document Information
                    </div>
                    <div class="input-fields">
                        <div class="row">

                            @if($document->document_type_id == 'SOP')
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="doc-num">Document Number</label>
                                        <input type="text" id="doc-num" name="document_number" class="default-name" readonly
                                            value="
                                            @if ($document->revised === 'Yes')
                                                @php
                                                    $revisionNumber = str_pad($document->revised_doc, 2, '0', STR_PAD_LEFT);
                                                @endphp

                                                @if(in_array($document->sop_type_short, ['EOP', 'IOP']))
                                                    {{ $document->department_id }}/{{ $document->sop_type_short }}/{{ str_pad($currentId, 3, '0', STR_PAD_LEFT) }}-{{ $revisionNumber }}
                                                @else
                                                    {{ $document->sop_type_short }}/{{ $document->department_id }}/{{ str_pad($currentId, 3, '0', STR_PAD_LEFT) }}-{{ $revisionNumber }}
                                                @endif
                                            @else
                                                @if(in_array($document->sop_type_short, ['EOP', 'IOP']))
                                                    {{ $document->department_id }}/{{ $document->sop_type_short }}/{{ str_pad($currentId, 3, '0', STR_PAD_LEFT) }}-00
                                                @else
                                                    {{ $document->sop_type_short }}/{{ $document->department_id }}/{{ str_pad($currentId, 3, '0', STR_PAD_LEFT) }}-00
                                                @endif
                                            @endif">
                                    </div>
                                </div>
                            @else
                                <div class="col-md-6" style="display: none;">
                                    <div class="group-input">
                                        <label for="doc-num">Document Number</label>
                                        <input type="text" id="doc-num" name="document_number" class="default-name" readonly
                                            value="
                                            @if ($document->revised === 'Yes')
                                                @php
                                                    $revisionNumber = str_pad($document->revised_doc, 2, '0', STR_PAD_LEFT);
                                                @endphp

                                                @if(in_array($document->sop_type_short, ['EOP', 'IOP']))
                                                    {{ $document->department_id }}/{{ $document->sop_type_short }}/{{ str_pad($currentId, 3, '0', STR_PAD_LEFT) }}-{{ $revisionNumber }}
                                                @else
                                                    {{ $document->sop_type_short }}/{{ $document->department_id }}/{{ str_pad($currentId, 3, '0', STR_PAD_LEFT) }}-{{ $revisionNumber }}
                                                @endif
                                            @else
                                                @if(in_array($document->sop_type_short, ['EOP', 'IOP']))
                                                    {{ $document->department_id }}/{{ $document->sop_type_short }}/{{ str_pad($currentId, 3, '0', STR_PAD_LEFT) }}-00
                                                @else
                                                    {{ $document->sop_type_short }}/{{ $document->department_id }}/{{ str_pad($currentId, 3, '0', STR_PAD_LEFT) }}-00
                                                @endif
                                            @endif">
                                    </div>
                                </div>
                            @endif

                            @if($document->document_type_id == 'SOP') 
                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="legacy_number">Legacy Document Number</label>
                                    <input type="text" id="legacy_number" name="legacy_number"
                                        value="{{ $document->legacy_number }}" maxlength="255"
                                        {{ Helpers::isRevised($document->stage) }}>
                                </div>
                            </div>
                            @else
                            <div class="col-md-6" style="display: none;">
                                <div class="group-input">
                                    <label for="legacy_number">Legacy Document Number</label>
                                    <input type="text" id="legacy_number" name="legacy_number"
                                        value="{{ $document->legacy_number }}" maxlength="255"
                                        {{ Helpers::isRevised($document->stage) }}>
                                </div>
                            </div>
                            @endif

                            @if($document->document_type_id == 'SOP')
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="link-doc">Reference Record</label>
                                        <select multiple name="reference_record[]" placeholder="Select Reference Records"
                                            data-search="false" data-silent-initial-value-set="true" id="reference_record"
                                            {{ Helpers::isRevised($document->stage) }}>
                                            @if (!empty($document_data))
                                                @foreach ($document_data as $temp)
                                                    @if ($temp->id != $document->id)
                                                        <option value="{{ $temp->id }}"
                                                            {{ str_contains($document->reference_record, $temp->id) ? 'selected' : '' }}>
                                                            {{ $temp->sop_type_short }}/000{{ $temp->id }}/R{{ $temp->major }}.{{ $temp->minor }}/{{ $temp->document_name }}
                                                        </option>
                                                    @endif
                                                @endforeach
                                            @endif
                                        </select>

                                        @foreach ($history as $tempHistory)
                                            @if (
                                                $tempHistory->activity_type == 'Reference Record' &&
                                                    !empty($tempHistory->comment) &&
                                                    $tempHistory->user_id == Auth::user()->id)
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                    @if (Auth::user()->role != 3 && $document->stage < 8)
                                        <div class="comment">
                                            <div>
                                                <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                    at {{ date('d-M-Y h:i:s') }}</p>

                                                <input class="input-field" type="text" name="reference_record_comment">
                                            </div>
                                            <div class="button">Add Comment</div>
                                        </div>
                                    @endif
                                </div>
                            @else
                                <div class="col-md-12" style="display: none;">
                                    <div class="group-input">
                                        <label for="link-doc">Reference Record</label>
                                        <select multiple name="reference_record[]" placeholder="Select Reference Records"
                                            data-search="false" data-silent-initial-value-set="true" id="reference_record"
                                            {{ Helpers::isRevised($document->stage) }}>
                                            @if (!empty($document_data))
                                                @foreach ($document_data as $temp)
                                                    @if ($temp->id != $document->id)
                                                        <option value="{{ $temp->id }}"
                                                            {{ str_contains($document->reference_record, $temp->id) ? 'selected' : '' }}>
                                                            {{ $temp->sop_type_short }}/000{{ $temp->id }}/R{{ $temp->major }}.{{ $temp->minor }}/{{ $temp->document_name }}
                                                        </option>
                                                    @endif
                                                @endforeach
                                            @endif
                                        </select>

                                        @foreach ($history as $tempHistory)
                                            @if (
                                                $tempHistory->activity_type == 'Reference Record' &&
                                                    !empty($tempHistory->comment) &&
                                                    $tempHistory->user_id == Auth::user()->id)
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                    @if (Auth::user()->role != 3 && $document->stage < 8)
                                        <div class="comment">
                                            <div>
                                                <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                    at {{ date('d-M-Y h:i:s') }}</p>

                                                <input class="input-field" type="text" name="reference_record_comment">
                                            </div>
                                            <div class="button">Add Comment</div>
                                        </div>
                                    @endif
                                </div>
                            @endif
                        

                            <div class="col-6">
                                <div class="group-input">
                                    <label for="depart-name">Department Name</label>
                                    <select name="department_id" id="depart-name"
                                        {{ Helpers::isRevised($document->stage) }}>
                                        <option value="" disabled selected>Enter your Selection</option>

                                        @foreach (Helpers::getDmsDepartments() as $code => $department)
                                            <option value="{{ $code }}"
                                                @if ($document->department_id == $code) selected @endif>{{ $department }}
                                            </option>
                                        @endforeach

                                    </select>
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Department' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                                <!-- <p id="depart-nameError" style="color:red">**Department Name is required</p> -->


                                @if (Auth::user()->role != 3 && $document->stage < 8)
                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text" name="department_id_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                            </div>

                            
                        @if($document->document_type_id == 'SOP')
                            <div class="col-6">
                                <div class="group-input">
                                    <label for="major">Document Version <small>(Major)</small><span
                                            class="text-danger">*</span>
                                        <span class="text-primary" data-bs-toggle="modal"
                                            data-bs-target="#document-management-system-modal"
                                            style="font-size: 0.8rem; font-weight: 400;">
                                            (Launch Instruction) </span>
                                    </label>
                                    <input type="number" name="major" id="major" min="0"
                                        value="{{ $document->major }}" required
                                        {{ Helpers::isRevised($document->stage) }}>

                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Major' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                                @if (Auth::user()->role != 3 && $document->stage < 8)
                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text" name="major_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif
                            </div>
                        @else
                            <div class="col-6" style="display:none">
                                <div class="group-input">
                                    <label for="major">Document Version <small>(Major)</small><span
                                            class="text-danger">*</span>
                                     
                                    </label>
                                    <input type="number" name="major" id="major" min="0"
                                        value="{{ $document->major }}">
                                </div>
                            </div>
                        @endif    



                            <!-- testing code -->
                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="doc-type">Document Type</label>
                                    <select name="document_type_id" id="doc-type" {{ Helpers::isRevised($document->stage) }}>
                                        <option value="">Enter your Selection</option>
                                        @foreach (Helpers::getDocumentTypes() as $code => $type)
                                            <option data-id="{{ $code }}" value="{{ $code }}"
                                                {{ $code == $document->document_type_id ? 'selected' : '' }}>
                                                {{ $type }}
                                            </option>
                                        @endforeach
                                    </select>

                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Document' &&
                                            !empty($tempHistory->comment) &&
                                            $tempHistory->user_id == Auth::user()->id
                                        )
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modified by {{ $users_name }} at {{ $tempHistory->created_at }}</p>
                                            <input class="input-field" style="background: #ffff0061; color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)
                                    {{-- Add Comment --}}
                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modified by
                                                {{ Auth::user()->name }} at {{ date('d-M-Y h:i:s') }}</p>
                                            <input class="input-field" type="text" name="document_type_id_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif
                            </div>

                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="doc-code">Document Type Code</label>
                                    <div class="default-name">
                                        <span id="document_type_code">
                                            @foreach (Helpers::getDocumentTypes() as $code => $type)
                                                @if ($code == $document->document_type_id)
                                                    {{ $code }}
                                                @endif
                                            @endforeach
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <p id="doc-typeError" style="color:red">**Document Type is required</p>

                            @if($document->document_type_id == 'SOP') 
                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="doc-lang">Document Language</label>
                                    <select name="document_language_id" id="doc-lang"
                                        {{ Helpers::isRevised($document->stage) }}>
                                        <option value="">Enter your Selection</option>
                                        @foreach ($documentLanguages as $lan)
                                            <option data-id="{{ $lan->lcode }}" value="{{ $lan->id }}"
                                                {{ $lan->id == $document->document_language_id ? 'selected' : '' }}>
                                                {{ $lan->lname }}
                                            </option>
                                        @endforeach
                                    </select>
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Document Language' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)
                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text"
                                                name="document_language_id_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif
                            </div>
                            @else
                            <div class="col-md-6" style="display: none;">
                                <div class="group-input">
                                    <label for="doc-lang">Document Language</label>
                                    <select name="document_language_id" id="doc-lang"
                                        {{ Helpers::isRevised($document->stage) }}>
                                        <option value="">Enter your Selection</option>
                                        @foreach ($documentLanguages as $lan)
                                            <option data-id="{{ $lan->lcode }}" value="{{ $lan->id }}"
                                                {{ $lan->id == $document->document_language_id ? 'selected' : '' }}>
                                                {{ $lan->lname }}
                                            </option>
                                        @endforeach
                                    </select>
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Document Language' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>
                            @endif


                            @if($document->document_type_id == 'SOP') 
                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="doc-lang">Document Language Code</label>
                                    <div class="default-name"><span id="document_language">
                                            @if (!empty($documentLanguages))
                                                @foreach ($documentLanguages as $lan)
                                                    {{ $document->document_language_id == $lan->id ? $lan->lcode : '' }}
                                                @endforeach
                                            @else
                                                Not Selected
                                            @endif
                                        </span></div>
                                </div>
                            </div>
                            @else
                            <div class="col-md-6" style="display: none;">
                                <div class="group-input">
                                    <label for="doc-lang">Document Language Code</label>
                                    <div class="default-name"><span id="document_language">
                                            @if (!empty($documentLanguages))
                                                @foreach ($documentLanguages as $lan)
                                                    {{ $document->document_language_id == $lan->id ? $lan->lcode : '' }}
                                                @endforeach
                                            @else
                                                Not Selected
                                            @endif
                                        </span></div>
                                </div>
                            </div>
                            @endif

                          @if($document->document_type_id == 'SOP')
                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="keyword">Keywords</label>
                                    <div class="add-keyword">
                                        <input type="text" id="sourceField" class="mb-0" maxlength="15"
                                            {{ Helpers::isRevised($document->stage) }}>
                                        <button id="addButton" type="button">ADD</button>
                                    </div>
                                    <ul id="displayField" class="d-flex justify-content-between align-items-center">
                                        @if (!empty($keywords))
                                            @foreach ($keywords as $lan)
                                                <li>
                                                    {{ $lan->keyword }}
                                                    <span class="close-icon ms-2">x</span>
                                                </li>
                                            @endforeach
                                        @endif
                                    </ul>
                                    <select name="keywords[]" class="targetField" multiple id="keywords"
                                        style="display: none">
                                        @if (!empty($keywords))
                                            @foreach ($keywords as $lan)
                                                <option value="{{ $lan->keyword }}" selected>
                                                    {{ $lan->keyword }}
                                                </option>
                                            @endforeach
                                        @endif
                                    </select>
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Keywords' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>
                          @else
                            <div class="col-md-12" style="display: none;">
                                <div class="group-input">
                                    <label for="keyword">Keywords</label>
                                    <div class="add-keyword">
                                        <input type="text" id="sourceField" class="mb-0" maxlength="15"
                                            {{ Helpers::isRevised($document->stage) }}>
                                        <button id="addButton" type="button">ADD</button>
                                    </div>
                                    <ul id="displayField" class="d-flex justify-content-between align-items-center">
                                        @if (!empty($keywords))
                                            @foreach ($keywords as $lan)
                                                <li>
                                                    {{ $lan->keyword }}
                                                    <span class="close-icon ms-2">x</span>
                                                </li>
                                            @endforeach
                                        @endif
                                    </ul>
                                    <select name="keywords[]" class="targetField" multiple id="keywords"
                                        style="display: none">
                                        @if (!empty($keywords))
                                            @foreach ($keywords as $lan)
                                                <option value="{{ $lan->keyword }}" selected>
                                                    {{ $lan->keyword }}
                                                </option>
                                            @endforeach
                                        @endif
                                    </select>
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Keywords' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>
                          @endif
                          
                          

                          @if($document->document_type_id == 'SOP')

                            <div class="col-md-5 new-date-data-field">
                                <div class="group-input input-date">
                                    <label for="effective-date">Effective Date</label>
                                    <div><small class="text-primary">The effective date will be automatically populated
                                            once the record becomes effective</small></div>
                                    <div class="calenderauditee">
                                        <input @if ($document->stage != 1) disabled @endif type="text"
                                            id="effective_date"
                                            value="{{ $document->effective_date ? Carbon\Carbon::parse($document->effective_date)->format('d-M-Y') : '' }}"
                                            readonly placeholder="DD-MMM-YYYY"
                                            {{ Helpers::isRevised($document->stage) }} />
                                        <input @if ($document->stage != 1) disabled @endif type="date"
                                            name="effective_date" value="" class="hide-input"
                                            min="{{ Carbon\Carbon::today()->format('Y-m-d') }}"
                                            oninput="handleDateInput(this, 'effective_date')" />
                                    </div>
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Effective Date' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>

                                @if (Auth::user()->role != 3)

                                    <div class="comment">
                                        <div>

                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text" name="effective_date_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                            </div>

                            <div class="col-md-2">
                                <div class="group-input">
                                    <label for="review-period">Review Period (in years)</label>
                                    <input style="margin-top: 25px;" @if ($document->stage != 1) readonly @endif
                                        type="number" name="review_period" id="review_period" min="0"
                                        {{ Helpers::isRevised($document->stage) }} value={{ $document->review_period }}>
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Review Period' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                                <script>
                                    function validateInput(input) {
                                        if (input.value < 0) {
                                            input.value = 0;
                                        }
                                    }
                                </script>

                                @if (Auth::user()->role != 3)

                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text" name="review_period_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                            </div>

                            <div class="col-md-5 new-date-data-field">
                                <div class="group-input input-date">
                                    <label for="review-date">Next Review Date</label>

                                    <div class="calenderauditee">
                                        <input style="margin-top: 25px;" @if ($document->stage != 1) disabled @endif
                                            type="text" id="next_review_date" class="new_review_date_show"
                                            value="{{ $document->next_review_date ? Carbon\Carbon::parse($document->next_review_date)->format('d-M-Y') : '' }}"
                                            {{ Helpers::isRevised($document->stage) }} readonly
                                            placeholder="DD-MMM-YYYY" />
                                        <input @if ($document->stage != 1) disabled @endif type="date"
                                            name="next_review_date" value=""
                                            class="hide-input new_review_date_hide"
                                            min="{{ Carbon\Carbon::today()->format('Y-m-d') }}"
                                            oninput="handleDateInput(this, 'next_review_date')" />
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Next-Review Date' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                        color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>

                                @if (Auth::user()->role != 3)

                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text" name="next_review_date_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                            </div>
                            
                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="draft-doc">Attach Draft document</label>
                                    <input type="file" name="attach_draft_doocument"
                                        style="height: 100% !important; margin-bottom: 0px !important;"
                                        {{ Helpers::isRevised($document->stage) }}
                                        value="{{ $document->attach_draft_doocument }}">
                                    @if ($document->attach_draft_doocument)
                                        <input type="hidden" name="attach_draft_doocument"
                                            value="{{ $document->attach_draft_doocument }}">
                                        <p>Current file: {{ basename($document->attach_draft_doocument) }}</p>
                                    @endif



                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Draft Document' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                        color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)
                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text"
                                                name="attach_draft_doocument_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                            </div>

                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="effective-doc">Attach Effective document</label>
                                    <input type="file" name="attach_effective_docuement"
                                        style="height: 100% !important; margin-bottom: 0px !important;"
                                        {{ Helpers::isRevised($document->stage) }}
                                        value="{{ $document->attach_effective_docuement }}">
                                    @if ($document->attach_effective_docuement)
                                        <input type="hidden" name="attach_effective_docuement"
                                            value="{{ $document->attach_effective_docuement }}">
                                        <p>Current file: {{ basename($document->attach_effective_docuement) }}</p>
                                    @endif
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Effective Document' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                        color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)
                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text"
                                                name="attach_effective_docuement_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                            </div>
                        
                          @else
                            <div class="col-md-5 new-date-data-field" style="display: none;">
                              <div class="group-input input-date">
                                    <label for="effective-date">Effective Date</label>
                                    <div><small class="text-primary">The effective date will be automatically populated
                                            once the record becomes effective</small></div>
                                    <div class="calenderauditee">
                                        <input @if ($document->stage != 1) disabled @endif type="text"
                                            id="effective_date"
                                            value="{{ $document->effective_date ? Carbon\Carbon::parse($document->effective_date)->format('d-M-Y') : '' }}"
                                            readonly placeholder="DD-MMM-YYYY"
                                            {{ Helpers::isRevised($document->stage) }} />
                                        <input @if ($document->stage != 1) disabled @endif type="date"
                                            name="effective_date" value="" class="hide-input"
                                            min="{{ Carbon\Carbon::today()->format('Y-m-d') }}"
                                            oninput="handleDateInput(this, 'effective_date')" />
                                    </div>
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Effective Date' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>

                                @if (Auth::user()->role != 3)

                                    <div class="comment">
                                        <div>

                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text" name="effective_date_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                            </div>

                            <div class="col-md-2" style="display: none;">
                                <div class="group-input">
                                    <label for="review-period">Review Period (in years)</label>
                                    <input style="margin-top: 25px;" @if ($document->stage != 1) readonly @endif
                                        type="number" name="review_period" id="review_period" min="0"
                                        {{ Helpers::isRevised($document->stage) }} value={{ $document->review_period }}>
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Review Period' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                                <script>
                                    function validateInput(input) {
                                        if (input.value < 0) {
                                            input.value = 0;
                                        }
                                    }
                                </script>

                                @if (Auth::user()->role != 3)

                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text" name="review_period_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                            </div>

                            <div class="col-md-5 new-date-data-field" style="display: none;">
                                <div class="group-input input-date">
                                    <label for="review-date">Next Review Date</label>

                                    <div class="calenderauditee">
                                        <input style="margin-top: 25px;" @if ($document->stage != 1) disabled @endif
                                            type="text" id="next_review_date" class="new_review_date_show"
                                            value="{{ $document->next_review_date ? Carbon\Carbon::parse($document->next_review_date)->format('d-M-Y') : '' }}"
                                            {{ Helpers::isRevised($document->stage) }} readonly
                                            placeholder="DD-MMM-YYYY" />
                                        <input @if ($document->stage != 1) disabled @endif type="date"
                                            name="next_review_date" value=""
                                            class="hide-input new_review_date_hide"
                                            min="{{ Carbon\Carbon::today()->format('Y-m-d') }}"
                                            oninput="handleDateInput(this, 'next_review_date')" />
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Next-Review Date' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                        color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>

                                @if (Auth::user()->role != 3)

                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text" name="next_review_date_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                            </div>
                            
                            <div class="col-md-6" style="display: none;">
                                <div class="group-input">
                                    <label for="draft-doc">Attach Draft document</label>
                                    <input type="file" name="attach_draft_doocument"
                                        style="height: 100% !important; margin-bottom: 0px !important;"
                                        {{ Helpers::isRevised($document->stage) }}
                                        value="{{ $document->attach_draft_doocument }}">
                                    @if ($document->attach_draft_doocument)
                                        <input type="hidden" name="attach_draft_doocument"
                                            value="{{ $document->attach_draft_doocument }}">
                                        <p>Current file: {{ basename($document->attach_draft_doocument) }}</p>
                                    @endif



                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Draft Document' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                        color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)
                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text"
                                                name="attach_draft_doocument_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                            </div>

                            <div class="col-md-6" style="display: none;">
                                <div class="group-input">
                                    <label for="effective-doc">Attach Effective document</label>
                                    <input type="file" name="attach_effective_docuement"
                                        style="height: 100% !important; margin-bottom: 0px !important;"
                                        {{ Helpers::isRevised($document->stage) }}
                                        value="{{ $document->attach_effective_docuement }}">
                                    @if ($document->attach_effective_docuement)
                                        <input type="hidden" name="attach_effective_docuement"
                                            value="{{ $document->attach_effective_docuement }}">
                                        <p>Current file: {{ basename($document->attach_effective_docuement) }}</p>
                                    @endif
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Effective Document' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                        color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)
                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text"
                                                name="attach_effective_docuement_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                            </div>
                          @endif

                        </div>
                    </div>
                    <div class="orig-head">
                        Other Information
                    </div>
                    <div class="input-fields">
                        <div class="row">

                        @if($document->document_type_id == 'SOP')
                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="reviewers">Reviewers</label>

                                    <select id="choices-multiple-remove-button" class="choices-multiple-reviewer"
                                        name="reviewers[]" placeholder="Select Reviewers" multiple
                                        @if ($document->stage != 1) disabled @endif>
                                        @if (!empty($reviewer))
                                            @foreach ($reviewer as $lan)
                                                @if (Helpers::checkUserRolesreviewer($lan))
                                                    <option value="{{ $lan->id }}"
                                                        @if ($document->reviewers) @php
                                $data = explode(",", $document->reviewers);
                                $count = count($data);
                            @endphp
                            @for ($i = 0; $i < $count; $i++)
                                @if ($data[$i] == $lan->id)
                                    selected @endif
                                                        @endfor
                                                @endif>
                                                {{ $lan->name }}
                                                </option>
                                            @endif
                                        @endforeach
                                        @endif
                                    </select>



                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Reviewers' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                                <p id="reviewerError" style="color:red">**Reviewers are required</p>

                                @if (Auth::user()->role != 3 && $document->stage < 8)
                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text" name="reviewers_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                            </div>
                        @else
                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="reviewers">Checked By</label>

                                    <select id="choices-multiple-remove-button" class="choices-multiple-reviewer"
                                        name="reviewers[]" placeholder="Select Reviewers" multiple
                                        @if ($document->stage != 1) disabled @endif>
                                        @if (!empty($reviewer))
                                            @foreach ($reviewer as $lan)
                                                @if (Helpers::checkUserRolesreviewer($lan))
                                                    <option value="{{ $lan->id }}"
                                                        @if ($document->reviewers) @php
                                $data = explode(",", $document->reviewers);
                                $count = count($data);
                            @endphp
                            @for ($i = 0; $i < $count; $i++)
                                @if ($data[$i] == $lan->id)
                                    selected @endif
                                                        @endfor
                                                @endif>
                                                {{ $lan->name }}
                                                </option>
                                            @endif
                                        @endforeach
                                        @endif
                                    </select>



                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Reviewers' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                                <p id="reviewerError" style="color:red">**Reviewers are required</p>

                                @if (Auth::user()->role != 3 && $document->stage < 8)
                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text" name="reviewers_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                            </div>
                        @endif



                
                        
                        

                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="approvers">Approvers</label>
                                    <select id="choices-multiple-remove-button" class="choices-multiple-approver"
                                        {{ !Helpers::userIsQA() ? Helpers::isRevised($document->stage) : '' }}
                                        name="approvers[]" placeholder="Select Approvers" multiple
                                        @if ($document->stage != 1) disabled @endif>
                                        @if (!empty($approvers))
                                            @foreach ($approvers as $lan)
                                                @if (Helpers::checkUserRolesApprovers($lan))
                                                    <option value="{{ $lan->id }}"
                                                        @if ($document->approvers) @php
                            $data = explode(",",$document->approvers);
                            $count = count($data);
                            $i=0;
                            @endphp
                            @for ($i = 0; $i < $count; $i++) @if ($data[$i] == $lan->id)
                                selected @endif
                                                        @endfor
                                                @endif>
                                                {{ $lan->name }}
                                                </option>
                                            @endif
                                        @endforeach
                                        @endif
                                    </select>
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Approvers' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                                <p id="approverError" style="color:red">**Approvers are required</p>

                                @if (Auth::user()->role != 3 && $document->stage < 8)
                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text" name="approvers_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                            </div>

                        @if($document->document_type_id == 'SOP')
                            <div class="col-md-6">  
                                <div class="group-input">
                                    <label for="hods">HOD's</label>
                                    <select id="choices-multiple-remove-button" class="choices-multiple-approver"
                                        {{ !Helpers::userIsQA() ? Helpers::isRevised($document->stage) : '' }}
                                        name="hods[]" placeholder="Select HOD's" multiple
                                        @if ($document->stage != 1) disabled @endif>
                                        @foreach ($hods as $hod)
                                            <option value="{{ $hod->id }}"
                                                @if ($document->hods) @php
                                                    $data = explode(",",$document->hods);
                                                    $count = count($data);
                                                    $i=0;
                                                    @endphp
                                                    @for ($i = 0; $i < $count; $i++) @if ($data[$i] == $hod->id)
                                                        selected @endif
                                                @endfor>
                                                {{ $hod->name }}
                                            </option>
                                        @endif
                                        @endforeach
                                    </select>
                                    @foreach ($history as $tempHistory)
                                        @if (
                                            $tempHistory->activity_type == 'Approvers' &&
                                                !empty($tempHistory->comment) &&
                                                $tempHistory->user_id == Auth::user()->id)
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>


                                @if (Auth::user()->role != 3 && $document->stage < 8) 
                                    <div class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }}
                                                at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text" name="approvers_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif
                            </div>
                        @else
                            <div class="col-md-6" style="display: none">  
                                <div class="group-input">
                                    <label for="hods">HOD's</label>
                                    <select id="" class="choices-multiple-approver"
                                        name="hods[]" placeholder="Select HOD's" multiple>
                                        
                                    </select>
                                </div>
                            </div>
                        @endif 
                     </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" name="submit" value="save" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="nextButton" id="DocnextButton">Next</button>
                    </div>
                </div>

                <!-- ------------------------------------------------------------------------------------------------------------- -->
                <div id="add-doc" class="tabcontent">
                    <div class="orig-head">
                        Training Information
                    </div>
                    <div class="input-fields">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="train-require">Training Required?</label>
                                    <select name="training_required" {{ Helpers::isRevised($document->stage) }} required>
                                        <option value="">Enter your Selection</option>
                                        @if ($document->training_required == 'yes')
                                            <option value="yes" selected>Yes</option>
                                            <option value="no">No</option>
                                        @else
                                            <option value="no" selected>No</option>
                                            <option value="yes">Yes</option>

                                        @endif

                                    </select>
                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Training Required' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="link-doc">Trainer</label>
                                    <select name="trainer" {{ Helpers::isRevised($document->stage) }}>
                                        <option value="" selected>Enter your Selection</option>
                                        @foreach ($trainer as $temp)
                                            @if (Helpers::checkUserRolestrainer($temp))
                                                <option value="{{ $temp->id }}"
                                                    @if (!empty($trainingDoc)) @if ($trainingDoc->trainer == $temp->id) selected @endif
                                                    @endif>{{ $temp->name }}</option>
                                            @endif
                                        @endforeach
                                    </select>
                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Trainer' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>
                            {{-- <div class="col-md-6">
                                <div class="group-input">
                                    <label for="launch-cbt">Launch CBT</label>
                                    <select name="cbt">
                                        <option value="" selected>Enter your Selection</option>
                                        <option value="1`">Lorem, ipsum.</option>
                                        <option value="1`">Lorem, ipsum.</option>
                                        <option value="1`">Lorem, ipsum.</option>
                                        <option value="1`">Lorem, ipsum.</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="training-type">Type</label>
                                    <select name="training-type">
                                        <option value="" selected>Enter your Selection</option>
                                        <option value="1`">Lorem, ipsum.</option>
                                        <option value="1`">Lorem, ipsum.</option>
                                        <option value="1`">Lorem, ipsum.</option>
                                        <option value="1`">Lorem, ipsum.</option>
                                    </select>
                                </div>
                            </div> --}}
                            {{-- <div class="col-md-12">
                                <div class="group-input">
                                    <label for="test">
                                        Test(0)<button type="button" name="test"
                                            onclick="addTrainRow('test')" {{Helpers::isRevised($document->stage)}}>+</button>
                            </label>
                            <table class="table-bordered table" id="test">
                                <thead>
                                    <tr>
                                        <th class="row-num">Row No.</th>
                                        <th class="question">Question</th>
                                        <th class="answer">Answer</th>
                                        <th class="result">Result</th>
                                        <th class="comment">Comment</th>
                                        <th class="comment">Action</th>
                                    </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="test">
                                Survey(0)<button type="button" name="reporting1" onclick="addTrainRow('survey')" {{Helpers::isRevised($document->stage)}}>+</button>
                            </label>
                            <table class="table-bordered table" id="survey">
                                <thead>
                                    <tr>
                                        <th class="row-num">Row No.</th>
                                        <th class="question">Subject</th>
                                        <th class="answer">Topic</th>
                                        <th class="result">Rating</th>
                                        <th class="comment">Comment</th>
                                        <th class="comment">Action</th>
                                    </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                        </div>
                    </div> --}}
                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="comments">Comments</label>
                                    <textarea name="comments" {{ Helpers::isRevised($document->stage) }}>{{ $document->comments }}</textarea>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" name="submit" value="save" class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                    </div>
                </div>

                <div id="doc-content" class="tabcontent">
                    <div class="orig-head">
                        Document Information
                    </div>
                    <div class="input-fields">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="purpose">Objective</label>
                                    <textarea name="purpose" {{ Helpers::isRevised($document->stage) }}>{{ $document->document_content ? $document->document_content->purpose : '' }}</textarea>
                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Purpose' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>

                            @if (Auth::user()->role != 3 && $document->stage < 8) {{-- Add Comment  --}} <div
                                    class="comment">
                                    <div>
                                        <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                            {{ date('d-M-Y h:i:s') }}
                                        </p>

                                        <input class="input-field" type="text" name="purpose_comment">
                                    </div>
                                    <div class="button">Add Comment</div>
                                </div>
                            @endif

                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="scope">Scope</label>

                                    <textarea name="scope" {{ Helpers::isRevised($document->stage) }}>{{ $document->document_content ? $document->document_content->scope : '' }}</textarea>
                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Scope' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>

                            @if (Auth::user()->role != 3 && $document->stage < 8) {{-- Add Comment  --}} <div
                                    class="comment">
                                    <div>
                                        <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                            {{ date('d-M-Y h:i:s') }}
                                        </p>

                                        <input class="input-field" type="text" name="scope_comment">
                                    </div>
                                    <div class="button">Add Comment</div>
                                </div>
                            @endif

                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="responsibility" id="responsibility">
                                        Responsibility<button type="button" id="responsibilitybtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="responsibilitydiv">
                                         @if ($document->document_content && !empty($document->document_content->responsibility))

                                            @foreach (unserialize($document->document_content->responsibility) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleResponsibilityBlock' : 'singleResponsibilityBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="responsibility[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="responsibility[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subResponsibilityAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleResponsibilityBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="responsibility[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subResponsibilityAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Responsibility' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>

                            @if (Auth::user()->role != 3 && $document->stage < 8) {{-- Add Comment  --}} <div
                                    class="comment">
                                    <div>
                                        <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                            {{ date('d-M-Y h:i:s') }}
                                        </p>

                                        <input class="input-field" type="text" name="responsibility_comment">
                                    </div>
                                    <div class="button">Add Comment</div>
                                </div>
                            @endif

                            <div class="col-md-12">
                                <div class="group-input">

                                    <label for="accountability" id="accountability">
                                        Accountability<button type="button" id="accountabilitybtnadd"
                                            name="button">+</button>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does
                                                not require completion</small></div>
                                    </label>

                                    <div id="accountabilitydiv">

                                        @if ($document->document_content && !empty($document->document_content->accountability))
                                            @foreach (unserialize($document->document_content->accountability) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleAccountabilityBlock' : 'singleAccountabilityBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="accountability[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="accountability[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subAccountabilityAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @endif
                                    </div>

                                </div>
                            </div>

                            <div class="col-md-12">
                                <div class="group-input">

                                    <label for="references" id="references">
                                        References<button type="button" id="referencesbtadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>

                                    <div id="referencesdiv">
                                        @if ($document->document_content && !empty($document->document_content->references))
                                            @foreach (unserialize($document->document_content->references) as $key => $data)
                                                @if (!empty($data))
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleReferencesBlock' : 'singleReferencesBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="references[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="references[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subReferencesAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endif
                                            @endforeach
                                        @else
                                            <div class="singleReferencesBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="references[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subReferencesAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif

                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'References' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach




                                </div>
                            </div>

                            @if (Auth::user()->role != 3 && $document->stage < 8) {{-- Add Comment  --}} <div
                                    class="comment">
                                    <div>
                                        <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                            {{ date('d-M-Y h:i:s') }}
                                        </p>

                                        <input class="input-field" type="text" name="references_comment">
                                    </div>
                                    <div class="button">Add Comment</div>
                                </div>
                            @endif

                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="abbreviation" id="abbreviation">
                                        Abbreviation<button type="button" id="abbreviationbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>

                                    <div id="abbreviationdiv">
                                        @if ($document->document_content && !empty($document->document_content->abbreviation))
                                            @foreach (unserialize($document->document_content->abbreviation) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleAbbreviationBlock' : 'singleAbbreviationBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="abbreviation[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="abbreviation[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subAbbreviationAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Abbreviation' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>

                            @if (Auth::user()->role != 3 && $document->stage < 8) {{-- Add Comment  --}} <div
                                    class="comment">
                                    <div>
                                        <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                            {{ date('d-M-Y h:i:s') }}
                                        </p>

                                        <input class="input-field" type="text" name="abbreviation_comment">
                                    </div>
                                    <div class="button">Add Comment</div>
                                </div>
                            @endif

                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="abbreviation" id="definition">
                                        Definition<button type="button" id="Definitionbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>

                                    <div id="definitiondiv">
                                        @if ($document->document_content && !empty($document->document_content->defination))
                                            @foreach (unserialize($document->document_content->defination) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleDefinitionBlock' : 'singleDefinitionBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="defination[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="defination[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subDefinitionAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Definiton' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>

                            @if (Auth::user()->role != 3 && $document->stage < 8) {{-- Add Comment  --}} <div
                                    class="comment">
                                    <div>
                                        <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                            {{ date('d-M-Y h:i:s') }}
                                        </p>

                                        <input class="input-field" type="text" name="defination_comment">
                                    </div>
                                    <div class="button">Add Comment</div>
                                </div>
                            @endif

                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="reporting" id="newreport">
                                        General Instructions<button type="button" id="materialsbtadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    @if ($document->document_content && !empty($document->document_content->materials_and_equipments))
                                        <div class="materialsBlock">
                                            @foreach (unserialize($document->document_content->materials_and_equipments) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleMaterialBlock' : 'singleMaterialBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="materials_and_equipments[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="materials_and_equipments[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>

                                                            <div class="col-sm-1">
                                                                <button type="button" class="subMaterialsAdd"
                                                                    name="button"
                                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                                            </div>

                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        </div>
                                    @else
                                        <div class="singleMaterialBlock">
                                            <div class="row">
                                                <div class="col-sm-10">
                                                    <textarea name="materials_and_equipments[]" class="myclassname"></textarea>
                                                </div>

                                                <div class="col-sm-1">
                                                    <button type="button" class="subMaterialsAdd" name="button"
                                                        {{ Helpers::isRevised($document->stage) }}>+</button>
                                                </div>

                                                <div class="col-sm-1">
                                                    <button class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                </div>
                                            </div>
                                        </div>
                                    @endif

                                    <div id="materialsdiv"></div>
                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Materials and Equipments' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>

                            @if (Auth::user()->role != 3 && $document->stage < 8) {{-- Add Comment  --}} <div
                                    class="comment">
                                    <div>
                                        <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                            {{ date('d-M-Y h:i:s') }}
                                        </p>

                                        <input class="input-field" type="text"
                                            name="materials_and_equipments_comment">
                                    </div>
                                    <div class="button">Add Comment</div>
                                </div>
                            @endif


                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="procedure">Procedure</label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <textarea name="procedure" id="" class="summernote">{{ $document->document_content ? $document->document_content->procedure : '' }}</textarea>
                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="reporting" id="newreport">
                                        Cross References<button type="button" id="reportingbtadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>

                                    <div id="reportingdiv">
                                        @if ($document->document_content && !empty($document->document_content->reporting))
                                            @foreach (unserialize($document->document_content->reporting) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleReportingBlock' : 'singleReportingBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="reporting[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea type="text" name="reporting[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subReportingAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleReportingBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea type="text" name="reporting[]" class=""></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subReportingAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Reporting' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>

                            @if (Auth::user()->role != 3 && $document->stage < 8) {{-- Add Comment  --}} <div
                                    class="comment">
                                    <div>
                                        <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                            {{ date('d-M-Y h:i:s') }}
                                        </p>

                                        <input class="input-field" type="text" name="reporting_comment">
                                    </div>
                                    <div class="button">Add Comment</div>
                                </div>
                            @endif



                            <div class="col-md-12">
                                <div class="group-input">

                                    <label for="ann" id="ann">
                                        Annexure<button type="button" id="annbtadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>

                                    <div id="anndiv">
                                        @if ($document->document_content && !empty($document->document_content->ann))
                                            @foreach (unserialize($document->document_content->ann) as $key => $data)
                                                @if (!empty($data))
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleAnnexureBlock' : 'singleAnnexureBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="ann[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="ann[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subAnnexureAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endif
                                            @endforeach
                                        @else
                                            <div class="singleAnnexureBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <input type="text" name="ann[]" class="myclassname">
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subAnnexureAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn-btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'ann' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>


                            @if (Auth::user()->role != 3 && $document->stage < 8) {{-- Add Comment  --}} <div
                                    class="comment">
                                    <div>
                                        <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                            {{ date('d-M-Y h:i:s') }}
                                        </p>

                                        <input class="input-field" type="text" name="comment">
                                    </div>
                                    <div class="button">Add Comment</div>
                                </div>
                            @endif
                        </div>

                        {{-- <div class="col-md-12">
                            <div class="group-input">
                                <label for="test">
                                    Revision History
                                </label>
                                <div><small class="text-primary"></small></div>
                                <div class="table-responsive retrieve-table">
                                <table class="table-bordered table" id="">
                                    <thead>
                                        <tr>
                                            <th>Sr. No.</th>
                                            <th class="copy-name">Revision No.</th>
                                            <th class="copy-name">Change Control No./ DCRF No</th>
                                            <th class="copy-name">Effective Date</th>
                                            <th class="copy-name">Reason of revision</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                        @if($document->revised == 'Yes' && isset($document->revisions))
                                            @foreach($document->revisions as $key => $revision)
                                                <tr>
                                                    <td>{{ $key + 1 }}</td>
                                                    <td><input type="text" name="revision_number[]" value="{{ $revision->revision_number }}" class="form-control"></td>
                                                    <td><input type="text" name="cc_no[]" value="{{ $revision->cc_no }}" class="form-control"></td>
                                                    <td><input type="date" name="revised_effective_date[]" value="{{ $revision->revised_effective_date }}" class="form-control"></td>
                                                    <td><input type="text" name="reason[]" value="{{ $revision->reason }}" class="form-control"></td>
                                                </tr>
                                            @endforeach
                                        @endif

                                    </tbody>
                                </table>
                                </div>
                            </div>
                        </div> --}}
                    </div>

                    <div class="input-fields">
                        <div class="group-input">
                            <label for="distribution-list" style="font-weight: bold;">
                                Distribution List
                            </label>
                            <div class="table-responsive retrieve-table">
                                <table class="table table-bordered" id="distribution-list">
                                    <thead>
                                        <tr>
                                            <th>Row</th>
                                            <th class="copy-name">Copy</th>
                                            <th class="copy-name">No. of Copies</th>
                                            <th class="copy-name">User Department</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1</td>
                                            <td style="font-weight: bold;">Master Copy</td>
                                            <td><input type="text" id="copies-master"
                                                    name="master_copy_number"
                                                    value="{{ $document->master_copy_number }}" class="form-control">
                                            </td>
                                            <td>
                                                <div class="col-md-12">
                                                    <div class="group-input">
                                                        <input type="text" name="master_user_department" value="{{$document->master_user_department}}">
                                                        {{-- <select name="master_user_department"
                                                            id="master_user_department" class="form-control"
                                                            {{ Helpers::isRevised($document->stage) }}>
                                                            <option value="" disabled selected>Enter your Selection
                                                            </option>

                                                            @foreach (Helpers::getDepartments() as $code => $department)
                                                                <option value="{{ $code }}"
                                                                    @if ($document->master_user_department == $code) selected @endif>
                                                                    {{ $department }}
                                                                </option>
                                                            @endforeach
                                                        </select> --}}
                                                    </div>
                                                </div>
                                            </td>
                                            {{-- <td>
                                                <select id="department-master" class="form-control"
                                                    placeholder="Select..." name="master_user_department">
                                                    <option value="">Select the departments</option>
                                                    @foreach ($departments as $department)
                                                        <option value="{{ $department->id }}"
                                                            {{ $document->master_user_department == $department->id ? 'selected' : '' }}>
                                                            {{ $department->name }}
                                                        </option>
                                                    @endforeach
                                                </select>
                                            </td> --}}
                                        </tr>
                                        <tr>
                                            <td>2</td>
                                            <td style="font-weight: bold;">Controlled Copy</td>
                                            <td><input type="text" id="copies-controlled"
                                                    name="controlled_copy_number"
                                                    value="{{ $document->controlled_copy_number }}"
                                                    class="form-control">
                                            </td>
                                            <td>
                                                <div class="col-md-12">
                                                    <div class="group-input">
                                                        <input type="text" name="controlled_user_department" value="{{$document->controlled_user_department}}">
                                                        {{-- <select name="controlled_user_department"
                                                            id="controlled_user_department" class="form-control"
                                                            {{ Helpers::isRevised($document->stage) }}>
                                                            <option value="" disabled selected>Enter your Selection
                                                            </option>

                                                            @foreach (Helpers::getDepartments() as $code => $department)
                                                                <option value="{{ $code }}"
                                                                    @if ($document->controlled_user_department == $code) selected @endif>
                                                                    {{ $department }}
                                                                </option>
                                                            @endforeach
                                                        </select> --}}
                                                    </div>
                                                </div>
                                            </td>
                                            {{-- <td>
                                                <select id="department-controlled" class="form-control"
                                                    placeholder="Select..." name="controlled_user_department">
                                                    <option value="">Select the departments</option>
                                                    @foreach ($departments as $department)
                                                        <option value="{{ $department->id }}"
                                                            {{ $document->controlled_user_department == $department->id ? 'selected' : '' }}>
                                                            {{ $department->name }}
                                                        </option>
                                                    @endforeach
                                                </select>
                                            </td> --}}
                                        </tr>
                                        <tr>
                                            <td>3</td>
                                            <td style="font-weight: bold;">Display Copy</td>
                                            <td><input type="text" id="copies-display"
                                                    name="display_copy_number"
                                                    value="{{ $document->display_copy_number }}" class="form-control">
                                            </td>
                                            <td>
                                                <div class="col-md-12">
                                                    <div class="group-input">
                                                        <input type="text" name="display_user_department" value="{{$document->display_user_department}}">
                                                        {{-- <select name="display_user_department"
                                                            id="display_user_department" class="form-control"
                                                            {{ Helpers::isRevised($document->stage) }}>
                                                            <option value="" disabled selected>Enter your Selection
                                                            </option>

                                                            @foreach (Helpers::getDepartments() as $code => $department)
                                                                <option value="{{ $code }}"
                                                                    @if ($document->display_user_department == $code) selected @endif>
                                                                    {{ $department }}
                                                                </option>
                                                            @endforeach
                                                        </select> --}}
                                                    </div>
                                                </div>
                                            </td>
                                            {{-- <td>
                                                <select id="department-display" class="form-control"
                                                    placeholder="Select..." name="display_user_department">
                                                    <option value="">Select the departments</option>
                                                    @foreach ($departments as $department)
                                                        <option value="{{ $department->id }}"
                                                            {{ $document->display_user_department == $department->id ? 'selected' : '' }}>
                                                            {{ $department->name }}
                                                        </option>
                                                    @endforeach
                                                </select>
                                            </td> --}}
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>


                        {{-- <div class="col-md-12">
                            <div class="group-input">
                                <label for="test">
                                    Revision History
                                </label>
                                <div><small class="text-primary"></small></div>
                                <div class="table-responsive retrieve-table">
                                <table class="table-bordered table" id="">
                                    <thead>
                                        <tr>
                                            <th>Sr. No.</th>
                                            <th class="copy-name">Revision No.</th>
                                            <th class="copy-name">Change Control No./ DCRF No</th>
                                            <th class="copy-name">Effective Date</th>
                                            <th class="copy-name">Reason of revision</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @if($document->revised == 'Yes')
                                            <tr>
                                                <td>1</td>
                                                <td><input type="text" name="revision_number[]" value="{{ $document->revised_doc }}" class="form-control"></td>
                                                <td><input type="text" name="cc_no[]" value="{{ $document->cc_no }}" class="form-control"></td>
                                                <td><input type="text" name="effective_date[]" value="{{ Helpers::getDateFormat($document->effective_date) }}" class="form-control"></td>
                                                <td><input type="text" name="reason[]" value="{{ $document->reason }}" class="form-control"></td>
                                            </tr>
                                        @else
                                            <tr>
                                                <td>1</td>
                                                <td><input type="text" name="revision_number[]" value="" class="form-control">NA</td>
                                                <td><input type="text" name="cc_no[]" value="" class="form-control">NA</td>
                                                <td><input type="text" name="effective_date[]" value="" class="form-control">NA</td>
                                                <td><input type="text" name="reason[]" value="" class="form-control">NA</td>
                                            </tr>
                                        @endif
                                    </tbody>
                                </table>
                                </div>
                            </div>
                        </div> --}}

                        <div class="group-input">
                            <label for="action-plan-grid">
                                Revision History<button type="button" name="action-plan-grid"
                                        id="Details_add_revision">+</button>
                            </label>
                            <div class="table-responsive">
                                <table class="table table-bordered" id="Details-table-revision">
                                    <thead>
                                        <tr>
                                            <th style="width: 2%">Sr. No.</th>
                                            <th style="width: 12%">Revision No.</th>
                                            <th style="width: 12%">Change Control No./ DCRF No</th>
                                            <th style="width: 12%">Effective Date</th>
                                            <th style="width: 30%">Reason of revision</th>
                                            <th style="width: 3%">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @php
                                            $serialNumber = 1;
                                            $GtpData = isset($RevisionHistoryData->data) && is_string($RevisionHistoryData->data)
                                                ? json_decode($RevisionHistoryData->data, true)
                                                : (is_array($RevisionHistoryData->data) ? $RevisionHistoryData->data : []);
                                        @endphp

                                        @if(!empty($GtpData))
                                            @foreach($GtpData as $key => $gtp_data)
                                                <tr>
                                                    <td>{{ $serialNumber++ }}</td>
                                                    <td><input type="text" name="revision_history[{{ $key }}][revision_number]" value="{{ $gtp_data['revision_number'] ?? '' }}"></td>
                                                    <td><input type="text" name="revision_history[{{ $key }}][cc_no]" value="{{ $gtp_data['cc_no'] ?? '' }}"></td>
                                                    <td><input type="date" name="revision_history[{{ $key }}][revised_effective_date]" value="{{ $gtp_data['revised_effective_date'] ?? '' }}"></td>
                                                    <td><input type="text" name="revision_history[{{ $key }}][reason_of_revision]" value="{{ $gtp_data['reason_of_revision'] ?? '' }}"></td>
                                                    <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                </tr>
                                            @endforeach
                                        @else
                                            <tr>
                                                <td>{{ $serialNumber++ }}</td>
                                                <td><input type="text" name="revision_history[0][revision_number]"></td>
                                                <td><input type="text" name="revision_history[0][cc_no]"></td>
                                                <td><input type="date" name="revision_history[0][revised_effective_date]"></td>
                                                <td><input type="text" name="revision_history[0][reason_of_revision]"></td>
                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                            </tr>
                                        @endif
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <script>
                            $(document).ready(function() {
                                function updateSerialNumbers() {
                                    $('#Details-table-revision tbody tr').each(function(index) {
                                        $(this).find('td:first-child input').val(index + 1); // Update Sr. No
                                        $(this).find('td:nth-child(2) input').attr('name', `gtp[${index}][test_gtp]`);
                                    });
                                }

                                $('#Details_add_revision').click(function() {
                                    var serialNumber = $('#Details-table-revision tbody tr').length + 1; // Get the next serial number
                                    var newRow = `
                                        <tr>
                                            <td><input disabled type="text" style="width:40px; text-align:center;" value="${serialNumber}"></td>
                                            <td><input type="text" name="revision_history[${serialNumber - 1}][revision_number]" value=""></td>
                                            <td><input type="text" name="revision_history[${serialNumber - 1}][cc_no]" value=""></td>
                                            <td><input type="date" name="revision_history[${serialNumber - 1}][revised_effective_date]" value=""></td>
                                            <td><input type="text" name="revision_history[${serialNumber - 1}][reason_of_revision]" value=""></td>
                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                        </tr>`;

                                    $('#Details-table-revision tbody').append(newRow);
                                });

                                // Remove row functionality
                                $(document).on('click', '.removeRowBtn', function() {
                                    $(this).closest('tr').remove();
                                    updateSerialNumbers(); // Update serial numbers after removal
                                });
                            });
                        </script>


                    <div class="button-block">
                        <button type="submit" name="submit" value="save" class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                    </div>
                </div>

                {{-- HOD REMARKS TAB START --}}
                {{-- <div id="hod-remarks-tab" class="tabcontent">

                    <div class="input-fields">
                        <div class="group-input">
                            <label for="hod-remark">HOD Comments</label>
                            <textarea class="summernote {{ !Helpers::checkRoles(4) ? 'summernote-disabled' : '' }}" name="hod_comments">{{ $document->document_content ? $document->document_content->hod_comments : '' }}</textarea>
                        </div>
                    </div>

                    <div class="input-fields">
                        <label for="tran-attach">HOD Attachments</label>
                        <div class="file-attachment-field">
                            <div class="file-attachment-list" id="hod_attachments">
                                @if ($document->document_content && $document->document_content->hod_attachments)
                                    @foreach (json_decode($document->document_content->hod_attachments) as $file)
                                        <h6 type="button" class="file-container text-dark"
                                            style="background-color: rgb(243, 242, 240);">
                                            <input type="hidden"
                                                name="existing_hod_attachments[{{ $file }}]">
                                            <b>{{ $file }}</b>
                                            <a href="{{ asset('upload/' . $file) }}" target="_blank"><i
                                                    class="fa fa-eye text-primary"
                                                    style="font-size:20px; margin-right:-10px;"></i></a>
                                            <a type="button" class="remove-file"
                                                data-file-name="{{ $file }}"><i
                                                    class="fa-solid fa-circle-xmark"
                                                    style="color:red; font-size:20px;"></i></a>
                                        </h6>
                                    @endforeach
                                @endif
                            </div>
                            <div class="add-btn">
                                <div class="{{ !Helpers::checkRoles(4) ? 'btn-disabled' : 'add-hod-attachment-btn' }} ">
                                    Add</div>
                                <input type="file" id="myfile" name="hod_attachments[]"
                                    class="add-hod-attachment-file" oninput="addMultipleFiles(this, 'hod_attachments')"
                                    multiple>
                            </div>
                        </div>

                    </div>

                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>

                </div> --}}
                {{-- HOD REMARKS TAB END --}}


                    <!-- MFPS Tabs -->
                    <div id="doc-mfps" class="tabcontent">
                        <div class="orig-head">
                            Master Finished Product Specification
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="doc-type">Specification No</label>
                                        <input type="text" id="specification" name="specification_mfps_no" value="{{ $document->specification_mfps_no }}" maxlength="255">
                                    </div>
                                </div> --}}
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="stp">Specification No</label>
                                        @php
                                            $revisionNumber = $document->revised == 'Yes' ? str_pad($document->revised_doc, 2, '0', STR_PAD_LEFT) : '00';
                                            $stpNumber = "MFPS/A/" . str_pad($document->id, 4, '0', STR_PAD_LEFT) . "-$revisionNumber";
                                        @endphp
                                        <input type="text" id="stp" name="stp_mfps_no" value="{{ $stpNumber }}" maxlength="255" readonly>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="doc-type">Name of Product</label>
                                        <input type="text" id="mfproduct" name="mfproduct_name" value="{{ $document->mfproduct_name }}" maxlength="255">
                                    </div>
                                </div>
                                <div class="col-12 sub-head">
                                        SPECIFICATION
                                    <div class="group-input">
                                        <label for="procedure"></label>
                                        
                                        <textarea name="master_specification" id="" class="summernote">{{ $document->master_specification ? $document->master_specification : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                    <div class="group-input">
                                        <label for="action-plan-grid">
                                            Revision History<button type="button" name="action-plan-grid"
                                                    id="mfps_revision">+</button>
                                        </label>
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="table_mfps_revision">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 2%">Sr. No.</th>
                                                        <th style="width: 12%">Revision No.</th>
                                                        <th style="width: 12%">Change Control No./ DCRF No</th>
                                                        <th style="width: 12%">Effective Date</th>
                                                        <th style="width: 30%">Reason of revision</th>
                                                        <th style="width: 3%">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @php
                                                        $serialNumber = 1;
                                                        $GtpData = isset($RevisionGridmfpsData->data) && is_string($RevisionGridmfpsData->data)
                                                            ? json_decode($RevisionGridmfpsData->data, true)
                                                            : (is_array($RevisionGridmfpsData->data) ? $RevisionGridmfpsData->data : []);
                                                    @endphp

                                                    @if(!empty($GtpData))
                                                        @foreach($GtpData as $key => $gtp_data)
                                                            <tr>
                                                                <td>{{ $serialNumber++ }}</td>
                                                                <td><input type="text" name="revision_mfps_data[{{ $key }}][rev_mfps_no]" value="{{ $gtp_data['rev_mfps_no'] ?? '' }}"></td>
                                                                <td><input type="text" name="revision_mfps_data[{{ $key }}][change_ctrl_mfps_no]" value="{{ $gtp_data['change_ctrl_mfps_no'] ?? '' }}"></td>
                                                                <td><input type="date" name="revision_mfps_data[{{ $key }}][eff_date_mfps]" value="{{ $gtp_data['eff_date_mfps'] ?? '' }}"></td>
                                                                <td><input type="text" name="revision_mfps_data[{{ $key }}][rev_reason_mfps]" value="{{ $gtp_data['rev_reason_mfps'] ?? '' }}"></td>
                                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                            </tr>
                                                        @endforeach
                                                    @else
                                                        <tr>
                                                            <td>{{ $serialNumber++ }}</td>
                                                            <td><input type="text" name="revision_mfps_data[0][rev_mfps_no]"></td>
                                                            <td><input type="text" name="revision_mfps_data[0][change_ctrl_mfps_no]"></td>
                                                            <td><input type="date" name="revision_mfps_data[0][eff_date_mfps]"></td>
                                                            <td><input type="text" name="revision_mfps_data[0][rev_reason_mfps]"></td>
                                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                        </tr>
                                                    @endif
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <script>
                                        $(document).ready(function() {
                                            function updateSerialNumbers() {
                                                $('#table_mfps_revision tbody tr').each(function(index) {
                                                    $(this).find('td:first-child input').val(index + 1); // Update Sr. No
                                                    $(this).find('td:nth-child(2) input').attr('name', `gtp[${index}][test_gtp]`);
                                                });
                                            }

                                            $('#mfps_revision').click(function() {
                                                var serialNumber = $('#table_mfps_revision tbody tr').length + 1; // Get the next serial number
                                                var newRow = `
                                                    <tr>
                                                        <td><input disabled type="text" style="width:40px; text-align:center;" value="${serialNumber}"></td>
                                                        <td><input type="text" name="revision_mfps_data[${serialNumber - 1}][rev_mfps_no]" value=""></td>
                                                        <td><input type="text" name="revision_mfps_data[${serialNumber - 1}][change_ctrl_mfps_no]" value=""></td>
                                                        <td><input type="date" name="revision_mfps_data[${serialNumber - 1}][eff_date_mfps]" value=""></td>
                                                        <td><input type="text" name="revision_mfps_data[${serialNumber - 1}][rev_reason_mfps]" value=""></td>
                                                        <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                    </tr>`;

                                                $('#table_mfps_revision tbody').append(newRow);
                                            });

                                            // Remove row functionality
                                            $(document).on('click', '.removeRowBtn', function() {
                                                $(this).closest('tr').remove();
                                                updateSerialNumbers(); // Update serial numbers after removal
                                            });
                                        });
                                    </script>




                                


                            </div>
                        </div>
                            
                            <div class="button-block">
                                <button type="submit" value="save" name="submit" id="DocsaveButton"
                                    class="saveButton">Save</button>
                                <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                    </a>
                                </button>
                            </div>
                    </div>

                    <!-- mfpstp -->
                    <div id="doc-mfpstp" class="tabcontent">
                        <div class="orig-head">
                             Master Finished Product Standard Testing Procedure
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="stp">Specification No</label>
                                        @php
                                            $revisionNumber = $document->revised == 'Yes' ? str_pad($document->revised_doc, 2, '0', STR_PAD_LEFT) : '00';
                                            $mfpstpNumber = "MFP/STP/A/" . str_pad($document->id, 4, '0', STR_PAD_LEFT) . "-$revisionNumber";
                                        @endphp
                                        <input type="text" id="stp" name="stp_mfpstp_no" value="{{ $mfpstpNumber }}" maxlength="255" readonly>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="reference">Product Name</label>
                                        <input type="text" name="product_name_mstp" value="{{$document->document_content->product_name_mstp}}">
                                    </div>
                                </div>


                                {{-- <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="doc-type">Specification No</label>
                                        <input type="text" id="specification" name="specification_mfpstp_no" maxlength="255" value="{{$document->specification_mfpstp_no}}" >
                                    </div>
                                </div> --}}

                                <div class="col-12 sub-head">
                                     Standard Testing procedure
                                    <div class="group-input">
                                        <label for="procedure"></label>
                                        
                                        <textarea name="mfpstp_specification" id="" class="summernote">{{ $document->mfpstp_specification ? $document->mfpstp_specification : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                <div class="group-input">
                                        <label for="action-plan-grid">
                                            Revision History<button type="button" name="action-plan-grid"
                                                    id="mfpstp_revision">+</button>
                                        </label>
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="table_mfpstp_revision">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 2%">Sr. No.</th>
                                                        <th style="width: 12%">Revision No.</th>
                                                        <th style="width: 12%">Change Control No./ DCRF No</th>
                                                        <th style="width: 12%">Effective Date</th>
                                                        <th style="width: 30%">Reason of revision</th>
                                                        <th style="width: 3%">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @php
                                                        $serialNumber = 1;
                                                        $GtpData = isset($RevisionGridmfpstpData->data) && is_string($RevisionGridmfpstpData->data)
                                                            ? json_decode($RevisionGridmfpstpData->data, true)
                                                            : (is_array($RevisionGridmfpstpData->data) ? $RevisionGridmfpstpData->data : []);
                                                    @endphp

                                                    @if(!empty($GtpData))
                                                        @foreach($GtpData as $key => $gtp_data)
                                                            <tr>
                                                                <td>{{ $serialNumber++ }}</td>
                                                                <td><input type="text" name="revision_mfpstp_data[{{ $key }}][rev_mfpstp_no]" value="{{ $gtp_data['rev_mfpstp_no'] ?? '' }}"></td>
                                                                <td><input type="text" name="revision_mfpstp_data[{{ $key }}][change_ctrl_mfpstp_no]" value="{{ $gtp_data['change_ctrl_mfpstp_no'] ?? '' }}"></td>
                                                                <td><input type="date" name="revision_mfpstp_data[{{ $key }}][eff_date_mfpstp]" value="{{ $gtp_data['eff_date_mfpstp'] ?? '' }}"></td>
                                                                <td><input type="text" name="revision_mfpstp_data[{{ $key }}][rev_reason_mfpstp]" value="{{ $gtp_data['rev_reason_mfpstp'] ?? '' }}"></td>
                                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                            </tr>
                                                        @endforeach
                                                    @else
                                                        <tr>
                                                            <td>{{ $serialNumber++ }}</td>
                                                            <td><input type="text" name="revision_mfpstp_data[0][rev_mfpstp_no]"></td>
                                                            <td><input type="text" name="revision_mfpstp_data[0][change_ctrl_mfpstp_no]"></td>
                                                            <td><input type="date" name="revision_mfpstp_data[0][eff_date_mfpstp]"></td>
                                                            <td><input type="text" name="revision_mfpstp_data[0][rev_reason_mfpstp]"></td>
                                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                        </tr>
                                                    @endif
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <script>
                                        $(document).ready(function() {
                                            function updateSerialNumbers() {
                                                $('#table_mfpstp_revision tbody tr').each(function(index) {
                                                    $(this).find('td:first-child input').val(index + 1); // Update Sr. No
                                                    $(this).find('td:nth-child(2) input').attr('name', `gtp[${index}][test_gtp]`);
                                                });
                                            }

                                            $('#mfpstp_revision').click(function() {
                                                var serialNumber = $('#table_mfpstp_revision tbody tr').length + 1; // Get the next serial number
                                                var newRow = `
                                                    <tr>
                                                        <td><input disabled type="text" style="width:40px; text-align:center;" value="${serialNumber}"></td>
                                                        <td><input type="text" name="revision_mfpstp_data[${serialNumber - 1}][rev_mfpstp_no]" value=""></td>
                                                        <td><input type="text" name="revision_mfpstp_data[${serialNumber - 1}][change_ctrl_mfpstp_no]" value=""></td>
                                                        <td><input type="date" name="revision_mfpstp_data[${serialNumber - 1}][eff_date_mfpstp]" value=""></td>
                                                        <td><input type="text" name="revision_mfpstp_data[${serialNumber - 1}][rev_reason_mfpstp]" value=""></td>
                                                        <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                    </tr>`;

                                                $('#table_mfpstp_revision tbody').append(newRow);
                                            });

                                            // Remove row functionality
                                            $(document).on('click', '.removeRowBtn', function() {
                                                $(this).closest('tr').remove();
                                                updateSerialNumbers(); // Update serial numbers after removal
                                            });
                                        });
                                    </script>




                            </div>
                        </div>



                        <div class="button-block">
                            <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                            <button type="button" class="backButton" onclick="previousStep()">Back</button>
                            <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                            <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                </a>
                            </button>
                        </div>
                    </div>

                    <script>
                        document.addEventListener("DOMContentLoaded", function () {
                            function addSpecificationsTesting() {
                                let tableBody = document.querySelector("#specifications-testing tbody");
                                let rowCount = tableBody.querySelectorAll("tr").length;
                                let newRow = document.createElement("tr");

                                newRow.innerHTML = `
                                    <td>${rowCount + 1}</td>
                                    <td><input type="text" name="specifications_testing[${rowCount}][tests]"></td>
                                    <td><button type="button" class="removeSpecRow">Remove</button></td>
                                `;

                                tableBody.appendChild(newRow);
                                updateSerialNumbers();
                            }

                            document.addEventListener("click", function (event) {
                                if (event.target.classList.contains("removeSpecRow")) {
                                    let row = event.target.closest("tr");
                                    row.remove();
                                    updateSerialNumbers();
                                }
                            });

                            function updateSerialNumbers() {
                                let rows = document.querySelectorAll("#specifications-testing tbody tr");
                                rows.forEach((row, index) => {
                                    row.cells[0].textContent = index + 1;
                                    row.querySelectorAll("input").forEach(input => {
                                        let nameMatch = input.name.match(/specifications_testing\[\d+]\[(.+)]/);
                                        if (nameMatch) {
                                            input.name = `specifications_testing[${index}][${nameMatch[1]}]`;
                                        }
                                    });
                                });
                            }

                            window.addSpecificationsTesting = addSpecificationsTesting;
                        });
                    </script>

                    <!-- Study Report Tab -->
                    <div id="doc-study" class="tabcontent">
                        <div class="orig-head">
                            Study Report
                        </div>
                        {{--
                        <div class="input-fields">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="study_purpose">Objective</label>
                                        <textarea name="study_purpose" {{ Helpers::isRevised($document->stage) }}>{{ $document->document_content ? $document->document_content->study_purpose : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Objective' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="study_purpose_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="study_scope">Scope</label>

                                        <textarea name="study_scope" {{ Helpers::isRevised($document->stage) }}>{{ $document->document_content ? $document->document_content->study_scope : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Scope' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="study_scope_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="responsibilities" id="responsibilities">
                                            Responsibilities<button type="button" id="responsibilitiesbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="responsibilitiesdiv">
                                            @if ($document->document_content && !empty($document->document_content->responsibilities))
                                                @foreach (unserialize($document->document_content->responsibilities) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleResponsibilitiesBlock' : 'singleResponsibilitiesBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="responsibilities[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="responsibilities[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subResponsibilitiesAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleResponsibilitiesBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="responsibilities[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subResponsibilitiesAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Responsibilities' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="responsibilities_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif



                                <div class="col-md-12">
                                    <div class="group-input">

                                        <label for="referencesss" id="referencesss">
                                            References(if any)<button type="button" id="referencesssbtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="referencesssdiv">
                                            @if ($document->document_content && !empty($document->document_content->referencesss))
                                                @foreach (unserialize($document->document_content->referencesss) as $key => $data)
                                                    @if (!empty($data))
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSingleReferencesssBlock' : 'singleReferencesssBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="referencesss[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="referencesss[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subReferencesssAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endif
                                                @endforeach
                                            @else
                                                <div class="singleReferencesssBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="referencesss[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subReferencesssAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif

                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Referencesss' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;color: black;"

                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach




                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="referencesss_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="assessment" id="assessment">
                                            Assessment & Evaluation<button type="button" id="assessmentbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="assessmentdiv">
                                            @if ($document->document_content && !empty($document->document_content->assessment))
                                                @foreach (unserialize($document->document_content->assessment) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleAssessmentBlock' : 'singleAssessmentBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="assessment[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="assessment[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subAssessmentAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Assessment & Evaluation' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="assessment_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="strategy" id="strategy">
                                            Strategy of Evaluation<button type="button" id="Strategybtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="strategydiv">
                                            @if ($document->document_content && !empty($document->document_content->strategy))
                                                @foreach (unserialize($document->document_content->strategy) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleStrategyBlock' : 'singleStrategyBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="strategy[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="strategy[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subStrategyAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Strategy of Evaluation' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="strategy_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="summary" id="summary">
                                            Summary & Findings<button type="button" id="newSummarybtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        @if ($document->document_content && !empty($document->document_content->summary_and_findings))
                                            <div id="summarydiv">
                                                @foreach (unserialize($document->document_content->summary_and_findings) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleSummaryBlock' : 'singleSummaryBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="summary_and_findings[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="summary_and_findings[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>

                                                                <div class="col-sm-1">
                                                                    <button type="button" class="subSummaryAdd"
                                                                        name="button"
                                                                        {{ Helpers::isRevised($document->stage) }}>+</button>
                                                                </div>

                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            </div>
                                        @else
                                            <div class="singleSummaryBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="summary_and_findings[]" class="myclassname"></textarea>
                                                    </div>

                                                    <div class="col-sm-1">
                                                        <button type="button" class="subSummaryAdd" name="button"
                                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                                    </div>

                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif

                                    <div id="summarydiv"></div>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Summary & Findings' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text"
                                                name="summary_and_findings_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="conclusion" id="conclusion">
                                            Conclusion & Recommendation<button type="button" id="conclusionbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="conclusiondiv">
                                            @if ($document->document_content && !empty($document->document_content->conclusion_and_recommendations))
                                                @foreach (unserialize($document->document_content->conclusion_and_recommendations) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleConclusionBlock' : 'singleConclusionBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="conclusion_and_recommendations[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="conclusion_and_recommendations[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subConclusionAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleConclusionBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="conclusion_and_recommendations[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subConclusionAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Conclusion & Recommendation' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="conclusion_and_recommendations_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="procedure">Attachment</label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <textarea name="study_attachments" id="summernote" class="summernote">{{ $document->document_content ? $document->document_content->study_attachments : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Attachment' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>


                            </div>
                        </div>
                        --}}

                        <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="attachment_srtDatafield">
                                            @if ($document->attachment_srt)
                                                @foreach(json_decode($document->attachment_srt) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_attachment_srt[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="attachment_srtData" style="cursor: pointer;">Add</label>
                                            <input type="file" id="attachment_srtData" name="attachment_srt[]"
                                                oninput="addMultipleFiles(this, 'attachment_srtDatafield')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_attachment_srt" name="deleted_attachment_srt" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_attachment_srt');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>
                        <div class="button-block">
                                    <button type="submit" name="submit" value="save" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                </div>
                    </div>



                  <!-- Study Protocol Tabs -->
                    <div id="doc-stprotocol" class="tabcontent">
                        <div class="orig-head">
                            Study Protocol
                        </div>
                    {{--
                        <div class="input-fields">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="stprotocol_purpose">Objective</label>
                                        <textarea name="stprotocol_purpose" {{ Helpers::isRevised($document->stage) }}>{{ $document->document_content ? $document->document_content->stprotocol_purpose : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Objective' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="stprotocol_purpose_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="stprotocol_scope">Scope</label>

                                        <textarea name="stprotocol_scope" {{ Helpers::isRevised($document->stage) }}>{{ $document->document_content ? $document->document_content->stprotocol_scope : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Scope' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="stprotocol_scope_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="stresponsibility" id="stresponsibility">
                                            Responsibilities<button type="button" id="stresponsibilitybtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="stresponsibilitydiv">
                                            @if ($document->document_content && !empty($document->document_content->stresponsibility))
                                                @foreach (unserialize($document->document_content->stresponsibility) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleStResponsibilityBlock' : 'singleStResponsibilityBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="stresponsibility[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="stresponsibility[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark substResponsibilityAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleStResponsibilityBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="stresponsibility[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark substResponsibilityAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Responsibilities' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="stresponsibility_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif



                                <div class="col-md-12">
                                    <div class="group-input">

                                        <label for="stdefination" id="stdefination">
                                            Defination<button type="button" id="stdefinationbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="stdefinationdiv">
                                            @if ($document->document_content && !empty($document->document_content->stdefination))
                                                @foreach (unserialize($document->document_content->stdefination) as $key => $data)
                                                    @if (!empty($data))
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSinglestdefinationBlock' : 'singlestdefinationBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="stdefination[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="stdefination[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark substdefinationAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endif
                                                @endforeach
                                            @else
                                                <div class="singlestdefinationBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="stdefination[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark substdefinationAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif

                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Defination' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;color: black;"

                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach




                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="stdefination_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="streferences" id="streferences">
                                            References(if any)<button type="button" id="streferencesbtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="streferencesdiv">
                                            @if ($document->document_content && !empty($document->document_content->streferences))
                                                @foreach (unserialize($document->document_content->streferences) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSinglestreferencesBlock' : 'singlestreferencesBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="streferences[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="streferences[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark substreferencesAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'References(if any)' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="streferences_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="stbackground" id="stbackground">
                                            Background/History(if any)<button type="button" id="stbackgroundbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="stbackgrounddiv">
                                            @if ($document->document_content && !empty($document->document_content->stbackground))
                                                @foreach (unserialize($document->document_content->stbackground) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSinglestbackgroundBlock' : 'singlestbackgroundBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="stbackground[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="stbackground[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark substbackgroundAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Background/History(if any)' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="stbackground_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="stassessment" id="stassessment">
                                            Assessment/Evaluation<button type="button" id="stassessmentbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        @if ($document->document_content && !empty($document->document_content->stassessment))
                                            <div id="stassessmentdiv">
                                                @foreach (unserialize($document->document_content->stassessment) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSinglestassessmentBlock' : 'singlestassessmentBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="stassessment[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="stassessment[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>

                                                                <div class="col-sm-1">
                                                                    <button type="button" class="substassessmentAdd"
                                                                        name="button"
                                                                        {{ Helpers::isRevised($document->stage) }}>+</button>
                                                                </div>

                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            </div>
                                        @else
                                            <div class="singlestassessmentBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="stassessment[]" class="myclassname"></textarea>
                                                    </div>

                                                    <div class="col-sm-1">
                                                        <button type="button" class="substassessmentAdd" name="button"
                                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                                    </div>

                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif

                                    <div id="stassessmentdiv"></div>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Assessment/Evaluation' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text"
                                                name="stassessment_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="ststrategy" id="ststrategy">
                                            Strategy Methodology<button type="button" id="ststrategybtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="ststrategyBlock">
                                            @if ($document->document_content && !empty($document->document_content->ststrategy))
                                                @foreach (unserialize($document->document_content->ststrategy) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleststrategyBlock' : 'singleststrategyBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="ststrategy[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="ststrategy[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subststrategyAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleststrategyBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="ststrategy[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subststrategyAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Strategy Methodology' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="ststrategy_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="stsummary" id="stsummary">
                                            Summary & Findings<button type="button" id="stsummarybtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="stsummarydiv">
                                            @if ($document->document_content && !empty($document->document_content->stsummary))
                                                @foreach (unserialize($document->document_content->stsummary) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsinglestsummaryBlock' : 'singlestsummaryBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="stsummary[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="stsummary[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark substsummaryAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singlestsummaryBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="stsummary[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark substsummaryAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Summary & Findings' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="stsummary_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="stconclusion" id="stconclusion">
                                            Conclusion<button type="button" id="stconclusionbtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="stconclusiondiv">
                                            @if ($document->document_content && !empty($document->document_content->stconclusion))
                                                @foreach (unserialize($document->document_content->stconclusion) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsinglestconclusionBlock' : 'singlestconclusionBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="stconclusion[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="stconclusion[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark substconclusionAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singlestconclusionBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="stconclusion[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark substconclusionAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Conclusion' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="stconclusion_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="stannexure" id="stannexure">
                                            Annexure<button type="button" id="stannexurebtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="stannexurediv">
                                            @if ($document->document_content && !empty($document->document_content->stannexure))
                                                @foreach (unserialize($document->document_content->stannexure) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsinglestannexureBlock' : 'singlestannexureBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="stannexure[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="stannexure[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark substannexureAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singlestannexureBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="stannexure[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark substannexureAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Annexure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="stannexure_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Doc_No" id="Doc_No">
                                            Reference Document Number (if any)<button type="button" id="Referencedocunumadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="Referencedocunumdiv">
                                            @if ($document->document_content && !empty($document->document_content->Referencedocunum))
                                                @foreach (unserialize($document->document_content->Referencedocunum) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsingleReferencedocunumBlock' : 'singleReferencedocunumBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="Referencedocunum[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="Referencedocunum[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark substReferencedocunumAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleReferencedocunumBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="Referencedocunum[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark substReferencedocunumAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Reference Document Number (if any)' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Referencedocunum_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif






                            </div>
                        </div>
                         --}}


                         <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="attachment_sptfield">
                                            @if ($document->attachment_spt)
                                                @foreach(json_decode($document->attachment_spt) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_attachment_spt[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="attachment_sptData" style="cursor: pointer;">Add</label>
                                            <input type="file" id="attachment_sptData" name="attachment_spt[]"
                                                oninput="addMultipleFiles(this, 'attachment_sptfield')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_attachment_spt" name="deleted_attachment_spt" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_attachment_spt');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>
                        <div class="button-block">
                                    <button type="submit" name="submit" value="save" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                </div>
                    </div>


                <!-- Equipment Hold Time Study Report Tab -->

                    <div id="doc-eqpreport" class="tabcontent">
                        <div class="orig-head">
                            Equipment Hold Time Study Report
                        </div>
                        {{--
                        <div class="input-fields">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="equipment_objective">Objective</label>
                                        <textarea name="equipment_objective" {{ Helpers::isRevised($document->stage) }}>{{ $document->document_content ? $document->document_content->equipment_objective : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Objective' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="equipment_objective_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="equipment_scope">Scope</label>

                                        <textarea name="equipment_scope" {{ Helpers::isRevised($document->stage) }}>{{ $document->document_content ? $document->document_content->equipment_scope : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Scope' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="equipment_scope_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="equipment_purpose">Purpose</label>

                                        <textarea name="equipment_purpose" {{ Helpers::isRevised($document->stage) }}>{{ $document->document_content ? $document->document_content->equipment_purpose : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Scope' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="equipment_purpose_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="euipmentresponsibility" id="euipmentresponsibility">
                                            Responsibilities<button type="button" id="euipmentresponsibilitybtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="euipmentresponsibilitydiv">
                                            @if ($document->document_content && !empty($document->document_content->euipmentresponsibility))
                                                @foreach (unserialize($document->document_content->euipmentresponsibility) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleEuipmentResponsibilityBlock' : 'singleEuipmentResponsibilityBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="euipmentresponsibility[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="euipmentresponsibility[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subEuipmentResponsibilityAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleEuipmentResponsibilityBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="euipmentresponsibility[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subEuipmentResponsibilityAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Responsibilities' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="euipmentresponsibility_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif



                                <div class="col-md-12">
                                    <div class="group-input">

                                        <label for="AnalyticalReport" id="AnalyticalReport">
                                            Analytical Report<button type="button" id="eqpAnalyticalReportbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="eqpAnalyticalReportdiv">
                                            @if ($document->document_content && !empty($document->document_content->eqpAnalyticalReport))
                                                @foreach (unserialize($document->document_content->eqpAnalyticalReport) as $key => $data)
                                                    @if (!empty($data))
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSingleEqpAnalyticalReportBlock' : 'singleEqpAnalyticalReportBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="eqpAnalyticalReport[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="eqpAnalyticalReport[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subEqpAnalyticalReportAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endif
                                                @endforeach
                                            @else
                                                <div class="singlestdefinationBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="eqpAnalyticalReport[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subEqpAnalyticalReportAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif

                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Analytical Report' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;color: black;"

                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach




                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="eqpAnalyticalReport_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="eqpdeviation" id="eqpdeviation">
                                            Deviation (If Any)<button type="button" id="eqpdeviationbtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="eqpdeviationdiv">
                                            @if ($document->document_content && !empty($document->document_content->eqpdeviation))
                                                @foreach (unserialize($document->document_content->eqpdeviation) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleEqpdeviationBlock' : 'singleEqpdeviationBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="eqpdeviation[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="eqpdeviation[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subEqpdeviationAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Deviation (If Any)' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="eqpdeviation_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="eqpchangecontrol" id="eqpchangecontrol">
                                            Change Control ( If Any)<button type="button" id="eqpchangecontrolbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="eqpchangecontroldiv">
                                            @if ($document->document_content && !empty($document->document_content->eqpchangecontrol))
                                                @foreach (unserialize($document->document_content->eqpchangecontrol) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleEqpchangecontrolBlock' : 'singleEqpchangecontrolBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="eqpchangecontrol[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="eqpchangecontrol[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subEqpchangecontrolAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Change Control ( If Any)' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="eqpchangecontrol_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="eqpsummary" id="eqpsummary">
                                            Summary<button type="button" id="eqpsummarybtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        @if ($document->document_content && !empty($document->document_content->eqpsummary))
                                            <div id="eqpsummarydiv">
                                                @foreach (unserialize($document->document_content->eqpsummary) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleEqpsummaryBlock' : 'singleEqpsummaryBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="eqpsummary[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="eqpsummary[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>

                                                                <div class="col-sm-1">
                                                                    <button type="button" class="subEqpsummaryAdd"
                                                                        name="button"
                                                                        {{ Helpers::isRevised($document->stage) }}>+</button>
                                                                </div>

                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            </div>
                                        @else
                                            <div class="singleEqpsummaryBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="eqpsummary[]" class="myclassname"></textarea>
                                                    </div>

                                                    <div class="col-sm-1">
                                                        <button type="button" class="subEqpsummaryAdd" name="button"
                                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                                    </div>

                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif

                                    <div id="eqpsummarydiv"></div>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Summary' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text"
                                                name="Summary_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="eqpconclusion" id="eqpconclusion">
                                            Conclusion<button type="button" id="eqpconclusionbtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="eqpconclusiondiv">
                                            @if ($document->document_content && !empty($document->document_content->eqpconclusion))
                                                @foreach (unserialize($document->document_content->eqpconclusion) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleEqpconclusionBlock' : 'singleEqpconclusionBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="eqpconclusion[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="eqpconclusion[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subeqpconclusionAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleEqpconclusionBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="eqpconclusion[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subeqpconclusionAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Conclusion' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Conclusion_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="eqpreportapproval" id="eqpreportapproval">
                                            Report Approval<button type="button" id="eqpreportapprovalbtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="eqpreportapprovaldiv">
                                            @if ($document->document_content && !empty($document->document_content->eqpreportapproval))
                                                @foreach (unserialize($document->document_content->eqpreportapproval) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleEqpreportapprovalBlock' : 'singleEqpreportapprovalBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="eqpreportapproval[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="eqpreportapproval[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subeqpreportapprovalAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleEqpreportapprovalBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="eqpreportapproval[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subeqpreportapprovalAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Report Approval' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Approval_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif







                            </div>
                        </div>
                        --}}

                        <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="attachment_ehtsrfield">
                                            @if ($document->attachment_ehtsr)
                                                @foreach(json_decode($document->attachment_ehtsr) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_attachment_ehtsr[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="attachment_ehtsrData" style="cursor: pointer;">Add</label>
                                            <input type="file" id="attachment_ehtsrData" name="attachment_ehtsr[]"
                                                oninput="addMultipleFiles(this, 'attachment_ehtsrfield')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_attachment_ehtsr" name="deleted_attachment_ehtsr" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_attachment_ehtsr');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>
                        <div class="button-block">
                                    <button type="submit" name="submit" value="save" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                </div>
                    </div>





                    <!-- TDS Tabs -->
                <div id="doc-tds" class="tabcontent">
                        <div class="orig-head">
                            TEST  DATA SHEET
                        </div>
                        <div class="input-fields">
                            <div class="row">

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="comments">Product/Material Name</label>
                                        <input type="text" name="product_material_name" value="{{$document->product_material_name}}">
                                    </div>
                                </div>
                                {{-- <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="train-require">TDS No.</label>
                                        <input type="number" name="tds_no" value="{{$document->tds_no}}">
                                    </div>
                                </div> --}}

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="comments">TDS Code</label>
                                        <select name="tds_name_code" id="">
                                            <option value="">Select here</option>
                                            <option {{ $document->tds_name_code == 'FP' ? 'selected' : '' }}
                                                        value="FP">Finished Product</option>
                                            <option {{ $document->tds_name_code == 'IP' ? 'selected' : '' }}
                                                        value="IP">Inprocess Product</option>
                                            <option {{ $document->tds_name_code == 'CV' ? 'selected' : '' }}
                                                        value="CV">Cleaning Validation</option>
                                            <option {{ $document->tds_name_code == 'RW' ? 'selected' : '' }}
                                                        value="RW">Raw Material</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                    <label for="train-require">TDS No.</label>
                                        @php
                                            $revisionNumber = $document->revised == 'Yes' ? str_pad($document->revised_doc, 2, '0', STR_PAD_LEFT) : '00';
                                            $mfpstpNumber = "$document->tds_name_code TDS/" . str_pad($document->id, 4, '0', STR_PAD_LEFT) . "-$revisionNumber";
                                        @endphp
                                        <input type="text" id="stp" name="tds_no" value="{{ $mfpstpNumber }}" maxlength="255" readonly>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="train-require">Reference Standard/General Testing Procédure No</label>
                                        <input type="text" name="Reference_Standard" value="{{$document->Reference_Standard}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="train-require">Total no. of pages in report</label>
                                        <input type="text" name="total_no_pages" value="{{$document->total_no_pages}}">
                                    </div>
                                </div>

                                {{-- <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="batch_no">Batch No</label>
                                        <input type="text" name="batch_no" value="{{$document->batch_no}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="ar_no">A.R. No.</label>
                                        <input type="text" name="ar_no" value="{{$document->ar_no}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="ar_no">Mfg. Date</label>
                                        <input type="date" name="mfg_date" value="{{$document->mfg_date}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="ar_no">Exp. Date</label>
                                        <input type="date" name="exp_date" value="{{$document->exp_date}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="ar_no">Analysis start date</label>
                                        <input type="date" name="analysis_start_date" value="{{$document->analysis_start_date}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="ar_no">Analysis completion date </label>
                                        <input type="date" name="analysis_completion_date" value="{{$document->analysis_completion_date}}">
                                    </div>
                                </div> --}}

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="ar_no">Specification No</label>
                                        <input type="text" name="specification_no" value="{{$document->specification_no}}">
                                    </div>
                                </div>


                                    <div class="col-12 sub-head">
                                        A) Summary of Results

                                        <div class="group-input">
                                            <label for="procedure"></label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <textarea name="tds_result" id="" class="summernote">{{ $document->document_content ? $document->document_content->tds_result : '' }}</textarea>
                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>
                             
                            

                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="tds_remark">Remark</label>
                                    <textarea name="tds_remark">{{$document->tds_remark}}</textarea>
                                </div>
                            </div>

                            <div class="col-12 sub-head">
                                B) Test wise data and calculation:-

                                <div class="group-input">
                                    <label for="procedure"></label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <textarea name="tds_test_wise" id="" class="summernote">{{ $document->document_content ? $document->document_content->tds_test_wise : '' }}</textarea>
                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>

                            <div class="orig-head">
                               SAMPLE RECONCILATION
                            </div>
                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="name_of_material/sample">Name of Material/Sample</label>
                                    <input type="text" name="name_of_material_sample" value="{{$document->name_of_material_sample}}">
                                </div>
                            </div>
                            {{-- <div class="col-md-6">
                                <div class="group-input">
                                    <label for="name_of_material/sample">Batch No.</label>
                                    <input type="text" name="sample_reconcilation_batchNo" value="{{$document->sample_reconcilation_batchNo}}">
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="name_of_material/sample">A.R.No.</label>
                                    <input type="text" name="sample_reconcilation_arNo" value="{{$document->sample_reconcilation_arNo}}">
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="name_of_material/sample">Total Quantity Received</label>
                                    <input type="text" name="sample_quatity_received" value="{{$document->sample_quatity_received}}">
                                </div>
                            </div> --}}

                                <div class="col-12 sub-head">
                                        Sample Reconcilation
                                </div>
                                    <div class="group-input">
                                        <label for="audit-agenda-grid">
                                            <button type="button" name="audit-agenda-grid" id="ObservationSample">+</button>
                                            <span class="text-primary" data-bs-toggle="modal" data-bs-target="#observation-field-instruction-modal" style="font-size: 0.8rem; font-weight: 400; cursor: pointer;">
                                                (Launch Instruction)
                                            </span>
                                        </label>
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="job-ObservationSample-table" style="width: 100%;">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 5%;">Sr No.</th>
                                                        <th>Test Name</th>
                                                        <th>Quantity Required for test as per STP</th>
                                                        <th>Quantity Used for test</th>
                                                        <th>Used by (Sign/Date)</th>
                                                    </tr>
                                                </thead>
                                                <tbody>

                                                    @php
                                                    $ProductDetails = 1;
                                                    @endphp

                                                    @if(!empty($sampleReconcilation) && is_array($sampleReconcilation->data))
                                                        @foreach($sampleReconcilation->data as $index => $detail)
                                                            <tr>
                                                                <td>{{ $ProductDetails++ }}</td>
                                                                <td><input type="text" name="sampleReconcilation[{{$index}}][test_name]" value="{{ $detail['test_name'] ?? '' }}"></td>
                                                                <td><input type="text" name="sampleReconcilation[{{$index}}][quantity_test_stp]" value="{{ $detail['quantity_test_stp'] ?? '' }}"></td>
                                                                <td><input type="text" name="sampleReconcilation[{{$index}}][quantity_userd_test]" value="{{ $detail['quantity_userd_test'] ?? '' }}"></td>
                                                                <td></td>
                                                            </tr>
                                                        @endforeach
                                                    @else
                                                        <tr>
                                                            <td><input disabled type="text" name="sampleReconcilation[0][serial]" value="1"></td>
                                                            <td><input type="text" name="sampleReconcilation[0][test_name]"></td>
                                                            <td><input type="text" name="sampleReconcilation[0][quantity_test_stp]"></td>
                                                            <td><input type="text" name="sampleReconcilation[0][quantity_userd_test]"></td>
                                                            <td></td>
                                                        </tr>
                                                    @endif
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                <script>
                                    $(document).ready(function() {
                                        $('#ObservationSample').click(function(e) {
                                            function generateTableRow(serialNumber) {

                                                var html =
                                                    '<tr>' +
                                                    '<td><input disabled type="text" name="sampleReconcilation[' + serialNumber +
                                                    '][serial]" value="' + serialNumber +
                                                    '"></td>' +
                                                    '<td><input type="text" name="sampleReconcilation[' + serialNumber +
                                                    '][test_name]"></td>' +
                                                    '<td><input type="text" name="sampleReconcilation[' + serialNumber +
                                                    '][quantity_test_stp]"></td>' +
                                                    '<td><input type="text" name="sampleReconcilation[' + serialNumber +
                                                    '][quantity_userd_test]"></td>' +

                                                    '<td></td>' +
                                                    '</tr>';

                                                return html;
                                            }

                                            var tableBody = $('#job-ObservationSample-table tbody');
                                            var rowCount = tableBody.children('tr').length;
                                            var newRow = generateTableRow(rowCount + 1);
                                            tableBody.append(newRow);
                                        });
                                    });
                                </script>

                                {{-- <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="name_of_material/sample">Total Quantity Consumed</label>
                                        <input type="text" name="total_quantity_consumed" value="{{$document->total_quantity_consumed}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="name_of_material/sample">Balance Quantity</label>
                                        <input type="text" name="balance_quantity" value="{{$document->balance_quantity}}">
                                    </div>
                                </div> --}}
                                {{-- <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="train-require">Balance Quantity Destructed</label>
                                        <select name="balance_quantity_destructed">
                                            <option value="">Enter your Selection</option>
                                            <option {{ $document->balance_quantity_destructed == 'Yes' ? 'selected' : '' }}
                                                        value="Yes">Yes</option>
                                            <option {{ $document->balance_quantity_destructed == 'No' ? 'selected' : '' }}
                                                        value="No">No</option>

                                        </select>
                                    </div>
                                </div> --}}


                                <div class="group-input">
                                    <label for="audit-agenda-grid">
                                        <button type="button" name="audit-agenda-grid" id="ObservationAdd">+</button>
                                        <span class="text-primary" data-bs-toggle="modal" data-bs-target="#observation-field-instruction-modal" style="font-size: 0.8rem; font-weight: 400; cursor: pointer;">
                                            (Launch Instruction)
                                        </span>
                                    </label>
                                    <div class="table-responsive">
                                        <table class="table table-bordered" id="job-responsibilty-table" style="width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th style="width:5%">Sr. No.</th>
                                                    <th class="">Revision No.</th>
                                                    <th class="">Change Control No./ DCRF No</th>
                                                    <th class="">Effective Date</th>
                                                    <th class="">Reason of revision</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            @php
                                                $ProductDetails = 1;
                                                $effectiveDate = DB::table('documents')->where('id', $document->record)->where('status', 'Effective')->value('effective_date');
                                            @endphp

                                                @if(!empty($summaryResult) && is_array($summaryResult->data))
                                                    @foreach($summaryResult->data as $index => $detail)
                                                        <tr>
                                                            <td>{{ $ProductDetails++ }}</td>
                                                            <td><input type="text" name="summaryResult[{{$index}}][revision_no_tds]" value="{{ $detail['revision_no_tds'] ?? '' }}"></td>
                                                            <td><input type="text" name="summaryResult[{{$index}}][changContNo_tds]" value="{{ $detail['changContNo_tds'] ?? '' }}"></td>
                                                            <td><input type="date" readonly name="summaryResult[{{$index}}][effectiveDate_tds]" value="{{ $effectiveDate ?? '' }}"></td>
                                                            <td><input type="text" name="summaryResult[{{$index}}][reasonRevi_tds]" value="{{ $detail['reasonRevi_tds'] ?? '' }}"></td>

                                                        </tr>
                                                    @endforeach
                                                @else
                                                    <tr>
                                                        <td><input disabled type="text" name="summaryResult[0][serial]" value="1"></td>
                                                        <td><input type="text" name="summaryResult[0][revision_no_tds]"></td>
                                                        <td><input type="text" name="summaryResult[0][changContNo_tds]"></td>
                                                        <td><input type="date" name="summaryResult[0][effectiveDate_tds]"></td>
                                                        <td><input type="text" name="summaryResult[0][reasonRevi_tds]"></td>
                                                    </tr>
                                                @endif
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            <script>
                                $(document).ready(function() {
                                    $('#ObservationAdd').click(function(e) {
                                        function generateTableRow(serialNumber) {

                                            var html =
                                                '<tr>' +
                                                    '<td><input disabled type="text" name="summaryResult[' + serialNumber +
                                                    '][serial]" value="' + serialNumber +
                                                    '"></td>' +
                                                    '<td><input type="text" name="summaryResult[' + serialNumber +
                                                    '][revision_no_tds]"></td>' +
                                                    '<td><input type="text" name="summaryResult[' + serialNumber +
                                                    '][changContNo_tds]"></td>' +
                                                    '<td><input type="date" name="summaryResult[' + serialNumber +
                                                    '][effectiveDate_tds]"></td>' +
                                                    '<td><input type="text" name="summaryResult[' + serialNumber +
                                                    '][reasonRevi_tds]"></td>' +
                                                '</tr>';

                                            return html;
                                        }

                                        var tableBody = $('#job-responsibilty-table tbody');
                                        var rowCount = tableBody.children('tr').length;
                                        var newRow = generateTableRow(rowCount + 1);
                                        tableBody.append(newRow);
                                    });
                                });
                            </script>

                            </div>

                         <div class="button-block">
                            <button type="submit" value="save" name="submit" id="DocsaveButton"
                                class="saveButton">Save</button>
                            <button type="button" class="backButton" onclick="previousStep()">Back</button>
                            <button type="button" class="nextButton" id="DocnextButton"
                                onclick="nextStep()">Next</button>
                            <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                </a>
                            </button>
                        </div>
                    </div>
                </div>

                      {{-- Finished product,  Inprocess , Cleaning Validation Specification (Commercial  registration , re-registration) tabs --}}

                <div id="doc_FPS" class="tabcontent">
                        <div class="orig-head">Finished Product Specification
                        </div>
                        <div class="input-fields">
                            <div class="row">

                            <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="stp">Specification No<span class="text-danger">*</span></label>
                                        @php
                                            $revisionNumber = $document->revised == 'Yes' ? str_pad($document->revised_doc, 2, '0', STR_PAD_LEFT) : '00';
                                            $mfpstpNumber = "FPS/" . str_pad($document->id, 4, '0', STR_PAD_LEFT) . "-$revisionNumber";
                                        @endphp
                                        <input type="text" id="stp" name="stp_mfpstp_no" value="{{ $mfpstpNumber }}" maxlength="255" readonly>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="generic-name">Product Name</label>
                                        <input type="text" name="fsproduct_name" value="{{ $document->fsproduct_name }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="generic-name">Generic Name</label>
                                        <input type="text" name="generic_name" value="{{ $document->generic_name }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="brand-name">Brand Name</label>
                                        <input type="text" name="brand_name" value="{{ $document->brand_name }}">
                                    </div>
                                </div>
                                {{-- <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="label-claim">Label Claim</label>
                                        <input type="text" name="label_claim" value="{{ $document->label_claim }}">
                                    </div>
                                </div> --}}

                                <div class="col-12 sub-head">
                                     Label Claim
                                    <div class="group-input">
                                        <label for="procedure"></label>
                                        
                                        <textarea name="label_claim" id="" class="summernote">{{ $document->label_claim ? $document->label_claim : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="product-code">Product Code</label>
                                        <input type="text" name="product_code" value="{{ $document->product_code }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="storage-condition">Storage Condition</label>
                                        <input type="text" name="fsstorage_condition" value="{{ $document->fsstorage_condition }}">
                                    </div>
                                </div>
                                {{-- <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="sample-quantity">Sample Quantity for Analysis</label>
                                        <select name="sample_quantity">
                                            <option value="" selected>Enter your Selection</option>
                                            <option value="Chemical Analysis" {{ $document->sample_quantity == "Chemical Analysis" ? 'selected' : '' }}>Chemical Analysis</option>
                                            <option value="Microbial Analysis" {{ $document->sample_quantity == "Microbial Analysis" ? 'selected' : '' }}>Microbial Analysis</option>
                                        </select>
                                    </div>
                                </div> --}}

                                <div class="col-12 sub-head">
                                    Sample Quantity for Analysis
                                    <div class="group-input">
                                        <label for="procedure"></label>
                                        <textarea name="sample_quantity" id="" class="summernote">{{ $document->sample_quantity ? $document->sample_quantity : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>


                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="reserve-sample">Reserve Sample Quantity</label>
                                        <input type="text" name="reserve_sample" value="{{ $document->reserve_sample }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="custom-sample">Custom Sample</label>
                                        <input type="text" name="custom_sample" value="{{ $document->custom_sample }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="reference">Reference</label>
                                        <input type="text" name="reference" value="{{ $document->reference }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="sampling-instructions">Sampling Instructions, Warnings, and Precautions</label>
                                        <input type="text" name="sampling_instructions" value="{{ $document->sampling_instructions }}">
                                    </div>
                                </div>


                                <div class="col-12 sub-head">
                                      SPECIFICATION
                                    <div class="group-input">
                                        <label for="procedure"></label>
                                        
                                        <textarea name="fps_specificationGrid" id="" class="summernote">{{ $document->fps_specificationGrid ? $document->fps_specificationGrid : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                            <div class="group-input">
                                <label for="action-plan-grid">
                                    Revision History<button type="button" name="action-plan-grid"
                                            id="add_revision">+</button>
                                </label>
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="table-revision">
                                        <thead>
                                            <tr>
                                                <th style="width: 2%">Sr. No.</th>
                                                <th style="width: 12%">Revision No.</th>
                                                <th style="width: 12%">Change Control No./ DCRF No</th>
                                                <th style="width: 12%">Effective Date</th>
                                                <th style="width: 30%">Reason of revision</th>
                                                <th style="width: 3%">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @php
                                                $serialNumber = 1;
                                                $GtpData = isset($RevisionGridData->data) && is_string($RevisionGridData->data)
                                                    ? json_decode($RevisionGridData->data, true)
                                                    : (is_array($RevisionGridData->data) ? $RevisionGridData->data : []);

                                                    $effectiveDate = DB::table('documents')->where('id', $document->record)->where('status', 'Effective')->value('effective_date');

                                            @endphp

                                            @if(!empty($GtpData))
                                                @foreach($GtpData as $key => $gtp_data)
                                                    <tr>
                                                        <td>{{ $serialNumber++ }}</td>
                                                        <td><input type="text" name="revision_data[{{ $key }}][rev_no]" value="{{ $gtp_data['rev_no'] ?? '' }}"></td>
                                                        <td><input type="text" name="revision_data[{{ $key }}][change_ctrl_no]" value="{{ $gtp_data['change_ctrl_no'] ?? '' }}"></td>
                                                        <td><input type="date" name="revision_data[{{ $key }}][eff_date]" value="{{ $effectiveDate ?? '' }}"></td>
                                                        <td><input type="text" name="revision_data[{{ $key }}][rev_reason]" value="{{ $gtp_data['rev_reason'] ?? '' }}"></td>
                                                        <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                    </tr>
                                                @endforeach
                                            @else
                                                <tr>
                                                    <td>{{ $serialNumber++ }}</td>
                                                    <td><input type="text" name="revision_data[0][rev_no]"></td>
                                                    <td><input type="text" name="revision_data[0][change_ctrl_no]"></td>
                                                    <td><input type="date" name="revision_data[0][eff_date]"></td>
                                                    <td><input type="text" name="revision_data[0][rev_reason]"></td>
                                                    <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                </tr>
                                            @endif
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <script>
                                $(document).ready(function() {
                                    function updateSerialNumbers() {
                                        $('#table-revision tbody tr').each(function(index) {
                                            $(this).find('td:first-child input').val(index + 1); // Update Sr. No
                                            $(this).find('td:nth-child(2) input').attr('name', `gtp[${index}][test_gtp]`);
                                        });
                                    }

                                    $('#add_revision').click(function() {
                                        var serialNumber = $('#table-revision tbody tr').length + 1; // Get the next serial number
                                        var newRow = `
                                            <tr>
                                                <td><input disabled type="text" style="width:40px; text-align:center;" value="${serialNumber}"></td>
                                                <td><input type="text" name="revision_data[${serialNumber - 1}][rev_no]" value=""></td>
                                                <td><input type="text" name="revision_data[${serialNumber - 1}][change_ctrl_no]" value=""></td>
                                                <td><input type="date" name="revision_data[${serialNumber - 1}][eff_date]" value=""></td>
                                                <td><input type="text" name="revision_data[${serialNumber - 1}][rev_reason]" value=""></td>
                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                            </tr>`;

                                        $('#table-revision tbody').append(newRow);
                                    });

                                    // Remove row functionality
                                    $(document).on('click', '.removeRowBtn', function() {
                                        $(this).closest('tr').remove();
                                        updateSerialNumbers(); // Update serial numbers after removal
                                    });
                                });
                            </script>





                                {{-- <div class="col-12">
                                    <div class="group-input">
                                        <label for="Specification Details">
                                            Specification Details
                                            <button type="button" id="specification_add">+</button>
                                        </label>
                                        <div class="table-responsive">
                                        <table class="table" id="specification_details" style="width: 100%; border-collapse: collapse;">
                                            <thead>
                                                <tr>
                                                    <th style="width: 10%; text-align: center; border: 1px solid black;" rowspan="2">Sr. No</th>
                                                    <th style="width: 20%; text-align: center; border: 1px solid black;" rowspan="2">Tests</th>
                                                    <th style="width: 50%; text-align: center; border: 1px solid black;" colspan="2">Specifications</th>
                                                    <th style="width: 20%; text-align: center; border: 1px solid black;" rowspan="2">Reference</th>
                                                    <th style="width: 10%; text-align: center; border: 1px solid black;" rowspan="2">Action</th>
                                                </tr>
                                                <tr>
                                                    <th style="width: 25%; text-align: center; border: 1px solid black;">Release</th>
                                                    <th style="width: 25%; text-align: center; border: 1px solid black;">Shelf Life</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (!empty($SpecificationData) && is_array($SpecificationData->data))
                                                    @foreach ($SpecificationData->data as $index => $spec)
                                                        <tr>
                                                            <td><input disabled type="text" name="specification_details[{{ $index }}][serial]" value="{{ $index + 1 }}"></td>
                                                            <td><input type="text" name="specification_details[{{ $index }}][test]" value="{{ $spec['test'] }}"></td>
                                                            <td><input type="text" name="specification_details[{{ $index }}][release]" value="{{ $spec['release'] }}"></td>
                                                            <td><input type="text" name="specification_details[{{ $index }}][shelf_life]" value="{{ $spec['shelf_life'] }}"></td>
                                                            <td><input type="text" name="specification_details[{{ $index }}][reference]" value="{{ $spec['reference'] }}"></td>
                                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                        </tr>
                                                    @endforeach
                                                @else
                                                    <tr class="no-data">
                                                        <td colspan="6" style="text-align: center;">No data found</td>
                                                    </tr>
                                                @endif
                                            </tbody>
                                        </table>

                                        </div>
                                    </div>
                                </div> --}}

                                <script>
                                    $(document).ready(function() {
                                        // Add new row in Specification table
                                        $('#specification_add').click(function(e) {
                                            e.preventDefault();

                                            function generateSpecificationRow(serialNumber) {
                                                return (
                                                    '<tr>' +
                                                    '<td><input disabled type="text" name="specification_details[' + serialNumber + '][serial]" value="' + (serialNumber + 1) + '"></td>' +
                                                    '<td><input type="text" name="specification_details[' + serialNumber + '][test]"></td>' +
                                                    '<td><input type="text" name="specification_details[' + serialNumber + '][release]"></td>' +
                                                    '<td><input type="text" name="specification_details[' + serialNumber + '][shelf_life]"></td>' +
                                                    '<td><input type="text" name="specification_details[' + serialNumber + '][reference]"></td>' +
                                                    '<td><button type="button" class="removeRowBtn">Remove</button></td>' +
                                                    '</tr>'
                                                );
                                            }

                                            var tableBody = $('#specification_details tbody');
                                            var rowCount = tableBody.children('tr').not('.no-data').length;

                                            // Remove "No data found" row if it exists
                                            if (rowCount === 0) {
                                                tableBody.find('.no-data').remove();
                                                rowCount = 0; // Start count from 0 if no rows exist
                                            }

                                            var newRow = generateSpecificationRow(rowCount);
                                            tableBody.append(newRow);
                                        });

                                        // Remove row in Specification table
                                        $(document).on('click', '.removeRowBtn', function() {
                                            $(this).closest('tr').remove();

                                            // Check if table is empty after deletion, add "No data found" row if so
                                            if ($('#specification_details tbody tr').length === 0) {
                                                $('#specification_details tbody').append('<tr class="no-data"><td colspan="6">No data found</td></tr>');
                                            }
                                        });
                                    });
                                </script>


                        {{-- <div class="col-12 sub-head">
                            Validation Specification
                        </div>
                        <div class="col-12">
                            <div class="group-input">
                                <label for="Specification Details">
                                    Specification Details
                                    <button type="button" id="specification_validation_add">+</button>
                                </label>
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="specification_validation_details" style="width: 100%;">
                                        <thead>
                                            <tr>
                                                <th style="width: 100px;">Sr. No.</th>
                                                <th>Test</th>
                                                <th>Specification</th>
                                                <th>Reference</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @if (!empty($Specification_Validation_Data) && is_array($Specification_Validation_Data->data))
                                                @foreach ($Specification_Validation_Data->data as $index => $spec)
                                                    <tr>
                                                        <td><input disabled type="text" name="specification_validation_details[{{ $index }}][serial]" value="{{ $index + 1 }}"></td>
                                                        <td><input type="text" name="specification_validation_details[{{ $index }}][test]" value="{{ $spec['test'] }}"></td>
                                                        <td><input type="text" name="specification_validation_details[{{ $index }}][specification]" value="{{ $spec['specification'] }}"></td>
                                                        <td><input type="text" name="specification_validation_details[{{ $index }}][reference]" value="{{ $spec['reference'] }}"></td>
                                                        <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                    </tr>
                                                @endforeach
                                            @else
                                                <tr class="no-data">
                                                    <td colspan="5">No data found</td>
                                                </tr>
                                            @endif
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div> --}}

                        {{-- <script>
                            $(document).ready(function() {
                                // Add new row in Specification Validation table
                                $('#specification_validation_add').click(function(e) {
                                    e.preventDefault();

                                    function generateSpecificationRow(serialNumber) {
                                        return (
                                            '<tr>' +
                                            '<td><input disabled type="text" name="specification_validation_details[' + serialNumber +
                                            '][serial]" value="' + (serialNumber + 1) + '"></td>' +
                                            '<td><input type="text" name="specification_validation_details[' + serialNumber + '][test]"></td>' +
                                            '<td><input type="text" name="specification_validation_details[' + serialNumber + '][specification]"></td>' +
                                            '<td><input type="text" name="specification_validation_details[' + serialNumber + '][reference]"></td>' +
                                            '<td><button type="button" class="removeRowBtn">Remove</button></td>' +
                                            '</tr>'
                                        );
                                    }

                                    var tableBody = $('#specification_validation_details tbody');
                                    var rowCount = tableBody.children('tr').not('.no-data').length;

                                    // Remove "No data found" row if it exists
                                    if (rowCount === 0) {
                                        tableBody.find('.no-data').remove();
                                        rowCount = 0; // Start count from 0 if no rows exist
                                    }

                                    var newRow = generateSpecificationRow(rowCount);
                                    tableBody.append(newRow);
                                });

                                // Remove row in Specification Validation table
                                $(document).on('click', '.removeRowBtn', function() {
                                    $(this).closest('tr').remove();

                                    // Check if table is empty after deletion, add "No data found" row if so
                                    if ($('#specification_validation_details tbody tr').length === 0) {
                                        $('#specification_validation_details tbody').append('<tr class="no-data"><td colspan="5">No data found</td></tr>');
                                    }
                                });
                            });
                        </script> --}}



                    </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>

                 {{-- protocal and crump tabs  --}}
                 <div id="doc_PCR" class="tabcontent">
                    <div class="orig-head">PROTOCOL CUM REPORT
                    </div>

                    <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="procumrepo_file_attachDatassp">
                                            @if ($document->procumrepo_file_attach)
                                                @foreach(json_decode($document->procumrepo_file_attach) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_procumrepo_file_attach[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="procumrepo_file_attachData" style="cursor: pointer;">Add</label>
                                            <input type="file" id="procumrepo_file_attachData" name="procumrepo_file_attach[]" 
                                                oninput="addMultipleFiles(this, 'procumrepo_file_attachDatassp')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>





                <!-- Cleaning Validation Specificatiom -->

                <div id="doc_CVS" class="tabcontent">
                        <div class="orig-head">Cleaning Validation Specification
                        </div>
                        <div class="input-fields">
                            <div class="row">

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="stp">Specification No<span class="text-danger">*</span></label>
                                        @php
                                            $revisionNumber = $document->revised == 'Yes' ? str_pad($document->revised_doc, 2, '0', STR_PAD_LEFT) : '00';
                                            $mfpstpNumber = "CVS/" . str_pad($document->id, 4, '0', STR_PAD_LEFT) . "-$revisionNumber";
                                        @endphp
                                        <input type="text" id="stp" name="stp_mfpstp_no" value="{{ $mfpstpNumber }}" maxlength="255" readonly>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="generic-name">Product Name</label>
                                        <input type="text" name="product_name_cvs" value="{{ $document->product_name_cvs }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="generic-name">Generic Name</label>
                                        <input type="text" name="generic_name_cvs" value="{{ $document->generic_name_cvs }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="brand-name">Brand Name</label>
                                        <input type="text" name="brand_name_cvs" value="{{ $document->brand_name_cvs }}">
                                    </div>
                                </div>
                                {{-- <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="label-claim">Label Claim</label>
                                        <input type="text" name="label_claim_cvs" value="{{ $document->label_claim_cvs }}">
                                    </div>
                                </div> --}}

                                <div class="col-12 sub-head">
                                     Label Claim
                                    <div class="group-input">
                                        <label for="procedure"></label>
                                        <textarea name="label_claim_cvs" id="" class="summernote">{{ $document->label_claim_cvs ? $document->label_claim_cvs : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="product-code">Product Code</label>
                                        <input type="text" name="product_code_cvs" value="{{ $document->product_code_cvs }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="storage-condition">Storage Condition</label>
                                        <input type="text" name="storage_condition_cvs" value="{{ $document->storage_condition_cvs }}">
                                    </div>
                                </div>
                                {{-- <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="sample-quantity">Sample Quantity for Analysis</label>
                                        <select name="sample_quantity_cvs">
                                            <option value="" selected>Enter your Selection</option>
                                            <option value="Chemical Analysis" {{ $document->sample_quantity_cvs == "Chemical Analysis" ? 'selected' : '' }}>Chemical Analysis</option>
                                            <option value="Microbial Analysis" {{ $document->sample_quantity_cvs == "Microbial Analysis" ? 'selected' : '' }}>Microbial Analysis</option>
                                        </select>
                                    </div>
                                </div> --}}

                                <div class="col-12 sub-head">
                                    Sample Quantity for Analysis
                                    <div class="group-input">
                                        <label for="procedure"></label>
                                        <textarea name="sample_quantity_cvs" id="" class="summernote">{{ $document->sample_quantity_cvs ? $document->sample_quantity_cvs : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="reserve-sample">Reserve Sample Quantity</label>
                                        <input type="text" name="reserve_sample_cvs" value="{{ $document->reserve_sample_cvs }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="custom-sample">Custom Sample</label>
                                        <input type="text" name="custom_sample_cvs" value="{{ $document->custom_sample_cvs }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="reference">Reference</label>
                                        <input type="text" name="reference_cvs" value="{{ $document->reference_cvs }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="sampling-instructions">Sampling Instructions, Warnings, and Precautions</label>
                                        <input type="text" name="sampling_instructions_cvs" value="{{ $document->sampling_instructions_cvs }}">
                                    </div>
                                </div>

                            {{-- <div class="col-12 sub-head">
                                    SPECIFICATION
                                </div>
                                <div class="col-12">
                                    <div class="group-input">
                                        <label for="Specification Details">
                                            Specification Details
                                            <button type="button" id="specification_add_cvs">+</button>
                                        </label>
                                        <div class="table-responsive">
                                        <table class="table" id="specification_details_cvs" style="width: 100%; border-collapse: collapse;">
                                            <thead>
                                                <tr>
                                                    <th style="width: 10%; text-align: center; border: 1px solid black;" rowspan="2">Sr. No</th>
                                                    <th style="width: 20%; text-align: center; border: 1px solid black;" rowspan="2">Tests</th>
                                                    <th style="width: 50%; text-align: center; border: 1px solid black;" colspan="2">Specifications</th>
                                                    <th style="width: 20%; text-align: center; border: 1px solid black;" rowspan="2">Reference</th>
                                                    <th style="width: 10%; text-align: center; border: 1px solid black;" rowspan="2">Action</th>
                                                </tr>
                                                <tr>
                                                    <th style="width: 25%; text-align: center; border: 1px solid black;">Release</th>
                                                    <th style="width: 25%; text-align: center; border: 1px solid black;">Shelf Life</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (!empty($SpecificationData_CVS) && is_array($SpecificationData_CVS->data))
                                                    @foreach ($SpecificationData_CVS->data as $index => $spec)
                                                        <tr>
                                                            <td><input disabled type="text" name="specification_details_cvs[{{ $index }}][serial]" value="{{ $index + 1 }}"></td>
                                                            <td><input type="text" name="specification_details_cvs[{{ $index }}][test]" value="{{ $spec['test'] }}"></td>
                                                            <td><input type="text" name="specification_details_cvs[{{ $index }}][release]" value="{{ $spec['release'] }}"></td>
                                                            <td><input type="text" name="specification_details_cvs[{{ $index }}][shelf_life]" value="{{ $spec['shelf_life'] }}"></td>
                                                            <td><input type="text" name="specification_details_cvs[{{ $index }}][reference]" value="{{ $spec['reference'] }}"></td>
                                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                        </tr>
                                                    @endforeach
                                                @else
                                                    <tr class="no-data">
                                                        <td colspan="6" style="text-align: center;">No data found</td>
                                                    </tr>
                                                @endif
                                            </tbody>
                                        </table>

                                        </div>
                                    </div>
                                </div>

                                <script>
                                    $(document).ready(function() {
                                        // Add new row in Specification table
                                        $('#specification_add_cvs').click(function(e) {
                                            e.preventDefault();

                                            function generateSpecificationRow(serialNumber) {
                                                return (
                                                    '<tr>' +
                                                    '<td><input disabled type="text" name="specification_details_cvs[' + serialNumber + '][serial]" value="' + (serialNumber + 1) + '"></td>' +
                                                    '<td><input type="text" name="specification_details_cvs[' + serialNumber + '][test]"></td>' +
                                                    '<td><input type="text" name="specification_details_cvs[' + serialNumber + '][release]"></td>' +
                                                    '<td><input type="text" name="specification_details_cvs[' + serialNumber + '][shelf_life]"></td>' +
                                                    '<td><input type="text" name="specification_details_cvs[' + serialNumber + '][reference]"></td>' +
                                                    '<td><button type="button" class="removeRowBtn">Remove</button></td>' +
                                                    '</tr>'
                                                );
                                            }

                                            var tableBody = $('#specification_details_cvs tbody');
                                            var rowCount = tableBody.children('tr').not('.no-data').length;

                                            // Remove "No data found" row if it exists
                                            if (rowCount === 0) {
                                                tableBody.find('.no-data').remove();
                                                rowCount = 0; // Start count from 0 if no rows exist
                                            }

                                            var newRow = generateSpecificationRow(rowCount);
                                            tableBody.append(newRow);
                                        });

                                        // Remove row in Specification table
                                        $(document).on('click', '.removeRowBtn', function() {
                                            $(this).closest('tr').remove();

                                            // Check if table is empty after deletion, add "No data found" row if so
                                            if ($('#specification_add_cvs tbody tr').length === 0) {
                                                $('#specification_add_cvs tbody').append('<tr class="no-data"><td colspan="6">No data found</td></tr>');
                                            }
                                        });
                                    });
                                </script> --}}


                        <div class="col-12 sub-head">
                             Specification
                            <div class="group-input">
                                <label for="procedure"></label>
                                <textarea name="cvs_specificationGrid" id="" class="summernote">{{ $document->cvs_specificationGrid ? $document->cvs_specificationGrid : '' }}</textarea>
                                @foreach ($history as $tempHistory)
                                    @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                        @php
                                            $users_name = DB::table('users')
                                                ->where('id', $tempHistory->user_id)
                                                ->value('name');
                                        @endphp
                                        <p style="color: blue">Modify by {{ $users_name }} at
                                            {{ $tempHistory->created_at }}
                                        </p>
                                        <input class="input-field"
                                            style="background: #ffff0061;
                                color: black;"
                                            type="text" value="{{ $tempHistory->comment }}" disabled>
                                    @endif
                                @endforeach
                            </div>
                        </div>
                        {{-- <div class="col-12">
                            <div class="group-input">
                                <label for="Specification Details">
                                    Specification Details
                                    <button type="button" id="specification_validation_add_cvs">+</button>
                                </label>
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="specification_validation_details_cvs" style="width: 100%;">
                                        <thead>
                                            <tr>
                                                <th style="width: 100px;">Sr. No.</th>
                                                <th>Test</th>
                                                <th>Specification</th>
                                                <th>Reference</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @if (!empty($Specification_Validation_Data_CVS) && is_array($Specification_Validation_Data_CVS->data))
                                                @foreach ($Specification_Validation_Data_CVS->data as $index => $spec)
                                                    <tr>
                                                        <td><input disabled type="text" name="specification_validation_details_cvs[{{ $index }}][serial]" value="{{ $index + 1 }}"></td>
                                                        <td><input type="text" name="specification_validation_details_cvs[{{ $index }}][test]" value="{{ $spec['test'] }}"></td>
                                                        <td><input type="text" name="specification_validation_details_cvs[{{ $index }}][specification]" value="{{ $spec['specification'] }}"></td>
                                                        <td><input type="text" name="specification_validation_details_cvs[{{ $index }}][reference]" value="{{ $spec['reference'] }}"></td>
                                                        <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                    </tr>
                                                @endforeach
                                            @else
                                                <tr class="no-data">
                                                    <td colspan="5">No data found</td>
                                                </tr>
                                            @endif
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div> --}}

                        <script>
                            $(document).ready(function() {
                                // Add new row in Specification Validation table
                                $('#specification_validation_add_cvs').click(function(e) {
                                    e.preventDefault();

                                    function generateSpecificationRow(serialNumber) {
                                        return (
                                            '<tr>' +
                                            '<td><input disabled type="text" name="specification_validation_details_cvs[' + serialNumber +
                                            '][serial]" value="' + (serialNumber + 1) + '"></td>' +
                                            '<td><input type="text" name="specification_validation_details_cvs[' + serialNumber + '][test]"></td>' +
                                            '<td><input type="text" name="specification_validation_details_cvs[' + serialNumber + '][specification]"></td>' +
                                            '<td><input type="text" name="specification_validation_details_cvs[' + serialNumber + '][reference]"></td>' +
                                            '<td><button type="button" class="removeRowBtn">Remove</button></td>' +
                                            '</tr>'
                                        );
                                    }

                                    var tableBody = $('#specification_validation_details_cvs tbody');
                                    var rowCount = tableBody.children('tr').not('.no-data').length;

                                    // Remove "No data found" row if it exists
                                    if (rowCount === 0) {
                                        tableBody.find('.no-data').remove();
                                        rowCount = 0; // Start count from 0 if no rows exist
                                    }

                                    var newRow = generateSpecificationRow(rowCount);
                                    tableBody.append(newRow);
                                });

                                // Remove row in Specification Validation table
                                $(document).on('click', '.removeRowBtn', function() {
                                    $(this).closest('tr').remove();

                                    // Check if table is empty after deletion, add "No data found" row if so
                                    if ($('#specification_validation_details_cvs tbody tr').length === 0) {
                                        $('#specification_validation_details_cvs tbody').append('<tr class="no-data"><td colspan="5">No data found</td></tr>');
                                    }
                                });
                            });
                        </script>

                            <div class="group-input">
                                <label for="action-plan-grid">
                                    Revision History<button type="button" name="action-plan-grid"
                                            id="CVS_revision">+</button>
                                </label>
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="table-cvs_revision">
                                        <thead>
                                            <tr>
                                                <th style="width: 2%">Sr. No.</th>
                                                <th style="width: 12%">Revision No.</th>
                                                <th style="width: 12%">Change Control No./ DCRF No</th>
                                                <th style="width: 12%">Effective Date</th>
                                                <th style="width: 30%">Reason of revision</th>
                                                <th style="width: 3%">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @php
                                                $serialNumber = 1;
                                                $GtpData = isset($RevisionGridCvsData->data) && is_string($RevisionGridCvsData->data)
                                                    ? json_decode($RevisionGridCvsData->data, true)
                                                    : (is_array($RevisionGridCvsData->data) ? $RevisionGridCvsData->data : []);
                                            @endphp

                                            @if(!empty($GtpData))
                                                @foreach($GtpData as $key => $gtp_data)
                                                    <tr>
                                                        <td>{{ $serialNumber++ }}</td>
                                                        <td><input type="text" name="revision_cvs_data[{{ $key }}][rev_cvs_no]" value="{{ $gtp_data['rev_cvs_no'] ?? '' }}"></td>
                                                        <td><input type="text" name="revision_cvs_data[{{ $key }}][change_ctrl_cvs_no]" value="{{ $gtp_data['change_ctrl_cvs_no'] ?? '' }}"></td>
                                                        <td><input type="date" name="revision_cvs_data[{{ $key }}][eff_date_cvs]" value="{{ $gtp_data['eff_date_cvs'] ?? '' }}"></td>
                                                        <td><input type="text" name="revision_cvs_data[{{ $key }}][rev_reason_cvs]" value="{{ $gtp_data['rev_reason_cvs'] ?? '' }}"></td>
                                                        <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                    </tr>
                                                @endforeach
                                            @else
                                                <tr>
                                                    <td>{{ $serialNumber++ }}</td>
                                                    <td><input type="text" name="revision_cvs_data[0][rev_cvs_no]"></td>
                                                    <td><input type="text" name="revision_cvs_data[0][change_ctrl_cvs_no]"></td>
                                                    <td><input type="date" name="revision_cvs_data[0][eff_date_cvs]"></td>
                                                    <td><input type="text" name="revision_cvs_data[0][rev_reason_cvs]"></td>
                                                    <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                </tr>
                                            @endif
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <script>
                                $(document).ready(function() {
                                    function updateSerialNumbers() {
                                        $('#table-cvs_revision tbody tr').each(function(index) {
                                            $(this).find('td:first-child input').val(index + 1); // Update Sr. No
                                            $(this).find('td:nth-child(2) input').attr('name', `gtp[${index}][test_gtp]`);
                                        });
                                    }

                                    $('#CVS_revision').click(function() {
                                        var serialNumber = $('#table-cvs_revision tbody tr').length + 1; // Get the next serial number
                                        var newRow = `
                                            <tr>
                                                <td><input disabled type="text" style="width:40px; text-align:center;" value="${serialNumber}"></td>
                                                <td><input type="text" name="revision_cvs_data[${serialNumber - 1}][rev_cvs_no]" value=""></td>
                                                <td><input type="text" name="revision_cvs_data[${serialNumber - 1}][change_ctrl_cvs_no]" value=""></td>
                                                <td><input type="date" name="revision_cvs_data[${serialNumber - 1}][eff_date_cvs]" value=""></td>
                                                <td><input type="text" name="revision_cvs_data[${serialNumber - 1}][rev_reason_cvs]" value=""></td>
                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                            </tr>`;

                                        $('#table-cvs_revision tbody').append(newRow);
                                    });

                                    // Remove row functionality
                                    $(document).on('click', '.removeRowBtn', function() {
                                        $(this).closest('tr').remove();
                                        updateSerialNumbers(); // Update serial numbers after removal
                                    });
                                });
                            </script>


                    </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>


                <!-- Inprocess Validation Specification -->
                <div id="doc_INPS" class="tabcontent">
                        <div class="orig-head">Inprocess Specification
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="stp">Specification No<span class="text-danger">*</span></label>
                                        @php
                                            $revisionNumber = $document->revised == 'Yes' ? str_pad($document->revised_doc, 2, '0', STR_PAD_LEFT) : '00';
                                            $mfpstpNumber = "IPS/" . str_pad($document->id, 4, '0', STR_PAD_LEFT) . "-$revisionNumber";
                                        @endphp
                                        <input type="text" id="stp" name="stp_mfpstp_no" value="{{ $mfpstpNumber }}" maxlength="255" readonly>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="generic-name">Product Name</label>
                                        <input type="text" name="product_name_inps" value="{{ $document->product_name_inps }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="generic-name">Generic Name</label>
                                        <input type="text" name="generic_name_inps" value="{{ $document->generic_name_inps }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="brand-name">Brand Name</label>
                                        <input type="text" name="brand_name_inps" value="{{ $document->brand_name_inps }}">
                                    </div>
                                </div>
                                {{-- <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="label-claim">Label Claim</label>
                                        <input type="text" name="label_claim_inps" value="{{ $document->label_claim_inps }}">
                                    </div>
                                </div> --}}

                                <div class="col-12 sub-head">
                                     Label Claim
                                    <div class="group-input">
                                        <label for="procedure"></label>
                                        <textarea name="label_claim_inps" id="" class="summernote">{{ $document->label_claim_inps ? $document->label_claim_inps : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="product-code">Product Code</label>
                                        <input type="text" name="product_code_inps" value="{{ $document->product_code_inps }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="storage-condition">Storage Condition</label>
                                        <input type="text" name="storage_condition_inps" value="{{ $document->storage_condition_inps }}">
                                    </div>
                                </div>

                                <div class="col-12 sub-head">
                                    Sample Quantity for Analysis
                                    <div class="group-input">
                                        <label for="procedure"></label>
                                        <textarea name="sample_quantity_inps" id="" class="summernote">{{ $document->sample_quantity_inps ? $document->sample_quantity_inps : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="reserve-sample">Reserve Sample Quantity</label>
                                        <input type="text" name="reserve_sample_inps" value="{{ $document->reserve_sample_inps }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="custom-sample">Custom Sample</label>
                                        <input type="text" name="custom_sample_inps" value="{{ $document->custom_sample_inps }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="reference">Reference</label>
                                        <input type="text" name="reference_inps" value="{{ $document->reference_inps }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="sampling-instructions">Sampling Instructions, Warnings, and Precautions</label>
                                        <input type="text" name="sampling_instructions_inps" value="{{ $document->sampling_instructions_inps }}">
                                    </div>
                                </div>

                            {{-- <div class="col-12 sub-head">
                                    SPECIFICATION
                                </div>
                                <div class="col-12">
                                    <div class="group-input">
                                        <label for="Specification Details">
                                            Specification Details
                                            <button type="button" id="specification_add_inps">+</button>
                                        </label>
                                        <div class="table-responsive">
                                        <table class="table" id="specification_details_inps" style="width: 100%; border-collapse: collapse;">
                                            <thead>
                                                <tr>
                                                    <th style="width: 10%; text-align: center; border: 1px solid black;" rowspan="2">Sr. No</th>
                                                    <th style="width: 20%; text-align: center; border: 1px solid black;" rowspan="2">Tests</th>
                                                    <th style="width: 50%; text-align: center; border: 1px solid black;" colspan="2">Specifications</th>
                                                    <th style="width: 20%; text-align: center; border: 1px solid black;" rowspan="2">Reference</th>
                                                    <th style="width: 10%; text-align: center; border: 1px solid black;" rowspan="2">Action</th>
                                                </tr>
                                                <tr>
                                                    <th style="width: 25%; text-align: center; border: 1px solid black;">Release</th>
                                                    <th style="width: 25%; text-align: center; border: 1px solid black;">Shelf Life</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (!empty($SpecificationData_invs) && is_array($SpecificationData_invs->data))
                                                    @foreach ($SpecificationData_invs->data as $index => $spec)
                                                        <tr>
                                                            <td><input disabled type="text" name="specification_details_inps[{{ $index }}][serial]" value="{{ $index + 1 }}"></td>
                                                            <td><input type="text" name="specification_details_inps[{{ $index }}][test]" value="{{ $spec['test'] }}"></td>
                                                            <td><input type="text" name="specification_details_inps[{{ $index }}][release]" value="{{ $spec['release'] }}"></td>
                                                            <td><input type="text" name="specification_details_inps[{{ $index }}][shelf_life]" value="{{ $spec['shelf_life'] }}"></td>
                                                            <td><input type="text" name="specification_details_inps[{{ $index }}][reference]" value="{{ $spec['reference'] }}"></td>
                                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                        </tr>
                                                    @endforeach
                                                @else
                                                    <tr class="no-data">
                                                        <td colspan="6" style="text-align: center;">No data found</td>
                                                    </tr>
                                                @endif
                                            </tbody>
                                        </table>

                                        </div>
                                    </div>
                                </div>

                                <script>
                                    $(document).ready(function() {
                                        // Add new row in Specification table
                                        $('#specification_add_inps').click(function(e) {
                                            e.preventDefault();

                                            function generateSpecificationRow(serialNumber) {
                                                return (
                                                    '<tr>' +
                                                    '<td><input disabled type="text" name="specification_details_inps[' + serialNumber + '][serial]" value="' + (serialNumber + 1) + '"></td>' +
                                                    '<td><input type="text" name="specification_details_inps[' + serialNumber + '][test]"></td>' +
                                                    '<td><input type="text" name="specification_details_inps[' + serialNumber + '][release]"></td>' +
                                                    '<td><input type="text" name="specification_details_inps[' + serialNumber + '][shelf_life]"></td>' +
                                                    '<td><input type="text" name="specification_details_inps[' + serialNumber + '][reference]"></td>' +
                                                    '<td><button type="button" class="removeRowBtn">Remove</button></td>' +
                                                    '</tr>'
                                                );
                                            }

                                            var tableBody = $('#specification_details_inps tbody');
                                            var rowCount = tableBody.children('tr').not('.no-data').length;

                                            // Remove "No data found" row if it exists
                                            if (rowCount === 0) {
                                                tableBody.find('.no-data').remove();
                                                rowCount = 0; // Start count from 0 if no rows exist
                                            }

                                            var newRow = generateSpecificationRow(rowCount);
                                            tableBody.append(newRow);
                                        });

                                        // Remove row in Specification table
                                        $(document).on('click', '.removeRowBtn', function() {
                                            $(this).closest('tr').remove();

                                            // Check if table is empty after deletion, add "No data found" row if so
                                            if ($('#specification_add_inps tbody tr').length === 0) {
                                                $('#specification_add_inps tbody').append('<tr class="no-data"><td colspan="6">No data found</td></tr>');
                                            }
                                        });
                                    });
                            </script> --}}


                        <div class="col-12 sub-head">
                            Specification
                            <div class="group-input">
                                <label for="procedure"></label>
                                
                                <textarea name="ips_specificationGrid" id="" class="summernote">{{ $document->ips_specificationGrid ? $document->ips_specificationGrid : '' }}</textarea>
                                @foreach ($history as $tempHistory)
                                    @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                        @php
                                            $users_name = DB::table('users')
                                                ->where('id', $tempHistory->user_id)
                                                ->value('name');
                                        @endphp
                                        <p style="color: blue">Modify by {{ $users_name }} at
                                            {{ $tempHistory->created_at }}
                                        </p>
                                        <input class="input-field"
                                            style="background: #ffff0061;
                                color: black;"
                                            type="text" value="{{ $tempHistory->comment }}" disabled>
                                    @endif
                                @endforeach
                            </div>
                        </div>
                        {{-- <div class="col-12">
                            <div class="group-input">
                                <label for="Specification Details">
                                    Specification Details
                                    <button type="button" id="specification_validation_add_inps">+</button>
                                </label>
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="specification_validation_details_inps" style="width: 100%;">
                                        <thead>
                                            <tr>
                                                <th style="width: 100px;">Sr. No.</th>
                                                <th>Test</th>
                                                <th>Specification</th>
                                                <th>Reference</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @if (!empty($Specification_Validation_Data_invs) && is_array($Specification_Validation_Data_invs->data))
                                                @foreach ($Specification_Validation_Data_invs->data as $index => $spec)
                                                    <tr>
                                                        <td><input disabled type="text" name="specification_validation_details_inps[{{ $index }}][serial]" value="{{ $index + 1 }}"></td>
                                                        <td><input type="text" name="specification_validation_details_inps[{{ $index }}][test]" value="{{ $spec['test'] }}"></td>
                                                        <td><input type="text" name="specification_validation_details_inps[{{ $index }}][specification]" value="{{ $spec['specification'] }}"></td>
                                                        <td><input type="text" name="specification_validation_details_inps[{{ $index }}][reference]" value="{{ $spec['reference'] }}"></td>
                                                        <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                    </tr>
                                                @endforeach
                                            @else
                                                <tr class="no-data">
                                                    <td colspan="5" style="text-align: center;">No data found</td>
                                                </tr>
                                            @endif
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div> --}}

                        <script>
                            $(document).ready(function() {
                                // Add new row in Specification Validation table
                                $('#specification_validation_add_inps').click(function(e) {
                                    e.preventDefault();

                                    function generateSpecificationRow(serialNumber) {
                                        return (
                                            '<tr>' +
                                            '<td><input disabled type="text" name="specification_validation_details_inps[' + serialNumber +
                                            '][serial]" value="' + (serialNumber + 1) + '"></td>' +
                                            '<td><input type="text" name="specification_validation_details_inps[' + serialNumber + '][test]"></td>' +
                                            '<td><input type="text" name="specification_validation_details_inps[' + serialNumber + '][specification]"></td>' +
                                            '<td><input type="text" name="specification_validation_details_inps[' + serialNumber + '][reference]"></td>' +
                                            '<td><button type="button" class="removeRowBtn">Remove</button></td>' +
                                            '</tr>'
                                        );
                                    }

                                    var tableBody = $('#specification_validation_details_inps tbody');
                                    var rowCount = tableBody.children('tr').not('.no-data').length;

                                    // Remove "No data found" row if it exists
                                    if (rowCount === 0) {
                                        tableBody.find('.no-data').remove();
                                        rowCount = 0; // Start count from 0 if no rows exist
                                    }

                                    var newRow = generateSpecificationRow(rowCount);
                                    tableBody.append(newRow);
                                });

                                // Remove row in Specification Validation table
                                $(document).on('click', '.removeRowBtn', function() {
                                    $(this).closest('tr').remove();

                                    // Check if table is empty after deletion, add "No data found" row if so
                                    if ($('#specification_validation_details_inps tbody tr').length === 0) {
                                        $('#specification_validation_details_inps tbody').append('<tr class="no-data"><td colspan="5">No data found</td></tr>');
                                    }
                                });
                            });
                        </script>

                            <div class="group-input">
                                <label for="action-plan-grid">
                                    Revision History<button type="button" name="action-plan-grid"
                                            id="inps_revision">+</button>
                                </label>
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="table-inps_revision">
                                        <thead>
                                            <tr>
                                                <th style="width: 2%">Sr. No.</th>
                                                <th style="width: 12%">Revision No.</th>
                                                <th style="width: 12%">Change Control No./ DCRF No</th>
                                                <th style="width: 12%">Effective Date</th>
                                                <th style="width: 30%">Reason of revision</th>
                                                <th style="width: 3%">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @php
                                                $serialNumber = 1;
                                                $GtpData = isset($RevisionGridInpsData->data) && is_string($RevisionGridInpsData->data)
                                                    ? json_decode($RevisionGridInpsData->data, true)
                                                    : (is_array($RevisionGridInpsData->data) ? $RevisionGridInpsData->data : []);
                                            @endphp

                                            @if(!empty($GtpData))
                                                @foreach($GtpData as $key => $gtp_data)
                                                    <tr>
                                                        <td>{{ $serialNumber++ }}</td>
                                                        <td><input type="text" name="revision_inps_data[{{ $key }}][rev_inps_no]" value="{{ $gtp_data['rev_inps_no'] ?? '' }}"></td>
                                                        <td><input type="text" name="revision_inps_data[{{ $key }}][change_ctrl_inps_no]" value="{{ $gtp_data['change_ctrl_inps_no'] ?? '' }}"></td>
                                                        <td><input type="date" name="revision_inps_data[{{ $key }}][eff_date_inps]" value="{{ $gtp_data['eff_date_inps'] ?? '' }}"></td>
                                                        <td><input type="text" name="revision_inps_data[{{ $key }}][rev_reason_inps]" value="{{ $gtp_data['rev_reason_inps'] ?? '' }}"></td>
                                                        <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                    </tr>
                                                @endforeach
                                            @else
                                                <tr>
                                                    <td>{{ $serialNumber++ }}</td>
                                                    <td><input type="text" name="revision_inps_data[0][rev_inps_no]"></td>
                                                    <td><input type="text" name="revision_inps_data[0][change_ctrl_inps_no]"></td>
                                                    <td><input type="date" name="revision_inps_data[0][eff_date_inps]"></td>
                                                    <td><input type="text" name="revision_inps_data[0][rev_reason_inps]"></td>
                                                    <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                </tr>
                                            @endif
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <script>
                                $(document).ready(function() {
                                    function updateSerialNumbers() {
                                        $('#table-inps_revision tbody tr').each(function(index) {
                                            $(this).find('td:first-child input').val(index + 1); // Update Sr. No
                                            $(this).find('td:nth-child(2) input').attr('name', `gtp[${index}][test_gtp]`);
                                        });
                                    }

                                    $('#inps_revision').click(function() {
                                        var serialNumber = $('#table-inps_revision tbody tr').length + 1; // Get the next serial number
                                        var newRow = `
                                            <tr>
                                                <td><input disabled type="text" style="width:40px; text-align:center;" value="${serialNumber}"></td>
                                                <td><input type="text" name="revision_inps_data[${serialNumber - 1}][rev_inps_no]" value=""></td>
                                                <td><input type="text" name="revision_inps_data[${serialNumber - 1}][change_ctrl_inps_no]" value=""></td>
                                                <td><input type="date" name="revision_inps_data[${serialNumber - 1}][eff_date_inps]" value=""></td>
                                                <td><input type="text" name="revision_inps_data[${serialNumber - 1}][rev_reason_inps]" value=""></td>
                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                            </tr>`;

                                        $('#table-inps_revision tbody').append(newRow);
                                    });

                                    // Remove row functionality
                                    $(document).on('click', '.removeRowBtn', function() {
                                        $(this).closest('tr').remove();
                                        updateSerialNumbers(); // Update serial numbers after removal
                                    });
                                });
                            </script>



                    </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>





                {{-- hold study report tabs  --}}

                <div id="doc-holdtimstduy" class="tabcontent">
                    <div class="orig-head">
                        Hold Time Study Report
                    </div>
                    <div class="input-fields">
                        <div class="row">



                            {{-- <div class="col-md-12">
                                <div class="group-input">
                                    <label for="Purpose_HoTiStRe" id="Purpose_HoTiStRe">
                                        Purpose  <button type="button" id="Purpose_HoTiStRebtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="Purpose_HoTiStRediv">
                                        @if ($document->document_content && !empty($document->document_content->Purpose_HoTiStRe))
                                            @foreach (unserialize($document->document_content->Purpose_HoTiStRe) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSinglePurpose_HoTiStReBlock' : 'singlePurpose_HoTiStReBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="Purpose_HoTiStRe[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="Purpose_HoTiStRe[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subPurpose_HoTiStReAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singlePurpose_HoTiStReBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="Purpose_HoTiStRe[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subPurpose_HoTiStReAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Purpose_HoTiStRe' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>

                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="Scope_HoTiStRe" id="Scope_HoTiStRe">
                                        Scope  <button type="button" id="Scope_HoTiStRebtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="Scope_HoTiStRediv">
                                        @if ($document->document_content && !empty($document->document_content->Scope_HoTiStRe))
                                            @foreach (unserialize($document->document_content->Scope_HoTiStRe) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleScope_HoTiStReBlock' : 'singleScope_HoTiStReBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="Scope_HoTiStRe[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="Scope_HoTiStRe[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subScope_HoTiStReAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleScope_HoTiStReBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="Scope_HoTiStRe[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subScope_HoTiStReAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Scope_HoTiStRe' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>

                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="BatchDetails_HoTiStRe" id="BatchDetails_HoTiStRe">
                                        Batch Details  <button type="button" id="BatchDetails_HoTiStRebtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="BatchDetails_HoTiStRediv">
                                        @if ($document->document_content && !empty($document->document_content->BatchDetails_HoTiStRe))
                                            @foreach (unserialize($document->document_content->BatchDetails_HoTiStRe) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleBatchDetails_HoTiStReBlock' : 'singleBatchDetails_HoTiStReBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="BatchDetails_HoTiStRe[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="BatchDetails_HoTiStRe[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subBatchDetails_HoTiStReAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleBatchDetails_HoTiStReBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="BatchDetails_HoTiStRe[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subBatchDetails_HoTiStReAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'BatchDetails_HoTiStRe' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>

                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="ReferenceDocument_HoTiStRe" id="ReferenceDocument_HoTiStRe">
                                        Reference Document  <button type="button" id="ReferenceDocument_HoTiStRebtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="ReferenceDocument_HoTiStRediv">
                                        @if ($document->document_content && !empty($document->document_content->ReferenceDocument_HoTiStRe))
                                            @foreach (unserialize($document->document_content->ReferenceDocument_HoTiStRe) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleReferenceDocument_HoTiStReBlock' : 'singleReferenceDocument_HoTiStReBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="ReferenceDocument_HoTiStRe[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="ReferenceDocument_HoTiStRe[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subReferenceDocument_HoTiStReAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleReferenceDocument_HoTiStReBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="ReferenceDocument_HoTiStRe[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subReferenceDocument_HoTiStReAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'ReferenceDocument_HoTiStRe' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="group-input">
                                    <label for="Quality Control 1">
                                        Quality Control 1
                                        <button type="button" id="quality_add_1">+</button>
                                    </label>
                                    <div class="table-responsive">
                                        <table class="table table-bordered" id="quality_details_1"
                                            style="width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th>Sr. No.</th>
                                                    <th>Equipment Name</th>
                                                    <th>Location</th>
                                                    <th>Equipment No</th>
                                                    <th>Qualification Status</th>
                                                    <th>Valid Upto</th>
                                                    <th>Remark</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (!empty($CalibrationQualificationstatus) && is_array($CalibrationQualificationstatus->data))
                                                    @foreach ($CalibrationQualificationstatus->data as $index => $detail)
                                                        <tr>
                                                            <td><input disabled type="text"
                                                                    name="qualitycontrol_1[{{ $index }}][serial]"
                                                                    value="{{ $index + 1 }}"></td>
                                                            <td><input type="text"
                                                                    name="qualitycontrol_1[{{ $index }}][Equipment_Name]"
                                                                    value="{{ $detail['Equipment_Name'] }}"></td>
                                                            <td><input type="text"
                                                                    name="qualitycontrol_1[{{ $index }}][Location]"
                                                                    value="{{ $detail['Location'] }}">
                                                            </td>
                                                            <td><input type="text"
                                                                    name="qualitycontrol_1[{{ $index }}][Equipment_No]"
                                                                    value="{{ $detail['Equipment_No'] }}">
                                                            </td>
                                                            <td><input type="text"
                                                                    name="qualitycontrol_1[{{ $index }}][Qualification_Status]"
                                                                    value="{{ $detail['Qualification_Status'] }}">
                                                            </td>
                                                            <td><input type="text"
                                                                    name="qualitycontrol_1[{{ $index }}][Valid_Upto]"
                                                                    value="{{ $detail['Valid_Upto'] }}"></td>
                                                            <td><input type="text"
                                                                    name="qualitycontrol_1[{{ $index }}][remark]"
                                                                    value="{{ $detail['remark'] }}"></td>
                                                            <td><button type="button"
                                                                    class="removeRowBtn">Remove</button></td>
                                                        </tr>
                                                    @endforeach
                                                @else
                                                    <tr>
                                                        <td colspan="9">No data found</td>
                                                    </tr>
                                                @endif
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <script>
                                $(document).ready(function() {
                                    // Add new row in Quality Control 1 table
                                    $('#quality_add_1').click(function(e) {
                                        e.preventDefault();

                                        function generateQualityTableRow1(serialNumber) {
                                            return (
                                                '<tr>' +
                                                '<td><input disabled type="text" name="qualitycontrol_1[' + serialNumber +
                                                '][serial]" value="' + (serialNumber + 1) + '"></td>' +
                                                '<td><input type="text" name="qualitycontrol_1[' + serialNumber +
                                                '][Equipment_Name]"></td>' +
                                                '<td><input type="text" name="qualitycontrol_1[' + serialNumber +
                                                '][Location]"></td>' +
                                                '<td><input type="text" name="qualitycontrol_1[' + serialNumber +
                                                '][Equipment_No]"></td>' +
                                                '<td><input type="text" name="qualitycontrol_1[' + serialNumber +
                                                '][Qualification_Status]"></td>' +
                                                '<td><input type="text" name="qualitycontrol_1[' + serialNumber +
                                                '][Valid_Upto]"></td>' +
                                                '<td><input type="text" name="qualitycontrol_1[' + serialNumber +
                                                '][remark]"></td>' +
                                                '<td><button type="button" class="removeRowBtn">Remove</button></td>' +
                                                '</tr>'
                                            );
                                        }

                                        var tableBody = $('#quality_details_1 tbody');
                                        var rowCount = tableBody.children('tr').length;
                                        var newRow = generateQualityTableRow1(rowCount);
                                        tableBody.append(newRow);
                                    });

                                    // Remove row in Quality Control 1 table
                                    $(document).on('click', '.removeRowBtn', function() {
                                        $(this).closest('tr').remove();
                                    });
                                });
                            </script>

                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="ResultBulkStage_HoTiStRe" id="ResultBulkStage_HoTiStRe">
                                        Results of Bulk Stage  <button type="button" id="ResultBulkStage_HoTiStRebtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="ResultBulkStage_HoTiStRediv">
                                        @if ($document->document_content && !empty($document->document_content->ResultBulkStage_HoTiStRe))
                                            @foreach (unserialize($document->document_content->ResultBulkStage_HoTiStRe) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleResultBulkStage_HoTiStReBlock' : 'singleResultBulkStage_HoTiStReBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="ResultBulkStage_HoTiStRe[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="ResultBulkStage_HoTiStRe[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subResultBulkStage_HoTiStReAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleResultBulkStage_HoTiStReBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="ResultBulkStage_HoTiStRe[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subResultBulkStage_HoTiStReAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'ResultBulkStage_HoTiStRe' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>

                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="Summary_HoTiStRe" id="Summary_HoTiStRe">
                                        Summary  <button type="button" id="Summary_HoTiStRebtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="Summary_HoTiStRediv">
                                        @if ($document->document_content && !empty($document->document_content->Summary_HoTiStRe))
                                            @foreach (unserialize($document->document_content->Summary_HoTiStRe) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleSummary_HoTiStReBlock' : 'singleSummary_HoTiStReBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="Summary_HoTiStRe[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="Summary_HoTiStRe[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subSummary_HoTiStReAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleSummary_HoTiStReBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="Summary_HoTiStRe[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subSummary_HoTiStReAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Summary_HoTiStRe' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>

                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="Conclusion_HoTiStRe" id="Conclusion_HoTiStRe">
                                        Conclusion  <button type="button" id="Conclusion_HoTiStRebtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="Conclusion_HoTiStRediv">
                                        @if ($document->document_content && !empty($document->document_content->Conclusion_HoTiStRe))
                                            @foreach (unserialize($document->document_content->Conclusion_HoTiStRe) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleConclusion_HoTiStReBlock' : 'singleConclusion_HoTiStReBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="Conclusion_HoTiStRe[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="Conclusion_HoTiStRe[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subConclusion_HoTiStReAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleConclusion_HoTiStReBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="Conclusion_HoTiStRe[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subConclusion_HoTiStReAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'Conclusion_HoTiStRe' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>

                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="ReportApproval_HoTiStRe" id="ReportApproval_HoTiStRe">
                                        Report Approval  <button type="button" id="ReportApproval_HoTiStRebtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="ReportApproval_HoTiStRediv">
                                        @if ($document->document_content && !empty($document->document_content->ReportApproval_HoTiStRe))
                                            @foreach (unserialize($document->document_content->ReportApproval_HoTiStRe) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleReportApproval_HoTiStReBlock' : 'singleReportApproval_HoTiStReBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="ReportApproval_HoTiStRe[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="ReportApproval_HoTiStRe[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subReportApproval_HoTiStReAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleReportApproval_HoTiStReBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="ReportApproval_HoTiStRe[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subReportApproval_HoTiStReAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'ReportApproval_HoTiStRe' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div> --}}


                            <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>Hold Time Study File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="HolTimSutRepfile_attachDatassp">
                                            @if ($document->HolTimSutRepfile_attach)
                                                @foreach(json_decode($document->HolTimSutRepfile_attach) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_HolTimSutRepfile_attach[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="annex_V_user_attachmentHolTimSutRepfile_attach" style="cursor: pointer;">Add</label>
                                            <input type="file" id="annex_V_user_attachmentHolTimSutRepfile_attach" name="HolTimSutRepfile_attach[]"
                                                oninput="addMultipleFiles(this, 'HolTimSutRepfile_attachDatassp')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_HolTimSutRepfile_attach" name="deleted_HolTimSutRepfile_attach" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_HolTimSutRepfile_attach');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>


                        </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>


            {{-- temperature mapping protcal tabs edirt blade  --}}
            <div id="doc-tempmapping" class="tabcontent">
                <div class="orig-head">
                    Temperature Mapping Protocal
                </div>
                <div class="input-fields">
                    <div class="row">

                        <div class="col-12">
                            <div class="group-input">
                                <label for="File_Attachment"><b>Temperature Mapping Protocol Cum Report File Attachment</b></label>
                                <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                <div class="file-attachment-field">
                                    <div class="file-attachment-list" id="TemMapProCumRepfile_attachDatassp">
                                        @if ($document->TemMapProCumRepfile_attach)
                                            @foreach(json_decode($document->TemMapProCumRepfile_attach) as $file)
                                                <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                    <b>{{ $file }}</b>
                                                    <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                        <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                    </a>
                                                    <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                        <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                    </a>
                                                    <input type="hidden" name="existing_TemMapProCumRepfile_attach[]" value="{{ $file }}">
                                                </h6>
                                            @endforeach
                                        @endif
                                    </div>

                                    <div class="add-btn">
                                        <label for="annex_V_user_attachmentTemMapProCumRepfile" style="cursor: pointer;">Add</label>
                                        <input type="file" id="annex_V_user_attachmentTemMapProCumRepfile" name="TemMapProCumRepfile_attach[]"
                                            oninput="addMultipleFiles(this, 'TemMapProCumRepfile_attachDatassp')" multiple hidden>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden field to store deleted files -->
                        <input type="hidden" id="deleted_TemMapProCumRepfile_attach" name="deleted_TemMapProCumRepfile_attach" value="">

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                document.querySelectorAll('.remove-file').forEach(button => {
                                    button.addEventListener('click', function () {
                                        const fileName = this.getAttribute('data-file-name');
                                        const fileContainer = this.closest('.file-container');

                                        if (fileContainer) {
                                            fileContainer.style.display = 'none';

                                            const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                            if (hiddenInput) {
                                                hiddenInput.remove();
                                            }

                                            const deletedFilesInput = document.getElementById('deleted_TemMapProCumRepfile_attach');
                                            let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                            deletedFiles.push(fileName);
                                            deletedFilesInput.value = deletedFiles.join(',');
                                        }
                                    });
                                });
                            });

                            function addMultipleFiles(input, listId) {
                                let fileList = document.getElementById(listId);
                                for (let file of input.files) {
                                    let fileContainer = document.createElement('h6');
                                    fileContainer.classList.add('file-container', 'text-dark');
                                    fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                    let fileText = document.createElement('b');
                                    fileText.textContent = file.name;

                                    let removeLink = document.createElement('a');
                                    removeLink.classList.add('remove-file');
                                    removeLink.dataset.fileName = file.name;
                                    removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                    removeLink.addEventListener('click', function () {
                                        fileContainer.style.display = 'none';
                                    });

                                    fileContainer.appendChild(fileText);
                                    fileContainer.appendChild(removeLink);
                                    fileList.appendChild(fileContainer);
                                }
                            }
                        </script>



                    </div>
                </div>
                <div class="button-block">
                    <button type="submit" value="save" name="submit" id="DocsaveButton"
                        class="saveButton">Save</button>
                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                        </a>
                    </button>
                </div>
            </div>












          {{-- packing validation report tabs  by kpatel --}}

        <div id="doc-PacValRep" class="tabcontent">
            <div class="orig-head">
            Packing validation Report
            </div>
            <div class="input-fields">
                <div class="row">

                    {{-- <div class="col-md-6">
                        <div class="group-input">
                            <label for="purpose">Generic Name </label>
                            <input type="text" name="generic_PacValRep" value="{{$document->document_content->generic_PacValRep}}">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="group-input">
                            <label for="scope">Product Code</label>
                            <input type="text" name="PacValRep_product_code" value="{{$document->document_content->PacValRep_product_code}}">
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="group-input">
                            <label for="scope">Std. Batch size </label>
                            <input type="text" name="PacValRep_std_batch" value="{{$document->document_content->PacValRep_std_batch}}">
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="group-input">
                            <label for="scope">Category</label>
                            <input type="text" name="PacValRep_category" value="{{$document->document_content->PacValRep_category}}">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="group-input">
                            <label for="scope">Label Claim  </label>
                            <input type="text" name="PacValRep_label_claim" value="{{$document->document_content->PacValRep_label_claim}}">
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="group-input">
                            <label for="scope">Market</label>
                            <input type="text" name="PacValRep_market" value="{{$document->document_content->PacValRep_market}}">
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="group-input">
                            <label for="scope">Shelf Life</label>
                            <input type="text" name="PacValRep_shelf_life" value="{{$document->document_content->PacValRep_shelf_life}}">
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="group-input">
                            <label for="scope">BMR No.</label>
                            <input type="text" name="PacValRep_bmr_no" value="{{$document->document_content->PacValRep_bmr_no}}">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="group-input">
                            <label for="scope">MFR No.</label>
                            <input type="text" name="PacValRep_mpr_no" value="{{$document->document_content->PacValRep_mpr_no}}">
                        </div>
                    </div>


                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="Purpose_PaVaReKp" id="Purpose_PaVaReKp">
                                Purpose  <button type="button" id="Purpose_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="Purpose_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->Purpose_PaVaReKp))
                                    @foreach (unserialize($document->document_content->Purpose_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSinglePurpose_PaVaReKpBlock' : 'singlePurpose_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="Purpose_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="Purpose_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subPurpose_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singlePurpose_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="Purpose_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subPurpose_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'Purpose_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="Scope_PaVaReKp" id="Scope_PaVaReKp">
                                Scope  <button type="button" id="Scope_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="Scope_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->Scope_PaVaReKp))
                                    @foreach (unserialize($document->document_content->Scope_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSingleScope_PaVaReKpBlock' : 'singleScope_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="Scope_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="Scope_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subScope_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singleScope_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="Scope_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subScope_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'Scope_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="BatchDetails_PaVaReKp" id="BatchDetails_PaVaReKp">
                                Batch Details  <button type="button" id="BatchDetails_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="BatchDetails_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->BatchDetails_PaVaReKp))
                                    @foreach (unserialize($document->document_content->BatchDetails_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSingleBatchDetails_PaVaReKpBlock' : 'singleBatchDetails_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="BatchDetails_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="BatchDetails_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subBatchDetails_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singleBatchDetails_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="BatchDetails_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subBatchDetails_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'BatchDetails_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>



                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="ReferenceDocument_PaVaReKp" id="ReferenceDocument_PaVaReKp">
                                Reference Document  <button type="button" id="ReferenceDocument_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="ReferenceDocument_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->ReferenceDocument_PaVaReKp))
                                    @foreach (unserialize($document->document_content->ReferenceDocument_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSingleReferenceDocument_PaVaReKpBlock' : 'singleReferenceDocument_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="ReferenceDocument_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="ReferenceDocument_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subReferenceDocument_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singleReferenceDocument_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="ReferenceDocument_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subReferenceDocument_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'ReferenceDocument_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="PackingMaterialApprovalVendDeat_PaVaReKp" id="PackingMaterialApprovalVendDeat_PaVaReKp">
                                Packing Material Approved Vendor Details  <button type="button" id="PackingMaterialApprovalVendDeat_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="PackingMaterialApprovalVendDeat_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->PackingMaterialApprovalVendDeat_PaVaReKp))
                                    @foreach (unserialize($document->document_content->PackingMaterialApprovalVendDeat_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSinglePackingMaterialApprovalVendDeat_PaVaReKpBlock' : 'singlePackingMaterialApprovalVendDeat_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="PackingMaterialApprovalVendDeat_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="PackingMaterialApprovalVendDeat_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subPackingMaterialApprovalVendDeat_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singlePackingMaterialApprovalVendDeat_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="PackingMaterialApprovalVendDeat_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subPackingMaterialApprovalVendDeat_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'PackingMaterialApprovalVendDeat_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="UsedEquipmentCalibrationQualiSta_PaVaReKp" id="UsedEquipmentCalibrationQualiSta_PaVaReKp">
                                Used Equipment Calibration and  Qualification status  <button type="button" id="UsedEquipmentCalibrationQualiSta_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="UsedEquipmentCalibrationQualiSta_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->UsedEquipmentCalibrationQualiSta_PaVaReKp))
                                    @foreach (unserialize($document->document_content->UsedEquipmentCalibrationQualiSta_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSingleUsedEquipmentCalibrationQualiSta_PaVaReKpBlock' : 'singleUsedEquipmentCalibrationQualiSta_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="UsedEquipmentCalibrationQualiSta_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="UsedEquipmentCalibrationQualiSta_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subUsedEquipmentCalibrationQualiSta_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singleUsedEquipmentCalibrationQualiSta_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="UsedEquipmentCalibrationQualiSta_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subUsedEquipmentCalibrationQualiSta_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'UsedEquipmentCalibrationQualiSta_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="ResultOfPacking_PaVaReKp" id="ResultOfPacking_PaVaReKp">
                                Results Of Packing (Finished product)  <button type="button" id="ResultOfPacking_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="ResultOfPacking_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->ResultOfPacking_PaVaReKp))
                                    @foreach (unserialize($document->document_content->ResultOfPacking_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSingleResultOfPacking_PaVaReKpBlock' : 'singleResultOfPacking_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="ResultOfPacking_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="ResultOfPacking_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subResultOfPacking_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singleResultOfPacking_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="ResultOfPacking_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subResultOfPacking_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'ResultOfPacking_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="CriticalProcessParameters_PaVaReKp" id="CriticalProcessParameters_PaVaReKp">
                                Critical process parameters & Critical quality attributes  <button type="button" id="CriticalProcessParameters_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="CriticalProcessParameters_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->CriticalProcessParameters_PaVaReKp))
                                    @foreach (unserialize($document->document_content->CriticalProcessParameters_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSingleCriticalProcessParameters_PaVaReKpBlock' : 'singleCriticalProcessParameters_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="CriticalProcessParameters_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="CriticalProcessParameters_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subCriticalProcessParameters_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singleCriticalProcessParameters_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="CriticalProcessParameters_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subCriticalProcessParameters_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'CriticalProcessParameters_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="yield_PaVaReKp" id="yield_PaVaReKp">
                                % Yield <button type="button" id="yield_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="yield_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->yield_PaVaReKp))
                                    @foreach (unserialize($document->document_content->yield_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSingleyield_PaVaReKpBlock' : 'singleyield_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="yield_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="yield_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subyield_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singleyield_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="yield_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subyield_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'yield_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>


                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="HoldTimeStudy_PaVaReKp" id="HoldTimeStudy_PaVaReKp">
                                Hold time Study <button type="button" id="HoldTimeStudy_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="HoldTimeStudy_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->HoldTimeStudy_PaVaReKp))
                                    @foreach (unserialize($document->document_content->HoldTimeStudy_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSingleHoldTimeStudy_PaVaReKpBlock' : 'singleHoldTimeStudy_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="HoldTimeStudy_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="HoldTimeStudy_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subHoldTimeStudy_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singleHoldTimeStudy_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="HoldTimeStudy_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subHoldTimeStudy_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'HoldTimeStudy_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="CleaningValidation_PaVaReKp" id="CleaningValidation_PaVaReKp">
                                Cleaning validation  <button type="button" id="CleaningValidation_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="CleaningValidation_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->CleaningValidation_PaVaReKp))
                                    @foreach (unserialize($document->document_content->CleaningValidation_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSingleCleaningValidation_PaVaReKpBlock' : 'singleCleaningValidation_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="CleaningValidation_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="CleaningValidation_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subCleaningValidation_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singleCleaningValidation_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="CleaningValidation_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subCleaningValidation_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'CleaningValidation_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="StabilityStudy_PaVaReKp" id="StabilityStudy_PaVaReKp">
                                Stability study  <button type="button" id="StabilityStudy_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="StabilityStudy_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->StabilityStudy_PaVaReKp))
                                    @foreach (unserialize($document->document_content->StabilityStudy_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSingleStabilityStudy_PaVaReKpBlock' : 'singleStabilityStudy_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="StabilityStudy_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="StabilityStudy_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subStabilityStudy_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singleStabilityStudy_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="StabilityStudy_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subStabilityStudy_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'StabilityStudy_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>



                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="DeviationIfAny_PaVaReKp" id="DeviationIfAny_PaVaReKp">
                                Deviation If Any <button type="button" id="DeviationIfAny_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="DeviationIfAny_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->DeviationIfAny_PaVaReKp))
                                    @foreach (unserialize($document->document_content->DeviationIfAny_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSingleDeviationIfAny_PaVaReKpBlock' : 'singleDeviationIfAny_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="DeviationIfAny_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="DeviationIfAny_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subDeviationIfAny_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singleDeviationIfAny_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="DeviationIfAny_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subDeviationIfAny_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'DeviationIfAny_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="ChangeControlifany_PaVaReKp" id="ChangeControlifany_PaVaReKp">
                                Change Control ( If any)  <button type="button" id="ChangeControlifany_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="ChangeControlifany_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->ChangeControlifany_PaVaReKp))
                                    @foreach (unserialize($document->document_content->ChangeControlifany_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSingleChangeControlifany_PaVaReKpBlock' : 'singleChangeControlifany_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="ChangeControlifany_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="ChangeControlifany_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subChangeControlifany_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singleChangeControlifany_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="ChangeControlifany_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subChangeControlifany_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'ChangeControlifany_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="Summary_PaVaReKp" id="Summary_PaVaReKp">
                                Summary  <button type="button" id="Summary_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="Summary_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->Summary_PaVaReKp))
                                    @foreach (unserialize($document->document_content->Summary_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSingleSummary_PaVaReKpBlock' : 'singleSummary_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="Summary_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="Summary_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subSummary_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singleSummary_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="Summary_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subSummary_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'Summary_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="Conclusion_PaVaReKp" id="Conclusion_PaVaReKp">
                                Conclusion  <button type="button" id="Conclusion_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="Conclusion_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->Conclusion_PaVaReKp))
                                    @foreach (unserialize($document->document_content->Conclusion_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSingleConclusion_PaVaReKpBlock' : 'singleConclusion_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="Conclusion_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="Conclusion_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subConclusion_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singleConclusion_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="Conclusion_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subConclusion_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'Conclusion_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="ProposedParameters_PaVaReKp" id="ProposedParameters_PaVaReKp">
                                Proposed Parameters for Upcoming Batches  <button type="button" id="ProposedParameters_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="ProposedParameters_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->ProposedParameters_PaVaReKp))
                                    @foreach (unserialize($document->document_content->ProposedParameters_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSingleProposedParameters_PaVaReKpBlock' : 'singleProposedParameters_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="ProposedParameters_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="ProposedParameters_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subProposedParameters_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singleProposedParameters_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="ProposedParameters_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subProposedParameters_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'ProposedParameters_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="group-input">
                            <label for="ReportApproval_PaVaReKp" id="ReportApproval_PaVaReKp">
                                Report Approval  <button type="button" id="ReportApproval_PaVaReKpbtnadd" name="button"
                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                    require completion</small></div>
                            <div id="ReportApproval_PaVaReKpdiv">
                                @if ($document->document_content && !empty($document->document_content->ReportApproval_PaVaReKp))
                                    @foreach (unserialize($document->document_content->ReportApproval_PaVaReKp) as $key => $data)
                                        <div
                                            class="{{ str_contains($key, 'sub') ? 'subSingleReportApproval_PaVaReKpBlock' : 'singleReportApproval_PaVaReKpBlock' }}">
                                            @if (str_contains($key, 'sub'))
                                                <div class="resrow row">
                                                    <div class="col-6">
                                                        <textarea name="ReportApproval_PaVaReKp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            @else
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="ReportApproval_PaVaReKp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-dark subReportApproval_PaVaReKpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                @else
                                    <div class="singleReportApproval_PaVaReKpBlock">
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="ReportApproval_PaVaReKp[]" class="myclassname"></textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button class="btn btn-dark subReportApproval_PaVaReKpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                @endif
                            </div>

                            @foreach ($history as $tempHistory)
                                @if ($tempHistory->activity_type == 'ReportApproval_PaVaReKp' && !empty($tempHistory->comment))
                                    @php
                                        $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                    @endphp
                                    <p style="color: blue">Modify by {{ $users_name }} at
                                        {{ $tempHistory->created_at }}
                                    </p>
                                    <input class="input-field"
                                        style="background: #ffff0061;
                            color: black;"
                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                @endif
                            @endforeach
                        </div>
                    </div> --}}



                    <div class="col-12">
                        <div class="group-input">
                            <label for="File_Attachment"><b>Packing Validation Report File Attachment</b></label>
                            <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                            <div class="file-attachment-field">
                                <div class="file-attachment-list" id="packing_validationReport">
                                    @if ($document->PacValRepfile_attach)
                                        @foreach(json_decode($document->PacValRepfile_attach) as $file)
                                            <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                <b>{{ $file }}</b>
                                                <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                    <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                </a>
                                                <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                    <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                </a>
                                                <input type="hidden" name="existing_PacValRepfile_attach[]" value="{{ $file }}">
                                            </h6>
                                        @endforeach
                                    @endif
                                </div>

                                <div class="add-btn">
                                    <label for="annex_V_user_attachmentData" style="cursor: pointer;">Add</label>
                                    <input type="file" id="annex_V_user_attachmentData" name="PacValRepfile_attach[]"
                                        oninput="addMultipleFiles(this, 'packing_validationReport')" multiple hidden>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden field to store deleted files -->
                    <input type="hidden" id="deleted_PacValRepfile_attach" name="deleted_PacValRepfile_attach" value="">

                    <script>
                        document.addEventListener('DOMContentLoaded', function () {
                            document.querySelectorAll('.remove-file').forEach(button => {
                                button.addEventListener('click', function () {
                                    const fileName = this.getAttribute('data-file-name');
                                    const fileContainer = this.closest('.file-container');

                                    if (fileContainer) {
                                        fileContainer.style.display = 'none';

                                        const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                        if (hiddenInput) {
                                            hiddenInput.remove();
                                        }

                                        const deletedFilesInput = document.getElementById('deleted_PacValRepfile_attach');
                                        let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                        deletedFiles.push(fileName);
                                        deletedFilesInput.value = deletedFiles.join(',');
                                    }
                                });
                            });
                        });

                        function addMultipleFiles(input, listId) {
                            let fileList = document.getElementById(listId);
                            for (let file of input.files) {
                                let fileContainer = document.createElement('h6');
                                fileContainer.classList.add('file-container', 'text-dark');
                                fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                let fileText = document.createElement('b');
                                fileText.textContent = file.name;

                                let removeLink = document.createElement('a');
                                removeLink.classList.add('remove-file');
                                removeLink.dataset.fileName = file.name;
                                removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                removeLink.addEventListener('click', function () {
                                    fileContainer.style.display = 'none';
                                });

                                fileContainer.appendChild(fileText);
                                fileContainer.appendChild(removeLink);
                                fileList.appendChild(fileContainer);
                            }
                        }
                    </script>




                </div>
            </div>
            <div class="button-block">
                <button type="submit" value="save" name="submit" id="DocsaveButton"
                    class="saveButton">Save</button>
                <button type="button" class="backButton" onclick="previousStep()">Back</button>
                <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                    </a>
                </button>
            </div>
        </div>


{{-- ---------------sttrart tabs --Format for comppressed air and nitrgen ges sys protocal  ----------------------- --}}

<div id="doc-FoCoANGsP" class="tabcontent">
    <div class="orig-head">
        Format for Compressed Air and Nitrogen Gas System Protocol
    </div>
    <div class="input-fields">
        <div class="row">



            {{-- <div class="col-md-12">
                <div class="group-input">
                    <label for="Protocolapproval_FoCompAaNirogenkp" id="Protocolapproval_FoCompAaNirogenkp">
                        Protocol Approval  <button type="button" id="Protocolapproval_FoCompAaNirogenkpbtnadd" name="button"
                            {{ Helpers::isRevised($document->stage) }}>+</button>
                    </label>
                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                            require completion</small></div>
                    <div id="Protocolapproval_FoCompAaNirogenkpdiv">
                        @if ($document->document_content && !empty($document->document_content->Protocolapproval_FoCompAaNirogenkp))
                            @foreach (unserialize($document->document_content->Protocolapproval_FoCompAaNirogenkp) as $key => $data)
                                <div
                                    class="{{ str_contains($key, 'sub') ? 'subSingleProtocolapproval_FoCompAaNirogenkpBlock' : 'singleProtocolapproval_FoCompAaNirogenkpBlock' }}">
                                    @if (str_contains($key, 'sub'))
                                        <div class="resrow row">
                                            <div class="col-6">
                                                <textarea name="Protocolapproval_FoCompAaNirogenkp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                            </div>
                                            <div class="col-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    @else
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="Protocolapproval_FoCompAaNirogenkp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-dark subProtocolapproval_FoCompAaNirogenkpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                            </div>
                                        </div>
                                    @endif
                                </div>
                            @endforeach
                        @else
                            <div class="singleProtocolapproval_FoCompAaNirogenkpBlock">
                                <div class="row">
                                    <div class="col-sm-10">
                                        <textarea name="Protocolapproval_FoCompAaNirogenkp[]" class="myclassname"></textarea>
                                    </div>
                                    <div class="col-sm-1">
                                        <button class="btn btn-dark subProtocolapproval_FoCompAaNirogenkpAdd">+</button>
                                    </div>
                                    <div class="col-sm-1">
                                        <button
                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                    </div>
                                </div>
                            </div>
                        @endif
                    </div>

                    @foreach ($history as $tempHistory)
                        @if ($tempHistory->activity_type == 'Protocolapproval_FoCompAaNirogenkp' && !empty($tempHistory->comment))
                            @php
                                $users_name = DB::table('users')
                                    ->where('id', $tempHistory->user_id)
                                    ->value('name');
                            @endphp
                            <p style="color: blue">Modify by {{ $users_name }} at
                                {{ $tempHistory->created_at }}
                            </p>
                            <input class="input-field"
                                style="background: #ffff0061;
                    color: black;"
                                type="text" value="{{ $tempHistory->comment }}" disabled>
                        @endif
                    @endforeach
                </div>
            </div>

            <div class="col-md-12">
                <div class="group-input">
                    <label for="Objective_FoCompAaNirogenkp" id="Objective_FoCompAaNirogenkp">
                        Objective  <button type="button" id="Objective_FoCompAaNirogenkpbtnadd" name="button"
                            {{ Helpers::isRevised($document->stage) }}>+</button>
                    </label>
                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                            require completion</small></div>
                    <div id="Objective_FoCompAaNirogenkpdiv">
                        @if ($document->document_content && !empty($document->document_content->Objective_FoCompAaNirogenkp))
                            @foreach (unserialize($document->document_content->Objective_FoCompAaNirogenkp) as $key => $data)
                                <div
                                    class="{{ str_contains($key, 'sub') ? 'subSingleObjective_FoCompAaNirogenkpBlock' : 'singleObjective_FoCompAaNirogenkpBlock' }}">
                                    @if (str_contains($key, 'sub'))
                                        <div class="resrow row">
                                            <div class="col-6">
                                                <textarea name="Objective_FoCompAaNirogenkp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                            </div>
                                            <div class="col-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    @else
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="Objective_FoCompAaNirogenkp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-dark subObjective_FoCompAaNirogenkpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                            </div>
                                        </div>
                                    @endif
                                </div>
                            @endforeach
                        @else
                            <div class="singleObjective_FoCompAaNirogenkpBlock">
                                <div class="row">
                                    <div class="col-sm-10">
                                        <textarea name="Objective_FoCompAaNirogenkp[]" class="myclassname"></textarea>
                                    </div>
                                    <div class="col-sm-1">
                                        <button class="btn btn-dark subObjective_FoCompAaNirogenkpAdd">+</button>
                                    </div>
                                    <div class="col-sm-1">
                                        <button
                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                    </div>
                                </div>
                            </div>
                        @endif
                    </div>

                    @foreach ($history as $tempHistory)
                        @if ($tempHistory->activity_type == 'Objective_FoCompAaNirogenkp' && !empty($tempHistory->comment))
                            @php
                                $users_name = DB::table('users')
                                    ->where('id', $tempHistory->user_id)
                                    ->value('name');
                            @endphp
                            <p style="color: blue">Modify by {{ $users_name }} at
                                {{ $tempHistory->created_at }}
                            </p>
                            <input class="input-field"
                                style="background: #ffff0061;
                    color: black;"
                                type="text" value="{{ $tempHistory->comment }}" disabled>
                        @endif
                    @endforeach
                </div>
            </div>

            <div class="col-md-12">
                <div class="group-input">
                    <label for="Purpose_FoCompAaNirogenkp" id="Purpose_FoCompAaNirogenkp">
                        Purpose <button type="button" id="Purpose_FoCompAaNirogenkpbtnadd" name="button"
                            {{ Helpers::isRevised($document->stage) }}>+</button>
                    </label>
                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                            require completion</small></div>
                    <div id="Purpose_FoCompAaNirogenkpdiv">
                        @if ($document->document_content && !empty($document->document_content->Purpose_FoCompAaNirogenkp))
                            @foreach (unserialize($document->document_content->Purpose_FoCompAaNirogenkp) as $key => $data)
                                <div
                                    class="{{ str_contains($key, 'sub') ? 'subSinglePurpose_FoCompAaNirogenkpBlock' : 'singlePurpose_FoCompAaNirogenkpBlock' }}">
                                    @if (str_contains($key, 'sub'))
                                        <div class="resrow row">
                                            <div class="col-6">
                                                <textarea name="Purpose_FoCompAaNirogenkp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                            </div>
                                            <div class="col-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    @else
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="Purpose_FoCompAaNirogenkp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-dark subPurpose_FoCompAaNirogenkpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                            </div>
                                        </div>
                                    @endif
                                </div>
                            @endforeach
                        @else
                            <div class="singlePurpose_FoCompAaNirogenkpBlock">
                                <div class="row">
                                    <div class="col-sm-10">
                                        <textarea name="Purpose_FoCompAaNirogenkp[]" class="myclassname"></textarea>
                                    </div>
                                    <div class="col-sm-1">
                                        <button class="btn btn-dark subPurpose_FoCompAaNirogenkpAdd">+</button>
                                    </div>
                                    <div class="col-sm-1">
                                        <button
                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                    </div>
                                </div>
                            </div>
                        @endif
                    </div>

                    @foreach ($history as $tempHistory)
                        @if ($tempHistory->activity_type == 'Purpose_FoCompAaNirogenkp' && !empty($tempHistory->comment))
                            @php
                                $users_name = DB::table('users')
                                    ->where('id', $tempHistory->user_id)
                                    ->value('name');
                            @endphp
                            <p style="color: blue">Modify by {{ $users_name }} at
                                {{ $tempHistory->created_at }}
                            </p>
                            <input class="input-field"
                                style="background: #ffff0061;
                    color: black;"
                                type="text" value="{{ $tempHistory->comment }}" disabled>
                        @endif
                    @endforeach
                </div>
            </div>



            <div class="col-md-12">
                <div class="group-input">
                    <label for="Scope_FoCompAaNirogenkp" id="Scope_FoCompAaNirogenkp">
                        Scope  <button type="button" id="Scope_FoCompAaNirogenkpbtnadd" name="button"
                            {{ Helpers::isRevised($document->stage) }}>+</button>
                    </label>
                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                            require completion</small></div>
                    <div id="Scope_FoCompAaNirogenkpdiv">
                        @if ($document->document_content && !empty($document->document_content->Scope_FoCompAaNirogenkp))
                            @foreach (unserialize($document->document_content->Scope_FoCompAaNirogenkp) as $key => $data)
                                <div
                                    class="{{ str_contains($key, 'sub') ? 'subSingleScope_FoCompAaNirogenkpBlock' : 'singleScope_FoCompAaNirogenkpBlock' }}">
                                    @if (str_contains($key, 'sub'))
                                        <div class="resrow row">
                                            <div class="col-6">
                                                <textarea name="Scope_FoCompAaNirogenkp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                            </div>
                                            <div class="col-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    @else
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="Scope_FoCompAaNirogenkp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-dark subScope_FoCompAaNirogenkpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                            </div>
                                        </div>
                                    @endif
                                </div>
                            @endforeach
                        @else
                            <div class="singleScope_FoCompAaNirogenkpBlock">
                                <div class="row">
                                    <div class="col-sm-10">
                                        <textarea name="Scope_FoCompAaNirogenkp[]" class="myclassname"></textarea>
                                    </div>
                                    <div class="col-sm-1">
                                        <button class="btn btn-dark subScope_FoCompAaNirogenkpAdd">+</button>
                                    </div>
                                    <div class="col-sm-1">
                                        <button
                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                    </div>
                                </div>
                            </div>
                        @endif
                    </div>

                    @foreach ($history as $tempHistory)
                        @if ($tempHistory->activity_type == 'Scope_FoCompAaNirogenkp' && !empty($tempHistory->comment))
                            @php
                                $users_name = DB::table('users')
                                    ->where('id', $tempHistory->user_id)
                                    ->value('name');
                            @endphp
                            <p style="color: blue">Modify by {{ $users_name }} at
                                {{ $tempHistory->created_at }}
                            </p>
                            <input class="input-field"
                                style="background: #ffff0061;
                    color: black;"
                                type="text" value="{{ $tempHistory->comment }}" disabled>
                        @endif
                    @endforeach
                </div>
            </div>

            <div class="col-md-12">
                <div class="group-input">
                    <label for="ExcutionTeamResp_FoCompAaNirogenkp" id="ExcutionTeamResp_FoCompAaNirogenkp">
                        Execution Team Responsibilities  <button type="button" id="ExcutionTeamResp_FoCompAaNirogenkpbtnadd" name="button"
                            {{ Helpers::isRevised($document->stage) }}>+</button>
                    </label>
                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                            require completion</small></div>
                    <div id="ExcutionTeamResp_FoCompAaNirogenkpdiv">
                        @if ($document->document_content && !empty($document->document_content->ExcutionTeamResp_FoCompAaNirogenkp))
                            @foreach (unserialize($document->document_content->ExcutionTeamResp_FoCompAaNirogenkp) as $key => $data)
                                <div
                                    class="{{ str_contains($key, 'sub') ? 'subSingleExcutionTeamResp_FoCompAaNirogenkpBlock' : 'singleExcutionTeamResp_FoCompAaNirogenkpBlock' }}">
                                    @if (str_contains($key, 'sub'))
                                        <div class="resrow row">
                                            <div class="col-6">
                                                <textarea name="ExcutionTeamResp_FoCompAaNirogenkp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                            </div>
                                            <div class="col-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    @else
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="ExcutionTeamResp_FoCompAaNirogenkp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-dark subExcutionTeamResp_FoCompAaNirogenkpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                            </div>
                                        </div>
                                    @endif
                                </div>
                            @endforeach
                        @else
                            <div class="singleExcutionTeamResp_FoCompAaNirogenkpBlock">
                                <div class="row">
                                    <div class="col-sm-10">
                                        <textarea name="ExcutionTeamResp_FoCompAaNirogenkp[]" class="myclassname"></textarea>
                                    </div>
                                    <div class="col-sm-1">
                                        <button class="btn btn-dark subExcutionTeamResp_FoCompAaNirogenkpAdd">+</button>
                                    </div>
                                    <div class="col-sm-1">
                                        <button
                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                    </div>
                                </div>
                            </div>
                        @endif
                    </div>

                    @foreach ($history as $tempHistory)
                        @if ($tempHistory->activity_type == 'ExcutionTeamResp_FoCompAaNirogenkp' && !empty($tempHistory->comment))
                            @php
                                $users_name = DB::table('users')
                                    ->where('id', $tempHistory->user_id)
                                    ->value('name');
                            @endphp
                            <p style="color: blue">Modify by {{ $users_name }} at
                                {{ $tempHistory->created_at }}
                            </p>
                            <input class="input-field"
                                style="background: #ffff0061;
                    color: black;"
                                type="text" value="{{ $tempHistory->comment }}" disabled>
                        @endif
                    @endforeach
                </div>
            </div>

            <div class="col-md-12">
                <div class="group-input">
                    <label for="Abbreviations_FoCompAaNirogenkp" id="Abbreviations_FoCompAaNirogenkp">
                        Abbreviations  <button type="button" id="Abbreviations_FoCompAaNirogenkpbtnadd" name="button"
                            {{ Helpers::isRevised($document->stage) }}>+</button>
                    </label>
                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                            require completion</small></div>
                    <div id="Abbreviations_FoCompAaNirogenkpdiv">
                        @if ($document->document_content && !empty($document->document_content->Abbreviations_FoCompAaNirogenkp))
                            @foreach (unserialize($document->document_content->Abbreviations_FoCompAaNirogenkp) as $key => $data)
                                <div
                                    class="{{ str_contains($key, 'sub') ? 'subSingleAbbreviations_FoCompAaNirogenkpBlock' : 'singleAbbreviations_FoCompAaNirogenkpBlock' }}">
                                    @if (str_contains($key, 'sub'))
                                        <div class="resrow row">
                                            <div class="col-6">
                                                <textarea name="Abbreviations_FoCompAaNirogenkp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                            </div>
                                            <div class="col-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    @else
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="Abbreviations_FoCompAaNirogenkp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-dark subAbbreviations_FoCompAaNirogenkpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                            </div>
                                        </div>
                                    @endif
                                </div>
                            @endforeach
                        @else
                            <div class="singleAbbreviations_FoCompAaNirogenkpBlock">
                                <div class="row">
                                    <div class="col-sm-10">
                                        <textarea name="Abbreviations_FoCompAaNirogenkp[]" class="myclassname"></textarea>
                                    </div>
                                    <div class="col-sm-1">
                                        <button class="btn btn-dark subAbbreviations_FoCompAaNirogenkpAdd">+</button>
                                    </div>
                                    <div class="col-sm-1">
                                        <button
                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                    </div>
                                </div>
                            </div>
                        @endif
                    </div>

                    @foreach ($history as $tempHistory)
                        @if ($tempHistory->activity_type == 'Abbreviations_FoCompAaNirogenkp' && !empty($tempHistory->comment))
                            @php
                                $users_name = DB::table('users')
                                    ->where('id', $tempHistory->user_id)
                                    ->value('name');
                            @endphp
                            <p style="color: blue">Modify by {{ $users_name }} at
                                {{ $tempHistory->created_at }}
                            </p>
                            <input class="input-field"
                                style="background: #ffff0061;
                    color: black;"
                                type="text" value="{{ $tempHistory->comment }}" disabled>
                        @endif
                    @endforeach
                </div>
            </div>

            <div class="col-md-12">
                <div class="group-input">
                    <label for="EquipmentSystemIde_FoCompAaNirogenkp" id="EquipmentSystemIde_FoCompAaNirogenkp">
                        Equipment / System Identification  <button type="button" id="EquipmentSystemIde_FoCompAaNirogenkpbtnadd" name="button"
                            {{ Helpers::isRevised($document->stage) }}>+</button>
                    </label>
                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                            require completion</small></div>
                    <div id="EquipmentSystemIde_FoCompAaNirogenkpdiv">
                        @if ($document->document_content && !empty($document->document_content->EquipmentSystemIde_FoCompAaNirogenkp))
                            @foreach (unserialize($document->document_content->EquipmentSystemIde_FoCompAaNirogenkp) as $key => $data)
                                <div
                                    class="{{ str_contains($key, 'sub') ? 'subSingleEquipmentSystemIde_FoCompAaNirogenkpBlock' : 'singleEquipmentSystemIde_FoCompAaNirogenkpBlock' }}">
                                    @if (str_contains($key, 'sub'))
                                        <div class="resrow row">
                                            <div class="col-6">
                                                <textarea name="EquipmentSystemIde_FoCompAaNirogenkp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                            </div>
                                            <div class="col-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    @else
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="EquipmentSystemIde_FoCompAaNirogenkp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-dark subEquipmentSystemIde_FoCompAaNirogenkpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                            </div>
                                        </div>
                                    @endif
                                </div>
                            @endforeach
                        @else
                            <div class="singleEquipmentSystemIde_FoCompAaNirogenkpBlock">
                                <div class="row">
                                    <div class="col-sm-10">
                                        <textarea name="EquipmentSystemIde_FoCompAaNirogenkp[]" class="myclassname"></textarea>
                                    </div>
                                    <div class="col-sm-1">
                                        <button class="btn btn-dark subEquipmentSystemIde_FoCompAaNirogenkpAdd">+</button>
                                    </div>
                                    <div class="col-sm-1">
                                        <button
                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                    </div>
                                </div>
                            </div>
                        @endif
                    </div>

                    @foreach ($history as $tempHistory)
                        @if ($tempHistory->activity_type == 'EquipmentSystemIde_FoCompAaNirogenkp' && !empty($tempHistory->comment))
                            @php
                                $users_name = DB::table('users')
                                    ->where('id', $tempHistory->user_id)
                                    ->value('name');
                            @endphp
                            <p style="color: blue">Modify by {{ $users_name }} at
                                {{ $tempHistory->created_at }}
                            </p>
                            <input class="input-field"
                                style="background: #ffff0061;
                    color: black;"
                                type="text" value="{{ $tempHistory->comment }}" disabled>
                        @endif
                    @endforeach
                </div>
            </div>

            <div class="col-md-12">
                <div class="group-input">
                    <label for="DocumentFollowed_FoCompAaNirogenkp" id="DocumentFollowed_FoCompAaNirogenkp">
                        Documents To Be Followed  <button type="button" id="DocumentFollowed_FoCompAaNirogenkpbtnadd" name="button"
                            {{ Helpers::isRevised($document->stage) }}>+</button>
                    </label>
                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                            require completion</small></div>
                    <div id="DocumentFollowed_FoCompAaNirogenkpdiv">
                        @if ($document->document_content && !empty($document->document_content->DocumentFollowed_FoCompAaNirogenkp))
                            @foreach (unserialize($document->document_content->DocumentFollowed_FoCompAaNirogenkp) as $key => $data)
                                <div
                                    class="{{ str_contains($key, 'sub') ? 'subSingleDocumentFollowed_FoCompAaNirogenkpBlock' : 'singleDocumentFollowed_FoCompAaNirogenkpBlock' }}">
                                    @if (str_contains($key, 'sub'))
                                        <div class="resrow row">
                                            <div class="col-6">
                                                <textarea name="DocumentFollowed_FoCompAaNirogenkp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                            </div>
                                            <div class="col-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    @else
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="DocumentFollowed_FoCompAaNirogenkp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-dark subDocumentFollowed_FoCompAaNirogenkpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                            </div>
                                        </div>
                                    @endif
                                </div>
                            @endforeach
                        @else
                            <div class="singleDocumentFollowed_FoCompAaNirogenkpBlock">
                                <div class="row">
                                    <div class="col-sm-10">
                                        <textarea name="DocumentFollowed_FoCompAaNirogenkp[]" class="myclassname"></textarea>
                                    </div>
                                    <div class="col-sm-1">
                                        <button class="btn btn-dark subDocumentFollowed_FoCompAaNirogenkpAdd">+</button>
                                    </div>
                                    <div class="col-sm-1">
                                        <button
                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                    </div>
                                </div>
                            </div>
                        @endif
                    </div>

                    @foreach ($history as $tempHistory)
                        @if ($tempHistory->activity_type == 'DocumentFollowed_FoCompAaNirogenkp' && !empty($tempHistory->comment))
                            @php
                                $users_name = DB::table('users')
                                    ->where('id', $tempHistory->user_id)
                                    ->value('name');
                            @endphp
                            <p style="color: blue">Modify by {{ $users_name }} at
                                {{ $tempHistory->created_at }}
                            </p>
                            <input class="input-field"
                                style="background: #ffff0061;
                    color: black;"
                                type="text" value="{{ $tempHistory->comment }}" disabled>
                        @endif
                    @endforeach
                </div>
            </div>

            <div class="col-md-12">
                <div class="group-input">
                    <label for="GenralConsPre_FoCompAaNirogenkp" id="GenralConsPre_FoCompAaNirogenkp">
                        General consideration/Prerequisites <button type="button" id="GenralConsPre_FoCompAaNirogenkpbtnadd" name="button"
                            {{ Helpers::isRevised($document->stage) }}>+</button>
                    </label>
                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                            require completion</small></div>
                    <div id="GenralConsPre_FoCompAaNirogenkpdiv">
                        @if ($document->document_content && !empty($document->document_content->GenralConsPre_FoCompAaNirogenkp))
                            @foreach (unserialize($document->document_content->GenralConsPre_FoCompAaNirogenkp) as $key => $data)
                                <div
                                    class="{{ str_contains($key, 'sub') ? 'subSingleGenralConsPre_FoCompAaNirogenkpBlock' : 'singleGenralConsPre_FoCompAaNirogenkpBlock' }}">
                                    @if (str_contains($key, 'sub'))
                                        <div class="resrow row">
                                            <div class="col-6">
                                                <textarea name="GenralConsPre_FoCompAaNirogenkp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                            </div>
                                            <div class="col-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    @else
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="GenralConsPre_FoCompAaNirogenkp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-dark subGenralConsPre_FoCompAaNirogenkpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                            </div>
                                        </div>
                                    @endif
                                </div>
                            @endforeach
                        @else
                            <div class="singleGenralConsPre_FoCompAaNirogenkpBlock">
                                <div class="row">
                                    <div class="col-sm-10">
                                        <textarea name="GenralConsPre_FoCompAaNirogenkp[]" class="myclassname"></textarea>
                                    </div>
                                    <div class="col-sm-1">
                                        <button class="btn btn-dark subGenralConsPre_FoCompAaNirogenkpAdd">+</button>
                                    </div>
                                    <div class="col-sm-1">
                                        <button
                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                    </div>
                                </div>
                            </div>
                        @endif
                    </div>

                    @foreach ($history as $tempHistory)
                        @if ($tempHistory->activity_type == 'GenralConsPre_FoCompAaNirogenkp' && !empty($tempHistory->comment))
                            @php
                                $users_name = DB::table('users')
                                    ->where('id', $tempHistory->user_id)
                                    ->value('name');
                            @endphp
                            <p style="color: blue">Modify by {{ $users_name }} at
                                {{ $tempHistory->created_at }}
                            </p>
                            <input class="input-field"
                                style="background: #ffff0061;
                    color: black;"
                                type="text" value="{{ $tempHistory->comment }}" disabled>
                        @endif
                    @endforeach
                </div>
            </div>


            <div class="col-md-12">
                <div class="group-input">
                    <label for="RevalidCrite_FoCompAaNirogenkp" id="RevalidCrite_FoCompAaNirogenkp">
                        Revalidation criteria <button type="button" id="RevalidCrite_FoCompAaNirogenkpbtnadd" name="button"
                            {{ Helpers::isRevised($document->stage) }}>+</button>
                    </label>
                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                            require completion</small></div>
                    <div id="RevalidCrite_FoCompAaNirogenkpdiv">
                        @if ($document->document_content && !empty($document->document_content->RevalidCrite_FoCompAaNirogenkp))
                            @foreach (unserialize($document->document_content->RevalidCrite_FoCompAaNirogenkp) as $key => $data)
                                <div
                                    class="{{ str_contains($key, 'sub') ? 'subSingleRevalidCrite_FoCompAaNirogenkpBlock' : 'singleRevalidCrite_FoCompAaNirogenkpBlock' }}">
                                    @if (str_contains($key, 'sub'))
                                        <div class="resrow row">
                                            <div class="col-6">
                                                <textarea name="RevalidCrite_FoCompAaNirogenkp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                            </div>
                                            <div class="col-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    @else
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="RevalidCrite_FoCompAaNirogenkp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-dark subRevalidCrite_FoCompAaNirogenkpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                            </div>
                                        </div>
                                    @endif
                                </div>
                            @endforeach
                        @else
                            <div class="singleRevalidCrite_FoCompAaNirogenkpBlock">
                                <div class="row">
                                    <div class="col-sm-10">
                                        <textarea name="RevalidCrite_FoCompAaNirogenkp[]" class="myclassname"></textarea>
                                    </div>
                                    <div class="col-sm-1">
                                        <button class="btn btn-dark subRevalidCrite_FoCompAaNirogenkpAdd">+</button>
                                    </div>
                                    <div class="col-sm-1">
                                        <button
                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                    </div>
                                </div>
                            </div>
                        @endif
                    </div>

                    @foreach ($history as $tempHistory)
                        @if ($tempHistory->activity_type == 'RevalidCrite_FoCompAaNirogenkp' && !empty($tempHistory->comment))
                            @php
                                $users_name = DB::table('users')
                                    ->where('id', $tempHistory->user_id)
                                    ->value('name');
                            @endphp
                            <p style="color: blue">Modify by {{ $users_name }} at
                                {{ $tempHistory->created_at }}
                            </p>
                            <input class="input-field"
                                style="background: #ffff0061;
                    color: black;"
                                type="text" value="{{ $tempHistory->comment }}" disabled>
                        @endif
                    @endforeach
                </div>
            </div>

            <div class="col-md-12">
                <div class="group-input">
                    <label for="Precautions_FoCompAaNirogenkp" id="Precautions_FoCompAaNirogenkp">
                        Precautions  <button type="button" id="Precautions_FoCompAaNirogenkpbtnadd" name="button"
                            {{ Helpers::isRevised($document->stage) }}>+</button>
                    </label>
                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                            require completion</small></div>
                    <div id="Precautions_FoCompAaNirogenkpdiv">
                        @if ($document->document_content && !empty($document->document_content->Precautions_FoCompAaNirogenkp))
                            @foreach (unserialize($document->document_content->Precautions_FoCompAaNirogenkp) as $key => $data)
                                <div
                                    class="{{ str_contains($key, 'sub') ? 'subSinglePrecautions_FoCompAaNirogenkpBlock' : 'singlePrecautions_FoCompAaNirogenkpBlock' }}">
                                    @if (str_contains($key, 'sub'))
                                        <div class="resrow row">
                                            <div class="col-6">
                                                <textarea name="Precautions_FoCompAaNirogenkp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                            </div>
                                            <div class="col-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    @else
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="Precautions_FoCompAaNirogenkp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-dark subPrecautions_FoCompAaNirogenkpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                            </div>
                                        </div>
                                    @endif
                                </div>
                            @endforeach
                        @else
                            <div class="singlePrecautions_FoCompAaNirogenkpBlock">
                                <div class="row">
                                    <div class="col-sm-10">
                                        <textarea name="Precautions_FoCompAaNirogenkp[]" class="myclassname"></textarea>
                                    </div>
                                    <div class="col-sm-1">
                                        <button class="btn btn-dark subPrecautions_FoCompAaNirogenkpAdd">+</button>
                                    </div>
                                    <div class="col-sm-1">
                                        <button
                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                    </div>
                                </div>
                            </div>
                        @endif
                    </div>

                    @foreach ($history as $tempHistory)
                        @if ($tempHistory->activity_type == 'Precautions_FoCompAaNirogenkp' && !empty($tempHistory->comment))
                            @php
                                $users_name = DB::table('users')
                                    ->where('id', $tempHistory->user_id)
                                    ->value('name');
                            @endphp
                            <p style="color: blue">Modify by {{ $users_name }} at
                                {{ $tempHistory->created_at }}
                            </p>
                            <input class="input-field"
                                style="background: #ffff0061;
                    color: black;"
                                type="text" value="{{ $tempHistory->comment }}" disabled>
                        @endif
                    @endforeach
                </div>
            </div>

            <div class="col-md-12">
                <div class="group-input">
                    <label for="RevalidProcess_FoCompAaNirogenkp" id="RevalidProcess_FoCompAaNirogenkp">
                        Revalidation process  <button type="button" id="RevalidProcess_FoCompAaNirogenkpbtnadd" name="button"
                            {{ Helpers::isRevised($document->stage) }}>+</button>
                    </label>
                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                            require completion</small></div>
                    <div id="RevalidProcess_FoCompAaNirogenkpdiv">
                        @if ($document->document_content && !empty($document->document_content->RevalidProcess_FoCompAaNirogenkp))
                            @foreach (unserialize($document->document_content->RevalidProcess_FoCompAaNirogenkp) as $key => $data)
                                <div
                                    class="{{ str_contains($key, 'sub') ? 'subSingleRevalidProcess_FoCompAaNirogenkpBlock' : 'singleRevalidProcess_FoCompAaNirogenkpBlock' }}">
                                    @if (str_contains($key, 'sub'))
                                        <div class="resrow row">
                                            <div class="col-6">
                                                <textarea name="RevalidProcess_FoCompAaNirogenkp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                            </div>
                                            <div class="col-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    @else
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="RevalidProcess_FoCompAaNirogenkp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-dark subRevalidProcess_FoCompAaNirogenkpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                            </div>
                                        </div>
                                    @endif
                                </div>
                            @endforeach
                        @else
                            <div class="singleRevalidProcess_FoCompAaNirogenkpBlock">
                                <div class="row">
                                    <div class="col-sm-10">
                                        <textarea name="RevalidProcess_FoCompAaNirogenkp[]" class="myclassname"></textarea>
                                    </div>
                                    <div class="col-sm-1">
                                        <button class="btn btn-dark subRevalidProcess_FoCompAaNirogenkpAdd">+</button>
                                    </div>
                                    <div class="col-sm-1">
                                        <button
                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                    </div>
                                </div>
                            </div>
                        @endif
                    </div>

                    @foreach ($history as $tempHistory)
                        @if ($tempHistory->activity_type == 'RevalidProcess_FoCompAaNirogenkp' && !empty($tempHistory->comment))
                            @php
                                $users_name = DB::table('users')
                                    ->where('id', $tempHistory->user_id)
                                    ->value('name');
                            @endphp
                            <p style="color: blue">Modify by {{ $users_name }} at
                                {{ $tempHistory->created_at }}
                            </p>
                            <input class="input-field"
                                style="background: #ffff0061;
                    color: black;"
                                type="text" value="{{ $tempHistory->comment }}" disabled>
                        @endif
                    @endforeach
                </div>
            </div>



            <div class="col-md-12">
                <div class="group-input">
                    <label for="AcceptanceCrite_FoCompAaNirogenkp" id="AcceptanceCrite_FoCompAaNirogenkp">
                        Acceptance criteria <button type="button" id="AcceptanceCrite_FoCompAaNirogenkpbtnadd" name="button"
                            {{ Helpers::isRevised($document->stage) }}>+</button>
                    </label>
                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                            require completion</small></div>
                    <div id="AcceptanceCrite_FoCompAaNirogenkpdiv">
                        @if ($document->document_content && !empty($document->document_content->AcceptanceCrite_FoCompAaNirogenkp))
                            @foreach (unserialize($document->document_content->AcceptanceCrite_FoCompAaNirogenkp) as $key => $data)
                                <div
                                    class="{{ str_contains($key, 'sub') ? 'subSingleAcceptanceCrite_FoCompAaNirogenkpBlock' : 'singleAcceptanceCrite_FoCompAaNirogenkpBlock' }}">
                                    @if (str_contains($key, 'sub'))
                                        <div class="resrow row">
                                            <div class="col-6">
                                                <textarea name="AcceptanceCrite_FoCompAaNirogenkp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                            </div>
                                            <div class="col-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    @else
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="AcceptanceCrite_FoCompAaNirogenkp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-dark subAcceptanceCrite_FoCompAaNirogenkpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                            </div>
                                        </div>
                                    @endif
                                </div>
                            @endforeach
                        @else
                            <div class="singleAcceptanceCrite_FoCompAaNirogenkpBlock">
                                <div class="row">
                                    <div class="col-sm-10">
                                        <textarea name="AcceptanceCrite_FoCompAaNirogenkp[]" class="myclassname"></textarea>
                                    </div>
                                    <div class="col-sm-1">
                                        <button class="btn btn-dark subAcceptanceCrite_FoCompAaNirogenkpAdd">+</button>
                                    </div>
                                    <div class="col-sm-1">
                                        <button
                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                    </div>
                                </div>
                            </div>
                        @endif
                    </div>

                    @foreach ($history as $tempHistory)
                        @if ($tempHistory->activity_type == 'AcceptanceCrite_FoCompAaNirogenkp' && !empty($tempHistory->comment))
                            @php
                                $users_name = DB::table('users')
                                    ->where('id', $tempHistory->user_id)
                                    ->value('name');
                            @endphp
                            <p style="color: blue">Modify by {{ $users_name }} at
                                {{ $tempHistory->created_at }}
                            </p>
                            <input class="input-field"
                                style="background: #ffff0061;
                    color: black;"
                                type="text" value="{{ $tempHistory->comment }}" disabled>
                        @endif
                    @endforeach
                </div>
            </div>

            <div class="col-md-12">
                <div class="group-input">
                    <label for="Annexure_FoCompAaNirogenkp" id="Annexure_FoCompAaNirogenkp">
                        Annexure  <button type="button" id="Annexure_FoCompAaNirogenkpbtnadd" name="button"
                            {{ Helpers::isRevised($document->stage) }}>+</button>
                    </label>
                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                            require completion</small></div>
                    <div id="Annexure_FoCompAaNirogenkpdiv">
                        @if ($document->document_content && !empty($document->document_content->Annexure_FoCompAaNirogenkp))
                            @foreach (unserialize($document->document_content->Annexure_FoCompAaNirogenkp) as $key => $data)
                                <div
                                    class="{{ str_contains($key, 'sub') ? 'subSingleAnnexure_FoCompAaNirogenkpBlock' : 'singleAnnexure_FoCompAaNirogenkpBlock' }}">
                                    @if (str_contains($key, 'sub'))
                                        <div class="resrow row">
                                            <div class="col-6">
                                                <textarea name="Annexure_FoCompAaNirogenkp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                            </div>
                                            <div class="col-1">
                                                <button
                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                            </div>
                                        </div>
                                    @else
                                        <div class="row">
                                            <div class="col-sm-10">
                                                <textarea name="Annexure_FoCompAaNirogenkp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-dark subAnnexure_FoCompAaNirogenkpAdd">+</button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button
                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                            </div>
                                        </div>
                                    @endif
                                </div>
                            @endforeach
                        @else
                            <div class="singleAnnexure_FoCompAaNirogenkpBlock">
                                <div class="row">
                                    <div class="col-sm-10">
                                        <textarea name="Annexure_FoCompAaNirogenkp[]" class="myclassname"></textarea>
                                    </div>
                                    <div class="col-sm-1">
                                        <button class="btn btn-dark subAnnexure_FoCompAaNirogenkpAdd">+</button>
                                    </div>
                                    <div class="col-sm-1">
                                        <button
                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                    </div>
                                </div>
                            </div>
                        @endif
                    </div>

                    @foreach ($history as $tempHistory)
                        @if ($tempHistory->activity_type == 'Annexure_FoCompAaNirogenkp' && !empty($tempHistory->comment))
                            @php
                                $users_name = DB::table('users')
                                    ->where('id', $tempHistory->user_id)
                                    ->value('name');
                            @endphp
                            <p style="color: blue">Modify by {{ $users_name }} at
                                {{ $tempHistory->created_at }}
                            </p>
                            <input class="input-field"
                                style="background: #ffff0061;
                    color: black;"
                                type="text" value="{{ $tempHistory->comment }}" disabled>
                        @endif
                    @endforeach
                </div>
            </div> --}}


                <div class="col-12">
                    <div class="group-input">
                        <label for="File_Attachment"><b>Format For Compressed Air And Nitrogen Gas System Protocol</b></label>
                        <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                        <div class="file-attachment-field">
                            <div class="file-attachment-list" id="formateCompresedAirAndNirogenProtocol">
                                @if ($document->ForComANiGasProtocolfile_attach)
                                    @foreach(json_decode($document->ForComANiGasProtocolfile_attach) as $file)
                                        <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                            <b>{{ $file }}</b>
                                            <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                            </a>
                                            <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                            </a>
                                            <input type="hidden" name="existing_ForComANiGasProtocolfile_attach[]" value="{{ $file }}">
                                        </h6>
                                    @endforeach
                                @endif
                            </div>

                            <div class="add-btn">
                                <label for="annex_V_user_attachmentDataformateCompresedAirAndNirogenPr" style="cursor: pointer;">Add</label>
                                <input type="file" id="annex_V_user_attachmentDataformateCompresedAirAndNirogenPr" name="ForComANiGasProtocolfile_attach[]"
                                    oninput="addMultipleFiles(this, 'formateCompresedAirAndNirogenProtocol')" multiple hidden>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hidden field to store deleted files -->
                <input type="hidden" id="deleted_ForComANiGasProtocolfile_attach" name="deleted_ForComANiGasProtocolfile_attach" value="">

                <script>
                    document.addEventListener('DOMContentLoaded', function () {
                        document.querySelectorAll('.remove-file').forEach(button => {
                            button.addEventListener('click', function () {
                                const fileName = this.getAttribute('data-file-name');
                                const fileContainer = this.closest('.file-container');

                                if (fileContainer) {
                                    fileContainer.style.display = 'none';

                                    const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                    if (hiddenInput) {
                                        hiddenInput.remove();
                                    }

                                    const deletedFilesInput = document.getElementById('deleted_ForComANiGasProtocolfile_attach');
                                    let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                    deletedFiles.push(fileName);
                                    deletedFilesInput.value = deletedFiles.join(',');
                                }
                            });
                        });
                    });

                    function addMultipleFiles(input, listId) {
                        let fileList = document.getElementById(listId);
                        for (let file of input.files) {
                            let fileContainer = document.createElement('h6');
                            fileContainer.classList.add('file-container', 'text-dark');
                            fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                            let fileText = document.createElement('b');
                            fileText.textContent = file.name;

                            let removeLink = document.createElement('a');
                            removeLink.classList.add('remove-file');
                            removeLink.dataset.fileName = file.name;
                            removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                            removeLink.addEventListener('click', function () {
                                fileContainer.style.display = 'none';
                            });

                            fileContainer.appendChild(fileText);
                            fileContainer.appendChild(removeLink);
                            fileList.appendChild(fileContainer);
                        }
                    }
                </script>


            </div>
        </div>
        <div class="button-block">
            <button type="submit" value="save" name="submit" id="DocsaveButton"
                class="saveButton">Save</button>
            <button type="button" class="backButton" onclick="previousStep()">Back</button>
            <button type="button" class="nextButton" onclick="nextStep()">Next</button>
            <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                </a>
            </button>
        </div>
    </div>

            {{-- bill of material tabs --}}

                        <div id="doc-billofmaterial" class="tabcontent">
                            <div class="orig-head">
                                Bill of Materia                    </div>
                            <div class="input-fields">
                                <div class="row">

                                    <div class="col-12">
                                        <div class="group-input">
                                            <label for="File_Attachment"><b>Bill of Materia File Attachment</b></label>
                                            <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                            <div class="file-attachment-field">
                                                <div class="file-attachment-list" id="billMatrialDatassp">
                                                    @if ($document->billMatrial)
                                                        @foreach(json_decode($document->billMatrial) as $file)
                                                            <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                                <b>{{ $file }}</b>
                                                                <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                                    <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                                </a>
                                                                <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                                    <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                                </a>
                                                                <input type="hidden" name="existing_billMatrial[]" value="{{ $file }}">
                                                            </h6>
                                                        @endforeach
                                                    @endif
                                                </div>

                                                <div class="add-btn">
                                                    <label for="bill_matrial_id" style="cursor: pointer;">Add</label>
                                                    <input type="file" id="bill_matrial_id" name="billMatrial[]"
                                                        oninput="addMultipleFiles(this, 'billMatrialDatassp')" multiple hidden>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Hidden field to store deleted files -->
                                    <input type="hidden" id="deleted_billMatrial" name="deleted_billMatrial" value="">

                                    <script>
                                        document.addEventListener('DOMContentLoaded', function () {
                                            document.querySelectorAll('.remove-file').forEach(button => {
                                                button.addEventListener('click', function () {
                                                    const fileName = this.getAttribute('data-file-name');
                                                    const fileContainer = this.closest('.file-container');

                                                    if (fileContainer) {
                                                        fileContainer.style.display = 'none';

                                                        const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                        if (hiddenInput) {
                                                            hiddenInput.remove();
                                                        }

                                                        const deletedFilesInput = document.getElementById('deleted_billMatrial');
                                                        let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                        deletedFiles.push(fileName);
                                                        deletedFilesInput.value = deletedFiles.join(',');
                                                    }
                                                });
                                            });
                                        });

                                        function addMultipleFiles(input, listId) {
                                            let fileList = document.getElementById(listId);
                                            for (let file of input.files) {
                                                let fileContainer = document.createElement('h6');
                                                fileContainer.classList.add('file-container', 'text-dark');
                                                fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                                let fileText = document.createElement('b');
                                                fileText.textContent = file.name;

                                                let removeLink = document.createElement('a');
                                                removeLink.classList.add('remove-file');
                                                removeLink.dataset.fileName = file.name;
                                                removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                                removeLink.addEventListener('click', function () {
                                                    fileContainer.style.display = 'none';
                                                });

                                                fileContainer.appendChild(fileText);
                                                fileContainer.appendChild(removeLink);
                                                fileList.appendChild(fileContainer);
                                            }
                                        }
                                    </script>




                                </div>
                            </div>
                            <div class="button-block">
                                <button type="submit" value="save" name="submit" id="DocsaveButton"
                                    class="saveButton">Save</button>
                                <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                    </a>
                                </button>
                            </div>
                        </div>



                        {{-- batch manifacturing  of material tabs --}}

                        <div id="doc-manufacturingRecord" class="tabcontent">
                            <div class="orig-head">
                                Batch Manufacturing Record (BMR)                    </div>
                            <div class="input-fields">
                                <div class="row">

                                    <div class="col-12">
                                        <div class="group-input">
                                            <label for="File_Attachment"><b>Batch Manufacturing Record (BMR)  File Attachment</b></label>
                                            <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                            <div class="file-attachment-field">
                                                <div class="file-attachment-list" id="batchManufacturingBmrDatassp">
                                                    @if ($document->batchManufacturingBmr)
                                                        @foreach(json_decode($document->batchManufacturingBmr) as $file)
                                                            <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                                <b>{{ $file }}</b>
                                                                <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                                    <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                                </a>
                                                                <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                                    <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                                </a>
                                                                <input type="hidden" name="existing_batchManufacturingBmr[]" value="{{ $file }}">
                                                            </h6>
                                                        @endforeach
                                                    @endif
                                                </div>

                                                <div class="add-btn">
                                                    <label for="batchManufacturingBmr_id" style="cursor: pointer;">Add</label>
                                                    <input type="file" id="batchManufacturingBmr_id" name="batchManufacturingBmr[]"
                                                        oninput="addMultipleFiles(this, 'batchManufacturingBmrDatassp')" multiple hidden>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Hidden field to store deleted files -->
                                    <input type="hidden" id="deleted_batchManufacturingBmr" name="deleted_batchManufacturingBmr" value="">

                                    <script>
                                        document.addEventListener('DOMContentLoaded', function () {
                                            document.querySelectorAll('.remove-file').forEach(button => {
                                                button.addEventListener('click', function () {
                                                    const fileName = this.getAttribute('data-file-name');
                                                    const fileContainer = this.closest('.file-container');

                                                    if (fileContainer) {
                                                        fileContainer.style.display = 'none';

                                                        const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                        if (hiddenInput) {
                                                            hiddenInput.remove();
                                                        }

                                                        const deletedFilesInput = document.getElementById('deleted_batchManufacturingBmr');
                                                        let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                        deletedFiles.push(fileName);
                                                        deletedFilesInput.value = deletedFiles.join(',');
                                                    }
                                                });
                                            });
                                        });

                                        function addMultipleFiles(input, listId) {
                                            let fileList = document.getElementById(listId);
                                            for (let file of input.files) {
                                                let fileContainer = document.createElement('h6');
                                                fileContainer.classList.add('file-container', 'text-dark');
                                                fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                                let fileText = document.createElement('b');
                                                fileText.textContent = file.name;

                                                let removeLink = document.createElement('a');
                                                removeLink.classList.add('remove-file');
                                                removeLink.dataset.fileName = file.name;
                                                removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                                removeLink.addEventListener('click', function () {
                                                    fileContainer.style.display = 'none';
                                                });

                                                fileContainer.appendChild(fileText);
                                                fileContainer.appendChild(removeLink);
                                                fileList.appendChild(fileContainer);
                                            }
                                        }
                                    </script>




                                </div>
                            </div>
                            <div class="button-block">
                                <button type="submit" value="save" name="submit" id="DocsaveButton"
                                    class="saveButton">Save</button>
                                <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                    </a>
                                </button>
                            </div>
                        </div>


                           {{-- Master Formula ecord R  of material tabs --}}

                           <div id="doc-masterformulaRecord" class="tabcontent">
                            <div class="orig-head">
                                Master Formula  Record                     </div>
                            <div class="input-fields">
                                <div class="row">

                                    <div class="col-12">
                                        <div class="group-input">
                                            <label for="File_Attachment"><b>Master Formula  Record   File Attachment</b></label>
                                            <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                            <div class="file-attachment-field">
                                                <div class="file-attachment-list" id="MasterFormulaRecordBMRDatassp">
                                                    @if ($document->MasterFormulaRecordBMR)
                                                        @foreach(json_decode($document->MasterFormulaRecordBMR) as $file)
                                                            <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                                <b>{{ $file }}</b>
                                                                <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                                    <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                                </a>
                                                                <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                                    <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                                </a>
                                                                <input type="hidden" name="existing_MasterFormulaRecordBMR[]" value="{{ $file }}">
                                                            </h6>
                                                        @endforeach
                                                    @endif
                                                </div>

                                                <div class="add-btn">
                                                    <label for="MasterFormulaRecordBMR_id" style="cursor: pointer;">Add</label>
                                                    <input type="file" id="MasterFormulaRecordBMR_id" name="MasterFormulaRecordBMR[]"
                                                        oninput="addMultipleFiles(this, 'MasterFormulaRecordBMRDatassp')" multiple hidden>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Hidden field to store deleted files -->
                                    <input type="hidden" id="deleted_MasterFormulaRecordBMR" name="deleted_MasterFormulaRecordBMR" value="">

                                    <script>
                                        document.addEventListener('DOMContentLoaded', function () {
                                            document.querySelectorAll('.remove-file').forEach(button => {
                                                button.addEventListener('click', function () {
                                                    const fileName = this.getAttribute('data-file-name');
                                                    const fileContainer = this.closest('.file-container');

                                                    if (fileContainer) {
                                                        fileContainer.style.display = 'none';

                                                        const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                        if (hiddenInput) {
                                                            hiddenInput.remove();
                                                        }

                                                        const deletedFilesInput = document.getElementById('deleted_MasterFormulaRecordBMR');
                                                        let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                        deletedFiles.push(fileName);
                                                        deletedFilesInput.value = deletedFiles.join(',');
                                                    }
                                                });
                                            });
                                        });

                                        function addMultipleFiles(input, listId) {
                                            let fileList = document.getElementById(listId);
                                            for (let file of input.files) {
                                                let fileContainer = document.createElement('h6');
                                                fileContainer.classList.add('file-container', 'text-dark');
                                                fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                                let fileText = document.createElement('b');
                                                fileText.textContent = file.name;

                                                let removeLink = document.createElement('a');
                                                removeLink.classList.add('remove-file');
                                                removeLink.dataset.fileName = file.name;
                                                removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                                removeLink.addEventListener('click', function () {
                                                    fileContainer.style.display = 'none';
                                                });

                                                fileContainer.appendChild(fileText);
                                                fileContainer.appendChild(removeLink);
                                                fileList.appendChild(fileContainer);
                                            }
                                        }
                                    </script>




                                </div>
                            </div>
                            <div class="button-block">
                                <button type="submit" value="save" name="submit" id="DocsaveButton"
                                    class="saveButton">Save</button>
                                <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                    </a>
                                </button>
                            </div>
                        </div>


                         {{-- Master Packing ecord R  of material tabs --}}

                         <div id="doc-masterPackingRecord" class="tabcontent">
                            <div class="orig-head">
                                Master Packing  Record                     </div>
                            <div class="input-fields">
                                <div class="row">

                                    <div class="col-12">
                                        <div class="group-input">
                                            <label for="File_Attachment"><b>Master Packing  Record   File Attachment</b></label>
                                            <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                            <div class="file-attachment-field">
                                                <div class="file-attachment-list" id="MasterPackingRecordDatassp">
                                                    @if ($document->MasterPackingRecord)
                                                        @foreach(json_decode($document->MasterPackingRecord) as $file)
                                                            <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                                <b>{{ $file }}</b>
                                                                <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                                    <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                                </a>
                                                                <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                                    <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                                </a>
                                                                <input type="hidden" name="existing_MasterPackingRecord[]" value="{{ $file }}">
                                                            </h6>
                                                        @endforeach
                                                    @endif
                                                </div>

                                                <div class="add-btn">
                                                    <label for="MasterPackingRecord_id" style="cursor: pointer;">Add</label>
                                                    <input type="file" id="MasterPackingRecord_id" name="MasterPackingRecord[]"
                                                        oninput="addMultipleFiles(this, 'MasterPackingRecordDatassp')" multiple hidden>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Hidden field to store deleted files -->
                                    <input type="hidden" id="deleted_MasterPackingRecord" name="deleted_MasterPackingRecord" value="">

                                    <script>
                                        document.addEventListener('DOMContentLoaded', function () {
                                            document.querySelectorAll('.remove-file').forEach(button => {
                                                button.addEventListener('click', function () {
                                                    const fileName = this.getAttribute('data-file-name');
                                                    const fileContainer = this.closest('.file-container');

                                                    if (fileContainer) {
                                                        fileContainer.style.display = 'none';

                                                        const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                        if (hiddenInput) {
                                                            hiddenInput.remove();
                                                        }

                                                        const deletedFilesInput = document.getElementById('deleted_MasterPackingRecord');
                                                        let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                        deletedFiles.push(fileName);
                                                        deletedFilesInput.value = deletedFiles.join(',');
                                                    }
                                                });
                                            });
                                        });

                                        function addMultipleFiles(input, listId) {
                                            let fileList = document.getElementById(listId);
                                            for (let file of input.files) {
                                                let fileContainer = document.createElement('h6');
                                                fileContainer.classList.add('file-container', 'text-dark');
                                                fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                                let fileText = document.createElement('b');
                                                fileText.textContent = file.name;

                                                let removeLink = document.createElement('a');
                                                removeLink.classList.add('remove-file');
                                                removeLink.dataset.fileName = file.name;
                                                removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                                removeLink.addEventListener('click', function () {
                                                    fileContainer.style.display = 'none';
                                                });

                                                fileContainer.appendChild(fileText);
                                                fileContainer.appendChild(removeLink);
                                                fileList.appendChild(fileContainer);
                                            }
                                        }
                                    </script>




                                </div>
                            </div>
                            <div class="button-block">
                                <button type="submit" value="save" name="submit" id="DocsaveButton"
                                    class="saveButton">Save</button>
                                <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                    </a>
                                </button>
                            </div>
                        </div>


                                         {{-- Site master  tabs   of material tabs --}}

                 <div id="doc-SiteMasterFile" class="tabcontent">
                    <div class="orig-head">
                        Site Master File                    </div>
                    <div class="input-fields">
                        <div class="row">


                            <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>Site Master File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="SiteMasterFileattDatassp">
                                            @if ($document->SiteMasterFileatt)
                                                @foreach(json_decode($document->SiteMasterFileatt) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_SiteMasterFileatt[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="SiteMasterFileatt_id" style="cursor: pointer;">Add</label>
                                            <input type="file" id="SiteMasterFileatt_id" name="SiteMasterFileatt[]"
                                                oninput="addMultipleFiles(this, 'SiteMasterFileattDatassp')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_SiteMasterFileatt" name="deleted_SiteMasterFileatt" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_SiteMasterFileatt');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>
                        </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>



                    <!-- Format for compressed air and Nitrogen gas system Report -->

                    <div id="doc-fcreport" class="tabcontent">
                        <div class="orig-head">
                            Format for compressed air and Nitrogen gas system Report
                        </div>
                        {{--
                        <div class="input-fields">
                            <div class="row">

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="eqp_approval">Protocol approval</label>
                                        <textarea name="format_approval" {{ Helpers::isRevised($document->stage) }}>{{ $document->document_content ? $document->document_content->format_approval : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Protocol Approval' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Protocol_Approval_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="format_objective">Objective</label>
                                        <textarea name="format_objective" {{ Helpers::isRevised($document->stage) }}>{{ $document->document_content ? $document->document_content->format_objective : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Objective' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="format_objective_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="format_scope">Scope</label>

                                        <textarea name="format_scope" {{ Helpers::isRevised($document->stage) }}>{{ $document->document_content ? $document->document_content->format_scope : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Scope' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8) <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="format_scope_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="formatidentification" id="formatidentification">
                                            Equipment / System Identification<button type="button" id="formatidentificationbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="formatidentificationdiv">
                                            @if ($document->document_content && !empty($document->document_content->formatidentification))
                                                @foreach (unserialize($document->document_content->formatidentification) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsingleformatidentificationBlock' : 'singleformatidentificationBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="formatidentification[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="formatidentification[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subformatidentificationAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleformatidentificationBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="formatidentification[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subformatidentificationAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Equipment / System Identification' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Identification_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif



                                <div class="col-md-12">
                                    <div class="group-input">

                                        <label for="executiontteam" id="executiontteam">
                                            Execution Team<button type="button" id="executiontteambtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="executiontteamdiv">
                                            @if ($document->document_content && !empty($document->document_content->executiontteam))
                                                @foreach (unserialize($document->document_content->executiontteam) as $key => $data)
                                                    @if (!empty($data))
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subsingleexecutiontteamBlock' : 'singleexecutiontteamBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="executiontteam[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="executiontteam[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subexecutiontteamAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endif
                                                @endforeach
                                            @else
                                                <div class="singleexecutiontteamBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="executiontteam[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subexecutiontteamAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif

                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Execution Team' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;color: black;"

                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach




                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Execution_Team_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="formatdocuments" id="formatdocuments">
                                            Documents To Be Followed<button type="button" id="formatdocumentsbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="formatdocumentsdiv">
                                            @if ($document->document_content && !empty($document->document_content->formatdocuments))
                                                @foreach (unserialize($document->document_content->formatdocuments) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsingleformatdocumentsBlock' : 'singleformatdocumentsBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="formatdocuments[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="formatdocuments[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subformatdocumentsAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Documents To Be Followed' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Documents_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="revalidationtype" id="revalidationtype">
                                            Type of revalidation<button type="button" id="revalidationtypebtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="revalidationtypediv">
                                            @if ($document->document_content && !empty($document->document_content->revalidationtype))
                                                @foreach (unserialize($document->document_content->revalidationtype) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsinglerevalidationtypeBlock' : 'singlerevalidationtypeBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="revalidationtype[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="revalidationtype[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subrevalidationtypeAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Type of revalidation' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Type_revalidation_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="RevalidationCriteria" id="RevalidationCriteria">
                                            Revalidation criteria<button type="button" id="RevalidationCriteriabtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        @if ($document->document_content && !empty($document->document_content->RevalidationCriteria))
                                            <div id="RevalidationCriteriadiv">
                                                @foreach (unserialize($document->document_content->RevalidationCriteria) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsingleRevalidationCriteriaBlock' : 'singleRevalidationCriteriaBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="RevalidationCriteria[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="RevalidationCriteria[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>

                                                                <div class="col-sm-1">
                                                                    <button type="button" class="subRevalidationCriteriaAdd"
                                                                        name="button"
                                                                        {{ Helpers::isRevised($document->stage) }}>+</button>
                                                                </div>

                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            </div>
                                        @else
                                            <div class="singleRevalidationCriteriaBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="RevalidationCriteria[]" class="myclassname"></textarea>
                                                    </div>

                                                    <div class="col-sm-1">
                                                        <button type="button" class="subRevalidationCriteriaAdd" name="button"
                                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                                    </div>

                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif

                                    <div id="RevalidationCriteriadiv"></div>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Revalidation criteria' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text"
                                                name="Revalidation_criteria_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="generalconsideration" id="generalconsideration">
                                            General consideration/Prerequisites<button type="button" id="generalconsiderationbtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="generalconsiderationdiv">
                                            @if ($document->document_content && !empty($document->document_content->generalconsideration))
                                                @foreach (unserialize($document->document_content->generalconsideration) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsinglegeneralconsiderationBlock' : 'singlegeneralconsiderationBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="generalconsideration[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="generalconsideration[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subgeneralconsiderationAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singlegeneralconsiderationBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="generalconsideration[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subgeneralconsiderationAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'General consideration/Prerequisites' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="General_consideration_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="precautions" id="precautions">
                                            Precautions<button type="button" id="precautionsbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="precautionsdiv">
                                            @if ($document->document_content && !empty($document->document_content->precautions))
                                                @foreach (unserialize($document->document_content->precautions) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsingleprecautionsBlock' : 'singleprecautionsBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="precautions[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="precautions[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subprecautionsAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleprecautionsBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="precautions[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subprecautionsAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Precautions' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Precautions_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="calibrationstatus" id="calibrationstatus">
                                            Test instrument calibration status<button type="button" id="calibrationstatusbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="calibrationstatusdiv">
                                            @if ($document->document_content && !empty($document->document_content->calibrationstatus))
                                                @foreach (unserialize($document->document_content->calibrationstatus) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsinglecalibrationstatusBlock' : 'singlecalibrationstatusBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="calibrationstatus[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="calibrationstatus[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subcalibrationstatusAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singlecalibrationstatusBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="calibrationstatus[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subcalibrationstatusAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Test instrument calibration status' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Test_instrument_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="testobservation" id="testobservation">
                                            Revalidation test observation<button type="button" id="testobservationbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="testobservationdiv">
                                            @if ($document->document_content && !empty($document->document_content->testobservation))
                                                @foreach (unserialize($document->document_content->testobservation) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsingletestobservationBlock' : 'singletestobservationBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="testobservation[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="testobservation[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subtestobservationAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singletestobservationBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="testobservation[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subtestobservationAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Revalidation test observation' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="observation_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="formatannexure" id="formatannexure">
                                            Annexure<button type="button" id="formatannexurebtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="formatannexurediv">
                                            @if ($document->document_content && !empty($document->document_content->formatannexure))
                                                @foreach (unserialize($document->document_content->formatannexure) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsingleformatannexureBlock' : 'singleformatannexureBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="formatannexure[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="formatannexure[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subformatannexureAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleformatannexureBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="formatannexure[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subformatannexureAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Annexure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Annexure_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="formatdeviation" id="formatdeviation">
                                            Deviation<button type="button" id="formatdeviationbtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="formatdeviationdiv">
                                            @if ($document->document_content && !empty($document->document_content->formatdeviation))
                                                @foreach (unserialize($document->document_content->formatdeviation) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsingleformatdeviationBlock' : 'singleformatdeviationBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="formatdeviation[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="formatdeviation[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subformatdeviationAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleformatdeviationBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="formatdeviation[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subformatdeviationAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Deviation' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Deviation_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="formatcc" id="formatcc">
                                            Change control<button type="button" id="formatccbtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="formatccdiv">
                                            @if ($document->document_content && !empty($document->document_content->formatcc))
                                                @foreach (unserialize($document->document_content->formatcc) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsingleformatccBlock' : 'singleformatccBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="formatcc[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="formatcc[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subformatccAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleformatccBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="formatcc[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subformatccAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Change control' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Change_control_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="formatsummary" id="formatsummary">
                                            Summary<button type="button" id="formatsummarybtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="formatsummarydiv">
                                            @if ($document->document_content && !empty($document->document_content->formatsummary))
                                                @foreach (unserialize($document->document_content->formatsummary) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsingleformatsummaryBlock' : 'singleformatsummaryBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="formatsummary[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="formatsummary[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subformatsummaryAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleformatsummaryBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="formatsummary[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subformatsummaryAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Summary' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Summary_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="formatconclusion" id="formatconclusion">
                                            Conclusion<button type="button" id="formatconclusionbtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="formatconclusiondiv">
                                            @if ($document->document_content && !empty($document->document_content->formatconclusion))
                                                @foreach (unserialize($document->document_content->formatconclusion) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsingleformatconclusionBlock' : 'singleformatconclusionBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="formatconclusion[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="formatconclusion[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subformatconclusionAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleformatconclusionBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="formatconclusion[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subformatconclusionAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Conclusion' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Conclusion_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                            </div>
                        </div>
                        --}}

                        <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="attach_comp_nitrogenDatafield">
                                            @if ($document->attach_comp_nitrogen)
                                                @foreach(json_decode($document->attach_comp_nitrogen) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_attach_comp_nitrogen[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="attach_comp_nitrogenData" style="cursor: pointer;">Add</label>
                                            <input type="file" id="attach_comp_nitrogenData" name="attach_comp_nitrogen[]"
                                                oninput="addMultipleFiles(this, 'attach_comp_nitrogenDatafield')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_attach_comp_nitrogen" name="deleted_attach_comp_nitrogen" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_attach_comp_nitrogen');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>
                        <div class="button-block">
                                    <button type="submit" name="submit" value="save" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                </div>
                    </div>


                    <!--Process Validation Protocol Interim  -->
                <div id="doc_proc_interim" class="tabcontent">
                    <div class="orig-head">
                        PROCESS VALIDATION INTERIM REPORT
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                <div class="">
                                  PRODUCT DETAILS
                                </div>  <br>

                                {{-- <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="purpose">Dosage Form</label>
                                        <input type="text" name="pvir_dosage_form" value="{{ $document->document_content->pvir_dosage_form }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Process Validation Interim Report</label>
                                        <input type="text" name="pvir_process_validation_interim_report" value="{{ $document->document_content->pvir_process_validation_interim_report }}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Product Name</label>
                                        <input type="text" name="pvir_product_name" value="{{ $document->document_content->pvir_product_name }}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Report No</label>
                                        <input type="number" name="pvir_report_no" value="{{ $document->document_content->pvir_report_no }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Batch No</label>
                                        <input type="number" name="pvir_batch_no" value="{{ $document->document_content->pvir_batch_no }}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="purpose">Generic Name </label>
                                        <input type="text" name="generic_pvir" value="{{ $document->document_content->generic_pvir }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Product Code</label>
                                        <input type="number" name="pvir_product_code" value="{{ $document->document_content->pvir_product_code }}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Std. Batch size </label>
                                        <input type="number" name="pvir_std_batch" value="{{ $document->document_content->pvir_std_batch }}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Category</label>
                                        <input type="text" name="pvir_category" value="{{ $document->document_content->pvir_category }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Label Claim</label>
                                        <input type="text" name="pvir_label_claim" value="{{ $document->document_content->pvir_label_claim }}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Market</label>
                                        <input type="text" name="pvir_market" value="{{ $document->document_content->pvir_market }}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Shelf Life</label>
                                        <input type="text" name="pvir_shelf_life" value="{{ $document->document_content->pvir_shelf_life }}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">BMR No.</label>
                                        <input type="number" name="pvir_bmr_no" value="{{ $document->document_content->pvir_bmr_no }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">MFR No.</label>
                                        <input type="number" name="pvir_mfr_no" value="{{ $document->document_content->generic_pvir }}">
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Critical_Process_Parameters" id="Critical_quality_attributes">
                                            Critical process parameters & Critical quality attributes  <button type="button" id="Critical_quality_pvirbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="critical_quality_pvirpdiv">
                                            @if ($document->document_content && !empty($document->document_content->critical_pvir))
                                                @foreach (unserialize($document->document_content->critical_pvir) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsingleCriticalPvirBlock' : 'singleCriticalPvirBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="critical_pvir[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="critical_pvir[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subcritical_quality_pvirAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleCriticalPvirBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="critical_pvir[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subcritical_quality_pvirAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger removeAllBlocks">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Critical process parameters & Critical quality attributes' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>




                                 <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Results of In process data" id="result_In_process_data">
                                            Results of In process data<button type="button" id="In_process_data_pvirbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="In_process_data_pvirdiv">
                                            @if ($document->document_content && !empty($document->document_content->In_process_data_pvir))
                                                @foreach (unserialize($document->document_content->In_process_data_pvir) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subIn_process_data_pvirAdd' : 'single_In_process_data_PvirBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="In_process_data_pvir[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="In_process_data_pvir[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subIn_process_data_pvirAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="single_In_process_data_PvirBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="In_process_data_pvir[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subIn_process_data_pvirAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Results of In process data' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>




                                 <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Yield at various stages" id="Various_stages">
                                            % Yield at various stages<button type="button" id="various_stages_pvirbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="various_stages_pvirdiv">
                                            @if ($document->document_content && !empty($document->document_content->various_stages_pvir))
                                                @foreach (unserialize($document->document_content->various_stages_pvir) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subvarious_stages_pvirAdd' : 'singlevarious_stages_PvirBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="various_stages_pvir[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="various_stages_pvir[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subvarious_stages_pvirAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singlevarious_stages_PvirBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="various_stages_pvir[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subvarious_stages_pvirAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == '% Yield at various stages' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="deviation" id="deviation_if_any">
                                            Deviation (If any)<button type="button" id="deviation_pvirbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="deviation_pvirdiv">
                                            @if ($document->document_content && !empty($document->document_content->deviation_pvir))
                                                @foreach (unserialize($document->document_content->deviation_pvir) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subdeviation_pvirAdd' : 'singleDeviationBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="deviation_pvir[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="deviation_pvir[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subdeviation_pvirAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singlevarious_stages_PvirBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="deviation_pvir[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subdeviation_pvirAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Deviation (If any)' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                                    color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>


                                 <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Change Control ( If any)" id="change_control_if_any">
                                            Change Control ( If any)<button type="button" id="change_controlpvirbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="change_controlpvirdiv">
                                            @if ($document->document_content && !empty($document->document_content->change_controlpvir))
                                                @foreach (unserialize($document->document_content->change_controlpvir) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subchange_controlpvirAdd' : 'singlechange_controlPvirBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="change_controlpvir[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="change_controlpvir[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subchange_controlpvirAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singlechange_controlPvirBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="change_controlpvir[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subchange_controlpvirAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Change Control ( If any)' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                 <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Summary" id="Summary">
                                            Summary<button type="button" id="Summarypvirbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="Summarypvirdiv">
                                            @if ($document->document_content && !empty($document->document_content->Summary_pvir))
                                                @foreach (unserialize($document->document_content->Summary_pvir) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSummarypvirAdd' : 'singleSummaryPvirBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="Summary_pvir[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="Summary_pvir[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subSummarypvirAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleSummaryPvirBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="Summary_pvir[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subSummarypvirAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Summary' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                 <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Conclusion" id="conclusion">
                                            Conclusion<button type="button" id="conclusionpvirbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="conclusion_pvirdiv">
                                            @if ($document->document_content && !empty($document->document_content->conclusion_pvir))
                                                @foreach (unserialize($document->document_content->conclusion_pvir) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subConclusion_pvirAdd' : 'single_Conclusion_pvirBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="conclusion_pvir[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="conclusion_pvir[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subConclusion_pvirAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="single_Conclusion_pvirBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="conclusion_pvir[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subConclusion_pvirAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Conclusion' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                 <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Report_Approval" id="report_approval">
                                             Report Approval<button type="button" id="report_approvalpvirbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="report_approvalpvirdiv">
                                            @if ($document->document_content && !empty($document->document_content->report_approvalpvir))
                                                @foreach (unserialize($document->document_content->report_approvalpvir) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subreport_approvalpvirAdd' : 'singlereport_approvalPvirBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="report_approvalpvir[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="report_approvalpvir[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subreport_approvalpvirAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singlereport_approvalPvirBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="report_approvalpvir[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subreport_approvalpvirAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Report Approval' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div> --}}

                                <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="pvir_fileattachement">
                                            @if ($document->document_content->pvir_attachment)
                                                @foreach(json_decode($document->document_content->pvir_attachment) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_file_attach[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="pvir_attachment" style="cursor: pointer;">Add</label>
                                            <input type="file" id="pvir_attachment" name="pvir_attachment[]"
                                                oninput="addMultipleFiles(this, 'pvir_fileattachement')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_file_attach" name="deleted_file_attach" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_file_attach');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>

                                {{-- <div class="col-12">
                                        <div class="group-input">
                                            <label for="File_Attachment">File Attachment</label>
                                            <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                            <div class="file-attachment-field">
                                                <div class="file-attachment-list" id="pvir_fileattachement">
                                                @if (!empty($document->document_content->pvir_attachment))
                                                    @php
                                                        $attachments = is_array($document->document_content->pvir_attachment)
                                                                        ? $document->document_content->pvir_attachment
                                                                        : explode(',', $document->document_content->pvir_attachment);
                                                    @endphp
                                                    @foreach ($attachments as $file)
                                                        <h6 type="button" class="file-container text-dark"
                                                            style="background-color: rgb(243, 242, 240);">
                                                            <b>{{ $file }}</b>
                                                            <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                                <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                            </a>
                                                            <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                                <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                            </a>
                                                        </h6>
                                                    @endforeach
                                                @endif
                                                </div>

                                                <div class="add-btn">
                                                    <label for="pvir_attachment" style="cursor: pointer;">Add</label>
                                                    <input type="file" id="pvir_attachment" name="pvir_attachment[]"
                                                        oninput="addMultipleFiles(this, 'pvir_fileattachement')" multiple hidden>
                                                </div>
                                            </div>
                                        </div>
                                    </div>



                                    <script>
                                    function addMultipleFiles(input, listId) {
                                        let fileList = document.getElementById(listId);
                                        fileList.innerHTML = ""; // Clear previous files (if needed)

                                        for (let file of input.files) {
                                            let fileItem = document.createElement("div");
                                            fileItem.textContent = file.name;
                                            fileList.appendChild(fileItem);
                                        }
                                    }
                                    </script> --}}


                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>



           <!-- Annexure I-Gxp Assessment start  -->
                <div id="doc_Annexure_I" class="tabcontent">
                    <div class="orig-head">
                        ANNEXURE I-Gxp Assessment
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- <div class=""> --}}
                                  {{-- PRODUCT DETAILS --}}
                                {{-- </div>  <br> <br> --}}

                                <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="annex_fileattachement">
                                            @if ($document->document_content->annex_I_gxp_attachment)
                                                @foreach(json_decode($document->document_content->annex_I_gxp_attachment) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_annefile_attach1[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="annex_I_gxp_attachment" style="cursor: pointer;">Add</label>
                                            <input type="file" id="annex_I_gxp_attachment" name="annex_I_gxp_attachment[]"
                                                oninput="addMultipleFiles(this, 'annex_fileattachement')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_anne_attach1" name="deleted_anne_attach1" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_anne_attach1');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>


                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>
               <!-- Annexure I-Gxp Assessment end  -->

               <!-- Annexure II-Initial Risk Assessment start -->
                <div id="doc_Annexure_II" class="tabcontent">
                    <div class="orig-head">
                        Annexure II-Initial Risk Assessment
                        {{-- ANNEXURE II-INITIAL RISK ASSESSMENT --}}
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- <div class="">
                                  PRODUCT DETAILS
                                </div>  <br> --}}

                                <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="annexIIRisk_fileattachement">
                                            @if ($document->document_content->annex_II_risk_attachment)
                                                @foreach(json_decode($document->document_content->annex_II_risk_attachment) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_annefile_attach2[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="annex_II_risk_attachment" style="cursor: pointer;">Add</label>
                                            <input type="file" id="annex_II_risk_attachment" name="annex_II_risk_attachment[]"
                                                oninput="addMultipleFiles(this, 'annexIIRisk_fileattachement')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_anne_attach2" name="deleted_anne_attach2" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_anne_attach2');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>



                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>
               <!-- Annexure II-Initial Risk Assessment end -->

               <!-- Annexure III-ERES Assessment start -->
                <div id="doc_Annexure_III" class="tabcontent">
                    <div class="orig-head">
                        Annexure III-ERES Assessment
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- <div class="">
                                  PRODUCT DETAILS
                                </div>  <br> --}}

                                <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="annexIIIeres_fileattachement">
                                            @if ($document->document_content->annex_III_eres_attachment)
                                                @foreach(json_decode($document->document_content->annex_III_eres_attachment) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_annefile_attach3[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="annex_III_eres_attachment" style="cursor: pointer;">Add</label>
                                            <input type="file" id="annex_III_eres_attachment" name="annex_III_eres_attachment[]"
                                                oninput="addMultipleFiles(this, 'annexIIIeres_fileattachement')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_anne_attach3" name="deleted_anne_attach3" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_anne_attach3');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>



                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>
               <!-- Annexure III-ERES Assessment end -->

               <!-- Annexure IV-Validation Plan start -->
                <div id="doc_Annexure_IV" class="tabcontent">
                    <div class="orig-head">
                        Annexure IV-Validation Plan
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- <div class="">
                                  PRODUCT DETAILS
                                </div>  <br> --}}

                                 <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="annexIVPlan_fileattachement">
                                            @if ($document->document_content->annex_IV_plan_attachment)
                                                @foreach(json_decode($document->document_content->annex_IV_plan_attachment) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_annefile_attach4[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="annex_IV_plan_attachment" style="cursor: pointer;">Add</label>
                                            <input type="file" id="annex_IV_plan_attachment" name="annex_IV_plan_attachment[]"
                                                oninput="addMultipleFiles(this, 'annexIVPlan_fileattachement')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_anne_attach4" name="deleted_anne_attach4" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_anne_attach4');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>



                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>
               <!-- Annexure IV-Validation Plan end -->

               <!-- Annexure V-User Requirements Specification start -->
                <div id="doc_Annexure_V" class="tabcontent">
                    <div class="orig-head">
                        Annexure V-User Required Specification
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- <div class="">
                                  PRODUCT DETAILS
                                </div>  <br> --}}

                            <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="annexVUser_fileattachement">
                                            @if ($document->document_content->annex_V_user_attachment)
                                                @foreach(json_decode($document->document_content->annex_V_user_attachment) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_annefile_attach5[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="annex_V_user_attachment" style="cursor: pointer;">Add</label>
                                            <input type="file" id="annex_V_user_attachment" name="annex_V_user_attachment[]"
                                                oninput="addMultipleFiles(this, 'annexVUser_fileattachement')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_anne_attach5" name="deleted_anne_attach5" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_anne_attach5');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>




                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>
               <!--Annexure V-User Requirements Specification end -->

                  <!-- Annexure VI-Functional Requirement Specification start  -->
                <div id="doc_Annexure_VI" class="tabcontent">
                    <div class="orig-head">
                        Annexure VI-Functional Requirement Specification
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- <div class="">
                                  PRODUCT DETAILS
                                </div>  <br> --}}

                                <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="annex_VIreq_fileattachement">
                                            @if ($document->document_content->annex_VI_req_attachment)
                                                @foreach(json_decode($document->document_content->annex_VI_req_attachment) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_annefile_attach6[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="annex_VI_req_attachment" style="cursor: pointer;">Add</label>
                                            <input type="file" id="annex_VI_req_attachment" name="annex_VI_req_attachment[]"
                                                oninput="addMultipleFiles(this, 'annex_VIreq_fileattachement')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_anne_attach6" name="deleted_anne_attach6" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_anne_attach6');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>



                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>
               <!-- Annexure VI-Functional Requirement Specification  -->

               <!-- Annexure VII-Functional Specification start -->
                <div id="doc_Annexure_VII" class="tabcontent">
                    <div class="orig-head">
                        Annexure VII-Functional Specification
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- <div class="">
                                  PRODUCT DETAILS
                                </div>  <br> --}}

                            <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="annex_VII_fun_fileattachement">
                                            @if ($document->document_content->annex_VII_fun_attachment)
                                                @foreach(json_decode($document->document_content->annex_VII_fun_attachment) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_annefile_attach7[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="annex_VII_fun_attachment" style="cursor: pointer;">Add</label>
                                            <input type="file" id="annex_VII_fun_attachment" name="annex_VII_fun_attachment[]"
                                                oninput="addMultipleFiles(this, 'annex_VII_fun_fileattachement')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_anne_attach7" name="deleted_anne_attach7" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_anne_attach7');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>


                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>
               <!-- Annexure VII-Functional Specification end -->

               <!-- Annexure VIII-Technical Specification start -->
                <div id="doc_Annexure_VIII" class="tabcontent">
                    <div class="orig-head">
                        Annexure VIII-Technical Specification
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- <div class="">
                                  PRODUCT DETAILS
                                </div>  <br> --}}

                            <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="annexVIII_tech_fileattachement">
                                            @if ($document->document_content->annex_VIII_tech_attachment)
                                                @foreach(json_decode($document->document_content->annex_VIII_tech_attachment) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_annefile_attach8[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="annex_VIII_tech_attachment" style="cursor: pointer;">Add</label>
                                            <input type="file" id="annex_VIII_tech_attachment" name="annex_VIII_tech_attachment[]"
                                                oninput="addMultipleFiles(this, 'annexVIII_tech_fileattachement')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_anne_attach8" name="deleted_anne_attach8" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_anne_attach8');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>



                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>
               <!-- Annexure VIII-Technical Specification end -->

               <!-- Annexure IX Functional Risk Assssment start -->
                <div id="doc_Annexure_IX" class="tabcontent">
                    <div class="orig-head">
                        Annexure IX Functional Risk Assssment
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- <div class="">
                                  PRODUCT DETAILS
                                </div>  <br> --}}

                            <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="annex_IX_risk_fileattachement">
                                            @if ($document->document_content->annex_IX_risk_attachment)
                                                @foreach(json_decode($document->document_content->annex_IX_risk_attachment) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_annefile_attach9[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="annex_IX_risk_attachment" style="cursor: pointer;">Add</label>
                                            <input type="file" id="annex_IX_risk_attachment" name="annex_IX_risk_attachment[]"
                                                oninput="addMultipleFiles(this, 'annex_IX_risk_fileattachement')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_anne_attach9" name="deleted_anne_attach9" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_anne_attach9');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>





                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>
               <!-- Annexure IX Functional Risk Assssment end -->

               <!-- Annexure X-Design Specification start -->
                <div id="doc_Annexure_X" class="tabcontent">
                    <div class="orig-head">
                        Annexure X-Design Specification
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- <div class="">
                                  PRODUCT DETAILS
                                </div>  <br> --}}

                                  <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="annex_X_Design_fileattachement">
                                            @if ($document->document_content->annex_X_design_attachment)
                                                @foreach(json_decode($document->document_content->annex_X_design_attachment) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_annefile_attach10[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="annex_X_design_attachment" style="cursor: pointer;">Add</label>
                                            <input type="file" id="annex_X_design_attachment" name="annex_X_design_attachment[]"
                                                oninput="addMultipleFiles(this, 'annex_X_Design_fileattachement')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_anne_attach10" name="deleted_anne_attach10" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_anne_attach10');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>



                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>
               <!-- Annexure X-Design Specification end -->


               <!-- Annexure XI-Configuration Specification start -->
               <div id="doc_Annexure_XI" class="tabcontent">
                    <div class="orig-head">
                        Annexure XI-Configuration Specification
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- <div class="">
                                  PRODUCT DETAILS
                                </div>  <br> --}}

                                <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="annex_XI_Config_fileattachement">
                                            @if ($document->document_content->annex_XI_confi_attachment)
                                                @foreach(json_decode($document->document_content->annex_XI_confi_attachment) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_annefile_attach11[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="annex_XI_confi_attachment" style="cursor: pointer;">Add</label>
                                            <input type="file" id="annex_XI_confi_attachment" name="annex_XI_confi_attachment[]"
                                                oninput="addMultipleFiles(this, 'annex_XI_Config_fileattachement')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_anne_attach11" name="deleted_anne_attach11" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_anne_attach11');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>



                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>
               <!-- Annexure XI-Configuration Specification end -->

               <!-- Annexure XII Installation Infrastructure Operational Performance Qualification Protocol start -->
                <div id="doc_Annexure_XII" class="tabcontent">
                    <div class="orig-head">
                        Annexure XII Installation Infrastructure Operational Performance Qualification Protocol
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- <div class="">
                                  PRODUCT DETAILS
                                </div>  <br> --}}

                            <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="annex_XII_quaProto_fileattachement">
                                            @if ($document->document_content->annex_XII_qua_proto_attachment)
                                                @foreach(json_decode($document->document_content->annex_XII_qua_proto_attachment) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_annefile_attach12[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="annex_XII_qua_proto_attachment" style="cursor: pointer;">Add</label>
                                            <input type="file" id="annex_XII_qua_proto_attachment" name="annex_XII_qua_proto_attachment[]"
                                                oninput="addMultipleFiles(this, 'annex_XII_quaProto_fileattachement')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_anne_attach12" name="deleted_anne_attach12" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_anne_attach12');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>





                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>
               <!-- Annexure XII Installation Infrastructure Operational Performance Qualification Protocol end -->

                 <!-- Annexure XIII Unit Integration Test Script start -->
                <div id="doc_Annexure_XIII" class="tabcontent">
                    <div class="orig-head">
                        Annexure XIII Unit Integration Test Script
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- <div class="">
                                  PRODUCT DETAILS
                                </div>  <br> --}}

                            <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="annex_XIII_unitInteg_fileattachement">
                                            @if ($document->document_content->annex_XIII_unit_integ_attachment)
                                                @foreach(json_decode($document->document_content->annex_XIII_unit_integ_attachment) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_annefile_attach13[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="annex_XIII_unit_integ_attachment" style="cursor: pointer;">Add</label>
                                            <input type="file" id="annex_XIII_unit_integ_attachment" name="annex_XIII_unit_integ_attachment[]"
                                                oninput="addMultipleFiles(this, 'annex_XIII_unitInteg_fileattachement')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_anne_attach13" name="deleted_anne_attach13" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_anne_attach13');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>



                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>
               <!-- Annexure XIII Unit Integration Test Script end -->

               <!-- Annexure XIV Data Migration Protocol start -->
                <div id="doc_Annexure_XIV" class="tabcontent">
                    <div class="orig-head">
                        Annexure XIV Data Migration Protocol
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- <div class="">
                                  PRODUCT DETAILS
                                </div>  <br> --}}

                            <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="annex_XIV_dataMigra_fileattachement">
                                            @if ($document->document_content->annex_XIV_data_migra_attachment)
                                                @foreach(json_decode($document->document_content->annex_XIV_data_migra_attachment) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_annefile_attach14[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="annex_XIV_data_migra_attachment" style="cursor: pointer;">Add</label>
                                            <input type="file" id="annex_XIV_data_migra_attachment" name="annex_XIV_data_migra_attachment[]"
                                                oninput="addMultipleFiles(this, 'annex_XIV_dataMigra_fileattachement')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_anne_attach14" name="deleted_anne_attach14" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_anne_attach14');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>



                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>
               <!-- Annexure XIV Data Migration Protocol end -->

               <!-- Annexure XV Data Qualification Protocol start -->
                <div id="doc_Annexure_XV" class="tabcontent">
                    <div class="orig-head">
                        Annexure XV Data Qualification Protocol
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- <div class="">
                                  PRODUCT DETAILS
                                </div>  <br> --}}

                                 <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="annex_XV_dataQualif_fileattachement">
                                            @if ($document->document_content->annex_XV_data_qualif_attachment)
                                                @foreach(json_decode($document->document_content->annex_XV_data_qualif_attachment) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_annefile_attach15[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="annex_XV_data_qualif_attachment" style="cursor: pointer;">Add</label>
                                            <input type="file" id="annex_XV_data_qualif_attachment" name="annex_XV_data_qualif_attachment[]"
                                                oninput="addMultipleFiles(this, 'annex_XV_dataQualif_fileattachement')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_anne_attach15" name="deleted_anne_attach15" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_anne_attach15');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>



                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>
               <!-- Annexure XV Data Qualification Protocol end -->


                    {{-- Finished product,  Inprocess,  Cleaning Validation Standard Testing Procedure (Commercial  registration , re-registration) TABS --}}

                    <div id="doc-fpstp" class="tabcontent">
                        <div class="orig-head">
                        Finished Product Standard Testing Procedure
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                 <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="stp">STP No<span class="text-danger">*</span></label>
                                        @php
                                            $revisionNumber = $document->revised == 'Yes' ? str_pad($document->revised_doc, 2, '0', STR_PAD_LEFT) : '00';
                                            $mfpstpNumber = "FPSTP/" . str_pad($document->id, 4, '0', STR_PAD_LEFT) . "-$revisionNumber";
                                        @endphp
                                        <input type="text" id="stp" name="stp_mfpstp_no" value="{{ $mfpstpNumber }}" maxlength="255" readonly>
                                    </div>
                                </div>

                                    <div class="col-md-6">
                                        <div class="group-input">
                                            <label for="reference">Product Name</label>
                                            <input type="text" name="product_name_fpstp" value="{{$document->document_content->product_name_fpstp}}">
                                        </div>
                                    </div>

                                    <div class="col-12 sub-head">
                                           STANDARD TESTING PROCEDURE
                                        <div class="group-input">
                                            <label for="procedure"></label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <textarea name="fpstp_testfield" id="" class="summernote">{{ $document->document_content ? $document->document_content->fpstp_testfield : '' }}</textarea>
                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>

                                    <div class="group-input">
                                        <label for="action-plan-grid">
                                            Revision History<button type="button" name="action-plan-grid"
                                                    id="fpstp_revision">+</button>
                                        </label>
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="table_fpstp_revision">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 2%">Sr. No.</th>
                                                        <th style="width: 12%">Revision No.</th>
                                                        <th style="width: 12%">Change Control No./ DCRF No</th>
                                                        <th style="width: 12%">Effective Date</th>
                                                        <th style="width: 30%">Reason of revision</th>
                                                        <th style="width: 3%">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @php
                                                        $serialNumber = 1;
                                                        $GtpData = isset($RevisionGridfpstpData->data) && is_string($RevisionGridfpstpData->data)
                                                            ? json_decode($RevisionGridfpstpData->data, true)
                                                            : (is_array($RevisionGridfpstpData->data) ? $RevisionGridfpstpData->data : []);
                                                    @endphp

                                                    @if(!empty($GtpData))
                                                        @foreach($GtpData as $key => $gtp_data)
                                                            <tr>
                                                                <td>{{ $serialNumber++ }}</td>
                                                                <td><input type="text" name="revision_fpstp_data[{{ $key }}][rev_fpstp_no]" value="{{ $gtp_data['rev_fpstp_no'] ?? '' }}"></td>
                                                                <td><input type="text" name="revision_fpstp_data[{{ $key }}][change_ctrl_fpstp_no]" value="{{ $gtp_data['change_ctrl_fpstp_no'] ?? '' }}"></td>
                                                                <td><input type="date" name="revision_fpstp_data[{{ $key }}][eff_date_fpstp]" value="{{ $gtp_data['eff_date_fpstp'] ?? '' }}"></td>
                                                                <td><input type="text" name="revision_fpstp_data[{{ $key }}][rev_reason_fpstp]" value="{{ $gtp_data['rev_reason_fpstp'] ?? '' }}"></td>
                                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                            </tr>
                                                        @endforeach
                                                    @else
                                                        <tr>
                                                            <td>{{ $serialNumber++ }}</td>
                                                            <td><input type="text" name="revision_fpstp_data[0][rev_fpstp_no]"></td>
                                                            <td><input type="text" name="revision_fpstp_data[0][change_ctrl_fpstp_no]"></td>
                                                            <td><input type="date" name="revision_fpstp_data[0][eff_date_fpstp]"></td>
                                                            <td><input type="text" name="revision_fpstp_data[0][rev_reason_fpstp]"></td>
                                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                        </tr>
                                                    @endif
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <script>
                                        $(document).ready(function() {
                                            function updateSerialNumbers() {
                                                $('#table_fpstp_revision tbody tr').each(function(index) {
                                                    $(this).find('td:first-child input').val(index + 1); // Update Sr. No
                                                    $(this).find('td:nth-child(2) input').attr('name', `gtp[${index}][test_gtp]`);
                                                });
                                            }

                                            $('#fpstp_revision').click(function() {
                                                var serialNumber = $('#table_fpstp_revision tbody tr').length + 1; // Get the next serial number
                                                var newRow = `
                                                    <tr>
                                                        <td><input disabled type="text" style="width:40px; text-align:center;" value="${serialNumber}"></td>
                                                        <td><input type="text" name="revision_fpstp_data[${serialNumber - 1}][rev_fpstp_no]" value=""></td>
                                                        <td><input type="text" name="revision_fpstp_data[${serialNumber - 1}][change_ctrl_fpstp_no]" value=""></td>
                                                        <td><input type="date" name="revision_fpstp_data[${serialNumber - 1}][eff_date_fpstp]" value=""></td>
                                                        <td><input type="text" name="revision_fpstp_data[${serialNumber - 1}][rev_reason_fpstp]" value=""></td>
                                                        <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                    </tr>`;

                                                $('#table_fpstp_revision tbody').append(newRow);
                                            });

                                            // Remove row functionality
                                            $(document).on('click', '.removeRowBtn', function() {
                                                $(this).closest('tr').remove();
                                                updateSerialNumbers(); // Update serial numbers after removal
                                            });
                                        });
                                    </script>

                                    

                                



                                {{-- <div class="col-12">
                                    <div class="group-input">
                                        <label for="Specification Details">
                                            STANDARD TESTING PROCEDURE
                                            <button type="button" id="Standard_Testing_add_1">+</button>
                                        </label>
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="Standard_Testing_detail_1" style="width: 100%;">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 100px;">Sr. No.</th>
                                                        <th>Test</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @php
                                                        $serialNumber = 1;
                                                        $Finished_Product_data = isset($Finished_Product->data) && is_string($Finished_Product->data)
                                                            ? json_decode($Finished_Product->data, true)
                                                            : (is_array($Finished_Product->data) ? $Finished_Product->data : []);
                                                    @endphp
                                                    @if(!empty($Finished_Product_data))
                                                        @foreach($Finished_Product_data  as $key => $item)
                                                            <tr>
                                                                <td><input type="text" disabled value="{{ $serialNumber++ }}" style="width: 30px;"></td>
                                                                <td><input type="text" name="item[{{ $key }}][testing]" value="{{ $item['testing'] ?? '' }}"></td>
                                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                            </tr>
                                                        @endforeach
                                                    @else
                                                        <tr>
                                                            <td><input type="text" disabled value="1" style="width: 30px;"></td>
                                                            <td><input type="text" name="item[0][testing]"></td>
                                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                        </tr>
                                                    @endif
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <script>
                                    $(document).ready(function() {
                                        $('#Standard_Testing_add_1').click(function(e) {
                                            e.preventDefault();

                                            function generateSpecificationTableRow(serialNumber) {
                                                var html =
                                                    '<tr>' +
                                                    '<td><input disabled type="text" name="item[' + serialNumber + '][serial]" value="' + (serialNumber + 1) + '"></td>' +
                                                    '<td><input type="text" name="item[' + serialNumber + '][testing]"></td>' +
                                                    '<td><button type="button" class="removeRowBtn">Remove</button></td>' +
                                                    '</tr>';
                                                return html;
                                            }

                                            var tableBody = $('#Standard_Testing_detail_1 tbody');
                                            var rowCount = tableBody.children('tr').length;
                                            var newRow = generateSpecificationTableRow(rowCount);
                                            tableBody.append(newRow);
                                        });

                                        $(document).on('click', '.removeRowBtn', function() {
                                            $(this).closest('tr').remove();
                                        });
                                    });
                                </script> --}}
                            </div>
                        </div>
                        <div class="button-block">
                            <button type="submit" value="save" name="submit" id="DocsaveButton"
                                class="saveButton">Save</button>
                            <button type="button" class="backButton" onclick="previousStep()">Back</button>
                            <button type="button" class="nextButton" id="DocnextButton"
                                onclick="nextStep()">Next</button>
                            <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                </a>
                            </button>
                        </div>
                    </div>




                    <div id="doc-istp" class="tabcontent">
                        <div class="orig-head">
                         Inprocess Standard Testing Procedure
                        </div>
                        <div class="input-fields">
                            <div class="row">

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="stp">STP No<span class="text-danger">*</span></label>
                                        @php
                                            $revisionNumber = $document->revised == 'Yes' ? str_pad($document->revised_doc, 2, '0', STR_PAD_LEFT) : '00';
                                            $mfpstpNumber = "IPSTP/" . str_pad($document->id, 4, '0', STR_PAD_LEFT) . "-$revisionNumber";
                                        @endphp
                                        <input type="text" id="stp" name="stp_mfpstp_no" value="{{ $mfpstpNumber }}" maxlength="255" readonly>
                                    </div>
                                </div>

                                    <div class="col-md-6">
                                        <div class="group-input">
                                            <label for="reference">Product Name</label>
                                            <input type="text" name="product_name_ipstp" value="{{$document->document_content->product_name_ipstp}}">
                                        </div>
                                    </div>

                                    <div class="col-12 sub-head">
                                           STANDARD TESTING PROCEDURE
                                        <div class="group-input">
                                            <label for="procedure"></label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <textarea name="ipstp_testfield" id="" class="summernote">{{ $document->document_content ? $document->document_content->ipstp_testfield : '' }}</textarea>
                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>

                                {{-- <div class="col-12">
                                    <div class="group-input">
                                        <label for="Specification Details">
                                            STANDARD TESTING PROCEDURE
                                            <button type="button" id="Standard_Testing_add_2">+</button>
                                        </label>
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="Standard_Testing_details_2" style="width: 100%;">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 100px;">Sr. No.</th>
                                                        <th>Test</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @php
                                                        $serialNumber = 1;
                                                        $Inprocess_standard_data = isset($Inprocess_standard->data) && is_string($Inprocess_standard->data)
                                                            ? json_decode($Inprocess_standard->data, true)
                                                            : (is_array($Inprocess_standard->data) ? $Inprocess_standard->data : []);
                                                    @endphp
                                                    @if(!empty($Inprocess_standard_data))
                                                        @foreach($Inprocess_standard_data as $key => $item)
                                                            <tr>
                                                                <td><input type="text" disabled value="{{ $serialNumber++ }}" style="width: 30px;"></td>
                                                                <td><input type="text" name="item[{{ $key }}][testingdata]" value="{{ $item['testingdata'] ?? '' }}"></td>
                                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                            </tr>
                                                        @endforeach
                                                    @else
                                                        <tr>
                                                            <td><input type="text" disabled value="1" style="width: 30px;"></td>
                                                            <td><input type="text" name="item[0][testingdata]"></td>
                                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                        </tr>
                                                    @endif
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div> --}}
                                {{-- <script>
                                    $(document).ready(function() {
                                        $('#Standard_Testing_add_2').click(function(e) {
                                            e.preventDefault();

                                            function generateSpecificationTableRow(serialNumber) {
                                                var html =
                                                    '<tr>' +
                                                    '<td><input disabled type="text" name="item[' + serialNumber + '][serial]" value="' + (serialNumber + 1) + '"></td>' +
                                                    '<td><input type="text" name="item[' + serialNumber + '][testingdata]"></td>' +
                                                    '<td><button type="button" class="removeRowBtn">Remove</button></td>' +
                                                    '</tr>';
                                                return html;
                                            }

                                            var tableBody = $('#Standard_Testing_details_2 tbody');
                                            var rowCount = tableBody.children('tr').length;
                                            var newRow = generateSpecificationTableRow(rowCount);
                                            tableBody.append(newRow);
                                        });

                                        // Remove row in Specification Details table
                                        $(document).on('click', '.removeRowBtn', function() {
                                            $(this).closest('tr').remove();
                                        });
                                    });
                                </script> --}}

                                    <div class="group-input">
                                        <label for="action-plan-grid">
                                            Revision History<button type="button" name="action-plan-grid"
                                                    id="inpstp_revision">+</button>
                                        </label>
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="table_inpstp_revision">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 2%">Sr. No.</th>
                                                        <th style="width: 12%">Revision No.</th>
                                                        <th style="width: 12%">Change Control No./ DCRF No</th>
                                                        <th style="width: 12%">Effective Date</th>
                                                        <th style="width: 30%">Reason of revision</th>
                                                        <th style="width: 3%">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @php
                                                        $serialNumber = 1;
                                                        $GtpData = isset($RevisionGridinpstpData->data) && is_string($RevisionGridinpstpData->data)
                                                            ? json_decode($RevisionGridinpstpData->data, true)
                                                            : (is_array($RevisionGridinpstpData->data) ? $RevisionGridinpstpData->data : []);
                                                    @endphp

                                                    @if(!empty($GtpData))
                                                        @foreach($GtpData as $key => $gtp_data)
                                                            <tr>
                                                                <td>{{ $serialNumber++ }}</td>
                                                                <td><input type="text" name="revision_inpstp_data[{{ $key }}][rev_inpstp_no]" value="{{ $gtp_data['rev_inpstp_no'] ?? '' }}"></td>
                                                                <td><input type="text" name="revision_inpstp_data[{{ $key }}][change_ctrl_inpstp_no]" value="{{ $gtp_data['change_ctrl_inpstp_no'] ?? '' }}"></td>
                                                                <td><input type="date" name="revision_inpstp_data[{{ $key }}][eff_date_inpstp]" value="{{ $gtp_data['eff_date_inpstp'] ?? '' }}"></td>
                                                                <td><input type="text" name="revision_inpstp_data[{{ $key }}][rev_reason_inpstp]" value="{{ $gtp_data['rev_reason_inpstp'] ?? '' }}"></td>
                                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                            </tr>
                                                        @endforeach
                                                    @else
                                                        <tr>
                                                            <td>{{ $serialNumber++ }}</td>
                                                            <td><input type="text" name="revision_inpstp_data[0][rev_inpstp_no]"></td>
                                                            <td><input type="text" name="revision_inpstp_data[0][change_ctrl_inpstp_no]"></td>
                                                            <td><input type="date" name="revision_inpstp_data[0][eff_date_inpstp]"></td>
                                                            <td><input type="text" name="revision_inpstp_data[0][rev_reason_inpstp]"></td>
                                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                        </tr>
                                                    @endif
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <script>
                                        $(document).ready(function() {
                                            function updateSerialNumbers() {
                                                $('#table_inpstp_revision tbody tr').each(function(index) {
                                                    $(this).find('td:first-child input').val(index + 1); // Update Sr. No
                                                    $(this).find('td:nth-child(2) input').attr('name', `gtp[${index}][test_gtp]`);
                                                });
                                            }

                                            $('#inpstp_revision').click(function() {
                                                var serialNumber = $('#table_inpstp_revision tbody tr').length + 1; // Get the next serial number
                                                var newRow = `
                                                    <tr>
                                                        <td><input disabled type="text" style="width:40px; text-align:center;" value="${serialNumber}"></td>
                                                        <td><input type="text" name="revision_inpstp_data[${serialNumber - 1}][rev_inpstp_no]" value=""></td>
                                                        <td><input type="text" name="revision_inpstp_data[${serialNumber - 1}][change_ctrl_inpstp_no]" value=""></td>
                                                        <td><input type="date" name="revision_inpstp_data[${serialNumber - 1}][eff_date_inpstp]" value=""></td>
                                                        <td><input type="text" name="revision_inpstp_data[${serialNumber - 1}][rev_reason_inpstp]" value=""></td>
                                                        <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                    </tr>`;

                                                $('#table_inpstp_revision tbody').append(newRow);
                                            });

                                            // Remove row functionality
                                            $(document).on('click', '.removeRowBtn', function() {
                                                $(this).closest('tr').remove();
                                                updateSerialNumbers(); // Update serial numbers after removal
                                            });
                                        });
                                    </script>


                            </div>
                        </div>
                        <div class="button-block">
                            <button type="submit" value="save" name="submit" id="DocsaveButton"
                                class="saveButton">Save</button>
                            <button type="button" class="backButton" onclick="previousStep()">Back</button>
                            <button type="button" class="nextButton" id="DocnextButton"
                                onclick="nextStep()">Next</button>
                            <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                </a>
                            </button>
                        </div>
                    </div>



                    <div id="doc-cvstp" class="tabcontent">
                        <div class="orig-head">
                        Cleaning Validation Standard Testing Procedure
                        </div>
                        <div class="input-fields">
                            <div class="row">

                            <!-- <div class="col-12 sub-head">
                                STANDARD TESTING PROCEDURE
                            </div> -->

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="stp">STP No<span class="text-danger">*</span></label>
                                        @php
                                            $revisionNumber = $document->revised == 'Yes' ? str_pad($document->revised_doc, 2, '0', STR_PAD_LEFT) : '00';
                                            $mfpstpNumber = "CVSTP/" . str_pad($document->id, 4, '0', STR_PAD_LEFT) . "-$revisionNumber";
                                        @endphp
                                        <input type="text" id="stp" name="stp_mfpstp_no" value="{{ $mfpstpNumber }}" maxlength="255" readonly>
                                    </div>
                                </div>

                                    <div class="col-md-6">
                                        <div class="group-input">
                                            <label for="reference">Product Name</label>
                                            <input type="text" name="product_name_cvstp" value="{{$document->document_content->product_name_cvstp}}">
                                        </div>
                                    </div>

                                    <div class="col-12 sub-head">
                                           STANDARD TESTING PROCEDURE
                                        <div class="group-input">
                                            <label for="procedure"></label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <textarea name="cvstp_testfield" id="" class="summernote">{{ $document->document_content ? $document->document_content->cvstp_testfield : '' }}</textarea>
                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>

                                    <div class="group-input">
                                        <label for="action-plan-grid">
                                            Revision History<button type="button" name="action-plan-grid"
                                                    id="cvstp_revision">+</button>
                                        </label>
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="table_cvstp_revision">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 2%">Sr. No.</th>
                                                        <th style="width: 12%">Revision No.</th>
                                                        <th style="width: 12%">Change Control No./ DCRF No</th>
                                                        <th style="width: 12%">Effective Date</th>
                                                        <th style="width: 30%">Reason of revision</th>
                                                        <th style="width: 3%">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @php
                                                        $serialNumber = 1;
                                                        $GtpData = isset($RevisionGridcvstpData->data) && is_string($RevisionGridcvstpData->data)
                                                            ? json_decode($RevisionGridcvstpData->data, true)
                                                            : (is_array($RevisionGridcvstpData->data) ? $RevisionGridcvstpData->data : []);
                                                    @endphp

                                                    @if(!empty($GtpData))
                                                        @foreach($GtpData as $key => $gtp_data)
                                                            <tr>
                                                                <td>{{ $serialNumber++ }}</td>
                                                                <td><input type="text" name="revision_cvstp_data[{{ $key }}][rev_cvstp_no]" value="{{ $gtp_data['rev_cvstp_no'] ?? '' }}"></td>
                                                                <td><input type="text" name="revision_cvstp_data[{{ $key }}][change_ctrl_cvstp_no]" value="{{ $gtp_data['change_ctrl_cvstp_no'] ?? '' }}"></td>
                                                                <td><input type="date" name="revision_cvstp_data[{{ $key }}][eff_date_cvstp]" value="{{ $gtp_data['eff_date_cvstp'] ?? '' }}"></td>
                                                                <td><input type="text" name="revision_cvstp_data[{{ $key }}][rev_reason_cvstp]" value="{{ $gtp_data['rev_reason_cvstp'] ?? '' }}"></td>
                                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                            </tr>
                                                        @endforeach
                                                    @else
                                                        <tr>
                                                            <td>{{ $serialNumber++ }}</td>
                                                            <td><input type="text" name="revision_cvstp_data[0][rev_cvstp_no]"></td>
                                                            <td><input type="text" name="revision_cvstp_data[0][change_ctrl_cvstp_no]"></td>
                                                            <td><input type="date" name="revision_cvstp_data[0][eff_date_cvstp]"></td>
                                                            <td><input type="text" name="revision_cvstp_data[0][rev_reason_cvstp]"></td>
                                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                        </tr>
                                                    @endif
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <script>
                                        $(document).ready(function() {
                                            function updateSerialNumbers() {
                                                $('#table_cvstp_revision tbody tr').each(function(index) {
                                                    $(this).find('td:first-child input').val(index + 1); // Update Sr. No
                                                    $(this).find('td:nth-child(2) input').attr('name', `gtp[${index}][test_gtp]`);
                                                });
                                            }

                                            $('#cvstp_revision').click(function() {
                                                var serialNumber = $('#table_cvstp_revision tbody tr').length + 1; // Get the next serial number
                                                var newRow = `
                                                    <tr>
                                                        <td><input disabled type="text" style="width:40px; text-align:center;" value="${serialNumber}"></td>
                                                        <td><input type="text" name="revision_cvstp_data[${serialNumber - 1}][rev_cvstp_no]" value=""></td>
                                                        <td><input type="text" name="revision_cvstp_data[${serialNumber - 1}][change_ctrl_cvstp_no]" value=""></td>
                                                        <td><input type="date" name="revision_cvstp_data[${serialNumber - 1}][eff_date_cvstp]" value=""></td>
                                                        <td><input type="text" name="revision_cvstp_data[${serialNumber - 1}][rev_reason_cvstp]" value=""></td>
                                                        <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                    </tr>`;

                                                $('#table_cvstp_revision tbody').append(newRow);
                                            });

                                            // Remove row functionality
                                            $(document).on('click', '.removeRowBtn', function() {
                                                $(this).closest('tr').remove();
                                                updateSerialNumbers(); // Update serial numbers after removal
                                            });
                                        });
                                    </script>

                            </div>
                        </div>
                        <div class="button-block">
                            <button type="submit" value="save" name="submit" id="DocsaveButton"
                                class="saveButton">Save</button>
                            <button type="button" class="backButton" onclick="previousStep()">Back</button>
                            <button type="button" class="nextButton" id="DocnextButton"
                                onclick="nextStep()">Next</button>
                            <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                </a>
                            </button>
                        </div>
                    </div>

                <!-- GTP -->
                <div id="doc-gtp" class="tabcontent">
                    <div class="orig-head">
                         GENERAL TESTING PROCEDURE
                        </div>
                    <div class="input-fields">
                        <div class="row">

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="stp">GTP No<span class="text-danger">*</span></label>
                                        @php
                                            $revisionNumber = $document->revised == 'Yes' ? str_pad($document->revised_doc, 2, '0', STR_PAD_LEFT) : '00';
                                            $mfpstpNumber = "GTP/" . str_pad($document->id, 4, '0', STR_PAD_LEFT) . "-$revisionNumber";
                                        @endphp
                                        <input type="text" id="stp" name="gtp_no" value="{{ $mfpstpNumber }}" maxlength="255" readonly>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="comments">Product/Material Name</label>
                                        <input type="text" name="gtp_product_material_name" value="{{$document->gtp_product_material_name}}">
                                    </div>
                                </div>


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="procedure">Test</label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <textarea name="gtp_test" id="" class="summernote">{{ $document->document_content ? $document->document_content->gtp_test : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>



                                <div class="group-input">
                                    <label for="action-plan-grid">
                                        Revision History<button type="button" name="action-plan-grid"
                                                id="Details_add_gtp">+</button>

                                    </label>
                                    <div class="table-responsive">
                                        <table class="table table-bordered" id="Details-table-gtp">
                                            <thead>
                                                <tr>
                                                    <th style="width:5%">Sr. No.</th>
                                                    <th class="">Revision No.</th>
                                                    <th class="">Change Control No./ DCRF No</th>
                                                    <th class="">Effective Date</th>
                                                    <th class="">Reason of revision</th>
                                                    <th style="width: 2%">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @php
                                                    $serialNumber = 1;
                                                    $GtpData = isset($GtpGridData->data) && is_string($GtpGridData->data)
                                                        ? json_decode($GtpGridData->data, true)
                                                        : (is_array($GtpGridData->data) ? $GtpGridData->data : []);
                                                @endphp

                                                @if(!empty($GtpData))
                                                    @foreach($GtpData as $key => $gtp_data)
                                                        <tr>
                                                            <td>{{ $serialNumber++ }}</td>
                                                            <td><input type="text" name="gtp[{{ $key }}][revision_no_gtp]" value="{{ $gtp_data['revision_no_gtp'] ?? '' }}"></td>
                                                            <td><input type="text" name="gtp[{{ $key }}][changContNo_gtp]" value="{{ $gtp_data['changContNo_gtp'] ?? '' }}"></td>
                                                            <td><input type="date" name="gtp[{{ $key }}][effectiveDate_gtp]" value="{{ $gtp_data['effectiveDate_gtp'] ?? '' }}"></td>
                                                            <td><input type="text" name="gtp[{{ $key }}][reasonRevi_gtp]" value="{{ $gtp_data['reasonRevi_gtp'] ?? '' }}"></td>
                                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                        </tr>
                                                    @endforeach
                                                @else
                                                    <tr>
                                                        <td>{{ $serialNumber++ }}</td>
                                                        <td><input type="text" name="gtp[0][revision_no_gtp]"></td>
                                                        <td><input type="text" name="gtp[0][changContNo_gtp]"></td>
                                                        <td><input type="date" name="gtp[0][effectiveDate_gtp]"></td>
                                                        <td><input type="text" name="gtp[0][reasonRevi_gtp]"></td>
                                                        <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                    </tr>
                                                @endif
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                </div>
                            </div>

                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>

                    <script>
                        $(document).ready(function() {
                            let investdetails = 1;
                            $('#Details_add_gtp').click(function(e) {
                                function generateTableRow(serialNumber) {
                                    var users = @json($users);
                                    console.log(users);
                                    var html =
                                            '<tr>' +
                                            '<td><input disabled type="text" style ="width:15px" value="' + serialNumber +
                                            '"></td>' +
                                            '<td><input type="text" name="gtp[' + investdetails +
                                            '][revision_no_gtp]" value=""></td>' +
                                            '<td><input type="text" name="gtp[' + investdetails +
                                            '][changContNo_gtp]" value=""></td>' +
                                            '<td><input type="date" name="gtp[' + investdetails +
                                            '][effectiveDate_gtp]" value=""></td>' +                                        
                                            '<td><input type="text" name="gtp[' + investdetails +
                                            '][reasonRevi_gtp]" value=""></td>' +
                                            '</tr>';

                                        return html;
                                    }

                                    var tableBody = $('#Details-table-gtp tbody');
                                    var rowCount = tableBody.children('tr').length;
                                    var newRow = generateTableRow(rowCount + 1);
                                    tableBody.append(newRow);
                                });
                            });
                    </script>

                <script>
                    $(document).on('click', '.removeRowBtn', function() {
                        $(this).closest('tr').remove();
                    })
                </script>


    <!---------------------------------------------- RMSTP tab ----------------------------------------->

            <div id="doc_rmstp" class="tabcontent">
                    <div class="orig-head">
                        Raw Material Standard Testing Procedure
                    </div>
                <div class="input-fields">
                    <div class="row">
                               <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="stp">STP No<span class="text-danger">*</span></label>
                                        @php
                                            $revisionNumber = $document->revised == 'Yes' ? str_pad($document->revised_doc, 2, '0', STR_PAD_LEFT) : '00';
                                            $mfpstpNumber = "RMSTP/" . str_pad($document->id, 4, '0', STR_PAD_LEFT) . "-$revisionNumber";
                                        @endphp
                                        <input type="text" id="stp" name="stp_mfpstp_no" value="{{ $mfpstpNumber }}" maxlength="255" readonly>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="reference">Product Name</label>
                                        <input type="text" name="product_name_rawmstp" value="{{$document->document_content->product_name_rawmstp}}">
                                    </div>
                                </div>

                                <div class="col-12 sub-head">
                                     Standard Testing Procedure
                                    <div class="group-input">
                                        <label for="procedure"></label>
                                        <textarea name="rawmaterials_testing" id="summernote" class="summernote">{{ $document->rawmaterials_testing ? $document->rawmaterials_testing : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                <div class="group-input">
                                        <label for="action-plan-grid">
                                            Revision History<button type="button" name="action-plan-grid"
                                                    id="rawmstp_revision">+</button>
                                        </label>
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="table_rawmstp_revision">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 2%">Sr. No.</th>
                                                        <th style="width: 12%">Revision No.</th>
                                                        <th style="width: 12%">Change Control No./ DCRF No</th>
                                                        <th style="width: 12%">Effective Date</th>
                                                        <th style="width: 30%">Reason of revision</th>
                                                        <th style="width: 3%">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @php
                                                        $serialNumber = 1;
                                                        $GtpData = isset($RevisionGridrawmstpData->data) && is_string($RevisionGridrawmstpData->data)
                                                            ? json_decode($RevisionGridrawmstpData->data, true)
                                                            : (is_array($RevisionGridrawmstpData->data) ? $RevisionGridrawmstpData->data : []);
                                                    @endphp

                                                    @if(!empty($GtpData))
                                                        @foreach($GtpData as $key => $gtp_data)
                                                            <tr>
                                                                <td>{{ $serialNumber++ }}</td>
                                                                <td><input type="text" name="revision_rawmstp_data[{{ $key }}][rev_rawmstp_no]" value="{{ $gtp_data['rev_rawmstp_no'] ?? '' }}"></td>
                                                                <td><input type="text" name="revision_rawmstp_data[{{ $key }}][change_ctrl_rawmstp_no]" value="{{ $gtp_data['change_ctrl_rawmstp_no'] ?? '' }}"></td>
                                                                <td><input type="date" name="revision_rawmstp_data[{{ $key }}][eff_date_rawmstp]" value="{{ $gtp_data['eff_date_rawmstp'] ?? '' }}"></td>
                                                                <td><input type="text" name="revision_rawmstp_data[{{ $key }}][rev_reason_rawmstp]" value="{{ $gtp_data['rev_reason_rawmstp'] ?? '' }}"></td>
                                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                            </tr>
                                                        @endforeach
                                                    @else
                                                        <tr>
                                                            <td>{{ $serialNumber++ }}</td>
                                                            <td><input type="text" name="revision_rawmstp_data[0][rev_rawmstp_no]"></td>
                                                            <td><input type="text" name="revision_rawmstp_data[0][change_ctrl_rawmstp_no]"></td>
                                                            <td><input type="date" name="revision_rawmstp_data[0][eff_date_rawmstp]"></td>
                                                            <td><input type="text" name="revision_rawmstp_data[0][rev_reason_rawmstp]"></td>
                                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                        </tr>
                                                    @endif
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <script>
                                        $(document).ready(function() {
                                            function updateSerialNumbers() {
                                                $('#table_rawmstp_revision tbody tr').each(function(index) {
                                                    $(this).find('td:first-child input').val(index + 1); // Update Sr. No
                                                    $(this).find('td:nth-child(2) input').attr('name', `gtp[${index}][test_gtp]`);
                                                });
                                            }

                                            $('#rawmstp_revision').click(function() {
                                                var serialNumber = $('#table_rawmstp_revision tbody tr').length + 1; // Get the next serial number
                                                var newRow = `
                                                    <tr>
                                                        <td><input disabled type="text" style="width:40px; text-align:center;" value="${serialNumber}"></td>
                                                        <td><input type="text" name="revision_rawmstp_data[${serialNumber - 1}][rev_rawmstp_no]" value=""></td>
                                                        <td><input type="text" name="revision_rawmstp_data[${serialNumber - 1}][change_ctrl_rawmstp_no]" value=""></td>
                                                        <td><input type="date" name="revision_rawmstp_data[${serialNumber - 1}][eff_date_rawmstp]" value=""></td>
                                                        <td><input type="text" name="revision_rawmstp_data[${serialNumber - 1}][rev_reason_rawmstp]" value=""></td>
                                                        <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                    </tr>`;

                                                $('#table_rawmstp_revision tbody').append(newRow);
                                            });

                                            // Remove row functionality
                                            $(document).on('click', '.removeRowBtn', function() {
                                                $(this).closest('tr').remove();
                                                updateSerialNumbers(); // Update serial numbers after removal
                                            });
                                        });
                                    </script>




                                
                            </div>
                        </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>




                <!-- Equipment Hold Time Study Protocol Tab -->

                    <div id="doc-eqpprotocol" class="tabcontent">
                        <div class="orig-head">
                            Equipment Hold Time Study Protocol
                        </div>
                        {{--
                        <div class="input-fields">
                            <div class="row">

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="eqp_approval">Approval</label>
                                        <textarea name="eqp_approval" {{ Helpers::isRevised($document->stage) }}>{{ $document->document_content ? $document->document_content->eqp_approval : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Approval' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Approval_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="eqp_objective">Objective</label>
                                        <textarea name="eqp_objective" {{ Helpers::isRevised($document->stage) }}>{{ $document->document_content ? $document->document_content->eqp_objective : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Objective' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="eqp_objective_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="eqp_scope">Scope</label>

                                        <textarea name="eqp_scope" {{ Helpers::isRevised($document->stage) }}>{{ $document->document_content ? $document->document_content->eqp_scope : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Scope' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="eqp_scope_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="eqpresponsibility" id="eqpresponsibility">
                                            Responsibility<button type="button" id="eqpresponsibilitybtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="eqpresponsibilitydiv">
                                            @if ($document->document_content && !empty($document->document_content->eqpresponsibility))
                                                @foreach (unserialize($document->document_content->eqpresponsibility) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleEqpresponsibilityBlock' : 'singleEqpresponsibilityBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="eqpresponsibility[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="eqpresponsibility[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subEqpResponsibilityAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleEqpresponsibilityBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="eqpresponsibility[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subEqpResponsibilityAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Responsibility' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="EqpResponsibilityAdd_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif



                                <div class="col-md-12">
                                    <div class="group-input">

                                        <label for="eqpdetails" id="eqpdetails">
                                            Equipment & Product details<button type="button" id="eqpdetailsbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="eqpdetailsdiv">
                                            @if ($document->document_content && !empty($document->document_content->eqpdetails))
                                                @foreach (unserialize($document->document_content->eqpdetails) as $key => $data)
                                                    @if (!empty($data))
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSingleEqpDetailsBlock' : 'singleEqpDetailsBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="eqpdetails[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="eqpdetails[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subEqpDetailsAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endif
                                                @endforeach
                                            @else
                                                <div class="singleEqpDetailsBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="eqpdetails[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subEqpDetailsAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif

                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Equipment & Product details' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;color: black;"

                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Eqpdetails_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="eqpsampling" id="eqpsampling">
                                            Sampling plan<button type="button" id="eqpsamplingbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="eqpsamplingdiv">
                                            @if ($document->document_content && !empty($document->document_content->eqpsampling))
                                                @foreach (unserialize($document->document_content->eqpsampling) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleEqpSamplingBlock' : 'singleEqpSamplingBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="eqpsampling[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="eqpsampling[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subEqpSamplingAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Sampling plan' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Sampling_plan_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Samplingprocedure" id="Samplingprocedure">
                                            Sampling and analysis procedure<button type="button" id="Samplingprocedurebtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="Samplingprocedurediv">
                                            @if ($document->document_content && !empty($document->document_content->Samplingprocedure))
                                                @foreach (unserialize($document->document_content->Samplingprocedure) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleSamplingprocedureBlock' : 'singleSamplingprocedureBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="Samplingprocedure[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="Samplingprocedure[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subSamplingprocedureAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Sampling and analysis procedure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Sampling_procedure_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="AcceptenceCriteria" id="AcceptenceCriteria">
                                            Acceptance Criteria<button type="button" id="AcceptenceCriteriabtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        @if ($document->document_content && !empty($document->document_content->AcceptenceCriteria))
                                            <div id="AcceptenceCriteriadiv">
                                                @foreach (unserialize($document->document_content->AcceptenceCriteria) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleAcceptenceCriteriaBlock' : 'singleAcceptenceCriteriaBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="AcceptenceCriteria[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="AcceptenceCriteria[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>

                                                                <div class="col-sm-1">
                                                                    <button type="button" class="subAcceptenceCriteriaAdd"
                                                                        name="button"
                                                                        {{ Helpers::isRevised($document->stage) }}>+</button>
                                                                </div>

                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            </div>
                                        @else
                                            <div class="singleAcceptenceCriteriaBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="AcceptenceCriteria[]" class="myclassname"></textarea>
                                                    </div>

                                                    <div class="col-sm-1">
                                                        <button type="button" class="subAcceptenceCriteriaAdd" name="button"
                                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                                    </div>

                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif

                                    <div id="AcceptenceCriteriadiv"></div>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Acceptance Criteria' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text"
                                                name="Acceptance_Criteria_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="EnvironmentalConditions" id="EnvironmentalConditions">
                                            Environmental Conditions<button type="button" id="EnvironmentalConditionsbtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="EnvironmentalConditionsdiv">
                                            @if ($document->document_content && !empty($document->document_content->EnvironmentalConditions))
                                                @foreach (unserialize($document->document_content->EnvironmentalConditions) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleEnvironmentalConditionsBlock' : 'singleEnvironmentalConditionsBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="EnvironmentalConditions[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="EnvironmentalConditions[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subEnvironmentalConditionsAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleEnvironmentalConditionsBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="EnvironmentalConditions[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subEnvironmentalConditionsAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Environmental Conditions' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Environmental_Conditions_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="eqpdetailsdeviation" id="eqpdetailsdeviation">
                                            Deviation (if any)<button type="button" id="eqpdetailsdeviationbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="eqpdetailsdeviationdiv">
                                            @if ($document->document_content && !empty($document->document_content->eqpdetailsdeviation))
                                                @foreach (unserialize($document->document_content->eqpdetailsdeviation) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleEqpdetailsdeviationBlock' : 'singleEqpdetailsdeviationBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="eqpdetailsdeviation[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="eqpdetailsdeviation[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subEqpdetailsdeviationAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleEqpdetailsdeviationBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="eqpdetailsdeviation[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subEqpdetailsdeviationAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Deviation (if any)' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Deviation_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="eqpdetailschangecontrol" id="eqpdetailschangecontrol">
                                            Change Control ( If Any)<button type="button" id="eqpdetailschangecontrolbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="eqpdetailschangecontroldiv">
                                            @if ($document->document_content && !empty($document->document_content->eqpdetailschangecontrol))
                                                @foreach (unserialize($document->document_content->eqpdetailschangecontrol) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subEqpdetailschangecontrolAdd' : 'singleEqpdetailschangecontrolBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="eqpdetailschangecontrol[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="eqpdetailschangecontrol[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subEqpdetailschangecontrolAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleEqpdetailschangecontrolBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="eqpdetailschangecontrol[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subEqpdetailschangecontrolAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Change Control ( If Any)' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Change_Control_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="eqpdetailssummary" id="eqpdetailssummary">
                                            Summary<button type="button" id="eqpdetailssummarybtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="eqpdetailssummarydiv">
                                            @if ($document->document_content && !empty($document->document_content->eqpdetailssummary))
                                                @foreach (unserialize($document->document_content->eqpdetailssummary) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleEqpdetailssummaryBlock' : 'singleEqpdetailssummaryBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="eqpdetailssummary[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="eqpdetailssummary[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subEqpdetailssummaryAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleEqpdetailssummaryBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="eqpdetailssummary[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subEqpdetailssummaryAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Summary' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Summary_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="eqpdetailsconclusion" id="eqpdetailsconclusion">
                                            Conclusion<button type="button" id="eqpdetailsconclusionbtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="eqpdetailsconclusiondiv">
                                            @if ($document->document_content && !empty($document->document_content->eqpdetailsconclusion))
                                                @foreach (unserialize($document->document_content->eqpdetailsconclusion) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleEqpdetailsconclusionBlock' : 'singleEqpdetailsconclusionBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="eqpdetailsconclusion[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="eqpdetailsconclusion[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subeqpdetailsconclusionAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleEqpdetailsconclusionBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="eqpdetailsconclusion[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subeqpdetailsconclusionAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Conclusion' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="Conclusion_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="eqpdetailstraining" id="eqpdetailstraining">
                                            Training<button type="button" id="eqpdetailstrainingbtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>

                                        <div id="eqpdetailstrainingdiv">
                                            @if ($document->document_content && !empty($document->document_content->eqpdetailstraining))
                                                @foreach (unserialize($document->document_content->eqpdetailstraining) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSingleEqpdetailstrainingBlock' : 'singleEqpdetailstrainingBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="eqpdetailstraining[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea type="text" name="eqpdetailstraining[]" class="" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button class="btn btn-dark subeqpdetailstrainingAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleEqpdetailstrainingBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea type="text" name="eqpdetailstraining[]" class=""></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subeqpdetailstrainingAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Training' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                @if (Auth::user()->role != 3 && $document->stage < 8)  <div
                                        class="comment">
                                        <div>
                                            <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at
                                                {{ date('d-M-Y h:i:s') }}
                                            </p>

                                            <input class="input-field" type="text" name="training_comment">
                                        </div>
                                        <div class="button">Add Comment</div>
                                    </div>
                                @endif











                            </div>
                        </div>
                        --}}


                        <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="attachment_ehtsprtDatassp">
                                            @if ($document->attachment_ehtsprt)
                                                @foreach(json_decode($document->attachment_ehtsprt) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_attachment_ehtsprt[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="attachment_ehtsprtData" style="cursor: pointer;">Add</label>
                                            <input type="file" id="attachment_ehtsprtData" name="attachment_ehtsprt[]"
                                                oninput="addMultipleFiles(this, 'attachment_ehtsprtDatassp')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_attachment_ehtsprt" name="deleted_attachment_ehtsprt" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_attachment_ehtsprt');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>
                        <div class="button-block">
                                    <button type="submit" name="submit" value="save" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                </div>
                    </div>

         <!---------------------------------------------- Process Validation Report tab ----------------------------------------->

         <div id="doc_pvr" class="tabcontent">
                    <div class="orig-head">
                    Process Validation Report
                    </div>
                        <div class="input-fields">

                                <div class="row">

                                {{--
                                    <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="purpose">Generic Name </label>
                                                <input type="text" name="generic_pvr" value="{{$document->document_content->generic_pvr}}">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">Product Code</label>
                                                <input type="text" name="product_code_pvr" value="{{$document->document_content->product_code_pvr}}">
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">Std. Batch size </label>
                                                <input type="text" name="std_batch_pvr" value="{{$document->document_content->std_batch_pvr}}">
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">Category</label>
                                                <input type="text" name="category_pvr" value="{{$document->document_content->category_pvr}}">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">Label Claim  </label>
                                                <input type="text" name="label_claim_pvr" value="{{$document->document_content->label_claim_pvr}}">
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">Market</label>
                                                <input type="text" name="market_pvr" value="{{$document->document_content->market_pvr}}">
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">Shelf Life</label>
                                                <input type="text" name="shelf_life_pvr" value="{{$document->document_content->shelf_life_pvr}}">
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">BMR No.</label>
                                                <input type="text" name="bmr_no_pvr" value="{{$document->document_content->bmr_no_pvr}}">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">MFR No.</label>
                                                <input type="text" name="mfr_no_pvr" value="{{$document->document_content->mfr_no_pvr}}">
                                            </div>
                                        </div>





                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="purpose_pvr" id="purpose_pvr">
                                                Purpose  <button type="button" id="purpose_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="purpose_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->purpose_pvr))
                                                    @foreach (unserialize($document->document_content->purpose_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSinglepurpose_pvrBlock' : 'singlepurpose_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="purpose_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="purpose_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subpurpose_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singlepurpose_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="purpose_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subpurpose_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'purpose_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>



                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="scope_pvr" id="scope_pvr">
                                                Scope  <button type="button" id="scope_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="scope_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->scope_pvr))
                                                    @foreach (unserialize($document->document_content->scope_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSinglescope_pvrBlock' : 'singlescope_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="scope_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="scope_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subscope_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singlescope_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="scope_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subscope_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'scope_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>



                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="batchdetail_pvr" id="batchdetail_pvr">
                                            Batch details  <button type="button" id="batchdetail_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="batchdetail_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->batchdetail_pvr))
                                                    @foreach (unserialize($document->document_content->batchdetail_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSinglebatchdetail_pvrBlock' : 'singlebatchdetail_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="batchdetail_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="batchdetail_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subbatchdetail_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singlebatchdetail_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="batchdetail_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subbatchdetail_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'batchdetail_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>




                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="refrence_document_pvr" id="refrence_document_pvr">
                                            Reference Document <button type="button" id="refrence_document_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="refrence_document_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->refrence_document_pvr))
                                                    @foreach (unserialize($document->document_content->refrence_document_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSinglerefrence_document_pvrBlock' : 'singlerefrence_document_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="refrence_document_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="refrence_document_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subrefrence_document_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singlerefrence_document_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="refrence_document_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subrefrence_document_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'refrence_document_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>


                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="active_raw_material_pvr" id="active_raw_material_pvr">
                                            Active raw material approved vendor details <button type="button" id="active_raw_material_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="active_raw_material_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->active_raw_material_pvr))
                                                    @foreach (unserialize($document->document_content->active_raw_material_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSingleactive_raw_material_pvrBlock' : 'singleactive_raw_material_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="active_raw_material_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="active_raw_material_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subactive_raw_material_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singleactive_raw_material_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="active_raw_material_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subactive_raw_material_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'active_raw_material_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>



                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="primary_packingmaterial_pvr" id="primary_packingmaterial_pvr">
                                            Primary packing material approved vendor details <button type="button" id="primary_packingmaterial_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="primary_packingmaterial_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->primary_packingmaterial_pvr))
                                                    @foreach (unserialize($document->document_content->primary_packingmaterial_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSingleprimary_packingmaterial_pvrBlock' : 'singleprimary_packingmaterial_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="primary_packingmaterial_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="primary_packingmaterial_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subprimary_packingmaterial_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singleprimary_packingmaterial_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="primary_packingmaterial_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subprimary_packingmaterial_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'primary_packingmaterial_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>





                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="used_equipment_calibration_pvr" id="used_equipment_calibration_pvr">
                                            Used Equipment Calibration and  Qualification status <button type="button" id="used_equipment_calibration_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="used_equipment_calibration_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->used_equipment_calibration_pvr))
                                                    @foreach (unserialize($document->document_content->used_equipment_calibration_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSingleused_equipment_calibration_pvrBlock' : 'singleused_equipment_calibration_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="used_equipment_calibration_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="used_equipment_calibration_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subused_equipment_calibration_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singleused_equipment_calibration_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="used_equipment_calibration_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subused_equipment_calibration_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'used_equipment_calibration_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>



                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="result_of_intermediate_pvr" id="result_of_intermediate_pvr">
                                            Results of intermediate Product <button type="button" id="result_of_intermediate_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="result_of_intermediate_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->result_of_intermediate_pvr))
                                                    @foreach (unserialize($document->document_content->result_of_intermediate_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSingleresult_of_intermediate_pvrBlock' : 'singleresult_of_intermediate_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="result_of_intermediate_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="result_of_intermediate_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subresult_of_intermediate_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singleresult_of_intermediate_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="result_of_intermediate_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subresult_of_intermediate_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'result_of_intermediate_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>



                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="result_of_finished_product_pvr" id="result_of_finished_product_pvr">
                                            Result of Finished Product <button type="button" id="result_of_finished_product_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="result_of_finished_product_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->result_of_finished_product_pvr))
                                                    @foreach (unserialize($document->document_content->result_of_finished_product_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSingleresult_of_finished_product_pvrBlock' : 'singleresult_of_finished_product_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="result_of_finished_product_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="result_of_finished_product_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subresult_of_finished_product_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singleresult_of_finished_product_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="result_of_finished_product_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subresult_of_finished_product_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'result_of_finished_product_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>



                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="result_of_packing_finished_pvr" id="result_of_packing_finished_pvr">
                                            Results Of Packing (Finished product) <button type="button" id="result_of_packing_finished_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="result_of_packing_finished_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->result_of_packing_finished_pvr))
                                                    @foreach (unserialize($document->document_content->result_of_packing_finished_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSingleresult_of_packing_finished_pvrBlock' : 'singleresult_of_packing_finished_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="result_of_packing_finished_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="result_of_packing_finished_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subresult_of_packing_finished_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singleresult_of_packing_finished_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="result_of_packing_finished_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subresult_of_packing_finished_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'result_of_packing_finished_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>




                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="criticalprocess_parameter_pvr" id="criticalprocess_parameter_pvr">
                                            Critical process parameters & Critical quality attributes <button type="button" id="criticalprocess_parameter_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="criticalprocess_parameter_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->criticalprocess_parameter_pvr))
                                                    @foreach (unserialize($document->document_content->criticalprocess_parameter_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSinglecriticalprocess_parameter_pvrBlock' : 'singlecriticalprocess_parameter_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="criticalprocess_parameter_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="criticalprocess_parameter_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subcriticalprocess_parameter_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singlecriticalprocess_parameter_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="criticalprocess_parameter_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subcriticalprocess_parameter_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'criticalprocess_parameter_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>



                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="yield_at_various_stage_pvr" id="yield_at_various_stage_pvr">
                                            Yield at various stages <button type="button" id="yield_at_various_stage_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="yield_at_various_stage_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->yield_at_various_stage_pvr))
                                                    @foreach (unserialize($document->document_content->yield_at_various_stage_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSingleyield_at_various_stage_pvrBlock' : 'singleyield_at_various_stage_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="yield_at_various_stage_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="yield_at_various_stage_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subyield_at_various_stage_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singleyield_at_various_stage_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="yield_at_various_stage_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subyield_at_various_stage_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'yield_at_various_stage_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>




                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="hold_time_study_pvr" id="hold_time_study_pvr">
                                            Hold time study<button type="button" id="hold_time_study_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="hold_time_study_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->hold_time_study_pvr))
                                                    @foreach (unserialize($document->document_content->hold_time_study_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSinglehold_time_study_pvrBlock' : 'singlehold_time_study_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="hold_time_study_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="hold_time_study_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subhold_time_study_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singlehold_time_study_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="hold_time_study_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subhold_time_study_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'hold_time_study_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>



                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="cleaningvalidation_pvr" id="cleaningvalidation_pvr">
                                            Cleaning validation<button type="button" id="cleaningvalidation_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="cleaningvalidation_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->cleaningvalidation_pvr))
                                                    @foreach (unserialize($document->document_content->cleaningvalidation_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSinglecleaningvalidation_pvrBlock' : 'singlecleaningvalidation_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="cleaningvalidation_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="cleaningvalidation_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subcleaningvalidation_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singlecleaningvalidation_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="cleaningvalidation_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subcleaningvalidation_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'cleaningvalidation_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>



                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="stability_study_pvr" id="stability_study_pvr">
                                            Stability study<button type="button" id="stability_study_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="stability_study_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->stability_study_pvr))
                                                    @foreach (unserialize($document->document_content->stability_study_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSinglestability_study_pvrBlock' : 'singlestability_study_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="stability_study_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="stability_study_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark substability_study_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singlestability_study_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="stability_study_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark substability_study_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'stability_study_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>



                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="deviation_if_any_pvr" id="deviation_if_any_pvr">
                                            Deviation (If any)<button type="button" id="deviation_if_any_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="deviation_if_any_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->deviation_if_any_pvr))
                                                    @foreach (unserialize($document->document_content->deviation_if_any_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSingledeviation_if_any_pvrBlock' : 'singledeviation_if_any_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="deviation_if_any_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="deviation_if_any_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subdeviation_if_any_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singledeviation_if_any_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="deviation_if_any_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subdeviation_if_any_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'deviation_if_any_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>



                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="changecontrol_pvr" id="changecontrol_pvr">
                                            Change Control ( If any)<button type="button" id="changecontrol_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="changecontrol_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->changecontrol_pvr))
                                                    @foreach (unserialize($document->document_content->changecontrol_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSinglechangecontrol_pvrBlock' : 'singlechangecontrol_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="changecontrol_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="changecontrol_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subchangecontrol_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singlechangecontrol_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="changecontrol_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subchangecontrol_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'changecontrol_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>




                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="summary_pvr" id="summary_pvr">
                                            Summary<button type="button" id="summary_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="summary_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->summary_pvr))
                                                    @foreach (unserialize($document->document_content->summary_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSinglesummary_pvrBlock' : 'singlesummary_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="summary_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="summary_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subsummary_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singlesummary_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="summary_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subsummary_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'summary_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>




                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="conclusion_pvr" id="conclusion_pvr">
                                            Conclusion<button type="button" id="conclusion_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="conclusion_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->conclusion_pvr))
                                                    @foreach (unserialize($document->document_content->conclusion_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSingleconclusion_pvrBlock' : 'singleconclusion_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="conclusion_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="conclusion_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subconclusion_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singleconclusion_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="conclusion_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subconclusion_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'conclusion_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>




                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="proposed_parameter_upcoming_batch_pvr" id="proposed_parameter_upcoming_batch_pvr">
                                            Proposed parameters for upcoming batches<button type="button" id="proposed_parameter_upcoming_batch_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="proposed_parameter_upcoming_batch_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->proposed_parameter_upcoming_batch_pvr))
                                                    @foreach (unserialize($document->document_content->proposed_parameter_upcoming_batch_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSingleproposed_parameter_upcoming_batch_pvrBlock' : 'singleproposed_parameter_upcoming_batch_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="proposed_parameter_upcoming_batch_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="proposed_parameter_upcoming_batch_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subproposed_parameter_upcoming_batch_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singleproposed_parameter_upcoming_batch_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="proposed_parameter_upcoming_batch_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subproposed_parameter_upcoming_batch_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'proposed_parameter_upcoming_batch_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>


                                    <div class="col-md-12">
                                        <div class="group-input">
                                            <label for="report_approval_pvr" id="report_approval_pvr">
                                            Report Approval<button type="button" id="report_approval_pvrbtnadd" name="button"
                                                    {{ Helpers::isRevised($document->stage) }}>+</button>
                                            </label>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                    require completion</small></div>
                                            <div id="report_approval_pvrdiv">
                                                @if ($document->document_content && !empty($document->document_content->report_approval_pvr))
                                                    @foreach (unserialize($document->document_content->report_approval_pvr) as $key => $data)
                                                        <div
                                                            class="{{ str_contains($key, 'sub') ? 'subSinglereport_approval_pvrBlock' : 'singlereport_approval_pvrBlock' }}">
                                                            @if (str_contains($key, 'sub'))
                                                                <div class="resrow row">
                                                                    <div class="col-6">
                                                                        <textarea name="report_approval_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-1">
                                                                        <button
                                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @else
                                                                <div class="row">
                                                                    <div class="col-sm-10">
                                                                        <textarea name="report_approval_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-dark subreport_approval_pvrAdd">+</button>
                                                                    </div>
                                                                    <div class="col-sm-1">
                                                                        <button
                                                                            class="btn btn-danger removeAllBlocks">Remove</button>
                                                                    </div>
                                                                </div>
                                                            @endif
                                                        </div>
                                                    @endforeach
                                                @else
                                                    <div class="singlereport_approval_pvrBlock">
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="report_approval_pvr[]" class="myclassname"></textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button class="btn btn-dark subreport_approval_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>

                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'report_approval_pvr' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>
                                    --}}
                                    <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="file_attach_pvrDatassp">
                                            @if ($document->file_attach_pvr)
                                                @foreach(json_decode($document->file_attach_pvr) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_file_attach_pvr[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="file_attach_pvrData" style="cursor: pointer;">Add</label>
                                            <input type="file" id="file_attach_pvrData" name="file_attach_pvr[]"
                                                oninput="addMultipleFiles(this, 'file_attach_pvrDatassp')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_file_attach_pvr" name="deleted_file_attach_pvr" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_file_attach_pvr');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>

                            <div class="button-block">
                            <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                            <button type="button" class="backButton" onclick="previousStep()">Back</button>
                            <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                            <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                </a>
                            </button>
                        </div>
                </div>
            </div>
        </div>
        <!---------------------------------------------- cleaning validation protocol-doc tab ----------------------------------------->



        <div id="doc_cvpd" class="tabcontent">
                    <div class="orig-head">
                    Cleaning Validation Protocol
                    </div>
                <div class="input-fields">
                    <div class="row">


                        {{--
                         <div class="col-md-12">
                                <div class="group-input">
                                    <label for="objective_cvpd" id="objective_cvpd">
                                    Objective   <button type="button" id="objective_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="objective_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->objective_cvpd))
                                            @foreach (unserialize($document->document_content->objective_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleobjective_cvpdBlock' : 'singleobjective_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="objective_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="objective_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subobjective_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleobjective_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="objective_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subobjective_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'objective_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="scope_cvpd" id="scope_cvpd">
                                    Scope  <button type="button" id="scope_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="scope_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->scope_cvpd))
                                            @foreach (unserialize($document->document_content->scope_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSinglescope_cvpdBlock' : 'singlescope_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="scope_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="scope_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subscope_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singlescope_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="scope_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subscope_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'scope_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="purpose_cvpd" id="purpose_cvpd">
                                    Purpose  <button type="button" id="purpose_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="purpose_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->purpose_cvpd))
                                            @foreach (unserialize($document->document_content->purpose_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSinglepurpose_cvpdBlock' : 'singlepurpose_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="purpose_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="purpose_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subpurpose_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singlepurpose_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="purpose_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subpurpose_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'purpose_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="responsibilities_cvpd" id="responsibilities_cvpd">
                                    Responsibilities <button type="button" id="responsibilities_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="responsibilities_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->responsibilities_cvpd))
                                            @foreach (unserialize($document->document_content->responsibilities_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleresponsibilities_cvpdBlock' : 'singleresponsibilities_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="responsibilities_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="responsibilities_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subresponsibilities_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleresponsibilities_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="responsibilities_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subresponsibilities_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'responsibilities_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>




                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="identification_sensitive_product_contamination_cvpd" id="identification_sensitive_product_contamination_cvpd">
                                    Identification of most sensitive product for contamination on
                                        the basis of maximum daily dose & minimum batch size <button type="button" id="identification_sensitive_product_contamination_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="identification_sensitive_product_contamination_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->identification_sensitive_product_contamination_cvpd))
                                            @foreach (unserialize($document->document_content->identification_sensitive_product_contamination_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleidentification_sensitive_product_contamination_cvpdBlock' : 'singleidentification_sensitive_product_contamination_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="identification_sensitive_product_contamination_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="identification_sensitive_product_contamination_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subidentification_sensitive_product_contamination_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleidentification_sensitive_product_contamination_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="identification_sensitive_product_contamination_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subidentification_sensitive_product_contamination_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'identification_sensitive_product_contamination_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>


                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="matrix_worstcase_approach_cvpd" id="matrix_worstcase_approach_cvpd">
                                    Matrix Worst Case Approach Table- based on Risk analysis <button type="button" id="matrix_worstcase_approach_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="matrix_worstcase_approach_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->matrix_worstcase_approach_cvpd))
                                            @foreach (unserialize($document->document_content->matrix_worstcase_approach_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSinglematrix_worstcase_approach_cvpdBlock' : 'singlematrix_worstcase_approach_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="matrix_worstcase_approach_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="matrix_worstcase_approach_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark submatrix_worstcase_approach_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singlematrix_worstcase_approach_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="matrix_worstcase_approach_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark submatrix_worstcase_approach_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'matrix_worstcase_approach_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="acceptance_criteria_cvpd" id="acceptance_criteria_cvpd">
                                    Acceptance criteria <button type="button" id="acceptance_criteria_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="acceptance_criteria_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->acceptance_criteria_cvpd))
                                            @foreach (unserialize($document->document_content->acceptance_criteria_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleacceptance_criteria_cvpdBlock' : 'singleacceptance_criteria_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="acceptance_criteria_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="acceptance_criteria_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subacceptance_criteria_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleacceptance_criteria_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="acceptance_criteria_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subacceptance_criteria_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'acceptance_criteria_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>





                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="list_equipment_internal_surface_cvpd" id="list_equipment_internal_surface_cvpd">
                                    List of equipment  with internal Surface area of each equipment in sq.cm <button type="button" id="list_equipment_internal_surface_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="list_equipment_internal_surface_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->list_equipment_internal_surface_cvpd))
                                            @foreach (unserialize($document->document_content->list_equipment_internal_surface_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSinglelist_equipment_internal_surface_cvpdBlock' : 'singlelist_equipment_internal_surface_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="list_equipment_internal_surface_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="list_equipment_internal_surface_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark sublist_equipment_internal_surface_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singlelist_equipment_internal_surface_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="list_equipment_internal_surface_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark sublist_equipment_internal_surface_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'list_equipment_internal_surface_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="identification_clean_surfaces_cvpd" id="identification_clean_surfaces_cvpd">
                                    Identification of difficult to clean surfaces of equipment (Table & drawing) facility<button type="button" id="identification_clean_surfaces_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="identification_clean_surfaces_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->identification_clean_surfaces_cvpd))
                                            @foreach (unserialize($document->document_content->identification_clean_surfaces_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleidentification_clean_surfaces_cvpdBlock' : 'singleidentification_clean_surfaces_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="identification_clean_surfaces_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="identification_clean_surfaces_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subidentification_clean_surfaces_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleidentification_clean_surfaces_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="identification_clean_surfaces_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subidentification_clean_surfaces_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'identification_clean_surfaces_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="identification_clean_surfaces_cvpd" id="identification_clean_surfaces_cvpd">
                                    Identification of difficult to clean surfaces of equipment (Table & drawing) facility <button type="button" id="identification_clean_surfaces_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="identification_clean_surfaces_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->identification_clean_surfaces_cvpd))
                                            @foreach (unserialize($document->document_content->identification_clean_surfaces_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleidentification_clean_surfaces_cvpdBlock' : 'singleidentification_clean_surfaces_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="identification_clean_surfaces_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="identification_clean_surfaces_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subidentification_clean_surfaces_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleidentification_clean_surfaces_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="identification_clean_surfaces_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subidentification_clean_surfaces_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'identification_clean_surfaces_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="sampling_method_cvpd" id="sampling_method_cvpd">
                                    The sampling methods used as per product specific requirement <button type="button" id="sampling_method_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="sampling_method_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->sampling_method_cvpd))
                                            @foreach (unserialize($document->document_content->sampling_method_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSinglesampling_method_cvpdBlock' : 'singlesampling_method_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="sampling_method_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="sampling_method_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subsampling_method_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singlesampling_method_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="sampling_method_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subsampling_method_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'sampling_method_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>




                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="recovery_studies_cvpd" id="recovery_studies_cvpd">
                                    Recovery studies<button type="button" id="recovery_studies_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="recovery_studies_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->recovery_studies_cvpd))
                                            @foreach (unserialize($document->document_content->recovery_studies_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSinglerecovery_studies_cvpdBlock' : 'singlerecovery_studies_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="recovery_studies_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="recovery_studies_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subrecovery_studies_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singlerecovery_studies_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="recovery_studies_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subrecovery_studies_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'recovery_studies_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="calculating_carry_over_cvpd" id="calculating_carry_over_cvpd">
                                    Calculating carry over for swab for routine monitoring<button type="button" id="calculating_carry_over_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="calculating_carry_over_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->calculating_carry_over_cvpd))
                                            @foreach (unserialize($document->document_content->calculating_carry_over_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSinglecalculating_carry_over_cvpdBlock' : 'singlecalculating_carry_over_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="calculating_carry_over_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="calculating_carry_over_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subcalculating_carry_over_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singlecalculating_carry_over_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="calculating_carry_over_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subcalculating_carry_over_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'calculating_carry_over_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>




                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="calculating_rinse_analysis_cvpd" id="calculating_rinse_analysis_cvpd">
                                    Calculating carry over for rinse analysis for routine monitoring<button type="button" id="calculating_rinse_analysis_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="calculating_rinse_analysis_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->calculating_rinse_analysis_cvpd))
                                            @foreach (unserialize($document->document_content->calculating_rinse_analysis_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSinglecalculating_rinse_analysis_cvpdBlock' : 'singlecalculating_rinse_analysis_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="calculating_rinse_analysis_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="calculating_rinse_analysis_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subcalculating_rinse_analysis_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singlecalculating_rinse_analysis_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="calculating_rinse_analysis_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subcalculating_rinse_analysis_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'calculating_rinse_analysis_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="general_procedure_clean_cvpd" id="general_procedure_clean_cvpd">
                                    General Procedure to perform Cleaning Validation <button type="button" id="general_procedure_clean_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="general_procedure_clean_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->general_procedure_clean_cvpd))
                                            @foreach (unserialize($document->document_content->general_procedure_clean_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSinglegeneral_procedure_clean_cvpdBlock' : 'singlegeneral_procedure_clean_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="general_procedure_clean_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="general_procedure_clean_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subgeneral_procedure_clean_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singlegeneral_procedure_clean_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="general_procedure_clean_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subgeneral_procedure_clean_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'general_procedure_clean_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="analytical_method_validation_cvpd" id="analytical_method_validation_cvpd">
                                    Analytical method validation studies protocol & report<button type="button" id="analytical_method_validation_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="analytical_method_validation_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->analytical_method_validation_cvpd))
                                            @foreach (unserialize($document->document_content->analytical_method_validation_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleanalytical_method_validation_cvpdBlock' : 'singleanalytical_method_validation_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="analytical_method_validation_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="analytical_method_validation_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subanalytical_method_validation_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleanalytical_method_validation_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="analytical_method_validation_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subanalytical_method_validation_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'analytical_method_validation_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="list_cleaning_sop_cvpd" id="list_cleaning_sop_cvpd">
                                    List of cleaning SOPs & identification of variables<button type="button" id="list_cleaning_sop_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="list_cleaning_sop_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->list_cleaning_sop_cvpd))
                                            @foreach (unserialize($document->document_content->list_cleaning_sop_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSinglelist_cleaning_sop_cvpdBlock' : 'singlelist_cleaning_sop_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="list_cleaning_sop_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="list_cleaning_sop_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark sublist_cleaning_sop_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singlelist_cleaning_sop_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="list_cleaning_sop_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark sublist_cleaning_sop_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'list_cleaning_sop_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="clean_validation_exercise_cvpd" id="clean_validation_exercise_cvpd">
                                    Cleaning validation exercise<button type="button" id="clean_validation_exercise_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="clean_validation_exercise_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->clean_validation_exercise_cvpd))
                                            @foreach (unserialize($document->document_content->clean_validation_exercise_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleclean_validation_exercise_cvpdBlock' : 'singleclean_validation_exercise_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="clean_validation_exercise_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="clean_validation_exercise_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subclean_validation_exercise_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleclean_validation_exercise_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="clean_validation_exercise_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subclean_validation_exercise_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'clean_validation_exercise_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>




                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="evaluation_analytical_result_cvpd" id="evaluation_analytical_result_cvpd">
                                    Evaluation of analytical results of the samples<button type="button" id="evaluation_analytical_result_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="evaluation_analytical_result_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->evaluation_analytical_result_cvpd))
                                            @foreach (unserialize($document->document_content->evaluation_analytical_result_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleevaluation_analytical_result_cvpdBlock' : 'singleevaluation_analytical_result_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="evaluation_analytical_result_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="evaluation_analytical_result_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subevaluation_analytical_result_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleevaluation_analytical_result_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="evaluation_analytical_result_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subevaluation_analytical_result_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'evaluation_analytical_result_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>




                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="conclusion_pvr" id="conclusion_pvr">
                                    Conclusion<button type="button" id="conclusion_pvrbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="conclusion_pvrdiv">
                                        @if ($document->document_content && !empty($document->document_content->conclusion_pvr))
                                            @foreach (unserialize($document->document_content->conclusion_pvr) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleconclusion_pvrBlock' : 'singleconclusion_pvrBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="conclusion_pvr[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="conclusion_pvr[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subconclusion_pvrAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleconclusion_pvrBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="conclusion_pvr[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subconclusion_pvrAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'conclusion_pvr' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>




                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="summary_conclusion_cvpd" id="summary_conclusion_cvpd">
                                    Summary & conclusion<button type="button" id="summary_conclusion_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="summary_conclusion_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->summary_conclusion_cvpd))
                                            @foreach (unserialize($document->document_content->summary_conclusion_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSinglesummary_conclusion_cvpdBlock' : 'singlesummary_conclusion_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="summary_conclusion_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="summary_conclusion_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subsummary_conclusion_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singlesummary_conclusion_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="summary_conclusion_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subsummary_conclusion_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'summary_conclusion_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>


                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="training_cvpd" id="training_cvpd">
                                    Training<button type="button" id="training_cvpdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="training_cvpddiv">
                                        @if ($document->document_content && !empty($document->document_content->training_cvpd))
                                            @foreach (unserialize($document->document_content->training_cvpd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingletraining_cvpdBlock' : 'singletraining_cvpdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="training_cvpd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="training_cvpd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subtraining_cvpdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singletraining_cvpdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="training_cvpd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subtraining_cvpdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'training_cvpd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>

                     --}}
                     <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="attach_cvpdDataField">
                                            @if ($document->attach_cvpd)
                                                @foreach(json_decode($document->attach_cvpd) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_attach_cvpd[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="attach_cvpdData" style="cursor: pointer;">Add</label>
                                            <input type="file" id="attach_cvpdData" name="attach_cvpd[]" 
                                                oninput="addMultipleFiles(this, 'attach_cvpdDataField')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_attach_cvpd" name="deleted_attach_cvpd" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_attach_cvpd');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!---------------------------------------------- cleaning validation Report-doc tab ----------------------------------------->



        <div id="doc_cvrd" class="tabcontent">
                    <div class="orig-head">
                    Cleaning Validation Report
                    </div>
                <div class="input-fields">
                    <div class="row">


                   {{--

                    <div class="col-md-12">
                                <div class="group-input">
                                    <label for="objective_cvrd" id="objective_cvrd">
                                    Objective   <button type="button" id="objective_cvrdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="objective_cvrddiv">
                                        @if ($document->document_content && !empty($document->document_content->objective_cvrd))
                                            @foreach (unserialize($document->document_content->objective_cvrd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleobjective_cvrdBlock' : 'singleobjective_cvrdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="objective_cvrd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="objective_cvrd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subobjective_cvrdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleobjective_cvrdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="objective_cvrd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subobjective_cvrdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'objective_cvrd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="scope_cvrd" id="scope_cvrd">
                                    Scope  <button type="button" id="scope_cvrdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="scope_cvrddiv">
                                        @if ($document->document_content && !empty($document->document_content->scope_cvrd))
                                            @foreach (unserialize($document->document_content->scope_cvrd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSinglescope_cvrdBlock' : 'singlescope_cvrdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="scope_cvrd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="scope_cvrd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subscope_cvrdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singlescope_cvrdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="scope_cvrd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subscope_cvrdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'scope_cvrd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="purpose_cvrd" id="purpose_cvrd">
                                    Purpose  <button type="button" id="purpose_cvrdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="purpose_cvrddiv">
                                        @if ($document->document_content && !empty($document->document_content->purpose_cvrd))
                                            @foreach (unserialize($document->document_content->purpose_cvrd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSinglepurpose_cvrdBlock' : 'singlepurpose_cvrdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="purpose_cvrd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="purpose_cvrd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subpurpose_cvrdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singlepurpose_cvrdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="purpose_cvrd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subpurpose_cvrdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'purpose_cvrd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="responsibilities_cvrd" id="responsibilities_cvrd">
                                    Responsibilities <button type="button" id="responsibilities_cvrdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="responsibilities_cvrddiv">
                                        @if ($document->document_content && !empty($document->document_content->responsibilities_cvrd))
                                            @foreach (unserialize($document->document_content->responsibilities_cvrd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleresponsibilities_cvrdBlock' : 'singleresponsibilities_cvrdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="responsibilities_cvrd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="responsibilities_cvrd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subresponsibilities_cvrdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleresponsibilities_cvrdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="responsibilities_cvrd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subresponsibilities_cvrdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'responsibilities_cvrd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>




                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="analysis_methodology_cvrd" id="analysis_methodology_cvrd">
                                    Analysis Methodology <button type="button" id="analysis_methodology_cvrdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="analysis_methodology_cvrddiv">
                                        @if ($document->document_content && !empty($document->document_content->analysis_methodology_cvrd))
                                            @foreach (unserialize($document->document_content->analysis_methodology_cvrd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleanalysis_methodology_cvrdBlock' : 'singleanalysis_methodology_cvrdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="analysis_methodology_cvrd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="analysis_methodology_cvrd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subanalysis_methodology_cvrdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleanalysis_methodology_cvrdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="analysis_methodology_cvrd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subanalysis_methodology_cvrdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'analysis_methodology_cvrd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>


                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="recovery_study_report_cvrd" id="recovery_study_report_cvrd">
                                    Recovery Study Report<button type="button" id="recovery_study_report_cvrdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="recovery_study_report_cvrddiv">
                                        @if ($document->document_content && !empty($document->document_content->recovery_study_report_cvrd))
                                            @foreach (unserialize($document->document_content->recovery_study_report_cvrd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSinglerecovery_study_report_cvrdBlock' : 'singlerecovery_study_report_cvrdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="recovery_study_report_cvrd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="recovery_study_report_cvrd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subrecovery_study_report_cvrdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singlerecovery_study_report_cvrdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="recovery_study_report_cvrd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subrecovery_study_report_cvrdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'recovery_study_report_cvrd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="acceptance_critria_cvrd" id="acceptance_critria_cvrd">
                                    Acceptance Criteria <button type="button" id="acceptance_critria_cvrdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="acceptance_critria_cvrddiv">
                                        @if ($document->document_content && !empty($document->document_content->acceptance_critria_cvrd))
                                            @foreach (unserialize($document->document_content->acceptance_critria_cvrd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleacceptance_critria_cvrdBlock' : 'singleacceptance_critria_cvrdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="acceptance_critria_cvrd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="acceptance_critria_cvrd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subacceptance_critria_cvrdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleacceptance_critria_cvrdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="acceptance_critria_cvrd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subacceptance_critria_cvrdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'acceptance_critria_cvrd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>





                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="analytical_report_cvrd" id="analytical_report_cvrd">
                                    Analytical  Report <button type="button" id="analytical_report_cvrdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="analytical_report_cvrddiv">
                                        @if ($document->document_content && !empty($document->document_content->analytical_report_cvrd))
                                            @foreach (unserialize($document->document_content->analytical_report_cvrd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleanalytical_report_cvrdBlock' : 'singleanalytical_report_cvrdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="analytical_report_cvrd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="analytical_report_cvrd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subanalytical_report_cvrdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleanalytical_report_cvrdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="analytical_report_cvrd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subanalytical_report_cvrdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'analytical_report_cvrd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="physical_procedure_conformance_check_cvrd" id="physical_procedure_conformance_check_cvrd">
                                    Physical check & procedure conformance check<button type="button" id="physical_procedure_conformance_check_cvrdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="physical_procedure_conformance_check_cvrddiv">
                                        @if ($document->document_content && !empty($document->document_content->physical_procedure_conformance_check_cvrd))
                                            @foreach (unserialize($document->document_content->physical_procedure_conformance_check_cvrd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSinglephysical_procedure_conformance_check_cvrdBlock' : 'singlephysical_procedure_conformance_check_cvrdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="physical_procedure_conformance_check_cvrd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="physical_procedure_conformance_check_cvrd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subphysical_procedure_conformance_check_cvrdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singlephysical_procedure_conformance_check_cvrdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="physical_procedure_conformance_check_cvrd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subphysical_procedure_conformance_check_cvrdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'physical_procedure_conformance_check_cvrd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>



                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="conclusion_cvrd" id="conclusion_cvrd">
                                    Conclusion <button type="button" id="conclusion_cvrdbtnadd" name="button"
                                            {{ Helpers::isRevised($document->stage) }}>+</button>
                                    </label>
                                    <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                            require completion</small></div>
                                    <div id="conclusion_cvrddiv">
                                        @if ($document->document_content && !empty($document->document_content->conclusion_cvrd))
                                            @foreach (unserialize($document->document_content->conclusion_cvrd) as $key => $data)
                                                <div
                                                    class="{{ str_contains($key, 'sub') ? 'subSingleconclusion_cvrdBlock' : 'singleconclusion_cvrdBlock' }}">
                                                    @if (str_contains($key, 'sub'))
                                                        <div class="resrow row">
                                                            <div class="col-6">
                                                                <textarea name="conclusion_cvrd[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-1">
                                                                <button
                                                                    class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                            </div>
                                                        </div>
                                                    @else
                                                        <div class="row">
                                                            <div class="col-sm-10">
                                                                <textarea name="conclusion_cvrd[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-dark subconclusion_cvrdAdd">+</button>
                                                            </div>
                                                            <div class="col-sm-1">
                                                                <button
                                                                    class="btn btn-danger removeAllBlocks">Remove</button>
                                                            </div>
                                                        </div>
                                                    @endif
                                                </div>
                                            @endforeach
                                        @else
                                            <div class="singleconclusion_cvrdBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="conclusion_cvrd[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subconclusion_cvrdAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button
                                                            class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>

                                    @foreach ($history as $tempHistory)
                                        @if ($tempHistory->activity_type == 'conclusion_cvrd' && !empty($tempHistory->comment))
                                            @php
                                                $users_name = DB::table('users')
                                                    ->where('id', $tempHistory->user_id)
                                                    ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field"
                                                style="background: #ffff0061;
                                    color: black;"
                                                type="text" value="{{ $tempHistory->comment }}" disabled>
                                        @endif
                                    @endforeach
                                </div>
                            </div>


                    --}}

                    <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="file_attach_cvrdDatassp">
                                            @if ($document->file_attach_cvrd)
                                                @foreach(json_decode($document->file_attach_cvrd) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_file_attach_cvrd[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="file_attach_cvrdData" style="cursor: pointer;">Add</label>
                                            <input type="file" id="file_attach_cvrdData" name="file_attach_cvrd[]"
                                                oninput="addMultipleFiles(this, 'file_attach_cvrdDatassp')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_file_attach_cvrd" name="deleted_file_attach_cvrd" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_file_attach_cvrd');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>
            </div>
        </div>


  <!---------------------------------------------- stability study protocol tab ----------------------------------------->


             <div id="doc_ssp" class="tabcontent">
                            <div class="orig-head">
                            STABILITY STUDY PROTOCOL
                            </div>
                        <div class="input-fields">
                            <div class="row">



                           {{--

                                    <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="purpose">PRODUCT NAME  </label>
                                                <input type="text" name="product_name_ssp" value="{{$document->document_content->product_name_ssp}}">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">Protocol No.</label>
                                                <input type="text" name="protocol_no_ssp" value="{{$document->document_content->protocol_no_ssp}}">
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">Brand Name </label>
                                                <input type="text" name="brand_name_ssp" value="{{$document->document_content->brand_name_ssp}}">
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">Generic Name</label>
                                                <input type="text" name="generic_name_ssp" value="{{$document->document_content->generic_name_ssp}}">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">Label Claim  </label>
                                                <input type="text" name="label_claim_ssp" value="{{$document->document_content->label_claim_ssp}}">
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">FG Code</label>
                                                <input type="text" name="fg_code_ssp" value="{{$document->document_content->fg_code_ssp}}">
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">Pack Size</label>
                                                <input type="text" name="pack_size_ssp" value="{{$document->document_content->pack_size_ssp}}">
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">Shelf Life</label>
                                                <input type="text" name="shelf_life_ssp" value="{{$document->document_content->shelf_life_ssp}}">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">Market</label>
                                                <input type="text" name="market_ssp" value="{{$document->document_content->market_ssp}}">
                                            </div>
                                        </div>


                                        <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">Storage condition</label>
                                                <input type="text" name="storage_condition_ssp" value="{{$document->document_content->storage_condition_ssp}}">
                                            </div>
                                        </div>

                                        <div class="col-lg-6">
                                            <div class="group-input">
                                                <label for="change_related_to">PURPOSE</label>
                                                <select name="purpose_ssp" id="change_related_to">
                                                    <option value="">-- Select --</option>
                                                    <option value="New Product" {{ old('purpose_ssp', $document->document_content->purpose_ssp ?? '') == 'New Product' ? 'selected' : '' }}>New Product</option>
                                                    <option value="Change in Process" {{ old('purpose_ssp', $document->document_content->purpose_ssp ?? '') == 'Change in Process' ? 'selected' : '' }}>Change in Process</option>
                                                    <option value="Change in batch size" {{ old('purpose_ssp', $document->document_content->purpose_ssp ?? '') == 'Change in batch size' ? 'selected' : '' }}>Change in batch size</option>
                                                    <option value="Change in packing material" {{ old('purpose_ssp', $document->document_content->purpose_ssp ?? '') == 'Change in packing material' ? 'selected' : '' }}>Change in packing material</option>
                                                    <option value="Ongoing batch" {{ old('purpose_ssp', $document->document_content->purpose_ssp ?? '') == 'Ongoing batch' ? 'selected' : '' }}>Ongoing batch</option>
                                                    <option value="other" {{ old('purpose_ssp', $document->document_content->purpose_ssp ?? '') == 'other' ? 'selected' : '' }}>Other</option>
                                                </select>
                                            </div>
                                        </div>


                                        <div class="col-lg-6" id="other_specify_div" style="display:none;">
                                            <div class="group-input">
                                                <label for="other_specify">Please specify</label>
                                                <input type="text" name="specify_ssp" id="other_specify" value="{{ $document->document_content->specify_ssp ?? '' }}" placeholder="Specify if Other is selected">

                                            </div>
                                        </div>

                                                    <script>
                                                        $(document).ready(function() {
                                                            function toggleOtherSpecifyField() {
                                                                var changeRelatedTo = $('#change_related_to').val();
                                                                if (changeRelatedTo === 'other') {
                                                                    $('#other_specify_div').show();
                                                                } else {
                                                                    $('#other_specify_div').hide();
                                                                }
                                                            }

                                                            toggleOtherSpecifyField();

                                                            $('#change_related_to').change(function() {
                                                                toggleOtherSpecifyField();
                                                            });
                                                        });
                                                    </script>


                                        <div class="col-lg-6">
                                            <div class="group-input">
                                                <label for="change_related_to">SCOPE
                                            </label>
                                                <select name="scope_ssp" id="change_related_to">
                                                    <option value="">-- Select --</option>
                                                    <option value="Exhibit Batch" {{ old('scope_ssp', $document->document_content->scope_ssp ?? '') == 'Exhibit Batch' ? 'selected' : '' }}>Exhibit Batch</option>
                                                    <option value="Commercial Validation batch" {{ old('scope_ssp', $document->document_content->scope_ssp ?? '') == 'Commercial Validation batch' ? 'selected' : '' }}>Commercial Validation batch</option>
                                                    <option value="Commercial Annual batch" {{ old('scope_ssp', $document->document_content->scope_ssp ?? '') == 'Commercial Annual batch' ? 'selected' : '' }}>Commercial Annual batch</option>
                                                </select>

                                            </div>
                                        </div>






                                    <div class="col-md-12 mb-3">
                                            <div class="group-input">
                                                <label for="documentrefrence_ssp">DOCUMENT REFERENCES</label>
                                                <div><small class="text-primary">Please insert "NA" in the data field if it does
                                                        not require completion</small></div>
                                                <textarea name="documentrefrence_ssp" class="summernote">
                                                {{$document->document_content->documentrefrence_ssp}} </textarea>
                                            </div>
                                        </div>
                                    <div class="col-md-6">
                                            <div class="group-input">
                                                <label for="scope">REASON FOR STABILITY</label>
                                                <input type="text" name="reason_stability_ssp" value="{{$document->document_content->reason_stability_ssp}}">
                                            </div>
                                    </div>



                                    <div class="col-12">
                                <div class="group-input">
                                    <label for="batch_details">
                                        BATCH DETAILS
                                        <button type="button" id="BatchRecordSSP">+</button>
                                    </label>
                                    <div class="table-responsive">
                                        <table class="table table-bordered" id="batch_detailData_ssp" style="width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th style="width: 5%">Sr.No</th>
                                                    <th style="width: 20%">Batch Number</th>
                                                    <th style="width: 20%">Batch Size</th>
                                                    <th style="width: 20%">Manufacturing Date</th>
                                                    <th style="width: 20%">Expiry Date</th>
                                                    <th style="width: 10%">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @php
                                                    // Ensure $BATCH_DETAILS_ssp->data is an array
                                                    $batchData = !empty($BATCH_DETAILS_ssp) && is_string($BATCH_DETAILS_ssp->data)
                                                                ? json_decode($BATCH_DETAILS_ssp->data, true)
                                                                : (is_array($BATCH_DETAILS_ssp->data) ? $BATCH_DETAILS_ssp->data : []);
                                                @endphp

                                                @if (!empty($batchData))
                                                    @foreach ($batchData as $index => $spec)
                                                        <tr>
                                                            <td><input disabled type="text" name="batch_details_ssp[{{ $index }}][serial]" value="{{ $index + 1 }}"></td>
                                                            <td><input type="text" name="batch_details_ssp[{{ $index }}][batch_no]" value="{{ $spec['batch_no'] ?? '' }}"></td>
                                                            <td><input type="text" name="batch_details_ssp[{{ $index }}][batch_size]" value="{{ $spec['batch_size'] ?? '' }}"></td>
                                                            <td><input type="text" class="datepicker" name="batch_details_ssp[{{ $index }}][manufacture_date]" placeholder="DD-MM-YYYY" value="{{ $spec['manufacture_date'] ?? '' }}"></td>
                                                            <td><input type="text" class="datepicker" name="batch_details_ssp[{{ $index }}][expiry_date]" placeholder="DD-MM-YYYY" value="{{ $spec['expiry_date'] ?? '' }}"></td>
                                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                        </tr>
                                                    @endforeach
                                                @else
                                                    <tr class="no-data">
                                                        <td colspan="6" style="text-align: center;">No data found</td>
                                                    </tr>
                                                @endif
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>


                            <script>
                                $(document).ready(function() {
                                    function initializeDatepickers() {
                                        $(".datepicker").datepicker({
                                            dateFormat: "dd-M-yy"
                                        });
                                    }

                                    $('#BatchRecordSSP').click(function(e) {
                                        e.preventDefault();
                                        var tableBody = $('#batch_detailData_ssp tbody');
                                        var rowCount = tableBody.children('tr').not('.no-data').length;

                                        if (rowCount === 0) {
                                            tableBody.find('.no-data').remove();
                                        }

                                        var newRow = `
                                            <tr>
                                                <td><input disabled type="text" name="batch_details_ssp[${rowCount}][serial]" value="${rowCount + 1}"></td>
                                                <td><input type="text" name="batch_details_ssp[${rowCount}][batch_no]"></td>
                                                <td><input type="text" name="batch_details_ssp[${rowCount}][batch_size]"></td>
                                                <td><input type="text" class="datepicker" name="batch_details_ssp[${rowCount}][manufacture_date]" placeholder="DD-MM-YYYY"></td>
                                                <td><input type="text" class="datepicker" name="batch_details_ssp[${rowCount}][expiry_date]" placeholder="DD-MM-YYYY"></td>
                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                            </tr>`;

                                        tableBody.append(newRow);
                                        initializeDatepickers(); // Apply datepicker to new row
                                    });

                                    // Remove row functionality
                                    $(document).on('click', '.removeRowBtn', function() {
                                        $(this).closest('tr').remove();

                                        // Renumber serial numbers after removal
                                        $('#batch_detailData_ssp tbody tr').each(function(index) {
                                            $(this).find('td:first input').val(index + 1);
                                        });

                                        // If all rows are removed, show "No data found"
                                        if ($('#batch_detailData_ssp tbody tr').length === 0) {
                                            $('#batch_detailData_ssp tbody').append('<tr class="no-data"><td colspan="6" style="text-align: center;">No data found</td></tr>');
                                        }
                                    });

                                    // Initialize datepickers on page load
                                    initializeDatepickers();
                                });
                            </script>







                                    <div class="col-12">
                                        <div class="group-input">
                                            <label for="Specification Details">

                                                DETAILS
                                                <button type="button" id="SecondbatchDetailData_ssp">+</button>
                                            </label>
                                            <div class="table-responsive">
                                                <table class="table table-bordered" id="batch_detailRecord_ssp" style="width: 100%;">
                                                    <thead>
                                                            <tr>
                                                                <th style="width: 2%">Sr.No</th>
                                                                <th style="width: 12%">Stability station</th>
                                                                <th style="width: 12%">Required tests</th>

                                                                <th style="width: 3%">Action</th>

                                                            </tr>
                                                    </thead>
                                                    <tbody>
                                                        @if (!empty($DETAILS_ssp) && is_array($DETAILS_ssp->data))
                                                            @foreach ($DETAILS_ssp->data as $index => $spec)
                                                                <tr>
                                                                    <td><input disabled type="text" name="batch_detaildata_ssp[{{ $index }}][serial]" value="{{ $index + 1 }}"></td>
                                                                    <td><input type="text" name="batch_detaildata_ssp[{{ $index }}][stability_station]" value="{{ $spec['stability_station'] }}"></td>
                                                                    <td><input type="text" name="batch_detaildata_ssp[{{ $index }}][req_test]" value="{{ $spec['req_test'] }}"></td>

                                                                    <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                                </tr>
                                                            @endforeach
                                                        @else
                                                            <tr class="no-data">
                                                                <td colspan="5" style="text-align: center;">No data found</td>
                                                            </tr>
                                                        @endif
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <script>
                                        $(document).ready(function() {
                                            // Add new row in Specification Validation table
                                            $('#SecondbatchDetailData_ssp').click(function(e) {
                                                e.preventDefault();

                                                function generateSpecificationRow(serialNumber) {
                                                    return (
                                                        '<tr>' +
                                                        '<td><input disabled type="text" name="batch_detaildata_ssp[' + serialNumber +
                                                        '][serial]" value="' + (serialNumber + 1) + '"></td>' +
                                                        '<td><input type="text" name="batch_detaildata_ssp[' + serialNumber + '][stability_station]"></td>' +
                                                        '<td><input type="text" name="batch_detaildata_ssp[' + serialNumber + '][req_test]"></td>' +

                                                        '<td><button type="button" class="removeRowBtn">Remove</button></td>' +
                                                        '</tr>'
                                                    );
                                                }

                                                var tableBody = $('#batch_detailRecord_ssp tbody');
                                                var rowCount = tableBody.children('tr').not('.no-data').length;

                                                // Remove "No data found" row if it exists
                                                if (rowCount === 0) {
                                                    tableBody.find('.no-data').remove();
                                                    rowCount = 0; // Start count from 0 if no rows exist
                                                }

                                                var newRow = generateSpecificationRow(rowCount);
                                                tableBody.append(newRow);
                                            });

                                            // Remove row in Specification Validation table
                                            $(document).on('click', '.removeRowBtn', function() {
                                                $(this).closest('tr').remove();

                                                // Check if table is empty after deletion, add "No data found" row if so
                                                if ($('#batch_detaildata_ssp tbody tr').length === 0) {
                                                    $('#batch_detaildata_ssp tbody').append('<tr class="no-data"><td colspan="5">No data found</td></tr>');
                                                }
                                            });
                                        });
                                    </script>



                                 <div class="col-lg-12">
                                    <div class="group-input">
                                        <label for="others">Remark (if any)</label>
                                        <textarea name="remark_if_any_ssp">{{$document->document_content->remark_if_any_ssp}}</textarea>
                                    </div>
                                </div>

                                <div class="col-md-12 mb-3">
                                    <div class="group-input">
                                        <label for="documentrefrence_ssp">STABILITY DATA COMPILATION</label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does
                                                not require completion</small></div>
                                        <textarea name="stability_data_ssp" class="summernote">
                                        {{$document->document_content->stability_data_ssp}} </textarea>
                                    </div>
                                </div>


                                <div class="col-md-12 mb-3">
                                    <div class="group-input">
                                        <label for="procedure">GENERAL INSTRUCTIONS</label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does
                                                not require completion</small></div>
                                        <textarea name="general_inst_ssp" class="summernote">
                                        {{$document->document_content->general_inst_ssp}} </textarea>
                                    </div>
                                </div>


                                <div class="orig-head">
                                PROTOCOL CERTIFICATION
                                 </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="purpose">Stability Protocol For </label>
                                        <input type="text" name="stability_proto_ssp" value="{{$document->document_content->stability_proto_ssp}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Protocol No.</label>
                                        <input type="text" name="proto_no_ssp" value="{{$document->document_content->proto_no_ssp}}">
                                    </div>
                                </div>


                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="purpose">Product</label>
                                        <input type="text" name="product_ssp" value="{{$document->document_content->product_ssp}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Batch Number</label>
                                        <input type="text" name="batchnumber_ssp" value="{{$document->document_content->batchnumber_ssp}}">
                                    </div>
                                </div>

                        --}}



                            <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="Stability_study_protocolField">
                                            @if ($document->file_attach)
                                                @foreach(json_decode($document->file_attach) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_file_attach[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="file_attachDataSSP" style="cursor: pointer;">Add</label>
                                            <input type="file" id="file_attachDataSSP" name="file_attach[]" 
                                                oninput="addMultipleFiles(this, 'Stability_study_protocolField')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_file_attach" name="deleted_file_attach" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_file_attach');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>





                        <div class="button-block">
                            <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                            <button type="button" class="backButton" onclick="previousStep()">Back</button>
                            <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                            <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                </a>
                            </button>
                        </div>
                    </div>
                </div>
            </div>



                <!--Process Validation Protocol  -->
                <div id="doc_prvp" class="tabcontent">
                    <div class="orig-head">
                        Process Validation Protocol
                        </div>
                        <div class="input-fields">
                            <div class="row">
                                <div class="">
                                  PRODUCT DETAILS
                                </div>  <br>
                            {{-- <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="purpose">Generic Name </label>
                                        <input type="text" name="generic_prvp" value="{{$document->document_content->generic_prvp}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Product Code</label>
                                        <input type="text" name="prvp_product_code" value="{{$document->document_content->prvp_product_code}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Std. Batch size </label>
                                        <input type="text" name="prvp_std_batch" value="{{$document->document_content->prvp_std_batch}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Category</label>
                                        <input type="text" name="prvp_category" value="{{$document->document_content->prvp_category}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Label Claim  </label>
                                        <input type="text" name="prvp_label_claim" value="{{$document->document_content->prvp_label_claim}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Market</label>
                                        <input type="text" name="prvp_market" value="{{$document->document_content->prvp_market}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Shelf Life</label>
                                        <input type="text" name="prvp_shelf_life" value="{{$document->document_content->prvp_shelf_life}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">BMR No.</label>
                                        <input type="text" name="prvp_bmr_no" value="{{$document->document_content->prvp_bmr_no}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">MFR No.</label>
                                        <input type="text" name="prvp_mfr_no" value="{{$document->document_content->prvp_mfr_no}}">
                                    </div>
                                </div>


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="purpose">Purpose</label>
                                        <textarea name="prvp_purpose">{{$document->document_content->prvp_purpose}}</textarea>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="scope">Scope</label>
                                        <textarea name="prvp_scope">{{$document->document_content->prvp_scope}}</textarea>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="scope">Reason for validation</label>
                                        <textarea name="reason_validation">{{$document->document_content->reason_validation}}</textarea>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="responsibility" id="responsibility">
                                            Responsibility<button type="button" id="responsibilityprvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="responsibilityprvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->responsibilityprvp))
                                                @foreach (unserialize($document->document_content->responsibilityprvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subResponsibilityprvpAdd' : 'singleResponsibilityPrvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="responsibilityprvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="responsibilityprvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subResponsibilityprvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleResponsibilityPrvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="responsibilityprvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subResponsibilityprvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Responsibility' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="procedure">Validation Policy</label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <textarea name="validation_po_prvp" id="summernote" class="summernote">{{ $document->document_content ? $document->document_content->validation_po_prvp : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="scope">Description of SOP</label>
                                        <textarea name="description_sop_prvp">{{$document->document_content->description_sop_prvp}}</textarea>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="responsibility" id="responsibility">
                                                Active raw material approved vendor details<button type="button" id="accountabilityprvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="accountabilityprvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->responsibilityprvp))
                                                @foreach (unserialize($document->document_content->responsibilityprvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subAccountabilityprvpAdd' : 'singleAccountabilityPrvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="prvp_rawmaterial[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="prvp_rawmaterial[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subAccountabilityprvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleAccountabilityPrvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="prvp_rawmaterial[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subAccountabilityprvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Responsibility' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="responsibility" id="responsibility">
                                                Active raw material approved vendor details<button type="button" id="referencesprvpbtadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="referencesprvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->equipCaliQuali))
                                                @foreach (unserialize($document->document_content->equipCaliQuali) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subReferencesPrvpAdd' : 'singleReferencesPrvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="equipCaliQuali[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="equipCaliQuali[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subAccountabilityprvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleReferencesPrvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="equipCaliQuali[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subAccountabilityprvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Responsibility' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>




                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="references" id="referencesprvp">
                                        Primary packing material approved vendor details<button type="button" id="referencesprvpbtadd">+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does
                                                not require completion</small></div>
                                        <div id="referencesprvpdiv">
                                            <div class="singleReferencesPrvpBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="pripackmaterial[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subReferencesPrvpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="abbreviation" id="abbreviationprvp">
                                        Equipment Calibration & Qualification Status<button type="button" id="abbreviationprvpbtnadd"
                                                name="button">+</button>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it
                                                    does not require completion</small></div>
                                        </label>
                                        <div id="abbreviationprvpdiv">
                                            <div class="singleAbbreviationPrvpBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="equipCaliQuali[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subAbbreviationPrvpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="abbreviation" id="definitionprvp">
                                        Rationale for selection of critical steps<button type="button" id="DefinitionPrvpbtnadd"
                                                name="button">+</button>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it
                                                    does not require completion</small></div>
                                        </label>
                                        <div id="definitionprvpdiv">
                                            <div class="singleDefinitionPrvpBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="rationale_critical[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-dark subDefinitionPrvpAdd">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>

                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="reporting" id="newreport">
                                            Manufacturing Process Flow Chart <button type="button" id="materialsgeneralbtnadd"
                                                name="button">+</button>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it
                                                    does not require completion</small></div>
                                        </label>

                                        <div id="materialsGeneraldiv">
                                            <div class="singleMaterialGeneralBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="general_instrument[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button type="button" class="subMaterialsGenAdd"
                                                            name="button">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="reporting" id="newreport">
                                            Process Flow Chart <button type="button" id="processflowbtnadd"
                                                name="button">+</button>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it
                                                    does not require completion</small></div>
                                        </label>
                                        <div id="processFlowdiv">
                                            <div class="singleProcessFlowBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="process_flow[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button type="button" class="subProcessFlowAdd"
                                                            name="button">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12 mb-3">
                                    <div class="group-input">
                                        <label for="procedure">Sampling Plan, Procedure and rationale</label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does
                                                not require completion</small></div>
                                        <textarea name="prvp_procedure" class="summernote">
                                    </textarea>
                                    </div>
                                </div>


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="reporting" id="newreport">
                                            Diagrammatic representation of Sampling points<button type="button" id="diagrammaticbtnadd"
                                                name="button">+</button>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it
                                                    does not require completion</small></div>
                                        </label>
                                        <div id="diagrammaticdiv">
                                            <div class="singleDiagrammaticBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="diagrammatic[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button type="button" class="subDiagrammaticAdd"
                                                            name="button">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="reporting" id="newreport">
                                             Critical Process Parameters & Critical Process Attributes<button type="button" id="criticalprocessbtnadd"
                                                name="button">+</button>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it
                                                    does not require completion</small></div>
                                        </label>
                                        <div id="criticaldiv">
                                            <div class="singleCriticalBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="critical_process[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button type="button" class="subCriticalAdd"
                                                            name="button">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="reporting" id="newreport">
                                            Product Acceptance Criteria<button type="button" id="productacceptancebtnadd"
                                                name="button">+</button>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it
                                                    does not require completion</small></div>
                                        </label>
                                        <div id="productaccpdiv">
                                            <div class="singleProductAccpBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="product_acceptance[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button type="button" class="subProductAccpAdd"
                                                            name="button">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="reporting" id="newreport">
                                            Hold time study<button type="button" id="holdtimebtnadd"
                                                name="button">+</button>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it
                                                    does not require completion</small></div>
                                        </label>
                                        <div id="holdtimestudydiv">
                                            <div class="singleHoldTimeBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="holdtime_study[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button type="button" class="subHoldTimeAdd"
                                                            name="button">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="reporting" id="newreport">
                                            Cleaning validation<button type="button" id="cleaningvalibtnadd"
                                                name="button">+</button>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it
                                                    does not require completion</small></div>
                                        </label>
                                        <div id="cleaningvalidiv">
                                            <div class="singleCleaningValiBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="cleaning_validation[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button type="button" class="subCleaningValiAdd"
                                                            name="button">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="reporting" id="newreport">
                                            Stability study<button type="button" id="stabilitystudybtnadd"
                                                name="button">+</button>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it
                                                    does not require completion</small></div>
                                        </label>
                                        <div id="stabilitystudydiv">
                                            <div class="singleStabilityStudyBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="stability_study[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button type="button" class="subStabilityAdd"
                                                            name="button">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="reporting" id="newreport">
                                            Deviation<button type="button" id="deviationbtnadd"
                                                name="button">+</button>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it
                                                    does not require completion</small></div>
                                        </label>
                                        <div id="deviationdiv">
                                            <div class="singleDeviationBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="deviation[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button type="button" class="subDeviationAdd"
                                                            name="button">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="reporting" id="newreport">
                                            Change control<button type="button" id="changecontrolbtnadd"
                                                name="button">+</button>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it
                                                    does not require completion</small></div>
                                        </label>
                                        <div id="changecontroldiv">
                                            <div class="singleChangeControlBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="change_control[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button type="button" class="subChangeControlAdd"
                                                            name="button">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="reporting" id="newreport">
                                            Summary<button type="button" id="summaryprvpbtnadd"
                                                name="button">+</button>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it
                                                    does not require completion</small></div>
                                        </label>
                                        <div id="summaryprvpdiv">
                                            <div class="singleSummaryBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="summary_prvp[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button type="button" class="subSummaryPrvpAdd"
                                                            name="button">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="reporting" id="newreport">
                                            Conclusion<button type="button" id="conclusionprvpbtnadd"
                                                name="button">+</button>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it
                                                    does not require completion</small></div>
                                        </label>
                                        <div id="conclusionprvpdiv">
                                            <div class="singleConclusionBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="conclusion_prvp[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button type="button" class="subConclusionPrvpAdd"
                                                            name="button">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="reporting" id="newreport">
                                            Training<button type="button" id="trainingprvpbtnadd"
                                                name="button">+</button>
                                            <div><small class="text-primary">Please insert "NA" in the data field if it
                                                    does not require completion</small></div>
                                        </label>
                                        <div id="trainingprvpdiv">
                                            <div class="singleTrainingBlock">
                                                <div class="row">
                                                    <div class="col-sm-10">
                                                        <textarea name="training_prvp[]" class="myclassname"></textarea>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button type="button" class="subTrainingPrvpAdd"
                                                            name="button">+</button>
                                                    </div>
                                                    <div class="col-sm-1">
                                                        <button class="btn btn-danger removeAllBlocks">Remove</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div> --}}

                                <div class="col-12">
                                    <div class="group-input">
                                        <label for="File_Attachment"><b>File Attachment</b></label>
                                        <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                        <div class="file-attachment-field">
                                            <div class="file-attachment-list" id="ProValProtocolDatassp">
                                                @if ($document->ProValProtocol)
                                                    @foreach(json_decode($document->ProValProtocol) as $file)
                                                        <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                            <b>{{ $file }}</b>
                                                            <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                                <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                            </a>
                                                            <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                                <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                            </a>
                                                            <input type="hidden" name="existing_ProValProtocol[]" value="{{ $file }}">
                                                        </h6>
                                                    @endforeach
                                                @endif
                                            </div>

                                            <div class="add-btn">
                                                <label for="ProValProtocol_id" style="cursor: pointer;">Add</label>
                                                <input type="file" id="ProValProtocol_id" name="ProValProtocol[]"
                                                    oninput="addMultipleFiles(this, 'ProValProtocolDatassp')" multiple hidden>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Hidden field to store deleted files -->
                                <input type="hidden" id="deleted_ProValProtocol" name="deleted_ProValProtocol" value="">

                                <script>
                                    document.addEventListener('DOMContentLoaded', function () {
                                        document.querySelectorAll('.remove-file').forEach(button => {
                                            button.addEventListener('click', function () {
                                                const fileName = this.getAttribute('data-file-name');
                                                const fileContainer = this.closest('.file-container');

                                                if (fileContainer) {
                                                    fileContainer.style.display = 'none';

                                                    const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                    if (hiddenInput) {
                                                        hiddenInput.remove();
                                                    }

                                                    const deletedFilesInput = document.getElementById('deleted_ProValProtocol');
                                                    let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                    deletedFiles.push(fileName);
                                                    deletedFilesInput.value = deletedFiles.join(',');
                                                }
                                            });
                                        });
                                    });

                                    function addMultipleFiles(input, listId) {
                                        let fileList = document.getElementById(listId);
                                        for (let file of input.files) {
                                            let fileContainer = document.createElement('h6');
                                            fileContainer.classList.add('file-container', 'text-dark');
                                            fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                            let fileText = document.createElement('b');
                                            fileText.textContent = file.name;

                                            let removeLink = document.createElement('a');
                                            removeLink.classList.add('remove-file');
                                            removeLink.dataset.fileName = file.name;
                                            removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                            removeLink.addEventListener('click', function () {
                                                fileContainer.style.display = 'none';
                                            });

                                            fileContainer.appendChild(fileText);
                                            fileContainer.appendChild(removeLink);
                                            fileList.appendChild(fileContainer);
                                        }
                                    }
                                </script>



                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>


                  <!-- Validation Master Plan  -->
                <div id="doc_vmp" class="tabcontent">
                       <div class="orig-head">
                       Validation Master Plan
                        </div>
                    <div class="input-fields">
                         <div class="row">
                         <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="file_attach_vmpData">
                                            @if ($document->file_attach_vmp)
                                                @foreach(json_decode($document->file_attach_vmp) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_file_attach_vmp[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="file_attach_vmpDatafiled" style="cursor: pointer;">Add</label>
                                            <input type="file" id="file_attach_vmpDatafiled" name="file_attach_vmp[]"
                                                oninput="addMultipleFiles(this, 'file_attach_vmpData')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_file_attach_vmp" name="deleted_file_attach_vmp" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_file_attach_vmp');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>

                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>


                  <!-- Validation Master Plan  -->
                  <div id="doc_qm" class="tabcontent">
                       <div class="orig-head">
                       Quality Manual 
                        </div>
                    <div class="input-fields">
                         <div class="row">
                         <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="file_attach_qmData">
                                            @if ($document->file_attach_qm)
                                                @foreach(json_decode($document->file_attach_qm) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_file_attach_qm[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="file_attach_qmDatafiled" style="cursor: pointer;">Add</label>
                                            <input type="file" id="file_attach_qmDatafiled" name="file_attach_qm[]"
                                                oninput="addMultipleFiles(this, 'file_attach_qmData')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_file_attach_qm" name="deleted_file_attach_qm" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_file_attach_qm');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>

                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                         </div>
                    </div>
                </div>


                <!-- Protocol Cum Report -->
                    <div id="doc_qpcr" class="tabcontent">
                        <div class="orig-head">
                            Qualification Protocol Cum Report
                        </div>
                        <div class="input-fields">
                            <div class="row">




                            <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b>File Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="procumrepo_file_attachDatassp">
                                            @if ($document->procumrepo_file_attach)
                                                @foreach(json_decode($document->procumrepo_file_attach) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_procumrepo_file_attach[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="procumrepo_file_attachData" style="cursor: pointer;">Add</label>
                                            <input type="file" id="procumrepo_file_attachData" name="procumrepo_file_attach[]" 
                                                oninput="addMultipleFiles(this, 'procumrepo_file_attachDatassp')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_procumrepo_file_attach" name="deleted_procumrepo_file_attach" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_procumrepo_file_attach');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>



                            </div>
                        </div>
                        <div class="button-block">
                            <button type="submit" value="save" name="submit" id="DocsaveButton"
                                class="saveButton">Save</button>
                            <button type="button" class="backButton" onclick="previousStep()">Back</button>
                            <button type="button" class="nextButton" id="DocnextButton"
                                onclick="nextStep()">Next</button>
                            <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                </a>
                            </button>
                        </div>
                    </div>


                <!------------------------ Packing Material Specification - tab ------------------------------------>
                <div id="doc_pams" class="tabcontent">
                    <div class="orig-head">
                        PACKING MATERIAL SPECIFICATION
                        </div>
                    <div class="input-fields">
                        <div class="row">

                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="stp">Specification No<span class="text-danger">*</span></label>
                                    @php
                                        $revisionNumber = $document->revised == 'Yes' ? str_pad($document->revised_doc, 2, '0', STR_PAD_LEFT) : '00';
                                        $mfpstpNumber = "PMS/" . str_pad($document->id, 4, '0', STR_PAD_LEFT) . "-$revisionNumber";
                                    @endphp
                                    <input type="text" id="stp" name="stp_mfpstp_no" value="{{ $mfpstpNumber }}" maxlength="255" readonly>
                                </div>
                            </div>

                            <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="purpose">Material Name</label>
                                        <input type="text" name="packing_material_name" value="{{ $document->packing_material_name }}">
                                    </div>
                            </div>
                            <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="purpose">Item Code</label>
                                        <input type="text" name="item_code" value="{{ $document->item_code }}">
                                    </div>
                            </div>

                            <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="purpose">Name of packing material</label>
                                        <input type="text" name="name_pack_material" value="{{ $document->name_pack_material }}">
                                    </div>
                            </div>

                            <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Standard pack</label>
                                        <input type="text" name="standard_pack" value="{{ $document->standard_pack }}">
                                    </div>
                            </div>

                            <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="purpose">Sampling plan</label>
                                        <input type="text" name="sampling_plan" value="{{ $document->sampling_plan }}">
                                    </div>
                            </div>
                            <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Sampling Instructions</label>
                                        <input type="text" name="sampling_instruction" value="{{ $document->sampling_instruction }}">
                                    </div>
                            </div>

                            <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="purpose">Sample for analysis </label>
                                        <input type="text" name="sample_analysis" value="{{ $document->sample_analysis }}">
                                    </div>
                            </div>
                            <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Control Sample</label>
                                        <input type="text" name="control_sample" value="{{ $document->control_sample }}">
                                    </div>
                            </div>

                            <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="purpose">Safety Precautions</label>
                                        <input type="text" name="safety_precaution" vlaue="{{ $document->safety_precaution }}">
                                    </div>
                            </div>
                            <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Storage condition</label>
                                        <input type="text" name="storage_condition" value="{{ $document->storage_condition }}">
                                    </div>
                            </div>
                            <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Approved Vendors</label>
                                        <input type="text" name="approved_vendor" value="{{ $document->approved_vendor }}">
                                    </div>
                            </div>

                            @php
                                $serialNumber = 1;
                                $decodedPackingData = isset($PackingGridData->data) && is_string($PackingGridData->data)
                                    ? json_decode($PackingGridData->data, true)
                                    : (is_array($PackingGridData->data) ? $PackingGridData->data : []);
                            @endphp

                            {{--<div class="group-input">
                                <label for="action-plan-grid">
                                    Details
                                    <button type="button" id="Details_add_data">+</button>
                                    <span class="text-primary" data-bs-toggle="modal" data-bs-target="#observation-field-instruction-modal"
                                        style="font-size: 0.8rem; font-weight: 400; cursor: pointer;">
                                        Row Increment
                                    </span>
                                </label>
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="Details-table-data">
                                        <thead>
                                            <tr>
                                                <th style="width: 2%">Sr.No</th>
                                                <th style="width: 12%">Tests</th>
                                                <th style="width: 12%">Specifications</th>
                                                <th style="width: 12%">GTP No.</th>
                                                <th style="width: 3%">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @if(!empty($decodedPackingData))
                                                @foreach($decodedPackingData as $key => $test)
                                                    <tr>
                                                        <td><input type="text" disabled value="{{ $serialNumber++ }}" style="width: 30px;"></td>
                                                        <td><input type="text" name="packingtest[{{ $key }}][tests]" value="{{ $test['tests'] ?? '' }}"></td>
                                                        <td><input type="text" name="packingtest[{{ $key }}][specification]" value="{{ $test['specification'] ?? '' }}"></td>
                                                        <td><input type="text" name="packingtest[{{ $key }}][gtp_no]" value="{{ $test['gtp_no'] ?? '' }}"></td>
                                                        <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                    </tr>
                                                @endforeach
                                            @else
                                                <tr>
                                                    <td><input type="text" disabled value="1" style="width: 30px;"></td>
                                                    <td><input type="text" name="packingtest[0][tests]"></td>
                                                    <td><input type="text" name="packingtest[0][specification]"></td>
                                                    <td><input type="text" name="packingtest[0][gtp_no]"></td>
                                                    <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                </tr>
                                            @endif
                                        </tbody>
                                    </table>
                                </div>
                            </div> --}}

                                    <div class="col-12 sub-head">
                                        SPECIFICATION
                                        <div class="group-input">
                                            <label for="procedure"></label>
                                            
                                            <textarea name="packingmaterial_specification" id="summernote" class="summernote">{{ $document->packingmaterial_specification ? $document->packingmaterial_specification : '' }}</textarea>
                                            @foreach ($history as $tempHistory)
                                                @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                    @php
                                                        $users_name = DB::table('users')
                                                            ->where('id', $tempHistory->user_id)
                                                            ->value('name');
                                                    @endphp
                                                    <p style="color: blue">Modify by {{ $users_name }} at
                                                        {{ $tempHistory->created_at }}
                                                    </p>
                                                    <input class="input-field"
                                                        style="background: #ffff0061;
                                            color: black;"
                                                        type="text" value="{{ $tempHistory->comment }}" disabled>
                                                @endif
                                            @endforeach
                                        </div>
                                    </div>

                                    <div class="group-input">
                                        <label for="action-plan-grid">
                                            Revision History<button type="button" name="action-plan-grid"
                                                    id="pams_revision">+</button>
                                        </label>
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="table_pams_revision">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 2%">Sr. No.</th>
                                                        <th style="width: 12%">Revision No.</th>
                                                        <th style="width: 12%">Change Control No./ DCRF No</th>
                                                        <th style="width: 12%">Effective Date</th>
                                                        <th style="width: 30%">Reason of revision</th>
                                                        <th style="width: 3%">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @php
                                                        $serialNumber = 1;
                                                        $GtpData = isset($RevisionGridpamsData->data) && is_string($RevisionGridpamsData->data)
                                                            ? json_decode($RevisionGridpamsData->data, true)
                                                            : (is_array($RevisionGridpamsData->data) ? $RevisionGridpamsData->data : []);
                                                    @endphp

                                                    @if(!empty($GtpData))
                                                        @foreach($GtpData as $key => $gtp_data)
                                                            <tr>
                                                                <td>{{ $serialNumber++ }}</td>
                                                                <td><input type="text" name="revision_pams_data[{{ $key }}][rev_pams_no]" value="{{ $gtp_data['rev_pams_no'] ?? '' }}"></td>
                                                                <td><input type="text" name="revision_pams_data[{{ $key }}][change_ctrl_pams_no]" value="{{ $gtp_data['change_ctrl_pams_no'] ?? '' }}"></td>
                                                                <td><input type="date" name="revision_pams_data[{{ $key }}][eff_date_pams]" value="{{ $gtp_data['eff_date_pams'] ?? '' }}"></td>
                                                                <td><input type="text" name="revision_pams_data[{{ $key }}][rev_reason_pams]" value="{{ $gtp_data['rev_reason_pams'] ?? '' }}"></td>
                                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                            </tr>
                                                        @endforeach
                                                    @else
                                                        <tr>
                                                            <td>{{ $serialNumber++ }}</td>
                                                            <td><input type="text" name="revision_pams_data[0][rev_pams_no]"></td>
                                                            <td><input type="text" name="revision_pams_data[0][change_ctrl_pams_no]"></td>
                                                            <td><input type="date" name="revision_pams_data[0][eff_date_pams]"></td>
                                                            <td><input type="text" name="revision_pams_data[0][rev_reason_pams]"></td>
                                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                        </tr>
                                                    @endif
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <script>
                                        $(document).ready(function() {
                                            function updateSerialNumbers() {
                                                $('#table_pams_revision tbody tr').each(function(index) {
                                                    $(this).find('td:first-child input').val(index + 1); // Update Sr. No
                                                    $(this).find('td:nth-child(2) input').attr('name', `gtp[${index}][test_gtp]`);
                                                });
                                            }

                                            $('#pams_revision').click(function() {
                                                var serialNumber = $('#table_pams_revision tbody tr').length + 1; // Get the next serial number
                                                var newRow = `
                                                    <tr>
                                                        <td><input disabled type="text" style="width:40px; text-align:center;" value="${serialNumber}"></td>
                                                        <td><input type="text" name="revision_pams_data[${serialNumber - 1}][rev_pams_no]" value=""></td>
                                                        <td><input type="text" name="revision_pams_data[${serialNumber - 1}][change_ctrl_pams_no]" value=""></td>
                                                        <td><input type="date" name="revision_pams_data[${serialNumber - 1}][eff_date_pams]" value=""></td>
                                                        <td><input type="text" name="revision_pams_data[${serialNumber - 1}][rev_reason_pams]" value=""></td>
                                                        <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                    </tr>`;

                                                $('#table_pams_revision tbody').append(newRow);
                                            });

                                            // Remove row functionality
                                            $(document).on('click', '.removeRowBtn', function() {
                                                $(this).closest('tr').remove();
                                                updateSerialNumbers(); // Update serial numbers after removal
                                            });
                                        });
                                    </script>




                                    




                                </div>
                                </div>
                                <div class="button-block">
                                    <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                                    <button type="button" class="backButton" onclick="previousStep()">Back</button>
                                    <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                                    <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                        </a>
                                    </button>
                                </div>
                        </div>
    

                


                <!-- rajendra start -->

                {{-- Hold Time Study Protocol Tabs --}}
                  <div id="doc-htsp" class="tabcontent">
                    <div class="orig-head">
                        Hold Time Study Protocol</div>
                        <div class="input-fields">
                            <div class="row">
                                {{-- comment for temp --}}
                                {{-- <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Purpose">Purpose</label>
                                        <textarea name="htsp_purpose">{{$document->document_content->htsp_purpose}}</textarea>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="scope">Scope</label>
                                        <textarea name="htsp_scope">{{$document->document_content->htsp_scope}}</textarea>
                                    </div>
                                </div>



                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="responsibilityhtps" id="responsibilityhtps">
                                            Responsibility<button type="button" id="responsibilityhtpsbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="responsibilityhtpsdiv">
                                            @if ($document->document_content && !empty($document->document_content->htsp_responsibility))
                                                @foreach (unserialize($document->document_content->htsp_responsibility) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subresponsibilityhtpsAdd' : 'ResponsibilityBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="htsp_responsibility[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="htsp_responsibility[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subresponsibilityhtpsAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="ResponsibilityBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="htsp_responsibility[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subresponsibilityhtpsAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Responsibility' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div> --}}

                                {{-- <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="test">
                                            Revision History
                                        </label>
                                        <div><small class="text-primary"></small></div>
                                        <div class="table-responsive retrieve-table">
                                        <table class="table-bordered table" id="">
                                            <thead>
                                                <tr>
                                                    <th>Sr. No.</th>
                                                    <th class="copy-name">Revision No.</th>
                                                    <th class="copy-name">Change Control No./ DCRF No</th>
                                                    <th class="copy-name">Effective Date</th>
                                                    <th class="copy-name">Reason of revision</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>1</td>
                                                    <td><input type="text" id="" name="revision_number" value="" class="form-control"></td>
                                                    <td><input type="text" id="" name="cc_no" value="" class="form-control"></td>
                                                    <td><input type="text" id="" name="revised_effective_date" value="" class="form-control"></td>
                                                    <td><input type="text" id="" name="reason_of_revision" value="" class="form-control"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        </div>
                                    </div>
                                </div> --}}
                                {{-- comment for temp --}}
                            {{--

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="htspdescription" id="htspdescription">
                                            Description of SOP s to be followed<button type="button" id="htspdescriptionbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="htspdescriptiondiv">
                                            @if ($document->document_content && !empty($document->document_content->htsp_description_of_sop))
                                                @foreach (unserialize($document->document_content->htsp_description_of_sop) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subhtspdescriptionAdd' : 'htspdescriptionBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="htsp_description_of_sop[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="htsp_description_of_sop[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subhtspdescriptionAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="htspdescriptionBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="htsp_description_of_sop[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subhtspdescriptionAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Description of SOP s To Be Followed' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Specifications" id="Specifications">
                                            Specifications<button type="button" id="Specificationsbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="Specificationsdiv">
                                            @if ($document->document_content && !empty($document->document_content->htsp_specifications))
                                                @foreach (unserialize($document->document_content->htsp_specifications) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSpecificationsAdd' : 'SpecificationsBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="htsp_specifications[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="htsp_specifications[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subSpecificationsAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="SpecificationsBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="htsp_specifications[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subSpecificationsAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Specifications' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Samplinghtps" id="Samplinghtps">
                                            Sampling & Analysis Plan<button type="button" id="Samplinghtpsbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="Samplinghtpsdiv">
                                            @if ($document->document_content && !empty($document->document_content->htsp_sampling_analysis))
                                                @foreach (unserialize($document->document_content->htsp_sampling_analysis) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSamplinghtpsAdd' : 'singleResponsibilityPrvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="htsp_sampling_analysis[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="htsp_sampling_analysis[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subSamplinghtpsAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="singleResponsibilityPrvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="htsp_sampling_analysis[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subSamplinghtpsAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == ' Sampling & Analysis Plan' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Environmentalhtsp" id="Environmentalhtsp">
                                            Environmental Conditions During Hold Time<button type="button" id="Environmentalhtspbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="Environmentalhtspdiv">
                                            @if ($document->document_content && !empty($document->document_content->htsp_environmental_conditions))
                                                @foreach (unserialize($document->document_content->htsp_environmental_conditions) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subEnvironmentalhtspAdd' : 'EnvironmentalhtspBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="htsp_environmental_conditions[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="htsp_environmental_conditions[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subEnvironmentalhtspAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="EnvironmentalhtspBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="htsp_environmental_conditions[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subEnvironmentalhtspAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == ' Environmental Conditions During Hold Time' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Samplehtps" id="Samplehtps">
                                            Sample Quantity Calculation<button type="button" id="Samplehtpsbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="Samplehtpsdiv">
                                            @if ($document->document_content && !empty($document->document_content->htsp_sample_quantity_calculation))
                                                @foreach (unserialize($document->document_content->htsp_sample_quantity_calculation) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSamplehtpsAdd' : 'SamplehtpsBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="htsp_sample_quantity_calculation[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="htsp_sample_quantity_calculation[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subSamplehtpsAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="SamplehtpsBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="htsp_sample_quantity_calculation[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subSamplehtpsAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Sample Quantity Calculation' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Deviationhtps" id="Deviationhtps">
                                            Deviation<button type="button" id="Deviationhtpsbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="Deviationhtpsdiv">
                                            @if ($document->document_content && !empty($document->document_content->htsp_deviation))
                                                @foreach (unserialize($document->document_content->htsp_deviation) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subDeviationhtpsAdd' : 'DeviationhtpsBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="htsp_deviation[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="htsp_deviation[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subDeviationhtpsAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="DeviationhtpsBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="htsp_deviation[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subDeviationhtpsAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Deviation' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>


                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Summaryhtps" id="Summaryhtps">
                                            Summary<button type="button" id="Summaryhtpsbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="Summaryhtpsdiv">
                                            @if ($document->document_content && !empty($document->document_content->htsp_summary))
                                                @foreach (unserialize($document->document_content->htsp_summary) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSummaryhtpsAdd' : 'SummaryhtpsBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="htsp_summary[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="htsp_summary[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subSummaryhtpsAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="SummaryhtpsBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="htsp_summary[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subSummaryhtpsAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Summary' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Conclusionhtps" id="Conclusionhtps">
                                            Conclusion<button type="button" id="Conclusionhtpsbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="Conclusionhtpsdiv">
                                            @if ($document->document_content && !empty($document->document_content->htsp_conclusion))
                                                @foreach (unserialize($document->document_content->htsp_conclusion) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subConclusionhtpseAdd' : 'ConclusionhtpsBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="htsp_conclusion[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="htsp_conclusion[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subConclusionhtpseAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="ConclusionhtpsBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="htsp_conclusion[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subConclusionhtpseAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Conclusion' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div> --}}

                                <div class="col-12">
                                    <div class="group-input">
                                        <label for="File_Attachment"><b> Attachment</b></label>
                                        <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                        <div class="file-attachment-field">
                                            <div class="file-attachment-list" id="attachement_htsp">
                                                @if ($document->document_content->htspattachement)
                                                    @foreach(json_decode($document->document_content->htspattachement) as $file)
                                                        <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                            <b>{{ $file }}</b>
                                                            <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                                <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                            </a>
                                                            <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                                <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                            </a>
                                                            <input type="hidden" name="existing_htspattachement[]" value="{{ $file }}">
                                                        </h6>
                                                    @endforeach
                                                @endif
                                            </div>

                                            <div class="add-btn">
                                                <label for="htpsfile" style="cursor: pointer;">Add</label>
                                                <input type="file" id="htpsfile" name="htspattachement[]"
                                                    oninput="addMultipleFiles(this, 'attachement_htsp')" multiple hidden>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Hidden field to store deleted files -->
                                <input type="hidden" id="deleted_htspattachement" name="deleted_htspattachement" value="">

                                <script>
                                    document.addEventListener('DOMContentLoaded', function () {
                                        document.querySelectorAll('.remove-file').forEach(button => {
                                            button.addEventListener('click', function () {
                                                const fileName = this.getAttribute('data-file-name');
                                                const fileContainer = this.closest('.file-container');

                                                if (fileContainer) {
                                                    fileContainer.style.display = 'none';

                                                    const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                    if (hiddenInput) {
                                                        hiddenInput.remove();
                                                    }

                                                    const deletedFilesInput = document.getElementById('deleted_htspattachement');
                                                    let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                    deletedFiles.push(fileName);
                                                    deletedFilesInput.value = deletedFiles.join(',');
                                                }
                                            });
                                        });
                                    });

                                    function addMultipleFiles(input, listId) {
                                        let fileList = document.getElementById(listId);
                                        for (let file of input.files) {
                                            let fileContainer = document.createElement('h6');
                                            fileContainer.classList.add('file-container', 'text-dark');
                                            fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                            let fileText = document.createElement('b');
                                            fileText.textContent = file.name;

                                            let removeLink = document.createElement('a');
                                            removeLink.classList.add('remove-file');
                                            removeLink.dataset.fileName = file.name;
                                            removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                            removeLink.addEventListener('click', function () {
                                                fileContainer.style.display = 'none';
                                            });

                                            fileContainer.appendChild(fileText);
                                            fileContainer.appendChild(removeLink);
                                            fileList.appendChild(fileContainer);
                                        }
                                    }
                                </script>










                                {{-- <div class="input-fields">
                                    <div class="group-input">
                                        <label for="distribution-list" style="font-weight: bold;">
                                            Distribution List
                                        </label>
                                        <div class="table-responsive retrieve-table">
                                            <table class="table table-bordered" id="distribution-list">
                                                <thead>
                                                    <tr>
                                                        <th>Row</th>
                                                        <th class="copy-name">Copy</th>
                                                        <th class="copy-name">No. of Copies</th>
                                                        <th class="copy-name">User Department</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>1</td>
                                                        <td style="font-weight: bold;">Master Copy</td>
                                                        <td><input type="text" id="copies-master"
                                                                name="master_copy_number" value=""
                                                                class="form-control">
                                                        </td>

                                                        <td>
                                                            <div class="col-md-6">
                                                                <div class="group-input">
                                                                    <input type="text" name="master_user_department">

                                                                </div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>2</td>
                                                        <td style="font-weight: bold;">Controlled Copy</td>
                                                        <td><input type="text" id="copies-controlled"
                                                                name="controlled_copy_number" value=""
                                                                class="form-control"></td>

                                                        <td>
                                                            <div class="col-md-6">
                                                                <div class="group-input">
                                                                <input type="text" name="controlled_user_department">

                                                                </div>
                                                            </div>
                                                        </td>

                                                    </tr>
                                                    <tr>
                                                        <td>3</td>
                                                        <td style="font-weight: bold;">Display Copy</td>
                                                        <td><input type="text" id="copies-display"
                                                                name="display_copy_number" value=""
                                                                class="form-control">
                                                        </td>
                                                        <td>
                                                            <div class="col-md-6">
                                                                <div class="group-input">
                                                                    <input type="text" name="display_user_department">

                                                                </div>
                                                            </div>
                                                        </td>

                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div> --}}


                            </div>
                        </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>


                <div id="doc-afqp" class="tabcontent">
                    <div class="orig-head">
                        Annexure For Qualification Protocol
                    </div>
                    <div class="input-fields">
                        <div class="row">

                        <!-- <div class="col-12 sub-head">
                            STANDARD TESTING PROCEDURE
                        </div> -->

                        <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b> Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="attachement_afqp">
                                            @if ($document->document_content->afqpattachement)
                                                @foreach(json_decode($document->document_content->afqpattachement) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_afqpattachement[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="afqpfile" style="cursor: pointer;">Add</label>
                                            <input type="file" id="afqpfile" name="afqpattachement[]"
                                                oninput="addMultipleFiles(this, 'attachement_afqp')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_afqpattachement" name="deleted_afqpattachement" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_afqpattachement');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>









                        </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>
                <div id="doc-afqr" class="tabcontent">
                    <div class="orig-head">
                        Annexure For Qualification Report
                    </div>
                    <div class="input-fields">
                        <div class="row">

                        <!-- <div class="col-12 sub-head">
                            STANDARD TESTING PROCEDURE
                        </div> -->




                        <div class="col-12">
                            <div class="group-input">
                                <label for="File_Attachment"><b>File Attachment</b></label>
                                <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                <div class="file-attachment-field">
                                    <div class="file-attachment-list" id="attachement_afqr">
                                        @if ($document->document_content->afqrattachement)
                                            @foreach(json_decode($document->document_content->afqrattachement) as $file)
                                                <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                    <b>{{ $file }}</b>
                                                    <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                        <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                    </a>
                                                    <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                        <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                    </a>
                                                    <input type="hidden" name="existing_afqrattachement[]" value="{{ $file }}">
                                                </h6>
                                            @endforeach
                                        @endif
                                    </div>

                                    <div class="add-btn">
                                        <label for="afqrfile" style="cursor: pointer;">Add</label>
                                        <input type="file" id="afqrfile" name="afqrattachement[]"
                                            oninput="addMultipleFiles(this, 'attachement_afqr')" multiple hidden>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden field to store deleted files -->
                        <input type="hidden" id="deleted_afqrattachement" name="deleted_afqrattachement" value="">

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                document.querySelectorAll('.remove-file').forEach(button => {
                                    button.addEventListener('click', function () {
                                        const fileName = this.getAttribute('data-file-name');
                                        const fileContainer = this.closest('.file-container');

                                        if (fileContainer) {
                                            fileContainer.style.display = 'none';

                                            const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                            if (hiddenInput) {
                                                hiddenInput.remove();
                                            }

                                            const deletedFilesInput = document.getElementById('deleted_afqrattachement');
                                            let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                            deletedFiles.push(fileName);
                                            deletedFilesInput.value = deletedFiles.join(',');
                                        }
                                    });
                                });
                            });

                            function addMultipleFiles(input, listId) {
                                let fileList = document.getElementById(listId);
                                for (let file of input.files) {
                                    let fileContainer = document.createElement('h6');
                                    fileContainer.classList.add('file-container', 'text-dark');
                                    fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                    let fileText = document.createElement('b');
                                    fileText.textContent = file.name;

                                    let removeLink = document.createElement('a');
                                    removeLink.classList.add('remove-file');
                                    removeLink.dataset.fileName = file.name;
                                    removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                    removeLink.addEventListener('click', function () {
                                        fileContainer.style.display = 'none';
                                    });

                                    fileContainer.appendChild(fileText);
                                    fileContainer.appendChild(removeLink);
                                    fileList.appendChild(fileContainer);
                                }
                            }
                        </script>





                        </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>

                <div id="doc-afurs" class="tabcontent">
                    <div class="orig-head">
                        Annexure For User Requirement Specification
                    </div>
                    <div class="input-fields">
                        <div class="row">

                        <!-- <div class="col-12 sub-head">
                            STANDARD TESTING PROCEDURE
                        </div> -->

                        <div class="col-12">
                            <div class="group-input">
                                <label for="File_Attachment"><b> Attachment</b></label>
                                <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                <div class="file-attachment-field">
                                    <div class="file-attachment-list" id="attachement_afurs">
                                        @if ($document->document_content->afursattachement)
                                            @foreach(json_decode($document->document_content->afursattachement) as $file)
                                                <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                    <b>{{ $file }}</b>
                                                    <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                        <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                    </a>
                                                    <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                        <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                    </a>
                                                    <input type="hidden" name="existing_afursattachement[]" value="{{ $file }}">
                                                </h6>
                                            @endforeach
                                        @endif
                                    </div>

                                    <div class="add-btn">
                                        <label for="afursfile" style="cursor: pointer;">Add</label>
                                        <input type="file" id="afursfile" name="afursattachement[]"
                                            oninput="addMultipleFiles(this, 'attachement_afurs')" multiple hidden>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden field to store deleted files -->
                        <input type="hidden" id="deleted_afursattachement" name="deleted_afursattachement" value="">

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                document.querySelectorAll('.remove-file').forEach(button => {
                                    button.addEventListener('click', function () {
                                        const fileName = this.getAttribute('data-file-name');
                                        const fileContainer = this.closest('.file-container');

                                        if (fileContainer) {
                                            fileContainer.style.display = 'none';

                                            const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                            if (hiddenInput) {
                                                hiddenInput.remove();
                                            }

                                            const deletedFilesInput = document.getElementById('deleted_afursattachement');
                                            let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                            deletedFiles.push(fileName);
                                            deletedFilesInput.value = deletedFiles.join(',');
                                        }
                                    });
                                });
                            });

                            function addMultipleFiles(input, listId) {
                                let fileList = document.getElementById(listId);
                                for (let file of input.files) {
                                    let fileContainer = document.createElement('h6');
                                    fileContainer.classList.add('file-container', 'text-dark');
                                    fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                    let fileText = document.createElement('b');
                                    fileText.textContent = file.name;

                                    let removeLink = document.createElement('a');
                                    removeLink.classList.add('remove-file');
                                    removeLink.dataset.fileName = file.name;
                                    removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                    removeLink.addEventListener('click', function () {
                                        fileContainer.style.display = 'none';
                                    });

                                    fileContainer.appendChild(fileText);
                                    fileContainer.appendChild(removeLink);
                                    fileList.appendChild(fileContainer);
                                }
                            }
                        </script>










                        </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>

                <div id="doc-aqp" class="tabcontent">
                    <div class="orig-head">
                        Area Qualification Protocol
                    </div>
                    <div class="input-fields">
                        <div class="row">

                        <!-- <div class="col-12 sub-head">
                            STANDARD TESTING PROCEDURE
                        </div> -->

                       <div class="col-12">
                                <div class="group-input">
                                    <label for="File_Attachment"><b> Attachment</b></label>
                                    <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                    <div class="file-attachment-field">
                                        <div class="file-attachment-list" id="attachement_aqp">
                                            @if ($document->document_content->aqpattachement)
                                                @foreach(json_decode($document->document_content->aqpattachement) as $file)
                                                    <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                        <b>{{ $file }}</b>
                                                        <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                            <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                        </a>
                                                        <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                            <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                        </a>
                                                        <input type="hidden" name="existing_aqpattachement[]" value="{{ $file }}">
                                                    </h6>
                                                @endforeach
                                            @endif
                                        </div>

                                        <div class="add-btn">
                                            <label for="aqpfile" style="cursor: pointer;">Add</label>
                                            <input type="file" id="aqpfile" name="aqpattachement[]"
                                                oninput="addMultipleFiles(this, 'attachement_aqp')" multiple hidden>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden field to store deleted files -->
                            <input type="hidden" id="deleted_aqpattachement" name="deleted_aqpattachement" value="">

                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    document.querySelectorAll('.remove-file').forEach(button => {
                                        button.addEventListener('click', function () {
                                            const fileName = this.getAttribute('data-file-name');
                                            const fileContainer = this.closest('.file-container');

                                            if (fileContainer) {
                                                fileContainer.style.display = 'none';

                                                const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                if (hiddenInput) {
                                                    hiddenInput.remove();
                                                }

                                                const deletedFilesInput = document.getElementById('deleted_aqpattachement');
                                                let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                deletedFiles.push(fileName);
                                                deletedFilesInput.value = deletedFiles.join(',');
                                            }
                                        });
                                    });
                                });

                                function addMultipleFiles(input, listId) {
                                    let fileList = document.getElementById(listId);
                                    for (let file of input.files) {
                                        let fileContainer = document.createElement('h6');
                                        fileContainer.classList.add('file-container', 'text-dark');
                                        fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                        let fileText = document.createElement('b');
                                        fileText.textContent = file.name;

                                        let removeLink = document.createElement('a');
                                        removeLink.classList.add('remove-file');
                                        removeLink.dataset.fileName = file.name;
                                        removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                        removeLink.addEventListener('click', function () {
                                            fileContainer.style.display = 'none';
                                        });

                                        fileContainer.appendChild(fileText);
                                        fileContainer.appendChild(removeLink);
                                        fileList.appendChild(fileContainer);
                                    }
                                }
                            </script>











                        </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>
                <div id="doc-aqr" class="tabcontent">
                    <div class="orig-head">
                        Area Qualification Report
                    </div>
                    <div class="input-fields">
                        <div class="row">

                        <!-- <div class="col-12 sub-head">
                            STANDARD TESTING PROCEDURE
                        </div> -->

                        <div class="col-12">
                            <div class="group-input">
                                <label for="File_Attachment"><b> Attachment</b></label>
                                <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                <div class="file-attachment-field">
                                    <div class="file-attachment-list" id="attachement_aqr">
                                        @if ($document->document_content->aqrattachement)
                                            @foreach(json_decode($document->document_content->aqrattachement) as $file)
                                                <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                    <b>{{ $file }}</b>
                                                    <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                        <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                    </a>
                                                    <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                        <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                    </a>
                                                    <input type="hidden" name="existing_aqrattachement[]" value="{{ $file }}">
                                                </h6>
                                            @endforeach
                                        @endif
                                    </div>

                                    <div class="add-btn">
                                        <label for="aqrfile" style="cursor: pointer;">Add</label>
                                        <input type="file" id="aqrfile" name="aqrattachement[]"
                                            oninput="addMultipleFiles(this, 'attachement_aqr')" multiple hidden>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden field to store deleted files -->
                        <input type="hidden" id="deleted_aqrattachement" name="deleted_aqrattachement" value="">

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                document.querySelectorAll('.remove-file').forEach(button => {
                                    button.addEventListener('click', function () {
                                        const fileName = this.getAttribute('data-file-name');
                                        const fileContainer = this.closest('.file-container');

                                        if (fileContainer) {
                                            fileContainer.style.display = 'none';

                                            const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                            if (hiddenInput) {
                                                hiddenInput.remove();
                                            }

                                            const deletedFilesInput = document.getElementById('deleted_aqrattachement');
                                            let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                            deletedFiles.push(fileName);
                                            deletedFilesInput.value = deletedFiles.join(',');
                                        }
                                    });
                                });
                            });

                            function addMultipleFiles(input, listId) {
                                let fileList = document.getElementById(listId);
                                for (let file of input.files) {
                                    let fileContainer = document.createElement('h6');
                                    fileContainer.classList.add('file-container', 'text-dark');
                                    fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                    let fileText = document.createElement('b');
                                    fileText.textContent = file.name;

                                    let removeLink = document.createElement('a');
                                    removeLink.classList.add('remove-file');
                                    removeLink.dataset.fileName = file.name;
                                    removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                    removeLink.addEventListener('click', function () {
                                        fileContainer.style.display = 'none';
                                    });

                                    fileContainer.appendChild(fileText);
                                    fileContainer.appendChild(removeLink);
                                    fileList.appendChild(fileContainer);
                                }
                            }
                        </script>









                        </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>

                <div id="doc-pfmf" class="tabcontent">
                    <div class="orig-head">
                        Protocol For Media Fill
                    </div>
                    <div class="input-fields">
                        <div class="row">

                        <!-- <div class="col-12 sub-head">
                            STANDARD TESTING PROCEDURE
                        </div> -->

                        <div class="col-12">
                            <div class="group-input">
                                <label for="File_Attachment"><b> Attachment</b></label>
                                <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                <div class="file-attachment-field">
                                    <div class="file-attachment-list" id="attachement_pfmf">
                                        @if ($document->document_content->pfmfattachement)
                                            @foreach(json_decode($document->document_content->pfmfattachement) as $file)
                                                <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                    <b>{{ $file }}</b>
                                                    <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                        <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                    </a>
                                                    <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                        <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                    </a>
                                                    <input type="hidden" name="existing_pfmfattachement[]" value="{{ $file }}">
                                                </h6>
                                            @endforeach
                                        @endif
                                    </div>

                                    <div class="add-btn">
                                        <label for="pfmffile" style="cursor: pointer;">Add</label>
                                        <input type="file" id="pfmffile" name="pfmfattachement[]"
                                            oninput="addMultipleFiles(this, 'attachement_pfmf')" multiple hidden>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden field to store deleted files -->
                        <input type="hidden" id="deleted_pfmfattachement" name="deleted_pfmfattachement" value="">

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                document.querySelectorAll('.remove-file').forEach(button => {
                                    button.addEventListener('click', function () {
                                        const fileName = this.getAttribute('data-file-name');
                                        const fileContainer = this.closest('.file-container');

                                        if (fileContainer) {
                                            fileContainer.style.display = 'none';

                                            const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                            if (hiddenInput) {
                                                hiddenInput.remove();
                                            }

                                            const deletedFilesInput = document.getElementById('deleted_pfmfattachement');
                                            let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                            deletedFiles.push(fileName);
                                            deletedFilesInput.value = deletedFiles.join(',');
                                        }
                                    });
                                });
                            });

                            function addMultipleFiles(input, listId) {
                                let fileList = document.getElementById(listId);
                                for (let file of input.files) {
                                    let fileContainer = document.createElement('h6');
                                    fileContainer.classList.add('file-container', 'text-dark');
                                    fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                    let fileText = document.createElement('b');
                                    fileText.textContent = file.name;

                                    let removeLink = document.createElement('a');
                                    removeLink.classList.add('remove-file');
                                    removeLink.dataset.fileName = file.name;
                                    removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                    removeLink.addEventListener('click', function () {
                                        fileContainer.style.display = 'none';
                                    });

                                    fileContainer.appendChild(fileText);
                                    fileContainer.appendChild(removeLink);
                                    fileList.appendChild(fileContainer);
                                }
                            }
                        </script>









                        </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>
                <div id="doc-rfmf" class="tabcontent">
                    <div class="orig-head">
                        Report For Media Fill
                    </div>
                    <div class="input-fields">
                        <div class="row">

                        <!-- <div class="col-12 sub-head">
                            STANDARD TESTING PROCEDURE
                        </div> -->

                        <div class="col-12">
                            <div class="group-input">
                                <label for="File_Attachment"><b> Attachment</b></label>
                                <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                <div class="file-attachment-field">
                                    <div class="file-attachment-list" id="attachement_rfmf">
                                        @if ($document->document_content->rfmfattachement)
                                            @foreach(json_decode($document->document_content->rfmfattachement) as $file)
                                                <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                    <b>{{ $file }}</b>
                                                    <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                        <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                    </a>
                                                    <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                        <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                    </a>
                                                    <input type="hidden" name="existing_rfmfattachement[]" value="{{ $file }}">
                                                </h6>
                                            @endforeach
                                        @endif
                                    </div>

                                    <div class="add-btn">
                                        <label for="rfmffile" style="cursor: pointer;">Add</label>
                                        <input type="file" id="rfmffile" name="rfmfattachement[]"
                                            oninput="addMultipleFiles(this, 'attachement_rfmf')" multiple hidden>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden field to store deleted files -->
                        <input type="hidden" id="deleted_rfmfattachement" name="deleted_rfmfattachement" value="">

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                document.querySelectorAll('.remove-file').forEach(button => {
                                    button.addEventListener('click', function () {
                                        const fileName = this.getAttribute('data-file-name');
                                        const fileContainer = this.closest('.file-container');

                                        if (fileContainer) {
                                            fileContainer.style.display = 'none';

                                            const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                            if (hiddenInput) {
                                                hiddenInput.remove();
                                            }

                                            const deletedFilesInput = document.getElementById('deleted_rfmfattachement');
                                            let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                            deletedFiles.push(fileName);
                                            deletedFilesInput.value = deletedFiles.join(',');
                                        }
                                    });
                                });
                            });

                            function addMultipleFiles(input, listId) {
                                let fileList = document.getElementById(listId);
                                for (let file of input.files) {
                                    let fileContainer = document.createElement('h6');
                                    fileContainer.classList.add('file-container', 'text-dark');
                                    fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                    let fileText = document.createElement('b');
                                    fileText.textContent = file.name;

                                    let removeLink = document.createElement('a');
                                    removeLink.classList.add('remove-file');
                                    removeLink.dataset.fileName = file.name;
                                    removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                    removeLink.addEventListener('click', function () {
                                        fileContainer.style.display = 'none';
                                    });

                                    fileContainer.appendChild(fileText);
                                    fileContainer.appendChild(removeLink);
                                    fileList.appendChild(fileContainer);
                                }
                            }
                        </script>












                        </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>


                <div id="doc-asr" class="tabcontent">
                    <div class="orig-head">
                        annexure-XIX - System Retirement
                    </div>
                    <div class="input-fields">
                        <div class="row">

                        <!-- <div class="col-12 sub-head">
                            STANDARD TESTING PROCEDURE
                        </div> -->
                        <div class="col-12">
                            <div class="group-input">
                                <label for="File_Attachment"><b> Attachment</b></label>
                                <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                <div class="file-attachment-field">
                                    <div class="file-attachment-list" id="attachement_asr">
                                        @if ($document->document_content->annex_XIX_syst_retir_attachment)
                                            @foreach(json_decode($document->document_content->annex_XIX_syst_retir_attachment) as $file)
                                                <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                    <b>{{ $file }}</b>
                                                    <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                        <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                    </a>
                                                    <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                        <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                    </a>
                                                    <input type="hidden" name="existing_annex_XIX_syst_retir_attachment[]" value="{{ $file }}">
                                                </h6>
                                            @endforeach
                                        @endif
                                    </div>

                                    <div class="add-btn">
                                        <label for="asrfile" style="cursor: pointer;">Add</label>
                                        <input type="file" id="asrfile" name="annex_XIX_syst_retir_attachment[]"
                                            oninput="addMultipleFiles(this, 'attachement_asr')" multiple hidden>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden field to store deleted files -->
                        <input type="hidden" id="deleted_annex_XIX_syst_retir_attachment" name="deleted_annex_XIX_syst_retir_attachment" value="">

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                document.querySelectorAll('.remove-file').forEach(button => {
                                    button.addEventListener('click', function () {
                                        const fileName = this.getAttribute('data-file-name');
                                        const fileContainer = this.closest('.file-container');

                                        if (fileContainer) {
                                            fileContainer.style.display = 'none';

                                            const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                            if (hiddenInput) {
                                                hiddenInput.remove();
                                            }

                                            const deletedFilesInput = document.getElementById('deleted_annex_XIX_syst_retir_attachment');
                                            let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                            deletedFiles.push(fileName);
                                            deletedFilesInput.value = deletedFiles.join(',');
                                        }
                                    });
                                });
                            });

                            function addMultipleFiles(input, listId) {
                                let fileList = document.getElementById(listId);
                                for (let file of input.files) {
                                    let fileContainer = document.createElement('h6');
                                    fileContainer.classList.add('file-container', 'text-dark');
                                    fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                    let fileText = document.createElement('b');
                                    fileText.textContent = file.name;

                                    let removeLink = document.createElement('a');
                                    removeLink.classList.add('remove-file');
                                    removeLink.dataset.fileName = file.name;
                                    removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                    removeLink.addEventListener('click', function () {
                                        fileContainer.style.display = 'none';
                                    });

                                    fileContainer.appendChild(fileText);
                                    fileContainer.appendChild(removeLink);
                                    fileList.appendChild(fileContainer);
                                }
                            }
                        </script>






                        </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>

                <div id="doc-atm" class="tabcontent">
                    <div class="orig-head">
                        annexure-XVIII - Traceability Matrix
                    </div>
                    <div class="input-fields">
                        <div class="row">

                        <!-- <div class="col-12 sub-head">
                            STANDARD TESTING PROCEDURE
                        </div> -->
                        <div class="col-12">
                            <div class="group-input">
                                <label for="File_Attachment"><b> Attachment</b></label>
                                <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                <div class="file-attachment-field">
                                    <div class="file-attachment-list" id="attachement_atm">
                                        @if ($document->document_content->annex_XVIII_trac_matri_attachment)
                                            @foreach(json_decode($document->document_content->annex_XVIII_trac_matri_attachment) as $file)
                                                <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                    <b>{{ $file }}</b>
                                                    <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                        <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                    </a>
                                                    <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                        <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                    </a>
                                                    <input type="hidden" name="existing_annex_XVIII_trac_matri_attachment[]" value="{{ $file }}">
                                                </h6>
                                            @endforeach
                                        @endif
                                    </div>

                                    <div class="add-btn">
                                        <label for="atmfile" style="cursor: pointer;">Add</label>
                                        <input type="file" id="atmfile" name="annex_XVIII_trac_matri_attachment[]"
                                            oninput="addMultipleFiles(this, 'attachement_atm')" multiple hidden>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden field to store deleted files -->
                        <input type="hidden" id="deleted_annex_XVIII_trac_matri_attachment" name="deleted_annex_XVIII_trac_matri_attachment" value="">

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                document.querySelectorAll('.remove-file').forEach(button => {
                                    button.addEventListener('click', function () {
                                        const fileName = this.getAttribute('data-file-name');
                                        const fileContainer = this.closest('.file-container');

                                        if (fileContainer) {
                                            fileContainer.style.display = 'none';

                                            const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                            if (hiddenInput) {
                                                hiddenInput.remove();
                                            }

                                            const deletedFilesInput = document.getElementById('deleted_annex_XVIII_trac_matri_attachment');
                                            let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                            deletedFiles.push(fileName);
                                            deletedFilesInput.value = deletedFiles.join(',');
                                        }
                                    });
                                });
                            });

                            function addMultipleFiles(input, listId) {
                                let fileList = document.getElementById(listId);
                                for (let file of input.files) {
                                    let fileContainer = document.createElement('h6');
                                    fileContainer.classList.add('file-container', 'text-dark');
                                    fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                    let fileText = document.createElement('b');
                                    fileText.textContent = file.name;

                                    let removeLink = document.createElement('a');
                                    removeLink.classList.add('remove-file');
                                    removeLink.dataset.fileName = file.name;
                                    removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                    removeLink.addEventListener('click', function () {
                                        fileContainer.style.display = 'none';
                                    });

                                    fileContainer.appendChild(fileText);
                                    fileContainer.appendChild(removeLink);
                                    fileList.appendChild(fileContainer);
                                }
                            }
                        </script>



                        </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>

                <div id="doc-avsr" class="tabcontent">
                    <div class="orig-head">
                        annexure-XVII - Validation Summary Report

                    </div>
                    <div class="input-fields">
                        <div class="row">

                        <!-- <div class="col-12 sub-head">
                            STANDARD TESTING PROCEDURE
                        </div> -->
                        <div class="col-12">
                            <div class="group-input">
                                <label for="File_Attachment"><b> Attachment</b></label>
                                <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                <div class="file-attachment-field">
                                    <div class="file-attachment-list" id="attachement_avsr">
                                        @if ($document->document_content->annex_XVII_valid_summ_attachment)
                                            @foreach(json_decode($document->document_content->annex_XVII_valid_summ_attachment) as $file)
                                                <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                    <b>{{ $file }}</b>
                                                    <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                        <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                    </a>
                                                    <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                        <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                    </a>
                                                    <input type="hidden" name="existing_annex_XVII_valid_summ_attachment[]" value="{{ $file }}">
                                                </h6>
                                            @endforeach
                                        @endif
                                    </div>

                                    <div class="add-btn">
                                        <label for="avsrfile" style="cursor: pointer;">Add</label>
                                        <input type="file" id="avsrfile" name="annex_XVII_valid_summ_attachment[]"
                                            oninput="addMultipleFiles(this, 'attachement_avsr')" multiple hidden>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden field to store deleted files -->
                        <input type="hidden" id="deleted_annex_XVII_valid_summ_attachment" name="deleted_annex_XVII_valid_summ_attachment" value="">

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                document.querySelectorAll('.remove-file').forEach(button => {
                                    button.addEventListener('click', function () {
                                        const fileName = this.getAttribute('data-file-name');
                                        const fileContainer = this.closest('.file-container');

                                        if (fileContainer) {
                                            fileContainer.style.display = 'none';

                                            const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                            if (hiddenInput) {
                                                hiddenInput.remove();
                                            }

                                            const deletedFilesInput = document.getElementById('deleted_annex_XVII_valid_summ_attachment');
                                            let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                            deletedFiles.push(fileName);
                                            deletedFilesInput.value = deletedFiles.join(',');
                                        }
                                    });
                                });
                            });

                            function addMultipleFiles(input, listId) {
                                let fileList = document.getElementById(listId);
                                for (let file of input.files) {
                                    let fileContainer = document.createElement('h6');
                                    fileContainer.classList.add('file-container', 'text-dark');
                                    fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                    let fileText = document.createElement('b');
                                    fileText.textContent = file.name;

                                    let removeLink = document.createElement('a');
                                    removeLink.classList.add('remove-file');
                                    removeLink.dataset.fileName = file.name;
                                    removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                    removeLink.addEventListener('click', function () {
                                        fileContainer.style.display = 'none';
                                    });

                                    fileContainer.appendChild(fileText);
                                    fileContainer.appendChild(removeLink);
                                    fileList.appendChild(fileContainer);
                                }
                            }
                        </script>






                        </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>

                <div id="doc-aiiopq" class="tabcontent">
                    <div class="orig-head">
                        annexure-XVI - Installation_Infrastructure_Operational_Performance Qualification
                    </div>
                    <div class="input-fields">
                        <div class="row">

                        <!-- <div class="col-12 sub-head">
                            STANDARD TESTING PROCEDURE
                        </div> -->
                        <div class="col-12">
                            <div class="group-input">
                                <label for="File_Attachment"><b> Attachment</b></label>
                                <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                <div class="file-attachment-field">
                                    <div class="file-attachment-list" id="attachement_aiiopq">
                                        @if ($document->document_content->annex_XVI_per_qualif_attachment)
                                            @foreach(json_decode($document->document_content->annex_XVI_per_qualif_attachment) as $file)
                                                <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                    <b>{{ $file }}</b>
                                                    <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                        <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                    </a>
                                                    <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                        <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                    </a>
                                                    <input type="hidden" name="existing_annex_XVI_per_qualif_attachment[]" value="{{ $file }}">
                                                </h6>
                                            @endforeach
                                        @endif
                                    </div>

                                    <div class="add-btn">
                                        <label for="aiiopqfile" style="cursor: pointer;">Add</label>
                                        <input type="file" id="aiiopqfile" name="annex_XVI_per_qualif_attachment[]"
                                            oninput="addMultipleFiles(this, 'attachement_aiiopq')" multiple hidden>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden field to store deleted files -->
                        <input type="hidden" id="deleted_annex_XVI_per_qualif_attachment" name="deleted_annex_XVI_per_qualif_attachment" value="">

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                document.querySelectorAll('.remove-file').forEach(button => {
                                    button.addEventListener('click', function () {
                                        const fileName = this.getAttribute('data-file-name');
                                        const fileContainer = this.closest('.file-container');

                                        if (fileContainer) {
                                            fileContainer.style.display = 'none';

                                            const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                            if (hiddenInput) {
                                                hiddenInput.remove();
                                            }

                                            const deletedFilesInput = document.getElementById('deleted_annex_XVI_per_qualif_attachment');
                                            let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                            deletedFiles.push(fileName);
                                            deletedFilesInput.value = deletedFiles.join(',');
                                        }
                                    });
                                });
                            });

                            function addMultipleFiles(input, listId) {
                                let fileList = document.getElementById(listId);
                                for (let file of input.files) {
                                    let fileContainer = document.createElement('h6');
                                    fileContainer.classList.add('file-container', 'text-dark');
                                    fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                    let fileText = document.createElement('b');
                                    fileText.textContent = file.name;

                                    let removeLink = document.createElement('a');
                                    removeLink.classList.add('remove-file');
                                    removeLink.dataset.fileName = file.name;
                                    removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                    removeLink.addEventListener('click', function () {
                                        fileContainer.style.display = 'none';
                                    });

                                    fileContainer.appendChild(fileText);
                                    fileContainer.appendChild(removeLink);
                                    fileList.appendChild(fileContainer);
                                }
                            }
                        </script>






                        </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>

                {{-- Packing validation Protocol --}}
                <div id="doc-pvp" class="tabcontent">
                    <div class="orig-head">
                        Packing validation Protocol</div>
                        <div class="input-fields">
                            <div class="row">
                            {{--
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="comments">Dosage Form</label>
                                        <input type="text" name="dosageform_pvp" value="{{$document->document_content->dosageform_pvp}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="train-require">Packing Validation Protocol for</label>
                                        <input type="text" name="packingvalidation_pvp" value="{{$document->document_content->packingvalidation_pvp}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="comments">PRODUCT NAME</label>
                                        <input type="text" name="productname_pvp" value="{{$document->document_content->productname_pvp}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="train-require">Protocol No</label>
                                        <input type="text" name="protocolno_pvp" value="{{$document->document_content->protocolno_pvp}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="comments">Batch No</label>
                                        <input type="text" name="batchno_pvp" value="{{$document->document_content->batchno_pvp}}">
                                    </div>
                                </div>


                                <div class="">
                                    PRODUCT DETAILS
                                  </div>  <br>
                                  <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="purpose">Generic Name </label>
                                        <input type="text" name="generic_pvp" value="{{$document->document_content->generic_pvp}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Product Code</label>
                                        <input type="text" name="pvp_product_code" value="{{$document->document_content->pvp_product_code}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Std. Batch size </label>
                                        <input type="text" name="pvp_std_batch" value="{{$document->document_content->pvp_std_batch}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Category</label>
                                        <input type="text" name="pvp_category" value="{{$document->document_content->pvp_category}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Label Claim  </label>
                                        <input type="text" name="pvp_label_claim" value="{{$document->document_content->pvp_label_claim}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Market</label>
                                        <input type="text" name="pvp_market" value="{{$document->document_content->pvp_market}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">Shelf Life</label>
                                        <input type="text" name="pvp_shelf_life" value="{{$document->document_content->pvp_shelf_life}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">BMR No.</label>
                                        <input type="text" name="pvp_bmr_no" value="{{$document->document_content->pvp_bmr_no}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="scope">MFR No.</label>
                                        <input type="text" name="pvp_mfr_no" value="{{$document->document_content->pvp_mfr_no}}">
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Purpose">Purpose</label>
                                        <textarea name="pvp_purpose">{{$document->document_content->pvp_purpose}}</textarea>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="scope">Scope</label>
                                        <textarea name="pvp_scope">{{$document->document_content->pvp_scope}}</textarea>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="reasonforvalidationpvp" id="reasonforvalidationpvp">
                                            Reason for validation<button type="button" id="reasonforvalidationpvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="reasonforvalidationpvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->reasonfor_validationpvp))
                                                @foreach (unserialize($document->document_content->reasonfor_validationpvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subreasonforvalidationpvpAdd' : 'reasonforvalidationpvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="reasonfor_validationpvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="reasonfor_validationpvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subreasonforvalidationpvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="reasonforvalidationpvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="reasonfor_validationpvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subreasonforvalidationpvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Reason for validation' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="responsibilitypvp" id="responsibilitypvp">
                                            Responsibility<button type="button" id="responsibilitypvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="responsibilitypvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->pvp_responsibility))
                                                @foreach (unserialize($document->document_content->pvp_responsibility) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subresponsibilitypvpAdd' : 'responsibilitypvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="pvp_responsibility[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="pvp_responsibility[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subresponsibilitypvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="responsibilitypvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="pvp_responsibility[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subresponsibilitypvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Responsibility' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="validationpvp" id="validationpvp">
                                            Validation Policy<button type="button" id="validationpvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="validationpvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->pvp_validationpvp))
                                                @foreach (unserialize($document->document_content->pvp_validationpvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subvalidationpvpAdd' : 'validationpvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="pvp_validationpvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="pvp_validationpvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subvalidationpvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="validationpvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="pvp_validationpvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subvalidationpvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Validation Policy' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="descriptionsoppvp" id="descriptionsoppvp">
                                            Description of SOP<button type="button" id="descriptionsoppvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="descriptionsoppvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->descriptionsop_pvp))
                                                @foreach (unserialize($document->document_content->descriptionsop_pvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subdescriptionsoppvpAdd' : 'descriptionsoppvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="descriptionsop_pvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="descriptionsop_pvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subdescriptionsoppvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="descriptionsoppvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="descriptionsop_pvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subdescriptionsoppvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Description of SOP' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="packingmaterialpvp" id="packingmaterialpvp">
                                            Packing material approved vendor details<button type="button" id="packingmaterialpvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="packingmaterialpvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->packingmaterial_pvp))
                                                @foreach (unserialize($document->document_content->packingmaterial_pvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subpackingmaterialpvpAdd' : 'packingmaterialpvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="packingmaterial_pvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="packingmaterial_pvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subpackingmaterialpvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="packingmaterialpvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="packingmaterial_pvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subpackingmaterialpvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Packing material approved vendor details' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="equipmentpvp" id="equipmentpvp">
                                            Equipment Calibration & Qualification Status<button type="button" id="equipmentpvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="equipmentpvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->equipment_pvp))
                                                @foreach (unserialize($document->document_content->equipment_pvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subequipmentpvpAdd' : 'equipmentpvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="equipment_pvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="equipment_pvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subequipmentpvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="equipmentpvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="equipment_pvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subequipmentpvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Equipment Calibration & Qualification Status' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="rationalepvp" id="rationalepvp">
                                            Rationale for selection of critical steps<button type="button" id="rationalepvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="rationalepvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->rationale_pvp))
                                                @foreach (unserialize($document->document_content->rationale_pvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subrationalepvpAdd' : 'rationalepvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="rationale_pvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="rationale_pvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subrationalepvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="rationalepvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="rationale_pvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subrationalepvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Rationale for selection of critical steps' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="samplingpvp" id="samplingpvp">
                                            Sampling Plan & Procedure<button type="button" id="samplingpvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="samplingpvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->sampling_pvp))
                                                @foreach (unserialize($document->document_content->sampling_pvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subsamplingpvpAdd' : 'samplingpvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="sampling_pvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="sampling_pvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subsamplingpvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="samplingpvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="sampling_pvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subsamplingpvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Sampling Plan & Procedure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Criticalpvp" id="Criticalpvp">
                                            Critical Process Parameters & Critical quality Attributes<button type="button" id="Criticalpvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="Criticalpvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->critical_pvp))
                                                @foreach (unserialize($document->document_content->critical_pvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subCriticalpvpAdd' : 'CriticalpvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="critical_pvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="critical_pvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subCriticalpvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="CriticalpvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="critical_pvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subCriticalpvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Critical Process Parameters & Critical quality Attributes' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="ProductAcceptancepvp" id="ProductAcceptancepvp">
                                            Product Acceptance Criteria<button type="button" id="ProductAcceptancepvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="ProductAcceptancepvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->product_acceptancepvp))
                                                @foreach (unserialize($document->document_content->product_acceptancepvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subProductAcceptancepvpAdd' : 'ProductAcceptancepvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="product_acceptancepvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="product_acceptancepvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subProductAcceptancepvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="ProductAcceptancepvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="product_acceptancepvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subProductAcceptancepvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Product Acceptance Criteria' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Holdtimepvp" id="Holdtimepvp">
                                            Hold time study<button type="button" id="Holdtimepvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="Holdtimepvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->Holdtime_pvp))
                                                @foreach (unserialize($document->document_content->Holdtime_pvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subHoldtimepvpAdd' : 'HoldtimepvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="Holdtime_pvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="Holdtime_pvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subHoldtimepvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="HoldtimepvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="Holdtime_pvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subHoldtimepvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Hold time study' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Cleaningvalidationpvp" id="Cleaningvalidationpvp">
                                            Cleaning validation<button type="button" id="Cleaningvalidationpvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="Cleaningvalidationpvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->cleaning_validationpvp))
                                                @foreach (unserialize($document->document_content->cleaning_validationpvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subCleaningvalidationpvpAdd' : 'CleaningvalidationpvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="cleaning_validationpvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="cleaning_validationpvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subCleaningvalidationpvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="CleaningvalidationpvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="cleaning_validationpvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subCleaningvalidationpvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Cleaning validation' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Stabilitystudypvp" id="Stabilitystudypvp">
                                            Stability study<button type="button" id="Stabilitystudypvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="Stabilitystudypvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->Stability_studypvp))
                                                @foreach (unserialize($document->document_content->Stability_studypvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subStabilitystudypvpAdd' : 'StabilitystudypvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="Stability_studypvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="Stability_studypvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subStabilitystudypvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="StabilitystudypvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="Stability_studypvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subStabilitystudypvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Stability study' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Deviationpvp" id="Deviationpvp">
                                            Deviation<button type="button" id="Deviationpvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="Deviationpvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->Deviation_pvp))
                                                @foreach (unserialize($document->document_content->Deviation_pvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subDeviationpvpAdd' : 'DeviationpvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="Deviation_pvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="Deviation_pvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subDeviationpvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="DeviationpvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="Deviation_pvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subDeviationpvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Deviation' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Changecontrolpvp" id="Changecontrolpvp">
                                            Change control<button type="button" id="Changecontrolpvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="Changecontrolpvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->Change_controlpvp))
                                                @foreach (unserialize($document->document_content->Change_controlpvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subChangecontrolpvpAdd' : 'ChangecontrolpvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="Change_controlpvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="Change_controlpvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subChangecontrolpvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="ChangecontrolpvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="Change_controlpvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subChangecontrolpvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Change control' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Summarypvp" id="Summarypvp">
                                            Summary<button type="button" id="Summarypvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="Summarypvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->Summary_pvp))
                                                @foreach (unserialize($document->document_content->Summary_pvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subSummarypvpAdd' : 'SummarypvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="Summary_pvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="Summary_pvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subSummarypvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="SummarypvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="Summary_pvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subSummarypvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Summary' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="group-input">
                                        <label for="Conclusionpvp" id="Conclusionpvp">
                                            Conclusion<button type="button" id="Conclusionpvpbtnadd" name="button"
                                                {{ Helpers::isRevised($document->stage) }}>+</button>
                                        </label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not
                                                require completion</small></div>
                                        <div id="Conclusionpvpdiv">
                                            @if ($document->document_content && !empty($document->document_content->Conclusion_pvp))
                                                @foreach (unserialize($document->document_content->Conclusion_pvp) as $key => $data)
                                                    <div
                                                        class="{{ str_contains($key, 'sub') ? 'subConclusionpvpAdd' : 'ConclusionpvpBlock' }}">
                                                        @if (str_contains($key, 'sub'))
                                                            <div class="resrow row">
                                                                <div class="col-6">
                                                                    <textarea name="Conclusion_pvp[{{ $key }}]" class="myclassname">{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-1">
                                                                    <button
                                                                        class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                                </div>
                                                            </div>
                                                        @else
                                                            <div class="row">
                                                                <div class="col-sm-10">
                                                                    <textarea name="Conclusion_pvp[]" class="myclassname" {{ Helpers::isRevised($document->stage) }}>{{ $data }}</textarea>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-dark subConclusionpvpAdd">+</button>
                                                                </div>
                                                                <div class="col-sm-1">
                                                                    <button
                                                                        class="btn btn-danger removeAllBlocks">Remove</button>
                                                                </div>
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                            @else
                                                <div class="ConclusionpvpBlock">
                                                    <div class="row">
                                                        <div class="col-sm-10">
                                                            <textarea name="Conclusion_pvp[]" class="myclassname"></textarea>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button class="btn btn-dark subConclusionpvpAdd">+</button>
                                                        </div>
                                                        <div class="col-sm-1">
                                                            <button
                                                                class="btn btn-danger abbreviationbtnRemove">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            @endif
                                        </div>

                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Conclusion' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                            --}}







                                {{-- <div class="input-fields">
                                    <div class="group-input">
                                        <label for="distribution-list" style="font-weight: bold;">
                                            Distribution List
                                        </label>
                                        <div class="table-responsive retrieve-table">
                                            <table class="table table-bordered" id="distribution-list">
                                                <thead>
                                                    <tr>
                                                        <th>Row</th>
                                                        <th class="copy-name">Copy</th>
                                                        <th class="copy-name">No. of Copies</th>
                                                        <th class="copy-name">User Department</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>1</td>
                                                        <td style="font-weight: bold;">Master Copy</td>
                                                        <td><input type="text" id="copies-master"
                                                                name="master_copy_number" value=""
                                                                class="form-control">
                                                        </td>

                                                        <td>
                                                            <div class="col-md-6">
                                                                <div class="group-input">
                                                                    <input type="text" name="master_user_department">

                                                                </div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>2</td>
                                                        <td style="font-weight: bold;">Controlled Copy</td>
                                                        <td><input type="text" id="copies-controlled"
                                                                name="controlled_copy_number" value=""
                                                                class="form-control"></td>

                                                        <td>
                                                            <div class="col-md-6">
                                                                <div class="group-input">
                                                                <input type="text" name="controlled_user_department">

                                                                </div>
                                                            </div>
                                                        </td>

                                                    </tr>
                                                    <tr>
                                                        <td>3</td>
                                                        <td style="font-weight: bold;">Display Copy</td>
                                                        <td><input type="text" id="copies-display"
                                                                name="display_copy_number" value=""
                                                                class="form-control">
                                                        </td>
                                                        <td>
                                                            <div class="col-md-6">
                                                                <div class="group-input">
                                                                    <input type="text" name="display_user_department">

                                                                </div>
                                                            </div>
                                                        </td>

                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div> --}}


                                <div class="col-12">
                                    <div class="group-input">
                                        <label for="File_Attachment"><b> Attachment</b></label>
                                        <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                        <div class="file-attachment-field">
                                            <div class="file-attachment-list" id="attachement_pvp">
                                                @if ($document->document_content->pvpattachement)
                                                    @foreach(json_decode($document->document_content->pvpattachement) as $file)
                                                        <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                            <b>{{ $file }}</b>
                                                            <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                                <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                            </a>
                                                            <a type="button" class="remove-file" data-file-name="{{ $file }}">
                                                                <i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>
                                                            </a>
                                                            <input type="hidden" name="existing_pvpattachement[]" value="{{ $file }}">
                                                        </h6>
                                                    @endforeach
                                                @endif
                                            </div>

                                            <div class="add-btn">
                                                <label for="pvpfile" style="cursor: pointer;">Add</label>
                                                <input type="file" id="pvpfile" name="pvpattachement[]"
                                                    oninput="addMultipleFiles(this, 'attachement_pvp')" multiple hidden>
                                            </div>
                                        </div>
                                    </div>

                                            <!-- View Attachments Button -->
                                                <a href="{{ route('view.attachments', $document->id) }}" target="_blank" class="btn btn-primary mt-3">
                                                    View Attachments
                                                </a>
                                            
                                </div>
                                <input type="hidden" id="deleted_pvpattachement" name="deleted_pvpattachement" value="">



                                {{-- <div class="col-12">
                                    <div class="group-input">
                                        <label for="File_Attachment"><b>Attachment</b></label>
                                        <div><small class="text-primary">Please Attach all relevant or supporting documents</small></div>

                                        <div class="file-attachment-field">
                                            <div class="file-attachment-list" id="attachement_pvp">
                                                @if ($document->document_content->pvpattachement)
                                                    @foreach(json_decode($document->document_content->pvpattachement) as $file)
                                                        <h6 class="file-container text-dark" style="background-color: rgb(243, 242, 240);">
                                                            <b>{{ $file }}</b>
                                                            <a href="{{ asset('upload/' . $file) }}" target="_blank">
                                                                <i class="fa fa-eye text-primary" style="font-size:20px; margin-right:-10px;"></i>
                                                            </a>
                                                        </h6>
                                                    @endforeach
                                                @endif
                                            </div>

                                            <!-- View Attachments Button -->
                                            @if ($document->document_content->pvpattachement)
                                                <a href="{{ route('view.attachments', $document->id) }}" target="_blank" class="btn btn-primary mt-3">
                                                    View Attachments
                                                </a>
                                            @endif
                                        </div>
                                    </div>
                                </div> --}}


                                <script>
                                    document.addEventListener('DOMContentLoaded', function () {
                                        document.querySelectorAll('.remove-file').forEach(button => {
                                            button.addEventListener('click', function () {
                                                const fileName = this.getAttribute('data-file-name');
                                                const fileContainer = this.closest('.file-container');

                                                if (fileContainer) {
                                                    fileContainer.style.display = 'none';

                                                    const hiddenInput = fileContainer.querySelector('input[type="hidden"]');
                                                    if (hiddenInput) {
                                                        hiddenInput.remove();
                                                    }

                                                    const deletedFilesInput = document.getElementById('deleted_pvpattachement');
                                                    let deletedFiles = deletedFilesInput.value ? deletedFilesInput.value.split(',') : [];
                                                    deletedFiles.push(fileName);
                                                    deletedFilesInput.value = deletedFiles.join(',');
                                                }
                                            });
                                        });
                                    });

                                    function addMultipleFiles(input, listId) {
                                        let fileList = document.getElementById(listId);
                                        for (let file of input.files) {
                                            let fileContainer = document.createElement('h6');
                                            fileContainer.classList.add('file-container', 'text-dark');
                                            fileContainer.style.backgroundColor = 'rgb(243, 242, 240)';

                                            let fileText = document.createElement('b');
                                            fileText.textContent = file.name;

                                            let removeLink = document.createElement('a');
                                            removeLink.classList.add('remove-file');
                                            removeLink.dataset.fileName = file.name;
                                            removeLink.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color:red; font-size:20px;"></i>';
                                            removeLink.addEventListener('click', function () {
                                                fileContainer.style.display = 'none';
                                            });

                                            fileContainer.appendChild(fileText);
                                            fileContainer.appendChild(removeLink);
                                            fileList.appendChild(fileContainer);
                                        }
                                    }
                                </script>






                            </div>
                        </div>
                    <div class="button-block">
                        <button type="submit" value="save" name="submit" id="DocsaveButton"
                            class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" id="DocnextButton"
                            onclick="nextStep()">Next</button>
                        <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                            </a>
                        </button>
                    </div>
                </div>
                <!-- rajendra end -->

                {{-- Raw Material Specifications Tabs --}}
                    <div id="doc-rawms" class="tabcontent">
                        <div class="orig-head">Raw Material Specification</div>
                        <div class="input-fields">
                            <div class="row">

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="stp">Specification No</label>
                                        @php
                                            $revisionNumber = $document->revised == 'Yes' ? str_pad($document->revised_doc, 2, '0', STR_PAD_LEFT) : '00';
                                            $stpNumber = "RMS/" . str_pad($document->id, 4, '0', STR_PAD_LEFT) . "-$revisionNumber";
                                        @endphp
                                        <input type="text" id="stp" name="stp_mfps_no" value="{{ $stpNumber }}" maxlength="255" readonly>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="generic-name">CAS No.</label>
                                        <input type="text" name="cas_no_row_material" value="{{$document->cas_no_row_material}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="generic-name">Material Name</label>
                                        <input type="text" name="material_name" value="{{$document->material_name}}">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="brand-name">Molecular Formula</label>
                                        <input type="text" name="molecular_formula_row_material" value="{{$document->molecular_formula_row_material}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="label-claim">Molecular Weight</label>
                                        <input type="text" name="molecular_weight_row_material" value="{{$document->molecular_weight_row_material}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="product-code">Storage Condition</label>
                                        <input type="text" name="storage_condition_row_material" value="{{$document->storage_condition_row_material}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="retest-period">Retest Period</label>
                                        <input type="text" name="retest_period_row_material" value="{{$document->retest_period_row_material}}">
                                    </div>
                                </div>
                                {{-- <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="sampling-procedure">Sampling Procedure</label>
                                        <input type="text" name="sampling_procedure_row_material" value="{{$document->sampling_procedure_row_material}}">
                                    </div>
                                </div> --}}

                                <div class="col-12 sub-head">
                                      Sampling Procedure
                                    <div class="group-input">
                                        <label for="procedure"></label>
                                        <textarea name="sampling_procedure_row_material" id="summernote" class="summernote">{{ $document->sampling_procedure_row_material ? $document->sampling_procedure_row_material : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="item-code">Item Code</label>
                                        <input type="text" name="item_code_row_material" value="{{$document->item_code_row_material}}">
                                    </div>
                                </div>

                                {{-- <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="sample-quantity">Sample Quantity for Analysis</label>
                                        <select name="sample_quantity_row_material">
                                            <option value="" disabled {{ empty($document->sample_quantity_row_material) ? 'selected' : '' }}>--Select--</option>
                                            <option value="Chemical Analysis" {{ $document->sample_quantity_row_material == 'Chemical Analysis' ? 'selected' : '' }}>Chemical Analysis</option>
                                            <option value="Microbial Analysis" {{ $document->sample_quantity_row_material == 'Microbial Analysis' ? 'selected' : '' }}>Microbial Analysis</option>
                                        </select>
                                    </div>
                                </div> --}}

                                <div class="col-12 sub-head">
                                    Sample Quantity for Analysis
                                    <div class="group-input">
                                        <label for="procedure"></label>
                                        <textarea name="sample_quantity_row_material" id="summernote" class="summernote">{{ $document->sample_quantity_row_material ? $document->sample_quantity_row_material : '' }}</textarea>
                                        @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'Procedure' && !empty($tempHistory->comment))
                                                @php
                                                    $users_name = DB::table('users')
                                                        ->where('id', $tempHistory->user_id)
                                                        ->value('name');
                                                @endphp
                                                <p style="color: blue">Modify by {{ $users_name }} at
                                                    {{ $tempHistory->created_at }}
                                                </p>
                                                <input class="input-field"
                                                    style="background: #ffff0061;
                                        color: black;"
                                                    type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                        @endforeach
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="reserve-sample">Reserve Sample Quantity</label>
                                        <input type="text" name="reserve_sample_quantity_row_material" value="{{$document->reserve_sample_quantity_row_material}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="retest-sample">Sample Quantity for Retest</label>
                                        <input type="text" name="retest_sample_quantity_row_material" value="{{$document->retest_sample_quantity_row_material}}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="sampling-instructions">Sampling Instructions, Warnings, and Precautions</label>
                                        <input type="text" name="sampling_instructions_row_material" value="{{$document->sampling_instructions_row_material}}">
                                    </div>
                                </div>


                                {{-- <div class="col-12 sub-head">
                                    STANDARD TESTING PROCEDURE
                                </div> --}}
                                {{-- <div class="col-12">
                                    <div class="group-input">
                                        <label for="Specification Details">
                                            SPECIFICATION
                                            <button type="button" id="row_material_add">+</button>
                                        </label>
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="row_material_details" style="width: 100%;">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 100px;">Sr. No.</th>
                                                        <th>Test</th>
                                                        <th>Specification</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @php $rowIndex = 0; @endphp
                                                    @if(!empty($RowSpecification_Data) && is_array(json_decode($RowSpecification_Data->data, true)))
                                                        @foreach(json_decode($RowSpecification_Data->data, true) as $index => $spec)
                                                            <tr>
                                                                <td>
                                                                    <input disabled type="text" name="Row_Materail[{{ $rowIndex }}][serial]" value="{{ $rowIndex + 1 }}">
                                                                </td>
                                                                <td>
                                                                    <input type="text" name="Row_Materail[{{ $rowIndex }}][test]" value="{{ $spec['test'] ?? '' }}">
                                                                </td>
                                                                <td>
                                                                    <input type="text" name="Row_Materail[{{ $rowIndex }}][specification_row_material]" value="{{ $spec['specification_row_material'] ?? '' }}">
                                                                </td>
                                                                <td>
                                                                    <button type="button" class="removeRowBtn">Remove</button>
                                                                </td>
                                                            </tr>
                                                            @php $rowIndex++; @endphp
                                                        @endforeach
                                                    @else
                                                        <!-- Empty initial row -->
                                                        <tr>
                                                            <td>
                                                                <input disabled type="text" name="Row_Materail[0][serial]" value="1">
                                                            </td>
                                                            <td>
                                                                <input type="text" name="Row_Materail[0][test]" value="">
                                                            </td>
                                                            <td>
                                                                <input type="text" name="Row_Materail[0][specification_row_material]" value="">
                                                            </td>
                                                            <td>
                                                                <button type="button" class="removeRowBtn">Remove</button>
                                                            </td>
                                                        </tr>
                                                    @endif
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <script>
                                    $(document).ready(function () {
                                        // Add new row in Specification Details table
                                        $('#row_material_add').click(function (e) {
                                            e.preventDefault();

                                            var tableBody = $('#row_material_details tbody');
                                            var rowCount = tableBody.children('tr').length;

                                            var newRow = `
                                                <tr>
                                                    <td><input disabled type="text" name="Row_Materail[${rowCount}][serial]" value="${rowCount + 1}"></td>
                                                    <td><input type="text" name="Row_Materail[${rowCount}][test]"></td>
                                                    <td><input type="text" name="Row_Materail[${rowCount}][specification_row_material]"></td>
                                                    <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                </tr>
                                            `;
                                            tableBody.append(newRow);
                                        });

                                        // Remove row in Specification Details table
                                        $(document).on('click', '.removeRowBtn', function () {
                                            $(this).closest('tr').remove();

                                            // Recalculate serial numbers
                                            $('#row_material_details tbody tr').each(function (index) {
                                                $(this).find('td:first input').val(index + 1);
                                            });
                                        });
                                    });
                                </script> --}}

                                <div class="col-md-12 mb-3">
                                    <div class="group-input">
                                        <label for="rawmaterials_specifications">Specifications</label>
                                        <div><small class="text-primary">Please insert "NA" in the data field if it does not require completion</small></div>
                                        <textarea name="rawmaterials_specifications" class="summernote">
                                            {{ $document->rawmaterials_specifications }}
                                        </textarea>
                                    </div>
                                </div>

                                    <div class="group-input">
                                        <label for="action-plan-grid">
                                            Revision History<button type="button" name="action-plan-grid"
                                                    id="Rawms_revision">+</button>
                                        </label>
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="table_rawsm_revision">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 2%">Sr. No.</th>
                                                        <th style="width: 12%">Revision No.</th>
                                                        <th style="width: 12%">Change Control No./ DCRF No</th>
                                                        <th style="width: 12%">Effective Date</th>
                                                        <th style="width: 30%">Reason of revision</th>
                                                        <th style="width: 3%">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @php
                                                        $serialNumber = 1;
                                                        $GtpData = isset($RevisionGridrawmsData->data) && is_string($RevisionGridrawmsData->data)
                                                            ? json_decode($RevisionGridrawmsData->data, true)
                                                            : (is_array($RevisionGridrawmsData->data) ? $RevisionGridrawmsData->data : []);
                                                    @endphp

                                                    @if(!empty($GtpData))
                                                        @foreach($GtpData as $key => $gtp_data)
                                                            <tr>
                                                                <td>{{ $serialNumber++ }}</td>
                                                                <td><input type="text" name="revision_rawms_data[{{ $key }}][rev_rawms_no]" value="{{ $gtp_data['rev_rawms_no'] ?? '' }}"></td>
                                                                <td><input type="text" name="revision_rawms_data[{{ $key }}][change_ctrl_rawms_no]" value="{{ $gtp_data['change_ctrl_rawms_no'] ?? '' }}"></td>
                                                                <td><input type="date" name="revision_rawms_data[{{ $key }}][eff_date_rawms]" value="{{ $gtp_data['eff_date_rawms'] ?? '' }}"></td>
                                                                <td><input type="text" name="revision_rawms_data[{{ $key }}][rev_reason_rawms]" value="{{ $gtp_data['rev_reason_rawms'] ?? '' }}"></td>
                                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                            </tr>
                                                        @endforeach
                                                    @else
                                                        <tr>
                                                            <td>{{ $serialNumber++ }}</td>
                                                            <td><input type="text" name="revision_rawms_data[0][rev_rawms_no]"></td>
                                                            <td><input type="text" name="revision_rawms_data[0][change_ctrl_rawms_no]"></td>
                                                            <td><input type="date" name="revision_rawms_data[0][eff_date_rawms]"></td>
                                                            <td><input type="text" name="revision_rawms_data[0][rev_reason_rawms]"></td>
                                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                        </tr>
                                                    @endif
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <script>
                                        $(document).ready(function() {
                                            function updateSerialNumbers() {
                                                $('#table_rawsm_revision tbody tr').each(function(index) {
                                                    $(this).find('td:first-child input').val(index + 1); // Update Sr. No
                                                    $(this).find('td:nth-child(2) input').attr('name', `gtp[${index}][test_gtp]`);
                                                });
                                            }

                                            $('#Rawms_revision').click(function() {
                                                var serialNumber = $('#table_rawsm_revision tbody tr').length + 1; // Get the next serial number
                                                var newRow = `
                                                    <tr>
                                                        <td><input disabled type="text" style="width:40px; text-align:center;" value="${serialNumber}"></td>
                                                        <td><input type="text" name="revision_rawms_data[${serialNumber - 1}][rev_rawms_no]" value=""></td>
                                                        <td><input type="text" name="revision_rawms_data[${serialNumber - 1}][change_ctrl_rawms_no]" value=""></td>
                                                        <td><input type="date" name="revision_rawms_data[${serialNumber - 1}][eff_date_rawms]" value=""></td>
                                                        <td><input type="text" name="revision_rawms_data[${serialNumber - 1}][rev_reason_rawms]" value=""></td>
                                                        <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                    </tr>`;

                                                $('#table_rawsm_revision tbody').append(newRow);
                                            });

                                            // Remove row functionality
                                            $(document).on('click', '.removeRowBtn', function() {
                                                $(this).closest('tr').remove();
                                                updateSerialNumbers(); // Update serial numbers after removal
                                            });
                                        });
                                    </script>



                            </div>
                        </div>
                        <div class="button-block">
                            <button type="submit" value="save" name="submit" id="DocsaveButton"
                                class="saveButton">Save</button>
                            <button type="button" class="backButton" onclick="previousStep()">Back</button>
                            <button type="button" class="nextButton" id="DocnextButton"
                                onclick="nextStep()">Next</button>
                            <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                                </a>
                            </button>
                        </div>
                    </div>







  <!------------------------ PRODUCT / ITEM INFORMATION - ADDENDUM FOR SPECIFICATION ------------------------------------>
                <div id="doc_pias" class="tabcontent">
                    <div class="orig-head">
                    PRODUCT / ITEM INFORMATION - ADDENDUM FOR SPECIFICATION
                    </div>
                    <div class="input-fields">
                       <div class="row">

                            <div class="col-md-6">
                                <div class="group-input">
                                    <label for="packing_material_name">Product Name</label>
                                    <input type="text" name="pia_name" value="{{ old('pia_name', $document->pia_name ?? '') }}">
                                </div>
                            </div>


                            <div class="col-md-6">
                                    <div class="group-input">
                                        <label for="comments">Code</label>
                                        <select name="pia_name_code" id="">
                                            <option value="">Select here</option>
                                            <option value="FP" {{ old('pia_name_code', $supplierData->pia_name_code ?? '') == 'FP' ? 'selected' : '' }}>Finished Product</option>
                                            <option value="IP" {{ old('pia_name_code', $supplierData->pia_name_code ?? '') == 'IP' ? 'selected' : '' }}>Inprocess Product</option>
                                            <option value="CV" {{ old('pia_name_code', $supplierData->pia_name_code ?? '') == 'CV' ? 'selected' : '' }}>Cleaning Validation</option>
                                            <option value="RW" {{ old('pia_name_code', $supplierData->pia_name_code ?? '') == 'RW' ? 'selected' : '' }}>Raw Material</option>
                                            <option value="CM" {{ old('pia_name_code', $supplierData->pia_name_code ?? '') == 'CM' ? 'selected' : '' }}>Consumable</option>
                                        </select>
                                    </div>
                            </div>



                        @php
                            $serialNumber = 1;
                            $decodedProductData = isset($ProductSpecification->data) && is_string($ProductSpecification->data)
                                ? json_decode($ProductSpecification->data, true)
                                : (is_array($ProductSpecification->data) ? $ProductSpecification->data : []);
                        @endphp

                        <div class="group-input">
                            <label for="action-plan-grid">
                                For Finished Product Specification use below table
                                <button type="button" id="addRowBtndata">+</button>
                                <span class="text-primary" data-bs-toggle="modal" data-bs-target="#observation-field-instruction-modal"
                                    style="font-size: 0.8rem; font-weight: 400; cursor: pointer;">
                                    Row Increment
                                </span>
                            </label>
                            <div class="table-responsive">
                                <table class="table table-bordered" id="productDetailsTable">
                                    <thead>
                                        <tr>
                                            <th style="width: 2%">Sr.No</th>
                                            <th style="width: 2%">Product Code</th>
                                            <th style="width: 2%">FG Code</th>
                                            <th style="width: 2%">Country</th>
                                            <th style="width: 2%">Brand Name / Grade</th>
                                            <th style="width: 2%">Pack Size</th>
                                            <th style="width: 2%">Shelf Life</th>
                                            <th style="width: 2%">Sample Quantity</th>
                                            <th style="width: 2%">Storage Condition</th>
                                            <th style="width: 2%">Prepared by Quality Person (Sign/Date)</th>
                                            <th style="width: 2%">Checked by QC (HOD/Designee) (Sign/Date)</th>
                                            <th style="width: 2%">Approved by QA (HOD/Designee) (Sign/Date)</th>
                                            <th style="width: 3%">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @if(!empty($decodedProductData))
                                            @foreach($decodedProductData as $key => $product)
                                                <tr>
                                                    <td><input type="text" disabled value="{{ $serialNumber++ }}" style="width: 30px;"></td>
                                                    <td><input type="text" name="product[{{ $key }}][product_code]" value="{{ $product['product_code'] ?? '' }}"></td>
                                                    <td><input type="text" name="product[{{ $key }}][fg_code]" value="{{ $product['fg_code'] ?? '' }}"></td>
                                                    <td><input type="text" name="product[{{ $key }}][country]" value="{{ $product['country'] ?? '' }}"></td>
                                                    <td><input type="text" name="product[{{ $key }}][brand_name_grade]" value="{{ $product['brand_name_grade'] ?? '' }}"></td>
                                                    <td><input type="text" name="product[{{ $key }}][pack_size]" value="{{ $product['pack_size'] ?? '' }}"></td>
                                                    <td><input type="text" name="product[{{ $key }}][shelf_life]" value="{{ $product['shelf_life'] ?? '' }}"></td>
                                                    <td><input type="text" name="product[{{ $key }}][sample_quantity]" value="{{ $product['sample_quantity'] ?? '' }}"></td>
                                                    <td><input type="text" name="product[{{ $key }}][storage_condition]" value="{{ $product['storage_condition'] ?? '' }}"></td>
                                                    <td><input type="text" name="product[{{ $key }}][prepared_by_quality_person]" value="{{ $product['prepared_by_quality_person'] ?? '' }}"></td>
                                                    <td><input type="text" name="product[{{ $key }}][checked_by_qc_hod_designee]" value="{{ $product['checked_by_qc_hod_designee'] ?? '' }}"></td>
                                                    <td><input type="text" name="product[{{ $key }}][approved_by_qa_hod_designee]" value="{{ $product['approved_by_qa_hod_designee'] ?? '' }}"></td>
                                                    <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                </tr>
                                            @endforeach
                                        @else
                                            <tr>
                                                <td><input type="text" disabled value="1" style="width: 30px;"></td>
                                                <td><input type="text" name="product[0][product_code]"></td>
                                                <td><input type="text" name="product[0][fg_code]"></td>
                                                <td><input type="text" name="product[0][country]"></td>
                                                <td><input type="text" name="product[0][brand_name_grade]"></td>
                                                <td><input type="text" name="product[0][pack_size]"></td>
                                                <td><input type="text" name="product[0][shelf_life]"></td>
                                                <td><input type="text" name="product[0][sample_quantity]"></td>
                                                <td><input type="text" name="product[0][storage_condition]"></td>
                                                <td><input type="text" name="product[0][prepared_by_quality_person]"></td>
                                                <td><input type="text" name="product[0][checked_by_qc_hod_designee]"></td>
                                                <td><input type="text" name="product[0][approved_by_qa_hod_designee]"></td>
                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                            </tr>
                                        @endif
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <script>
                            $(document).ready(function () {
                                let investDetails = {{ isset($decodedProductData) ? count($decodedProductData) : 1 }};

                                $('#addRowBtndata').click(function () {
                                    let rowCount = $('#productDetailsTable tbody tr').length + 1;
                                    let newRow = `
                                        <tr>
                                            <td><input type="text" disabled value="${rowCount}" style="width: 30px;"></td>
                                            <td><input type="text" name="product[${investDetails}][product_code]"></td>
                                            <td><input type="text" name="product[${investDetails}][fg_code]"></td>
                                            <td><input type="text" name="product[${investDetails}][country]"></td>
                                            <td><input type="text" name="product[${investDetails}][brand_name_grade]"></td>
                                            <td><input type="text" name="product[${investDetails}][pack_size]"></td>
                                            <td><input type="text" name="product[${investDetails}][shelf_life]"></td>
                                            <td><input type="text" name="product[${investDetails}][sample_quantity]"></td>
                                            <td><input type="text" name="product[${investDetails}][storage_condition]"></td>
                                            <td><input type="text" name="product[${investDetails}][prepared_by_quality_person]"></td>
                                            <td><input type="text" name="product[${investDetails}][checked_by_qc_hod_designee]"></td>
                                            <td><input type="text" name="product[${investDetails}][approved_by_qa_hod_designee]"></td>
                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                        </tr>
                                    `;
                                    $('#productDetailsTable tbody').append(newRow);
                                    investDetails++;
                                });

                                $(document).on('click', '.removeRowBtn', function () {
                                    $(this).closest('tr').remove();
                                    updateRowNumbers();
                                });

                                function updateRowNumbers() {
                                    $('#productDetailsTable tbody tr').each(function(index) {
                                        $(this).find('td:first-child input').val(index + 1);
                                    });
                                }
                            });
                        </script>


                        @php
                            $serialNumber = 1;
                            $decodedMaterialData = isset($MaterialSpecification->data) && is_string($MaterialSpecification->data)
                                ? json_decode($MaterialSpecification->data, true)
                                : (is_array($MaterialSpecification->data) ? $MaterialSpecification->data : []);
                        @endphp

                        <div class="group-input">
                            <label for="action-plan-grid">
                                Raw Material Specification - Use the table below
                                <button type="button" id="RowMaterialData">+</button>
                                <span class="text-primary" data-bs-toggle="modal" data-bs-target="#observation-field-instruction-modal"
                                    style="font-size: 0.8rem; font-weight: 400; cursor: pointer;">
                                    Row Increment
                                </span>
                            </label>
                            <div class="table-responsive">
                                <table class="table table-bordered" id="RowMaterialTable">
                                    <thead>
                                        <tr>
                                            <th style="width: 2%">Sr.No</th>
                                            <th style="width: 2%">Item Code</th>
                                            <th style="width: 2%">Vendor Name</th>
                                            <th style="width: 2%">Grade</th>
                                            <th style="width: 2%">Sample Quantity</th>
                                            <th style="width: 2%">Storage Condition</th>
                                            <th style="width: 2%">Prepared by Quality Person (Sign/Date)</th>
                                            <th style="width: 2%">Checked by QC (HOD/Designee) (Sign/Date)</th>
                                            <th style="width: 2%">Approved by QA (HOD/Designee) (Sign/Date)</th>
                                            <th style="width: 3%">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @if(!empty($decodedMaterialData))
                                            @foreach($decodedMaterialData as $key => $material)
                                                <tr>
                                                    <td><input type="text" disabled value="{{ $serialNumber++ }}" style="width: 30px;"></td>
                                                    <td><input type="text" name="row_material[{{ $key }}][item_code]" value="{{ $material['item_code'] ?? '' }}"></td>
                                                    <td><input type="text" name="row_material[{{ $key }}][vendor_name]" value="{{ $material['vendor_name'] ?? '' }}"></td>
                                                    <td><input type="text" name="row_material[{{ $key }}][grade]" value="{{ $material['grade'] ?? '' }}"></td>
                                                    <td><input type="text" name="row_material[{{ $key }}][sample_quantity]" value="{{ $material['sample_quantity'] ?? '' }}"></td>
                                                    <td><input type="text" name="row_material[{{ $key }}][storage_condition]" value="{{ $material['storage_condition'] ?? '' }}"></td>
                                                    <td><input type="text" name="row_material[{{ $key }}][prepared_quality_person_sign_date]" value="{{ $material['prepared_quality_person_sign_date'] ?? '' }}"></td>
                                                    <td><input type="text" name="row_material[{{ $key }}][check_by_qc_hod_designee_sign]" value="{{ $material['check_by_qc_hod_designee_sign'] ?? '' }}"></td>
                                                    <td><input type="text" name="row_material[{{ $key }}][approved_by_qa_hod_desinee_sign]" value="{{ $material['approved_by_qa_hod_desinee_sign'] ?? '' }}"></td>
                                                    <td><button type="button" class="removeRowBtn">Remove</button></td>
                                                </tr>
                                            @endforeach
                                        @else
                                            <tr>
                                                <td><input type="text" disabled value="1" style="width: 30px;"></td>
                                                <td><input type="text" name="row_material[0][item_code]"></td>
                                                <td><input type="text" name="row_material[0][vendor_name]"></td>
                                                <td><input type="text" name="row_material[0][grade]"></td>
                                                <td><input type="text" name="row_material[0][sample_quantity]"></td>
                                                <td><input type="text" name="row_material[0][storage_condition]"></td>
                                                <td><input type="text" name="row_material[0][prepared_quality_person_sign_date]"></td>
                                                <td><input type="text" name="row_material[0][check_by_qc_hod_designee_sign]"></td>
                                                <td><input type="text" name="row_material[0][approved_by_qa_hod_desinee_sign]"></td>
                                                <td><button type="button" class="removeRowBtn">Remove</button></td>
                                            </tr>
                                        @endif
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <script>
                            $(document).ready(function () {
                                let investDetails = {{ isset($decodedMaterialData) ? count($decodedMaterialData) : 1 }};

                                $('#RowMaterialData').click(function () {
                                    let rowCount = $('#RowMaterialTable tbody tr').length + 1;
                                    let newRow = `
                                        <tr>
                                            <td><input type="text" disabled value="${rowCount}" style="width: 30px;"></td>
                                            <td><input type="text" name="row_material[${investDetails}][item_code]"></td>
                                            <td><input type="text" name="row_material[${investDetails}][vendor_name]"></td>
                                            <td><input type="text" name="row_material[${investDetails}][grade]"></td>
                                            <td><input type="text" name="row_material[${investDetails}][sample_quantity]"></td>
                                            <td><input type="text" name="row_material[${investDetails}][storage_condition]"></td>
                                            <td><input type="text" name="row_material[${investDetails}][prepared_quality_person_sign_date]"></td>
                                            <td><input type="text" name="row_material[${investDetails}][check_by_qc_hod_designee_sign]"></td>
                                            <td><input type="text" name="row_material[${investDetails}][approved_by_qa_hod_desinee_sign]"></td>
                                            <td><button type="button" class="removeRowBtn">Remove</button></td>
                                        </tr>
                                    `;
                                    $('#RowMaterialTable tbody').append(newRow);
                                    investDetails++;
                                });

                                $(document).on('click', '.removeRowBtn', function () {
                                    $(this).closest('tr').remove();
                                    updateRowNumbers();
                                });

                                function updateRowNumbers() {
                                    $('#RowMaterialTable tbody tr').each(function(index) {
                                        $(this).find('td:first-child input').val(index + 1);
                                    });
                                }
                            });
                        </script>



                        <div class="button-block">
                            <button type="submit" value="save" name="submit" class="saveButton">Save</button>
                            <button type="button" class="backButton" onclick="previousStep()">Back</button>
                            <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                            <button type="button"> <a href="{{ url('rcms/qms-dashboard') }}" class="text-white"> Exit
                             </a>
                            </button>
                        </div>
                    </div>
            </div>
        </div>



















                <div id="annexures" class="tabcontent">
                    <div class="d-flex justify-content-end">
                        <div>
                            <button data-bs-toggle="modal" data-bs-target="#annexure-modal" type="button"
                                class="btn btn-primary">Annexure Print</button>
                        </div>
                    </div>

                    <div class="input-fields">
                        @if ($document->document_content && !empty($document->document_content->annexuredata))
                            @foreach (unserialize($document->document_content->annexuredata) as $data)
                                <div class="group-input mb-3">
                                    <label>Annexure A-{{ $loop->index + 1 }}</label>
                                    <textarea class="summernote" name="annexuredata[]">{{ $data }}</textarea>
                                </div>
                            @endforeach
                        @else
                            @for ($i = 1; $i <= 20; $i++)
                                <div class="group-input mb-3">
                                    <label for="annexure-{{ $i }}">Annexure A-{{ $i }}</label>
                                    <textarea class="summernote" name="annexuredata[]" id="annexure-{{ $i }}"></textarea>
                                </div>
                            @endfor
                        @endif
                    </div>
                    <div class="button-block">
                        <button type="submit" name="submit" value="save" class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                    </div>
                </div>

                <div id="distribution-retrieval" class="tabcontent">
                    <div class="orig-head">
                        Distribution & Retrieval
                    </div>
                    {{-- <div class="col-md-12 input-fields">
                        <div class="group-input">

                            <label for="distribution" id="distribution">
                                Distribution & Retrieval<button type="button" id="distributionbtnadd" name="button">+</button>
                            </label>
                            <div><small class="text-primary">Please insert "NA" in the data field if it does not require completion</small></div>
                            @if (!empty($document->document_content->distribution))
                                @foreach (unserialize($document->document_content->distribution) as $data)
                                    <input type="text" name="distribution[]" class="myclassname"
                                        value="{{ $data }}">
                                            @endforeach
                                            @else
                                            <input type="text" name="distribution[]" class="myclassname">
                                            @endif

                                            <div id="distributiondiv"></div>
                                            @foreach ($history as $tempHistory)
                                            @if ($tempHistory->activity_type == 'distribution' && !empty($tempHistory->comment))
                                            @php
                                            $users_name = DB::table('users')
                                            ->where('id', $tempHistory->user_id)
                                            ->value('name');
                                            @endphp
                                            <p style="color: blue">Modify by {{ $users_name }} at
                                                {{ $tempHistory->created_at }}
                                            </p>
                                            <input class="input-field" style="background: #ffff0061;
                            color: black;" type="text" value="{{ $tempHistory->comment }}" disabled>
                                            @endif
                                            @endforeach




                                        </div>
                                        </div>

                                        @if (Auth::user()->role != 3 && $document->stage < 8) {{-- Add Comment
                        <div class="comment">
                            <div>
                                <p class="timestamp" style="color: blue">Modify by {{ Auth::user()->name }} at {{ date('d-M-Y h:i:s') }}</p>

                                            <input class="input-field" type="text" name="distribution_comment">
                                            </div>
                                            <div class="button">Add Comment</div>
                                            </div>
                                            @endif --}}
                    <div class="input-fields">
                        <div class="group-input">
                            <label for="distriution_retrieval">
                                Distribution & Retrieval
                                <button type="button" name="agenda"
                                    onclick="addDistributionRetrieval1('distribution-retrieval-grid')">+</button>
                            </label>
                            <div class="table-responsive retrieve-table">
                                <table class="table table-bordered" id="distribution-retrieval-grid">
                                    <thead>
                                        <tr>
                                            <th>Row </th>
                                            <th class="copy-name">Document Title</th>
                                            <th class="copy-name">Document Number</th>
                                            <th class="copy-name">Document Printed By</th>
                                            <th class="copy-name">Document Printed on</th>
                                            <th class="copy-num">Number of Print Copies</th>
                                            <th class="copy-name">Issuance Date</th>
                                            <th class="copy-name">Issued To </th>
                                            <th class="copy-long">Department/Location</th>
                                            <th class="copy-num">Number of Issued Copies</th>
                                            <th class="copy-long">Reason for Issuance</th>
                                            <th class="copy-name">Retrieval Date</th>
                                            <th class="copy-name">Retrieved By</th>
                                            <th class="copy-name">Retrieved Person Department</th>
                                            <th class="copy-num">Number of Retrieved Copies</th>
                                            <th class="copy-long">Reason for Retrieval</th>
                                            <th class="copy-long">Remarks</th>
                                            <th class="copy-long">Action</th>

                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach ($document_distribution_grid as $grid)
                                            <tr>
                                                <td>
                                                    {{ $loop->index + 1 }}
                                                    {{-- <input type="text" value="{{ $loop->index }}" name="distribution[{{ $loop->index }}][serial_number]"> --}}
                                                </td>
                                                <td><input type="text"
                                                    name="distribution[{{ $loop->index }}][document_title]"
                                                    value="{{ $document->document_name }}" readonly>
                                                </td>
                                                <td><input type="text"
                                                        name="distribution[{{ $loop->index }}][document_number]"
                                                        value="{{ $document->sop_type_short }}/{{ $document->department_id }}/{{ str_pad($document->id, 4, '0', STR_PAD_LEFT) }}/R{{ $document->major }}" readonly>
                                                </td>
                                                <td><input type="text" value="{{ $grid->document_printed_by }}"
                                                        name="distribution[{{ $loop->index }}][document_printed_by]">
                                                </td>
                                                <td><input type="text" value="{{ $grid->document_printed_on }}"
                                                        name="distribution[{{ $loop->index }}][document_printed_on]">
                                                </td>
                                                <td><input type="text" value="{{ $grid->document_printed_copies }}"
                                                        name="distribution[{{ $loop->index }}][document_printed_copies]">
                                                </td>
                                                <td>
                                                    <div
                                                        class="group-input new-date-document_distribution_grid-field mb-0">
                                                        <div class="input-date ">
                                                            <div class="calenderauditee">
                                                                <input type="text"
                                                                    id="issuance_date' + serialNumber +'" readonly
                                                                    placeholder="DD-MMM-YYYY"
                                                                    value="{{ $grid->issuance_date }}" />
                                                                <input type="date"
                                                                    name="distribution[{{ $loop->index }}][issuance_date]"
                                                                    class="hide-input"
                                                                    style="position: absolute; top: 0; left: 0; opacity: 0;"
                                                                    oninput="handleDateInput(this, `issuance_date' + serialNumber +'`)"
                                                                    value="{{ $grid->issuance_date }}" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>

                                                <td>
                                                    <select id="select-state" placeholder="Select..."
                                                        name="distribution[{{ $loop->index }}][issuance_to]">
                                                        <option value='0'
                                                            {{ $grid->issuance_to == '0' ? 'selected' : '' }}>-- Select --
                                                        </option>
                                                        @foreach ($users as $user)
                                                            <option value="{{ $user->id }}"
                                                                {{ $grid->issuance_to == $user->id ? 'selected' : '' }}>
                                                                {{ $user->name }}</option>
                                                        @endforeach
                                                    </select>
                                                </td>
                                                <td>
                                                    <select id="select-state" placeholder="Select..."
                                                        name="distribution[{{ $loop->index }}][location]">
                                                        <option value="0" {{ $grid->location == '0' ? 'selected' : '' }}>-- Select --</option>
                                                        @foreach (Helpers::getDmsDepartments() as $code => $department)
                                                            <option value="{{ $code }}" {{ $grid->location == $code ? 'selected' : '' }}>
                                                                {{ $department }}
                                                            </option>
                                                        @endforeach
                                                    </select>
                                                </td>
                                                <td><input type="text"
                                                        name="distribution[{{ $loop->index }}][issued_copies]"
                                                        value="{{ $grid->issued_copies }}">
                                                </td>
                                                <td><input type="text"
                                                        name="distribution[{{ $loop->index }}][issued_reason]"
                                                        value="{{ $grid->issued_reason }}">
                                                </td>
                                                <td>
                                                    <div class="group-input new-date-data-field mb-0">
                                                        <div class="input-date ">
                                                            <div class="calenderauditee">
                                                                <input type="text"
                                                                    id="retrieval_date' + serialNumber +'" readonly
                                                                    placeholder="DD-MMM-YYYY"
                                                                    value="{{ $grid->retrieval_date }}" />
                                                                <input type="date"
                                                                    name="distribution[{{ $loop->index }}][retrieval_date]"
                                                                    class="hide-input"
                                                                    oninput="handleDateInput(this, `retrieval_date' + serialNumber +'`)"
                                                                    value="{{ $grid->retrieval_date }}" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <select id="select-state" placeholder="Select..."
                                                        name="distribution[{{ $loop->index }}][retrieval_by]">
                                                        <option value=""
                                                            {{ $grid->retrieval_by == '' ? 'selected' : '' }}>Select a
                                                            value</option>
                                                        @foreach ($users as $user)
                                                            <option value="{{ $user->id }}"
                                                                {{ $grid->retrieval_by == $user->id ? 'selected' : '' }}>
                                                                {{ $user->name }}</option>
                                                        @endforeach
                                                    </select>
                                                </td>
                                                <td>
                                                    {{-- <select id="select-state" placeholder="Select..."
                                                        name="distribution[{{ $loop->index }}][retrieved_department]">
                                                        <option value='0'
                                                            {{ $grid->retrieved_department == '0' ? 'selected' : '' }}>--
                                                            Select --</option>
                                                        @foreach ($departments as $department)
                                                            <option value='{{ $department->id }}'
                                                                {{ $grid->retrieved_department == $department->id ? 'selected' : '' }}>
                                                                {{ $department->name }}
                                                            </option>
                                                        @endforeach
                                                    </select> --}}

                                                    <select id="select-state" placeholder="Select..."
                                                        name="distribution[{{ $loop->index }}][retrieved_department]">
                                                        <option value='0' {{ $grid->retrieved_department == '0' ? 'selected' : '' }}>--Select --</option>
                                                        @foreach (Helpers::getDmsDepartments() as $code => $department)
                                                            <option value="{{ $code }}" {{ $grid->retrieved_department == $code ? 'selected' : '' }}>
                                                                {{ $department }}
                                                            </option>
                                                        @endforeach
                                                    </select>
                                                </td>
                                                <td><input type="number"
                                                        name="distribution[{{ $loop->index }}][retrieved_copies]"
                                                        value="{{ $grid->retrieved_copies }}">
                                                </td>
                                                <td><input type="text"
                                                        name="distribution[{{ $loop->index }}][retrieved_reason]"
                                                        value="{{ $grid->retrieved_reason }}">
                                                </td>
                                                <td><input type="text"
                                                        name="distribution[{{ $loop->index }}][remark]"
                                                        value="{{ $grid->remark }}">
                                                </td>
                                                <td>
                                                    <button class='removeTrainRow'>Remove</button>
                                                </td>
                                            </tr>
                                        @endforeach
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>


                    {{-- <script>
                        function addDistributionRetrieval1(tableId) {
                            let table = document.getElementById(tableId);
                            let currentRowCount = table.rows.length; // Existing rows count including the header
                            let newRow = table.insertRow(currentRowCount); // Insert new row at the end

                            // Mock data for departments and users if not available
                            let departmentsData = @json(Helpers::getDmsDepartments()); // Use PHP helper

                            newRow.setAttribute("id", "row" + currentRowCount);

                            // Document details
                            let sopTypeShort = "{{ $document->sop_type_short }}";
                            let departmentId = "{{ $document->department_id }}";
                            let documentId = "{{ str_pad($document->id, 4, '0', STR_PAD_LEFT) }}";
                            let major = "{{ $document->major }}";

                            // Create cells for the new row
                            let cell1 = newRow.insertCell(0);
                            cell1.innerHTML = currentRowCount;

                            let cell2 = newRow.insertCell(1);
                            cell2.innerHTML = `<textarea style="overflow: hidden; border: none; width: 10rem;"
                            name="distribution[${currentRowCount}][document_title]" readonly>{{ $document->document_name }}</textarea>`;

                            let cell3 = newRow.insertCell(2);
                            cell3.innerHTML = `<textarea style="overflow: hidden; border: none; width: 6rem;"
                            name="distribution[${currentRowCount}][document_number]" readonly>
                            ${sopTypeShort}/${departmentId}/${documentId}/R${major}</textarea>`;

                            let cell4 = newRow.insertCell(3);
                            cell4.innerHTML = `<textarea style="overflow: hidden; border: none; width: 6rem;"
                            name="distribution[${currentRowCount}][document_printed_by]"></textarea>`;

                            let cell5 = newRow.insertCell(4);
                            cell5.innerHTML = `<textarea style="overflow: hidden; border: none; width: 6rem;"
                            name="distribution[${currentRowCount}][document_printed_on]"></textarea>`;

                            let cell6 = newRow.insertCell(5);
                            cell6.innerHTML = `<textarea style="overflow: hidden; border: none; width: 6rem;"
                            name="distribution[${currentRowCount}][document_printed_copies]"></textarea>`;

                            let cell7 = newRow.insertCell(6);
                            cell7.innerHTML = '<div class="group-input new-date-data-field mb-0"> <div class="input-date "><div class="calenderauditee"><input style="width: 6rem;" type="text" id="issuance_date' + currentRowCount +'" readonly placeholder="DD-MMM-YYYY" /><input style="width:4rem" type="date" name="distribution['+ currentRowCount +'][issuance_date]" class="hide-input" oninput="handleDateInput(this, `issuance_date' + currentRowCount +'`)" /></div></div></div>';

                            let cell8 = newRow.insertCell(7);
                            cell8.innerHTML = `<select style="width: 6rem;" name="distribution[${currentRowCount}][issuance_to]">
                            <option value='0'>-- Select --</option>
                            ${users.map(user => `<option value="${user.id}">${user.name}</option>`).join('')}
                            </select>`;

                            let cell9 = newRow.insertCell(8);
                            cell9.innerHTML = `<select style="width: 6rem;" name="distribution[${currentRowCount}][location]">
                            <option value="0">-- Select --</option>
                            ${Object.entries(departmentsData).map(([code, name]) =>
                                `<option value="${code}">${name}</option>`).join('')}
                            </select>`;

                            let cell10 = newRow.insertCell(9);
                            cell10.innerHTML = `<textarea style="overflow: hidden;
                            border: none; width: 6rem;" type="text" name="distribution[${currentRowCount}][issued_copies]"></textarea>`;

                            let cell11 = newRow.insertCell(10);
                            cell11.innerHTML = `<textarea style="overflow: hidden;
                            border: none; width: 6rem;" type="text" name="distribution[${currentRowCount}][issued_reason]"></textarea>`;

                            let cell12 = newRow.insertCell(11);
                            cell12.innerHTML = '<div class="group-input new-date-data-field mb-0"><div class="input-date "><div class="calenderauditee"><input style=" width: 6rem;" type="text" id="retrieval_date' + currentRowCount +'" readonly placeholder="DD-MMM-YYYY" /><input style=" width: 4rem;" type="date" name="distribution['+currentRowCount+'][retrieval_date]" class="hide-input" oninput="handleDateInput(this, `retrieval_date' + currentRowCount +'`)" /></div></div></div>';

                            let cell13 = newRow.insertCell(12);
                            cell13.innerHTML = `<select style="
                            width: 6rem;" id="select-state" placeholder="Select..."
                                name="distribution[${currentRowCount}][retrieval_by]">
                                <option value='0'>-- Select --</option>
                                ${users.map(user => `<option value="${user.id}">${user.name}</option>`).join('')}
                            </select>`;

                            let cell14 = newRow.insertCell(13);
                            cell14.innerHTML = `
                                <select style="width: 6rem;" id="select-state" placeholder="Select..."
                                    name="distribution[${currentRowCount}][retrieved_department]">
                                    <option value="0" ${savedRetrival === "0" ? "selected" : ""}>-- Select --</option>
                                    ${Object.entries(departmentsData).map(([code, name]) =>
                                        `<option value="${code}" ${savedRetrival === code ? "selected" : ""}>${name}</option>`
                                    ).join('')}
                                </select>
                            `;

                            let cell15 = newRow.insertCell(14);
                            cell15.innerHTML = `<textarea style="overflow: hidden;
                            border: none; width: 6rem;" type="text" name="distribution[${currentRowCount}][retrieved_copies]"></textarea>`;

                            let cell16 = newRow.insertCell(15);
                            cell16.innerHTML = `<textarea style="overflow: hidden;
                            border: none; width: 6rem;" type="text" name="distribution[${currentRowCount}][retrieved_reason]"></textarea>`;

                            let cell17 = newRow.insertCell(16);
                            cell17.innerHTML = `<textarea style="overflow: hidden; border: none; width: 6rem;"
                            name="distribution[${currentRowCount}][remark]"></textarea>`;

                            let cell18 = newRow.insertCell(17);
                            cell18.innerHTML = `<button class='removeTrainRow' onclick="removeRow(this)">Remove</button>`;
                        }

                        function removeRow(button) {
                            let row = button.parentNode.parentNode;
                            row.parentNode.removeChild(row);
                        }
                    </script> --}}

                    <script>
                        function addDistributionRetrieval1(tableId) {
                            let table = document.getElementById(tableId);
                            let currentRowCount = table.rows.length; // Including the header
                            let newRow = table.insertRow(currentRowCount); // Insert a new row

                            // Fetch PHP data and escape properly
                            let departmentsData = @json(Helpers::getDmsDepartments());
                            let users = @json($users); // Assuming you pass users as a variable

                            // Document details
                            let sopTypeShort = "{{ $document->sop_type_short }}";
                            let departmentId = "{{ $document->department_id }}";
                            let documentId = "{{ str_pad($document->id, 4, '0', STR_PAD_LEFT) }}";
                            let major = "{{ $document->major }}";
                            let documentName = "{{ $document->document_name }}";

                            newRow.setAttribute("id", "row" + currentRowCount);

                            // Create and populate cells
                            newRow.innerHTML = `
                                <td>${currentRowCount}</td>
                                <td><textarea style="overflow: hidden; border: none; width: 10rem;"
                                    name="distribution[${currentRowCount}][document_title]" readonly>${documentName}</textarea></td>
                                <td><textarea style="overflow: hidden; border: none; width: 6rem;"
                                    name="distribution[${currentRowCount}][document_number]" readonly>${sopTypeShort}/${departmentId}/${documentId}/R${major}</textarea></td>
                                <td><textarea style="overflow: hidden; border: none; width: 6rem;"
                                    name="distribution[${currentRowCount}][document_printed_by]"></textarea></td>
                                <td><textarea style="overflow: hidden; border: none; width: 6rem;"
                                    name="distribution[${currentRowCount}][document_printed_on]"></textarea></td>
                                <td><textarea style="overflow: hidden; border: none; width: 6rem;"
                                    name="distribution[${currentRowCount}][document_printed_copies]"></textarea></td>
                                <td>
                                    <div class="group-input new-date-data-field mb-0">
                                        <div class="input-date">
                                            <div class="calenderauditee">
                                                <input style="width: 6rem;" type="text" id="issuance_date${currentRowCount}" readonly placeholder="DD-MMM-YYYY" />
                                                <input style="width:4rem" type="date" name="distribution[${currentRowCount}][issuance_date]"
                                                    class="hide-input" oninput="handleDateInput(this, 'issuance_date${currentRowCount}')">
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <select style="width: 6rem;" name="distribution[${currentRowCount}][issuance_to]">
                                        <option value="0">-- Select --</option>
                                        ${users.map(user => `<option value="${user.id}">${user.name}</option>`).join('')}
                                    </select>
                                </td>
                                <td>
                                    <select style="width: 6rem;" name="distribution[${currentRowCount}][location]">
                                        <option value="0">-- Select --</option>
                                        ${Object.entries(departmentsData).map(([code, name]) =>
                                            `<option value="${code}">${name}</option>`).join('')}
                                    </select>
                                </td>
                                <td><input type="number" style="overflow: hidden; border: none; width: 6rem;"
                                    name="distribution[${currentRowCount}][issued_copies]"></td>
                                <td><textarea style="overflow: hidden; border: none; width: 6rem;"
                                    name="distribution[${currentRowCount}][issued_reason]"></textarea></td>
                                <td>
                                    <div class="group-input new-date-data-field mb-0">
                                        <div class="input-date">
                                            <div class="calenderauditee">
                                                <input style="width: 6rem;" type="text" id="retrieval_date${currentRowCount}" readonly placeholder="DD-MMM-YYYY" />
                                                <input style="width: 4rem;" type="date" name="distribution[${currentRowCount}][retrieval_date]"
                                                    class="hide-input" oninput="handleDateInput(this, 'retrieval_date${currentRowCount}')">
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <select style="width: 6rem;" name="distribution[${currentRowCount}][retrieval_by]">
                                        <option value="0">-- Select --</option>
                                        ${users.map(user => `<option value="${user.id}">${user.name}</option>`).join('')}
                                    </select>
                                </td>
                                <td>
                                    <select style="width: 6rem;" name="distribution[${currentRowCount}][retrieved_department]">
                                        <option value="0">-- Select --</option>
                                        ${Object.entries(departmentsData).map(([code, name]) =>
                                            `<option value="${code}">${name}</option>`).join('')}
                                    </select>
                                </td>
                                <td><input type="number" style="overflow: hidden; border: none; width: 6rem;"
                                    name="distribution[${currentRowCount}][retrieved_copies]"></td>
                                <td><textarea style="overflow: hidden; border: none; width: 6rem;"
                                    name="distribution[${currentRowCount}][retrieved_reason]"></textarea></td>
                                <td><textarea style="overflow: hidden; border: none; width: 6rem;"
                                    name="distribution[${currentRowCount}][remark]"></textarea></td>
                                <td><button class="removeTrainRow" onclick="removeRow(this)">Remove</button></td>
                            `;
                        }

                        function removeRow(button) {
                            let row = button.parentNode.parentNode;
                            row.parentNode.removeChild(row);
                        }
                    </script>



                    <div class="button-block">
                        <button type="submit" name="submit" value="save" class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                    </div>
                </div>

                {{-- <div id="print-download" class="tabcontent">
                    <div class="orig-head">
                        Print Permissions
                    </div>
                    <div class="input-fields">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="person-print">Person Print Permission</label>
                                    <select id="choices-multiple-remove-button" placeholder="Select Persons" multiple>
                                        <option value="HTML">HTML</option>
                                        <option value="Jquery">Jquery</option>
                                        <option value="CSS">CSS</option>
                                        <option value="Bootstrap 3">Bootstrap 3</option>
                                        <option value="Bootstrap 4">Bootstrap 4</option>
                                        <option value="Java">Java</option>
                                        <option value="Javascript">Javascript</option>
                                        <option value="Angular">Angular</option>
                                        <option value="Python">Python</option>
                                        <option value="Hybris">Hybris</option>
                                        <option value="SQL">SQL</option>
                                        <option value="NOSQL">NOSQL</option>
                                        <option value="NodeJS">NodeJS</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="group-input">
                                    <table class="table-bordered table">
                                        <thead>
                                            <th class="person">Person</th>
                                            <th class="permission">Daily</th>
                                            <th class="permission">Weekly</th>
                                            <th class="permission">Monthly</th>
                                            <th class="permission">Quarterly</th>
                                            <th class="permission">Annually</th>
                                        </thead>
                                        <tbody>
                                            <td class="person">
                                                Amit Patel
                                            </td>
                                            <td class="permission">
                                                6543
                                            </td>
                                            <td class="permission">
                                                6543
                                            </td>
                                            <td class="permission">
                                                6543
                                            </td>
                                            <td class="permission">
                                                432
                                            </td>
                                            <td class="permission">
                                                123
                                            </td>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="group-print">Group Print Permission</label>
                                    <select id="choices-multiple-remove-button" placeholder="Select Persons" multiple>
                                        <option value="HTML">HTML</option>
                                        <option value="Jquery">Jquery</option>
                                        <option value="CSS">CSS</option>
                                        <option value="Bootstrap 3">Bootstrap 3</option>
                                        <option value="Bootstrap 4">Bootstrap 4</option>
                                        <option value="Java">Java</option>
                                        <option value="Javascript">Javascript</option>
                                        <option value="Angular">Angular</option>
                                        <option value="Python">Python</option>
                                        <option value="Hybris">Hybris</option>
                                        <option value="SQL">SQL</option>
                                        <option value="NOSQL">NOSQL</option>
                                        <option value="NodeJS">NodeJS</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="group-input">
                                    <table class="table-bordered table">
                                        <thead>
                                            <th class="person">Groupd</th>
                                            <th class="permission">Daily</th>
                                            <th class="permission">Weekly</th>
                                            <th class="permission">Monthly</th>
                                            <th class="permission">Quarterly</th>
                                            <th class="permission">Annually</th>
                                        </thead>
                                        <tbody>
                                            <td class="person">
                                                QA
                                            </td>
                                            <td class="permission">1</td>
                                            <td class="permission">
                                                54
                                            </td>
                                            <td class="permission">
                                                654
                                            </td>
                                            <td class="permission">
                                                765
                                            </td>
                                            <td class="permission">
                                                654
                                            </td>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="orig-head">
                        Download Permissions
                    </div>
                    <div class="input-fields">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="person-print">Person Download Permission</label>
                                    <select id="choices-multiple-remove-button" placeholder="Select Persons" multiple>
                                        <option value="HTML">HTML</option>
                                        <option value="Jquery">Jquery</option>
                                        <option value="CSS">CSS</option>
                                        <option value="Bootstrap 3">Bootstrap 3</option>
                                        <option value="Bootstrap 4">Bootstrap 4</option>
                                        <option value="Java">Java</option>
                                        <option value="Javascript">Javascript</option>
                                        <option value="Angular">Angular</option>
                                        <option value="Python">Python</option>
                                        <option value="Hybris">Hybris</option>
                                        <option value="SQL">SQL</option>
                                        <option value="NOSQL">NOSQL</option>
                                        <option value="NodeJS">NodeJS</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="group-input">
                                    <table class="table-bordered table">
                                        <thead>
                                            <th class="person">Groups</th>
                                            <th class="permission">Daily</th>
                                            <th class="permission">Weekly</th>
                                            <th class="permission">Monthly</th>
                                            <th class="permission">Quarterly</th>
                                            <th class="permission">Annually</th>
                                        </thead>
                                        <tbody>
                                            <td class="person">
                                                QA
                                            </td>
                                            <td class="permission">1</td>
                                            <td class="permission">
                                                54
                                            </td>
                                            <td class="permission">
                                                654
                                            </td>
                                            <td class="permission">
                                                765
                                            </td>
                                            <td class="permission">
                                                654
                                            </td>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="group-input">
                                    <label for="group-print">Group Download Permission</label>
                                    <select id="choices-multiple-remove-button" placeholder="Select Persons" multiple>
                                        <option value="HTML">HTML</option>
                                        <option value="Jquery">Jquery</option>
                                        <option value="CSS">CSS</option>
                                        <option value="Bootstrap 3">Bootstrap 3</option>
                                        <option value="Bootstrap 4">Bootstrap 4</option>
                                        <option value="Java">Java</option>
                                        <option value="Javascript">Javascript</option>
                                        <option value="Angular">Angular</option>
                                        <option value="Python">Python</option>
                                        <option value="Hybris">Hybris</option>
                                        <option value="SQL">SQL</option>
                                        <option value="NOSQL">NOSQL</option>
                                        <option value="NodeJS">NodeJS</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="group-input">
                                    <table class="table-bordered table">
                                        <thead>
                                            <th class="person">Person</th>
                                            <th class="permission">Daily</th>
                                            <th class="permission">Weekly</th>
                                            <th class="permission">Monthly</th>
                                            <th class="permission">Quarterly</th>
                                            <th class="permission">Annually</th>
                                        </thead>
                                        <tbody>
                                            <td class="person">
                                                Amit Patel
                                            </td>
                                            <td class="permission">1</td>
                                            <td class="permission">
                                                54
                                            </td>
                                            <td class="permission">
                                                654
                                            </td>
                                            <td class="permission">
                                                765
                                            </td>
                                            <td class="permission">
                                                654
                                            </td>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="button-block">
                        <button type="submit" name="submit" value="save" class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="button" class="nextButton" onclick="nextStep()">Next</button>
                    </div>
                </div> --}}

                <div id="sign" class="tabcontent">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="review-names">
                                <div class="orig-head">
                                    Originated By
                                </div>
                                @php
                                    $inreview = DB::table('stage_manages')
                                        ->join('users', 'stage_manages.user_id', '=', 'users.id')
                                        ->select('stage_manages.*', 'users.name as user_name')
                                        ->where('document_id', $document->id)
                                        ->where('stage', 'In-Review')
                                        ->get();

                                @endphp
                                <div class="name">{{ $document->originator ? $document->originator->name : 'null' }}
                                </div>

                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="review-names">
                                <div class="orig-head">
                                    Originated On
                                </div>
                                <div class="name">{{ $document->created_at }}</div>
                            </div>

                        </div>

                        {{-- <div class="col-md-6">
                            <div class="review-names">
                                <div class="orig-head">
                                    Originated On
                                </div>
                                @php
                                    $inreview = DB::table('stage_manages')
                                        ->join('users', 'stage_manages.user_id', '=', 'users.id')
                                        ->select('stage_manages.*', 'users.name as user_name')
                                        ->where('document_id', $document->id)
                                        ->where('stage', 'In-Approval')
                                        ->where('deleted_at', null)
                                        ->get();

                                @endphp
                                @foreach ($inreview as $temp)
                                    <div class="name">{{ $temp->user_name }}
                                                </div>

                                            </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="review-names">
                                                    <div class="orig-head">
                                                        Document Reuqest Approved On
                                                    </div>
                                                    <div class="name">{{ $temp->created_at }}</div>
                                                    @endforeach
                                                </div>
                                            </div> --}}
                        {{-- <div class="col-md-6">
                            <div class="review-names">
                                <div class="orig-head">
                                    Document Writing Completed By
                                </div>
                                @php
                                    $inreview = DB::table('stage_manages')
                                        ->join('users', 'stage_manages.user_id', '=', 'users.id')
                                        ->select('stage_manages.*', 'users.name as user_name')
                                        ->where('document_id', $document->id)
                                        ->where('stage', 'In-Approval')
                                        ->get();

                                @endphp
                                @foreach ($inreview as $temp)
                                    <div class="name">{{ $temp->user_name }}</div>

                                            </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="review-names">
                                                    <div class="orig-head">
                                                        Document Writing Completed On
                                                    </div>
                                                    <div class="name">{{ $temp->created_at }}</div>
                                                    @endforeach
                                                </div>
                                            </div> --}}
                        <div class="col-md-6">
                            <div class="review-names">
                                <div class="orig-head">
                                    HOD Review By
                                </div>
                                @php
                                    $inhodreview = DB::table('stage_manages')
                                        ->join('users', 'stage_manages.user_id', '=', 'users.id')
                                        ->select('stage_manages.*', 'users.name as user_name')
                                        ->where('document_id', $document->id)
                                        ->where('stage', 'HOD Review-Submit')
                                        ->where('deleted_at', null)
                                        ->get();

                                @endphp
                                @foreach ($inhodreview as $temp)
                                    <div class="name">{{ $temp->user_name }}</div>
                                @endforeach

                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="review-names">
                                <div class="orig-head">
                                    HOD Reviewed On
                                </div>
                                @foreach ($inhodreview as $temp)
                                    <div class="name">{{ $temp->created_at }}</div>
                                @endforeach
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="review-names">
                                <div class="orig-head">
                                    Reviewd By
                                </div>
                                @php
                                    $inreview = DB::table('stage_manages')
                                        ->join('users', 'stage_manages.user_id', '=', 'users.id')
                                        ->select('stage_manages.*', 'users.name as user_name')
                                        ->where('document_id', $document->id)
                                        ->where('stage', 'Review-Submit')
                                        ->where('deleted_at', null)
                                        ->get();

                                @endphp
                                @foreach ($inreview as $temp)
                                    <div class="name">{{ $temp->user_name }}</div>
                                @endforeach

                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="review-names">
                                <div class="orig-head">
                                    Reviewed On
                                </div>
                                @foreach ($inreview as $temp)
                                    <div class="name">{{ $temp->created_at }}</div>
                                @endforeach
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="review-names">
                                <div class="orig-head">
                                    Approved By
                                </div>
                                @php
                                    $inreview = DB::table('stage_manages')
                                        ->join('users', 'stage_manages.user_id', '=', 'users.id')
                                        ->select('stage_manages.*', 'users.name as user_name')
                                        ->where('document_id', $document->id)
                                        ->where('stage', 'Approval-Submit')
                                        ->where('deleted_at', null)
                                        ->get();

                                @endphp
                                @foreach ($inreview as $temp)
                                    <div class="name">{{ $temp->user_name }}</div>
                                @endforeach

                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="review-names">
                                <div class="orig-head">
                                    Approved On
                                </div>
                                @foreach ($inreview as $temp)
                                    <div class="name">{{ $temp->created_at }}</div>
                                @endforeach
                            </div>
                        </div>
                        {{-- <div class="col-md-6">
                            <div class="review-names">
                                <div class="orig-head">
                                    Training Completed By
                                </div>
                                <div class="name">Amit Patel</div>
                                <div class="name">Amit Patel</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="review-names">
                                <div class="orig-head">
                                    Training Completed On
                                </div>
                                <div class="name">29-12-2023 11:12PM</div>
                                <div class="name">29-12-2023 11:12PM</div>
                            </div>
                        </div> --}}
                    </div>
                    <div class="button-block">
                        <button type="submit" name="submit" value="save" class="saveButton">Save</button>
                        <button type="button" class="backButton" onclick="previousStep()">Back</button>
                        <button type="submit">Submit</button>
                    </div>
                </div>

                @if ($document->stage < 8) {{-- <div class="form-btn-bar">
                        <div class="container-fluid header-bottom bottom-pr-links">
                            <div class="container">
                                <div class="bottom-links">
                                    <div>
                                        <button type="submit" name="submit" value="save">Save</button>
                                    </div>
                                    <div>
                                        <a href="{{ route('documents.index') }}"> <button type="submit">Cancel</button></a>
                                                </div>
                                                </div>
                                                </div>
                                                </div>
                                                </div> --}}
                @endif

            </form>
        </div>
    </div>


    <style>
        #step-form>div {
            display: none
        }

        #step-form>div:nth-child(1) {
            display: block;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const removeButtons = document.querySelectorAll('.remove-file');

            removeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const fileName = this.getAttribute('data-file-name');
                    const fileContainer = this.closest('.file-container');

                    // Hide the file container
                    if (fileContainer) {
                        fileContainer.remove()
                    }
                });
            });
        });
    </script>

    <div class="modal fade" id="annexure-modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Annexure Print</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form action="{{ url('printPDFAnx', $document->id) }}" method="GET" target="_blank">
                    @csrf
                    <!-- Modal body -->
                    <div class="modal-body">
                        @for ($i = 1; $i <= 20; $i++)
                            <a href='{{ route('document.print.annexure', ['document' => $document->id, 'annexure' => $i]) }}'
                                target="_blank">Print Annexure A-{{ $i }}</a> <br>
                        @endfor
                    </div>

                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary rounded">Submit</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        var editor = new FroalaEditor('.summernote', {
            key: "uXD2lC7C4B4D4D4J4B11dNSWXf1h1MDb1CF1PLPFf1C1EESFKVlA3C11A8D7D2B4B4G2D3J3==",
            imageUploadParam: 'image_param',
            imageUploadMethod: 'POST',
            imageMaxSize: 20 * 1024 * 1024,
            imageUploadURL: "{{ route('api.upload.file') }}",
            fileUploadParam: 'image_param',
            fileUploadURL: "{{ route('api.upload.file') }}",
            videoUploadParam: 'image_param',
            videoUploadURL: "{{ route('api.upload.file') }}",
            videoMaxSize: 500 * 1024 * 1024,
        });


        $(".summernote-disabled").FroalaEditor("edit.off");
    </script>
    <script>
        VirtualSelect.init({
            ele: '#reference_record,#parent_child, #notify_to'
        });

        $('#summernote').summernote({
            toolbar: [
                ['style', ['style']],
                ['font', ['bold', 'underline', 'clear', 'italic']],
                ['color', ['color']],
                ['para', ['ul', 'ol', 'paragraph']],
                ['table', ['table']],
                ['insert', ['link', 'picture', 'video']],
                ['view', ['fullscreen', 'codeview', 'help']]
            ]
        });
    </script>

    <script>
        $(document).ready(function() {
            $('#addButton').click(function() {
                var sourceValue = $('#sourceField').val()
                    .trim(); // Get the trimmed value from the source field
                if (!sourceValue) return; // Prevent adding empty values

                // Create a new list item with the source value and a close icon
                var newItem = $('<li>', {
                    class: 'd-flex justify-content-between align-items-center'
                }).text(sourceValue);
                var closeButton = $('<span>', {
                    text: '×',
                    class: 'close-icon ms-2' // Bootstrap class for margin-left spacing
                }).appendTo(newItem);

                // Append the new list item to the display field
                $('#displayField').append(newItem);

                // Create a corresponding option in the hidden select
                var newOption = $('<option>', {
                    value: sourceValue,
                    text: sourceValue,
                    selected: 'selected'
                }).appendTo('#keywords');

                // Clear the input field
                $('#sourceField').val('');

                // Add click event for the close icon
                closeButton.on('click', function() {
                    var thisValue = $(this).parent().text().slice(0, -
                        1); // Remove the '×' from the value
                    $(this).parent().remove(); // Remove the parent list item on click
                    $('#keywords option').filter(function() {
                        return $(this).val() === thisValue;
                    }).remove(); // Also remove the corresponding option from the select
                });
            });

            $(document).on('click', '.close-icon', function() {
                var thisValue = $(this).parent().text().trim().slice(0, -1)
                    .trim(); // Remove the '×' from the value
                $(this).closest('li').remove();
                $('#keywords option').filter(function() {
                    return $(this).text().trim() === thisValue;
                }).remove()
            })
        });
    </script>

    <script>
        function openData(evt, cityName) {
            var i, cctabcontent, cctablinks;
            cctabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < cctabcontent.length; i++) {
                cctabcontent[i].style.display = "none";
            }
            cctablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < cctablinks.length; i++) {
                cctablinks[i].className = cctablinks[i].className.replace(" active", "");
            }
            document.getElementById(cityName).style.display = "block";
            evt.currentTarget.className += " active";

            // Find the index of the clicked tab button
            const index = Array.from(cctablinks).findIndex(button => button === evt.currentTarget);

            // Update the currentStep to the index of the clicked tab
            currentStep = index;
        }

        $('.add-hod-attachment-btn').click(function() {
            $('.add-hod-attachment-file').trigger('click');
        });

        const saveButtons = document.querySelectorAll(".saveButton");
        const nextButtons = document.querySelectorAll(".nextButton");
        const form = document.getElementById("step-form");
        const stepButtons = document.querySelectorAll(".tablinks");
        const steps = document.querySelectorAll(".tabcontent");
        let currentStep = 0;

        function nextStep() {
            // Check if there is a next step
            if (currentStep < steps.length - 1) {
                // Hide current step
                steps[currentStep].style.display = "none";

                // Show next step
                steps[currentStep + 1].style.display = "block";

                // Add active class to next button
                stepButtons[currentStep + 1].classList.add("active");

                // Remove active class from current button
                stepButtons[currentStep].classList.remove("active");

                // Update current step
                currentStep++;
            }
        }

        function previousStep() {
            // Check if there is a previous step
            if (currentStep > 0) {
                // Hide current step
                steps[currentStep].style.display = "none";

                // Show previous step
                steps[currentStep - 1].style.display = "block";

                // Add active class to previous button
                stepButtons[currentStep - 1].classList.add("active");

                // Remove active class from current button
                stepButtons[currentStep].classList.remove("active");

                // Update current step
                currentStep--;
            }
        }
    </script>
@endsection
